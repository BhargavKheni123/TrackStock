@model eTurns.DTO.OrderMasterDTO
@{
    GridHeaderSettings settings = new GridHeaderSettings() { dataViewType = DataViewType.None, DisplaySaveButton = false, DisplayUDFButton = false, UDFSetupFor = "", DisplaySettings = true, DisplayColumnSetupButton = false, DisplayContextMenu = false, DisplayPrintBlock = false, DisplayDeleteButton = false, ColumnSetupFor = "ReceivedItemDetailGrid", ShowSelectAll = true, DataTableName = "RecieveOrderLineItem" + Model.ID };
    string priceformate = "N" + eTurnsWeb.Helper.SessionHelper.CurrencyDecimalDigits;
    string quantityFormat = "N" + eTurnsWeb.Helper.SessionHelper.NumberDecimalDigits;
    bool isCost = eTurnsWeb.Helper.SessionHelper.GetAdminPermission(eTurnsWeb.Helper.SessionHelper.ModuleList.HideCostMarkUpSellPrice);
    bool HasOnTheFlyEntryRight = eTurnsWeb.Helper.SessionHelper.GetAdminPermission(eTurnsWeb.Helper.SessionHelper.ModuleList.OnTheFlyEntry);
    List<BinMasterDTO> lstBinMaster;
    bool isUpdate = false;
    bool isInsert = false;
    isUpdate = eTurnsWeb.Helper.SessionHelper.GetModulePermission(eTurnsWeb.Helper.SessionHelper.ModuleList.Receive, eTurnsWeb.Helper.SessionHelper.PermissionType.Update);
    isInsert = eTurnsWeb.Helper.SessionHelper.GetModulePermission(eTurnsWeb.Helper.SessionHelper.ModuleList.Receive, eTurnsWeb.Helper.SessionHelper.PermissionType.Insert);
    eTurns.DAL.RegionSettingDAL objRegionSettingDAL = new eTurns.DAL.RegionSettingDAL(eTurnsWeb.Helper.SessionHelper.EnterPriseDBName);
    bool isUnclose = eTurnsWeb.Helper.SessionHelper.GetAdminPermission(eTurnsWeb.Helper.SessionHelper.ModuleList.AllowAnOrderToBeUnclose);
    bool isOrderDetailsUDF = new eTurns.DAL.UDFDAL(eTurnsWeb.Helper.SessionHelper.EnterPriseDBName).GetNonDeletedUDFCountByUDFTableName("OrderDetails", eTurnsWeb.Helper.SessionHelper.RoomID, eTurnsWeb.Helper.SessionHelper.CompanyID) > 0;
    string CurrencySymbol = "";
    if (eTurnsWeb.Helper.SessionHelper.CurrencySymbol != null
        && !string.IsNullOrWhiteSpace(eTurnsWeb.Helper.SessionHelper.CurrencySymbol))
    {
        CurrencySymbol = Convert.ToString(eTurnsWeb.Helper.SessionHelper.CurrencySymbol);
    }
    //---------------------------------Calculate Total---------------------------------
    //
    int? PriseSelectionOption = 0;
    string TotalCost = "0.00";
    string TotalPrice = "0.00";

    bool isShowDeleted = ViewBag.IsShowDeleted ?? false;
    string ReceiveAllowedFileExtension = eTurns.DTO.SiteSettingHelper.ReceiveAllowedFileExtension;
    eTurns.DAL.RoomDAL onjRoomDAL = new eTurns.DAL.RoomDAL(eTurnsWeb.Helper.SessionHelper.EnterPriseDBName);
    RoomModuleSettingsDTO objRoomModuleSettingsDTO = onjRoomDAL.GetRoomModuleSettings(eTurnsWeb.Helper.SessionHelper.CompanyID, eTurnsWeb.Helper.SessionHelper.RoomID, (long)eTurnsWeb.Helper.SessionHelper.ModuleList.Orders);
    if (objRoomModuleSettingsDTO != null)
    {
        PriseSelectionOption = objRoomModuleSettingsDTO.PriseSelectionOption;
    }

    if (PriseSelectionOption != 1 && PriseSelectionOption != 2)
    {
        PriseSelectionOption = 1;
    }

    if (isShowDeleted == false)
    {
        if (Model.OrderListItem.Count > 0)
        {
            //double? T = null;
            //if (PriseSelectionOption == 1)
            //{
            //    T = Model.OrderListItem.Sum(x => (x.ApprovedQuantity.GetValueOrDefault(0) > 0 ? x.ApprovedQuantity : (x.RequestedQuantity.GetValueOrDefault(0) > 0 ? x.RequestedQuantity : 0)) * (x.SellPrice == null ? 0 : x.SellPrice) / (x.CostUOMValue == null || x.CostUOMValue == 0 ? 1 : x.CostUOMValue));
            //}
            //else
            //{
            //    T = Model.OrderListItem.Sum(x => (x.ApprovedQuantity.GetValueOrDefault(0) > 0 ? x.ApprovedQuantity : (x.RequestedQuantity.GetValueOrDefault(0) > 0 ? x.RequestedQuantity : 0)) * (x.Cost == null ? 0 : x.Cost) / (x.CostUOMValue == null || x.CostUOMValue == 0 ? 1 : x.CostUOMValue));
            //}

            //if (T != null)
            //{
            //    TotalCost = ((double)T).ToString(priceformate);
            //}

            if (Model.OrderCost != null && (double)Model.OrderCost > 0)
            {
                TotalCost = ((double)Model.OrderCost).ToString(priceformate, eTurnsWeb.Helper.SessionHelper.RoomCulture);
            }
            if (Model.OrderPrice != null && (double)Model.OrderPrice > 0)
            {
                TotalPrice = ((double)Model.OrderPrice).ToString(priceformate, eTurnsWeb.Helper.SessionHelper.RoomCulture);
            }
        }
    }
    else
    {
        if (Model.OrderListItem.Count > 0)
        {
            double? _OrderCost = Model.OrderListItem.Sum(x => x.IsCloseItem.GetValueOrDefault(false) ? x.OrderLineItemExtendedCost : double.Parse((x.ApprovedQuantity.GetValueOrDefault(0) == 0 ? x.RequestedQuantity.GetValueOrDefault(0) : x.ApprovedQuantity.GetValueOrDefault(0)).ToString()) * ((x.Cost.GetValueOrDefault(0)) / ((x.CostUOMValue ?? 0) == 0 ? 1 : (x.CostUOMValue ?? 1))));
            double? _OrderPrice = Model.OrderListItem.Sum(x => x.IsCloseItem.GetValueOrDefault(false) ? x.OrderLineItemExtendedPrice : double.Parse((x.ApprovedQuantity.GetValueOrDefault(0) == 0 ? x.RequestedQuantity.GetValueOrDefault(0) : x.ApprovedQuantity.GetValueOrDefault(0)).ToString()) * ((x.SellPrice.GetValueOrDefault(0)) / ((x.CostUOMValue ?? 0) == 0 ? 1 : (x.CostUOMValue ?? 1)))) ?? 0;

            TotalCost = (_OrderCost ?? 0).ToString(priceformate, eTurnsWeb.Helper.SessionHelper.RoomCulture);
            TotalPrice = (_OrderPrice ?? 0).ToString(priceformate, eTurnsWeb.Helper.SessionHelper.RoomCulture);
        }

    }


    string strDisabled = "";
    if (isShowDeleted)
    {
        strDisabled = "disabled=disabled";
    }
    string UNCPathRootReceiveFileLink = string.IsNullOrEmpty(eTurns.DTO.SiteSettingHelper.ReceiveFilePaths) ? string.Empty : eTurns.DTO.SiteSettingHelper.ReceiveFilePaths;
    Int64 EnterpriseId = eTurnsWeb.Helper.SessionHelper.EnterPriceID;
    Int64 CompanyID = eTurnsWeb.Helper.SessionHelper.CompanyID;
    Int64 RoomID = eTurnsWeb.Helper.SessionHelper.RoomID;
    UNCPathRootReceiveFileLink = UNCPathRootReceiveFileLink.Replace("~", string.Empty);
    string ReceiveFilePath = (UNCPathRootReceiveFileLink + EnterpriseId + "/" + CompanyID + "/" + RoomID);
}
<script type="text/javascript">
    $(document).ready(function () {
        AllowDeletePopup = false;
        $('#spnTotalOrderCost').html('@CurrencySymbol' + ' ' + '@TotalCost');
        $('#spnTotalOrderPrice').html('@CurrencySymbol' + ' ' + '@TotalPrice');
        if ('@PriseSelectionOption.ToString()' == '1') {
            $('#lblOrderTotalSellPrice').show();
            $('#spnTotalOrderPrice').show();

            $('#lblOrderTotalCost').hide();
            $('#spnTotalOrderCost').hide();
        }
        else if ('@PriseSelectionOption.ToString()' == '2') {
            $('#lblOrderTotalSellPrice').hide();
            $('#spnTotalOrderPrice').hide();

            $('#lblOrderTotalCost').show();
            $('#spnTotalOrderCost').show();
        }
    });
</script>
<div class="userListingWrapper">
    <div class="userListBlock">
        <div class="searchWrapper">
            <div class="searchBlock">
                <span class="label">@eTurns.DTO.Resources.ResCommon.Search</span>
                <div class="searchinputB">
                    <input type="text" class="searchinput" id="ReceiveItem_filter" />
                    <a href="javascript:void(0);" class="xclose">
                        <img src="~/Content/images/x.png" alt="X" id="ClearSearchReceive" />
                    </a>
                </div>
            </div>
            <input type="button" id="btnDiv" value="Div" style="visibility: hidden" />
            @Html.HiddenFor(mode => mode.StagingID, new { @id = "hdnStaginID" })
        </div>
        @Html.QuickListItemsGridTopHeader(settings, eTurnsWeb.Helper.SessionHelper.ModuleList.Orders)
        <div class="userContentInnerGrid" style="width: 99% !important; margin-left: 5px !important;
            float: left;">
            <table id="RecieveOrderLineItem@(Model.ID)" class="display">
                <thead>
                    <tr>
                        <th>
                            @eTurns.DTO.Resources.ResCommon.RowNo
                        </th>
                        <th class="NotSortable NotHide">
                            @eTurns.DTO.Resources.ResCommon.ExpandCollapse
                        </th>
                        <th class="NotSortable NotHide">
                            @ResOrder.Receive
                        </th>
                        @if (Model.OrderType == (int)OrderType.Order)
                        {
                            <th class="NotSortable NotHide">
                                @eTurns.DTO.ResOrder.QuantityToReceive
                            </th>
                        }
                        else
                        {
                            <th class="NotSortable NotHide">
                                @eTurns.DTO.ResOrder.QuantityToReturn
                            </th>
                        }
                        @if (isCost && Model.OrderType == (int)OrderType.Order)
                        {
                            <th>
                                @eTurns.DTO.ResItemLocationDetails.Cost
                            </th>
                        }
                        <th>
                            @eTurns.DTO.ResOrder.PackSlipNumber
                        </th>
                        @if (Model.OrderType == (int)OrderType.Order)
                        {
                            <th>
                                @eTurns.DTO.ResItemLocationDetails.ReceivedDate
                            </th>
                        }
                        else
                        {
                            <th>
                                @eTurns.DTO.ResOrder.ReturnDate
                            </th>
                        }
                        <th>
                            @eTurns.DTO.ResOrder.Bin
                        </th>
                        <th class="NotHide">
                            @eTurns.DTO.ResItemMaster.ItemNumber
                        </th>
                        @if (Model.OrderType == (int)OrderType.Order)
                        {
                            <th class="NotSortable NotHide">
                                @eTurns.DTO.ResOrder.RequestedQuantity
                            </th>
                        }
                        else
                        {
                            <th class="NotSortable NotHide">
                                @eTurns.DTO.ResOrder.RequestedReturnQuantity
                            </th>
                        }
                        <th class="NotSortable NotHide">
                            @eTurns.DTO.ResOrder.ApprovedQuantity
                        </th>
                        @if (Model.OrderType == (int)OrderType.Order)
                        {
                            <th class="NotSortable NotHide">
                                @eTurns.DTO.ResOrder.RequiredDate
                            </th>
                        }
                        else
                        {
                            <th class="NotSortable NotHide">
                                @eTurns.DTO.ResOrder.RequiredReturnDate
                            </th>
                        }
                        @if (Model.OrderType == (int)OrderType.Order)
                        {
                            <th class="NotSortable NotHide">
                                @eTurns.DTO.ResOrder.ReceivedQuantity
                            </th>
                        }
                        else
                        {
                            <th class="NotSortable NotHide">
                                @eTurns.DTO.ResOrder.ReturnedQuantity
                            </th>
                        }
                        <th>
                            @eTurns.DTO.ResItemMaster.OnHandQuantity
                        </th>
                        <th>
                            @eTurns.DTO.ResItemMaster.StagedQuantity
                        </th>
                        <th>
                            @eTurns.DTO.ResItemMaster.Description
                        </th>
                        <th>
                            @eTurns.DTO.ResUnitMaster.Unit
                        </th>
                        <th>
                            @eTurns.DTO.ResGLAccount.GLAccount
                        </th>
                        @if (isCost)
                        {
                            <th>
                                @eTurns.DTO.ResItemMaster.Markup
                            </th>
                            <th>
                                @eTurns.DTO.ResItemMaster.SellPrice
                            </th>
                        }
                        <th>
                            @eTurns.DTO.ResSupplierMaster.Supplier
                        </th>
                        <th>
                            @eTurns.DTO.ResItemMaster.OnOrderQuantity
                        </th>
                        <th>
                            @eTurns.DTO.ResItemMaster.OnReturnQuantity
                        </th>
                        <th>
                            @eTurns.DTO.ResItemMaster.OnOrderInTransitQuantity
                        </th>
                        <th>
                            @eTurns.DTO.ResItemMaster.MinimumQuantity
                        </th>
                        <th>
                            @eTurns.DTO.ResItemMaster.MaximumQuantity
                        </th>
                        <th>
                            @eTurns.DTO.ResCategoryMaster.Category
                        </th>
                        <th>
                            @eTurns.DTO.ResItemMaster.DefaultReorderQuantity
                        </th>
                        <th>
                            @eTurns.DTO.ResItemMaster.ManufacturerName
                        </th>
                        <th>
                            @eTurns.DTO.ResItemMaster.ManufacturerNumber
                        </th>
                        <th>
                            @eTurns.DTO.ResItemMaster.SupplierPartNo
                        </th>
                        <th>
                            @eTurns.DTO.ResItemMaster.SuggestedOrderQuantity
                        </th>
                        <th>
                            @eTurns.DTO.ResOrder.ItemBlanketPO
                        </th>
                        <th>
                            @eTurns.DTO.ResOrder.SendToEDI
                        </th>
                        @if (isCost)
                        {
                            <th>
                                @eTurns.DTO.ResOrder.ExtendedCost
                            </th>
                        }

                        <th class="NotSortable">
                            @eTurns.DTO.ResOrder.Comment
                        </th>
                        <th>
                            @eTurns.DTO.ResItemMaster.InTransferTransitQuantity
                        </th>
                        <th>
                            @ResCommon.CreatedBy
                        </th>
                        <th>
                            @ResCommon.CreatedOn
                        </th>
                        <th>
                            @ResCommon.LastUpdatedBy
                        </th>
                        <th>
                            @ResCommon.UpdatedOn
                        </th>
                        <th>
                            @ResCommon.AddedFrom
                        </th>
                        <th>
                            @ResCommon.ReceivedOnWeb
                        </th>
                        <th>
                            @ResCommon.EditedFrom
                        </th>
                        <th>
                            @ResCommon.ReceivedOn
                        </th>
                        <th>
                            @ResOrder.OrdDtlInTransitQty
                        </th>
                        @if (isCost)
                        {
                            <th>
                                @ResOrder.OrderLineItemExtendedCost
                            </th>
                        }
                        @if (isCost && Model.OrderType == (int)OrderType.Order)
                        {
                            <th>
                                @ResOrder.OrderItemSellPrice
                            </th>
                            <th>
                                @ResOrder.OrderItemMarkup
                            </th>
                            <th>
                                @ResOrder.OrderItemCostUOMValue
                            </th>
                        }
                        @if (isOrderDetailsUDF)
                        {
                            @Html.RenderColumnsHeader("OrderDetails", typeof(eTurns.DTO.ResOrderDetails))
                        }
                        @if (Model.OrderType == (int)OrderType.Order)
                        {
                            @Html.RenderColumnsHeader("ReceivedOrderTransferDetail", typeof(eTurns.DTO.ResReceiveOrderDetails), "")
                        }
                        @Html.RenderColumnsHeader("ItemMaster", typeof(eTurns.DTO.ResItemMaster), "Item")
                        @if (Model.OrderType == (int)OrderType.Order)
                        {
                            <th>
                                @ResCommon.FileAttachment
                            </th>
                            <th class="NotSortable">
                                @ResCommon.AttachedFiles
                            </th>
                        }
                        <th>
                            @ResOrder.ISBackOrdered
                        </th>
                        <th class="NotSortable NotHide">
                            @ResOrder.BackOrderedExpandCollapse
                        </th>
                        <th>
                            @ResOrder.POItemLineNumber
                        </th>
                        <th>
                            @ResOrder.OrderLineException
                        </th>
                        <th>
                            @ResOrder.OrderLineExceptionDesc
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.OrderListItem != null && Model.OrderListItem.Count > 0)
                    {
                        int POLineItemManual = 0;
                        foreach (var item in Model.OrderListItem)
                        {
                            bool isCloseItm = item.IsCloseItem.GetValueOrDefault(false);
                            lstBinMaster = new List<BinMasterDTO>();
                            lstBinMaster.Add(new BinMasterDTO() { BinNumber = item.BinName ?? string.Empty });

                            string strBack = "";
                            if (isCloseItm)
                            {
                                strBack = "background-color:LightGray;height: 35px;";
                            }
                            else
                            {
                                strBack = "";
                            }


                    <tr id="tr_@item.ID" style='@strBack'>
                        <td></td>
                        <td>
                            @if (isShowDeleted == false)
                            {
                                if (Model.OrderType == (int)OrderType.Order)
                                {
                                    <a href="javascript:void(0);" id="imgPlusMinus_@item.ID" class="RecieveDataInnerGrid" onclick="return ShowHideInnerGrid(this,@item.ID);">
                                        <img class="RecieveDataImg" src="/Content/images/drildown_open.jpg" alt="" />
                                    </a>
                                }
                                else
                                {
                                    <a href="javascript:void(0);" id="imgPlusMinus_@item.ID" class="RecieveDataInnerGrid" onclick="return ShowHideReturnInnerGrid(this,@item.ID);">
                                        <img class="RecieveDataImg" src="/Content/images/drildown_open.jpg" alt="" />
                                    </a>
                                }
                            }
                        </td>
                        <td>
                            @if (isShowDeleted == false && !isCloseItm && Model.OrderStatus > (int)OrderStatus.Approved && Model.OrderStatus < (int)OrderStatus.Closed && isInsert)
                            {
                                if (Model.OrderType == (int)OrderType.Order)
                                {
                                    <input id="btnInlineReceive@(item.ID)" type="button" value="@ResOrder.Receive" class="GridBtnStyle inLineBtn" @strDisabled />
                                }
                                else
                                {
                                    <input id="btnInlineReceive@(item.ID)" type="button" value="Return" class="GridBtnStyle inLineBtn" @strDisabled />
                                }
                            }
                            <input type="hidden" id="hdnItemCost@(item.ID)" value="@item.Cost.GetValueOrDefault(0)" />
                            <input type="hidden" id="hdnOrderCost@(item.ID)" value="@item.ItemCost.GetValueOrDefault(0)" />
                            <input type="hidden" id="hdnIsShowNormalItemPopUp@(item.ID)" value="@(item.IsShowNormalItemPopUp ? 1 : 0)" />
                        </td>
                        <td>
                            @if (!item.SerialNumberTracking)
                            {
                                double recQty = (item.ApprovedQuantity.GetValueOrDefault(0) - item.ReceivedQuantity.GetValueOrDefault(0));

                                if (SiteSettingHelper.IsBorderStateURL == "1" && SiteSettingHelper.EnableOktaLoginForSpecialUrls.Contains(eTurnsWeb.Helper.SessionHelper.CurrentDomainURL))
                                {
                                    recQty = (double)(item.InTransitQuantity ?? 0);
                                }
                                else
                                {
                                    if (item.InTransitQuantity > 0)
                                    {
                                        recQty = (double)item.InTransitQuantity;
                                    }
                                    else
                                    {
                                        if (recQty <= 0 || isCloseItm)
                                        {
                                            recQty = 0;
                                        }
                                    }
                                }

                                @Html.TextBox("txtReceiveQty" + item.ID, recQty, eTurnsWeb.Helper.SessionHelper.QuantityFormat, new { @class = "numericinput text-boxinner txtSRQtyFormat", @style = "width:93%;" })
                            }
                            else
                            {

                                double recQty = (item.ApprovedQuantity.GetValueOrDefault(0) - item.ReceivedQuantity.GetValueOrDefault(0));

                                if (SiteSettingHelper.IsBorderStateURL == "1" && SiteSettingHelper.EnableOktaLoginForSpecialUrls.Contains(eTurnsWeb.Helper.SessionHelper.CurrentDomainURL))
                                {
                                    recQty = (double)(item.InTransitQuantity ?? 0);
                                }
                                else
                                {
                                    if (item.InTransitQuantity > 0)
                                    {
                                        recQty = (double)item.InTransitQuantity;
                                    }
                                    else
                                    {
                                        if (recQty <= 0)
                                        {
                                            recQty = 0;
                                        }
                                    }
                                }
                                @Html.TextBox("txtReceiveQty" + item.ID, recQty, new { @class = "numericinput text-boxinner", @style = "width:93%;" })
                            }
                        </td>
                        @if (isCost && Model.OrderType == (int)OrderType.Order)
                        {
                            <td>
                                @if (item.Consignment)
                                {
                                    @Html.TextBox("txtCostBox" + item.ID, item.ItemCost, eTurnsWeb.Helper.SessionHelper.PriceFormat, new { @class = "text-boxinner numericDecimalinput disableBack", @style = "width:60px;", @readonly = "readonly" })
                                }
                                else
                                {
                                    @Html.TextBox("txtCostBox" + item.ID, item.ItemCost, eTurnsWeb.Helper.SessionHelper.PriceFormat, new { @class = "text-boxinner numericDecimalinput", @style = "width:60px;" })
                                }

                            </td>
                        }
                        <td>
                            @if (!isCloseItm)
                            {
                                @Html.TextBox("txtPackslip" + item.ID, Model.PackSlipNumber, new { @id = "txtPackslip" + item.ID, @class = "text-boxinner", @style = "width:100px;" })
                            }
                        </td>
                        <td>
                            <input id="txtReceiveDate@(item.ID)" type="text" style="width:80px;background:white;" readonly="readonly" class="hasDatePicker text-boxinner" value="@(objRegionSettingDAL.GetCurrentDatetimebyTimeZone(eTurnsWeb.Helper.SessionHelper.RoomID, eTurnsWeb.Helper.SessionHelper.CompanyID, eTurnsWeb.Helper.SessionHelper.UserID, eTurns.DTO.Resources.ResourceHelper.CurrentCult, eTurnsWeb.Helper.SessionHelper.RoomDateFormat,eTurnsWeb.Helper.SessionHelper.RoomCulture).ToString(eTurnsWeb.Helper.SessionHelper.RoomDateFormat, (System.Globalization.CultureInfo)System.Web.HttpContext.Current.Session["RoomCulture"]))" />
                        </td>
                        <td>
                            @if (!isCloseItm)
                            {
                                <span style="display:none">@item.BinName</span>
                                if (Model.StagingDefaultLocation.GetValueOrDefault(0) > 0)
                                {
                                    @Html.TextBox("txtReceiveBin", item.BinName, new { id = "txtReceiveBin", @class = "text-boxinner", @style = "width:90px;", @readonly = "readonly" })
                                }
                                else
                                {
                                    if (HasOnTheFlyEntryRight && (Model.OrderType == (int)OrderType.Order))
                                    {
                                        <span style='position: relative'>
                                            @Html.TextBox("txtReceiveBin", item.BinName, new { id = "txtReceiveBin", @class = "OrdDetailAuto text-boxinner", @style = "width:90px;" })
                                            <a id='lnkShowAllOptions' href='javascript:void(0);' style='position: absolute; right: 5px;
                                            top: 0px;' class="ShowAllOptions">
                                                <img src='/Content/images/arrow_down_black.png' alt='select' />
                                            </a>
                                            <input type="hidden" value="false" id="hdnIsLoadMoreLocations" />
                                        </span>
                                    }
                                    else if (HasOnTheFlyEntryRight && (Model.OrderType == (int)OrderType.RuturnOrder))
                                    {
                                        <span style='position: relative'>
                                            @Html.DropDownList("slctItemBinNumber", new SelectList(lstBinMaster, "BinNumber", "BinNumber", item.BinName), new { @class = "selectBox" })
                                            <input type="hidden" name="txtReceiveBin" id="txtReceiveBin" value="@item.BinName" />
                                        </span>
                                    }
                                    else
                                    {
                                        <span style='position: relative'>
                                            @Html.DropDownList("slctBinNumber", new SelectList(lstBinMaster, "BinNumber", "BinNumber", item.BinName), new { @class = "selectBox" })
                                            <input type="hidden" name="txtReceiveBin" id="txtReceiveBin" value="@item.BinName" />
                                        </span>
                                    }

                                }
                            }
                        </td>
                        <td>
                            @item.ItemNumber
                            <input id="hdnID" type="hidden" value="@item.ID" />
                            <input id="hdnItemNumber" type="hidden" value="@item.ItemNumber" />
                            <input id="hdnGUID" type="hidden" value="@item.GUID" />
                            <input id="hdnItemGUID" type="hidden" value="@item.ItemGUID" />
                            <input id="hdnOrderGUID" type="hidden" value="@item.OrderGUID" />
                            <input id="hdnBin" type="hidden" value="@item.Bin" />
                            <input id="hdnItemType" type="hidden" value="@item.ItemType" />
                            <input id="hdnItemDOCTrack" type="hidden" value="@item.DateCodeTracking.ToString()" />
                            <input id="hdnItemLOTTrack" type="hidden" value="@item.LotNumberTracking.ToString()" />
                            <input id="hdnItemSRTrack" type="hidden" value="@item.SerialNumberTracking.ToString()" />
                            <input id="hdnIsCloseItem" type="hidden" value="@isCloseItm.ToString()" />
                            <span id="spnOrderDetailGUID" style="display: none">@item.GUID</span>
                            <input id="hdnUDF1" type="hidden" value="@item.UDF1" />
                            <input id="hdnUDF2" type="hidden" value="@item.UDF2" />
                            <input id="hdnUDF3" type="hidden" value="@item.UDF3" />
                            <input id="hdnUDF4" type="hidden" value="@item.UDF4" />
                            <input id="hdnUDF5" type="hidden" value="@item.UDF5" />
                            <input id="hdnOrderLineItemIsDeleted" type="hidden" value="@item.IsDeleted.GetValueOrDefault(false).ToString()" />
                            <span id="spnOrderDetailID" style="display: none">@item.ID</span>
                        </td>
                        <td class="numericalign">
                            <span id="spnRequestedQty">@item.RequestedQuantity.GetValueOrDefault(0).ToString(quantityFormat)</span>
                        </td>
                        <td class="numericalign">
                            <span id="spnApprovedQty">@item.ApprovedQuantity.GetValueOrDefault(0).ToString(quantityFormat)</span>
                        </td>
                        <td>
                            @item.RequiredDate.GetValueOrDefault(DateTime.MinValue).ToString(eTurnsWeb.Helper.SessionHelper.RoomDateFormat, (System.Globalization.CultureInfo)System.Web.HttpContext.Current.Session["RoomCulture"])
                        </td>
                        <td class="numericalign">
                            <span id="spnReceivedQty">@item.ReceivedQuantity.GetValueOrDefault(0).ToString(quantityFormat)</span>
                        </td>
                        <td class="numericalign">
                            <span id="spnOnHandQty">@item.OnHandQuantity.GetValueOrDefault(0).ToString(quantityFormat)</span>
                        </td>
                        <td class="numericalign">
                            <span id="spnOnStageQty">@item.StagedQuantity.GetValueOrDefault(0).ToString(quantityFormat)</span>
                        </td>
                        <td>
                            @item.ItemDescription
                        </td>
                        <td>
                            @item.Unit
                        </td>
                        <td>
                            @item.GLAccount
                        </td>
                        @if (isCost)
                        {
                            <td class="numericalign">
                                @item.Markup
                            </td>
                            <td class="numericalign">
                                @item.SellPrice.GetValueOrDefault(0).ToString(priceformate, eTurnsWeb.Helper.SessionHelper.RoomCulture)
                            </td>
                        }
                        <td>
                            @item.SupplierName
                        </td>
                        <td class="numericalign">
                            @item.OnOrderQuantity.GetValueOrDefault(0).ToString(quantityFormat)
                        </td>
                        <td class="numericalign">
                            @item.OnReturnQuantity.GetValueOrDefault(0).ToString(quantityFormat)
                        </td>
                        <td class="numericalign">
                            <span id="spnIntransitQty">@item.OnOrderInTransitQuantity.GetValueOrDefault(0).ToString(quantityFormat)</span>
                        </td>
                        <td class="numericalign">
                            @item.MinimumQuantity.ToString(quantityFormat)
                        </td>
                        <td class="numericalign">
                            @item.MaximumQuantity.ToString(quantityFormat)
                        </td>
                        <td>
                            @item.Category
                        </td>
                        <td class="numericalign">
                            @item.DefaultReorderQuantity.ToString(quantityFormat)
                        </td>
                        <td>
                            @item.Manufacturer
                        </td>
                        <td>
                            @item.ManufacturerNumber
                        </td>
                        <td>
                            @item.SupplierPartNo
                        </td>
                        <td class="numericalign">
                            @item.SuggestedOrderQuantity.GetValueOrDefault(0).ToString(quantityFormat)
                        </td>
                        <td>
                            @item.ItemBlanketPO
                        </td>
                        <td>
                            @(item.IsEDISent.GetValueOrDefault(false) == true ? "True" : "False")
                        </td>
                        @if (isCost)
                        {
                            <td>
                                @item.ExtendedCost.GetValueOrDefault(0).ToString(priceformate, eTurnsWeb.Helper.SessionHelper.RoomCulture)
                            </td>
                        }
                        <td id="orderlinecommenttd">
                            @if (!isCloseItm)
                            {
                                <textarea id="Comment" style="width: 80% !important;"
                                          name="Comment" rows="3" cols="10" maxlength="2000">@item.Comment.Trim()
                                        </textarea>
                            }
                        </td>
                        <td>
                            @(item.ItemInTransitQuantity.GetValueOrDefault(0).ToString(quantityFormat))
                        </td>
                        <td>
                            @(item.CreatedByName)
                        </td>
                        <td>
                            @(item.CreatedDate)
                        </td>
                        <td>
                            @(item.UpdatedByName)
                        </td>
                        <td>
                            @(item.UpdatedDate)
                        </td>
                        <td>
                            @(item.AddedFrom)
                        </td>
                        <td>
                            @(item.ReceivedOnDateWeb)
                        </td>
                        <td>
                            @(item.EditedFrom)
                        </td>
                        <td>
                            @(item.ReceivedOnDate)
                        </td>
                        <td class="numericalign">
                            @(item.InTransitQuantity.GetValueOrDefault(0).ToString(quantityFormat))
                            <input type="hidden" name="txtInTransitQuantity" id="txtInTransitQuantity_@item.ID" value="@item.InTransitQuantity" />
                        </td>
                        @if (isCost)
                        {
                            <td class="numericalign">
                                @item.OrderLineItemExtendedCost.GetValueOrDefault(0).ToString(priceformate, eTurnsWeb.Helper.SessionHelper.RoomCulture)
                            </td>
                        }
                        @if (isCost && Model.OrderType == (int)OrderType.Order)
                        {
                            <td class="numericalign">
                                @item.ItemSellPrice.GetValueOrDefault(0).ToString(priceformate, eTurnsWeb.Helper.SessionHelper.RoomCulture)
                            </td>
                            <td class="numericalign">
                                @item.ItemMarkup.GetValueOrDefault(0).ToString(priceformate)
                            </td>
                            <td class="numericalign">
                                @item.ItemCostUOMValue.GetValueOrDefault(0).ToString(priceformate)
                            </td>
                        }
                        @if (isOrderDetailsUDF)
                        {
                            @Html.RenderColumnsArrayEditableObjectForDOM("OrderDetails", controlIDPostfix: "OrderDetails")
                        }
                        @if (Model.OrderType == (int)OrderType.Order)
                        {
                            @Html.RenderColumnsArrayEditableObjectForDOM("ReceivedOrderTransferDetail")
                        }
                        @(Html.RenderColumnsArrayForDOM("ItemMaster", item, "Item"))
                        @if (Model.OrderType == (int)OrderType.Order)
                        {
                            <td>
                                @if (isShowDeleted)
                                {
                                    <input type='file' class='orderdetailsfileattachment' data-id="@item.GUID" id="file_@item.GUID" multiple disabled="disabled" />
                                }
                                else
                                {
                                    <input type='file' class='orderdetailsfileattachment' data-id="@item.GUID" id="file_@item.GUID" multiple />
                                    <span id="validFileList_@item.GUID"></span>
                                }

                            </td>
                            <td>
                                @for (int i = 0; i < item.attachmentfileNames.Count; i++)
                                {
                                    string attachmentPath = ReceiveFilePath + "/" + item.ID + "/" + item.attachmentfileNames[i].FileName.ToString();
                                    <a class='preview' href='@attachmentPath' target='_blank'>@item.attachmentfileNames[i].FileName.ToString()</a><image class='receivedattachmentdelete' data-id="@item.attachmentfileNames[i].FileGUID" id='received_@item.attachmentfileNames[i].FileGUID' src='/content/images/delete.png' alt='Delete' />;
                                }
                            </td>
                        }
                        <td>
                            @Html.CheckBox("IsBackOrdered_" + item.GUID, (item.IsBackOrdered.HasValue ? Convert.ToBoolean(item.IsBackOrdered) : false), new { @class = "check-box", @data_id = "IsBackOrdered_" + item.GUID, @disabled = "disabled" })
                        </td>
                        <td>
                            <img class="BackOrderedExpand" src="/Content/images/drildown_open.jpg" />
                        </td>
                        <td>
                            @if (item.POItemLineNumber == null || item.POItemLineNumber < 1)
                            {
                                POLineItemManual++;
                                <span id="POLineItemNumbers" data-value="@POLineItemManual"> @(POLineItemManual) </span>
                            }
                            else
                            {
                                <span id="POLineItemNumbers" data-value="@item.POItemLineNumber"> @(item.POItemLineNumber) </span>
                            }
                        </td>
                        <td>
                            @Html.CheckBox("IsOrderLineException", (item.OrderLineException.HasValue ? Convert.ToBoolean(item.OrderLineException) : false), new { @class = "check-box", @disabled = "disabled", @data_id = "IsOrderLineException", @onclick = "setOrderLineExceptionStatus(this)", @data_value = Convert.ToBoolean(item.OrderLineException) })
                        </td>
                        <td>
                            @(item.OrderLineExceptionDesc)
                        </td>
                    </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
    @if (isShowDeleted == false && Model.OrderStatus > (int)OrderStatus.Approved && Model.OrderStatus < (int)OrderStatus.Closed && !Model.IsArchived.GetValueOrDefault(false))
    {
        if (isInsert)
        {
            if (Model.OrderType == (int)OrderType.Order)
            {
                <input id="btnReceiveAllNew" type="button" value="@ResOrder.ReceiveAll" style="float: left;
            margin-left: 5%; margin-top: -2%" class="CreateBtn" />
                @*<input id="btnReceiveALL" type="button" value="Receive ALL" style="float: left; margin-left: 5%;
                    margin-top: -2%" class="CreateBtn" />*@
            }
            else
            {
                <input id="btnReturnALL" type="button" value="@ResOrder.ReturnALL" style="float: left; margin-left: 5%;
            margin-top: -2%" class="CreateBtn" />
            }
            <span>&nbsp;</span>
        }
        <input id="btnClearAll" type="button" value="@ResOrder.ClearAll" style="float: left; margin-left: 1%;
            margin-top: -2%" class="CreateBtn" />
            <input id="btnSelectAll" type="button" value="@ResOrder.SelectAll" style="float: left; margin-left: 1%;
            margin-top: -2%; display: none" class="CreateBtn" />

        if (Model.OrderType == (int)OrderType.Order)
        {
            <input id="btnCloseOrder" type="button" value="@ResOrder.CloseOrder" style="float: left; margin-left: 4%;
            margin-top: -2%" class="CreateBtn" />
        }
        else
        {
            <input id="btnCloseOrder" type="button" value="@ResOrder.CloseReturnOrder" style="float: left;
            margin-left: 4%; margin-top: -2%" class="CreateBtn" />
        }

        <input id="btnCloseOrderLineItem" type="button" value="@ResOrder.CloseLineItem" style="float: left;
            margin-left: 1%; margin-top: -2%" class="CreateBtn" />

            <input id="btnUnCloseLineItem" type="button" value="@ResOrder.UncloseItem" style="float: left;
            margin-left: 1%; margin-top: -2%; display: none;" class="CreateBtn" />

            <input type="button" value="@eTurns.DTO.ResOrder.EditReceipts" id="btnEditReciept"
                   style="float: left; margin-left: 1%; margin-top: -2%" class="CreateBtn" />

                <input type="button" value="@ResOrder.ViewReceived" id="btnDeleteReceivedInLineItem" class="CreateBtn"
                       style="float: right; margin-right: 15%; margin-top: -2%;display:none;" />

                    <input type="button" value="@ResOrder.SaveBin" id="btnSaveSelectedBin" class="CreateBtn"
                           style="float: left; margin-left: 1%; margin-top: -2%" />
    }
</div>
<div id="LocationDetailsForItemReceive">
</div>
<script type="text/javascript" language="javascript">


    var OrdID = '@Model.ID';
    var oTableReceiveOrderLineItems;
    var bIsReceiveFilter = false;
    var NotAllowedCharCodes = [9, 16, 17, 18, 19, 20, 27, 33, 34, 35, 36, 37, 38, 39, 40];
    var anOpen = [];
    var objOrdRcvDtlGridColumns = {};
    var MsgReceivedSuccessfully = '@ResReceiveOrderDetails.MsgReceivedSuccessfully';
    var ResReceiveOrderDetails = '@ResReceiveOrderDetails.MsgErrorWhileReceving';
    var ReceivedFileExtension = '@ReceiveAllowedFileExtension';
    var removedReceiveListName = [];

    $(document).ready(function () {
        $('form').areYouSure();


        $('.ShowAllOptions').click(function () {
            $(this).siblings('.OrdDetailAuto').trigger("focus");
            $(this).siblings(".OrdDetailAuto").autocomplete("search", " ");
        });

        UDFfillEditableOptionsForGrid();
        $('#spnTotalCost').html('@CurrencySymbol' + ' ' + '@(Model.OrderCost.GetValueOrDefault(0).ToString(priceformate, eTurnsWeb.Helper.SessionHelper.RoomCulture))')
        if ('@isCost' == "True") {
            $('#liOrderCostInfo').show();
        }
        else {
            $('#liOrderCostInfo').hide();
        }

    });

      $("#RecieveOrderLineItem" +@(Model.ID)).on("click", "td img.BackOrderedExpand", function (event) {
        $('#DivLoading').show();
          if ($(this).parent().parent().find("img.RecieveDataImg.IsOpen") != undefined && $(this).parent().parent().find("img.RecieveDataImg.IsOpen").length > 0) {
              $(this).parent().parent().find("img.RecieveDataImg.IsOpen").parent().trigger("click");
        }
        var dtTable = $("#RecieveOrderLineItem" +@(Model.ID)).dataTable();
        var nTr = this.parentNode.parentNode;
        var i = $.inArray(nTr, anOpen);
        var parenttd = $(this).parents('td').parent();
        var ordTempDtlsGUID = parenttd.find("#hdnGUID").val();

        if (i === -1) {
            $('img.BackOrderedExpand', this.parentNode).attr('src', sImageUrl + "drildown_close.jpg");
            dtTable.fnOpen(nTr, fnFormatDetailsBackOrder(ordTempDtlsGUID), '');
            anOpen.push(nTr);
            $('img.BackOrderedExpand', this.parentNode).addClass("IsOpen");
        }
        else {
            $('img.BackOrderedExpand', this.parentNode).attr('src', sImageUrl + "drildown_open.jpg");
            dtTable.fnClose(nTr);
            anOpen.splice(i, 1);
            $('img.BackOrderedExpand', this.parentNode).removeClass("IsOpen");
            $('#DivLoading').hide();

        }

    });

    function fnFormatDetailsBackOrder(orderDetailsGUID) {
      var sOut = '';
         $.ajax({
                    "url": '@Url.Content("~/Order/BackOrderedDetails")',
                    data: { OrderDetailsGUID: orderDetailsGUID },
                    "async": false,
                    cache: false,
                    "dataType": "text",
                    "success": function (json) {
                        sOut = json;
                        $('#DivLoading').hide();
                    },
                    error: function (response) {
                        $('#DivLoading').hide();
                    }
                });
          return sOut;
     }



    function ShowHideInnerGrid(ctrl, id) {
        var tr = $('#tr_' + id);
        if ($(tr).find("img.BackOrderedExpand.IsOpen") != undefined && $(tr).find("img.BackOrderedExpand.IsOpen").length > 0) {
            $(tr).find("img.BackOrderedExpand.IsOpen").trigger("click");
        }
        $('#DivLoading').show();

        var nTr = tr[0];
        var i = $.inArray(nTr, anOpen);
        var dtTable = $('#RecieveOrderLineItem' + OrdID).dataTable();
        if (i === -1) {
            $('img', ctrl).attr('src', sImageUrl + "drildown_close.jpg");
            dtTable.fnOpen(nTr, fnFormatDetails(dtTable, nTr), '');
            anOpen.push(nTr);
            $('img', ctrl).addClass("IsOpen");

        }
        else {

            $('img', ctrl).attr('src', sImageUrl + "drildown_open.jpg");
            dtTable.fnClose(nTr);
            anOpen.splice(i, 1);
            //  dtTable.fnDraw();
            $('#DivLoading').hide();
            $('img', ctrl).removeClass("IsOpen");

        }
    }

    function fnFormatDetails(oTable, nTr) {
        var oData = oTable.fnGetData(nTr);
        var sOut = '';
        var ItemGUID = $(nTr).find('#hdnItemGUID').val();
        var GUId = $(nTr).find('#hdnGUID').val();
        ItemUniqueGUID = ItemGUID;


        $('#DivLoading').show();
        if ($(nTr).find('#hdnItemSRTrack').val() === "True") {
            $.ajax({
                "url": '@Url.Content("~/Receive/ReceiveItem")',
                "type": 'GET',
                "data": { 'OrderDetailGUID': GUId },
                "async": false,
                "cache": false,
                "dataType": "text",
                "success": function (json) {
                    sOut = json;
                    $('#DivLoading').hide();
                },
                error: function (response) {
                }
            });
        }
        else {
            $.ajax({
                "url": '@Url.Content("~/Order/ReceivedOrderDetail")',
                data: { 'ItemGUID': ItemGUID, 'ordDetailGUID': GUId },
                "async": false,
                cache: false,
                "dataType": "text",
                "success": function (json) {
                    sOut = json;
                    $('#DivLoading').hide();
                },
                error: function (response) {
                }
            });
        }
        return sOut;
    }

    /*region expand inner grid for return order start*/
    function ShowHideReturnInnerGrid(ctrl, id) {
        $('#DivLoading').show();
        if ($(tr).find("img.BackOrderedExpand.IsOpen") != undefined && $(tr).find("img.BackOrderedExpand.IsOpen").length > 0) {
            $(tr).find("img.BackOrderedExpand.IsOpen").trigger("click");
        }
        var tr = $('#tr_' + id);
        var nTr = tr[0];
        var i = $.inArray(nTr, anOpen);
        var dtTable = $('#RecieveOrderLineItem' + OrdID).dataTable();
        if (i === -1) {
            $('img', ctrl).attr('src', sImageUrl + "drildown_close.jpg");
            dtTable.fnOpen(nTr, fnFormatReturnDetails(dtTable, nTr), '');
            anOpen.push(nTr);
            $('img', ctrl).addClass("IsOpen");
        }
        else {

            $('img', ctrl).attr('src', sImageUrl + "drildown_open.jpg");
            dtTable.fnClose(nTr);
            anOpen.splice(i, 1);
            //  dtTable.fnDraw();
            $('#DivLoading').hide();
            $('img', ctrl).removeClass("IsOpen");
        }
    }

    function fnFormatReturnDetails(oTable, nTr) {
        var oData = oTable.fnGetData(nTr);
        var sOut = '';
        var ItemGUID = $(nTr).find('#hdnItemGUID').val();
        var GUId = $(nTr).find('#hdnGUID').val();
        ItemUniqueGUID = ItemGUID;


        $('#DivLoading').show();
        if ($(nTr).find('#hdnItemSRTrack').val() === "True") {
            $.ajax({
                "url": '@Url.Content("~/Order/ReturnItem")',
                "type": 'GET',
                "data": { 'OrderDetailGUID': GUId },
                "async": false,
                "cache": false,
                "dataType": "text",
                "success": function (json) {
                    sOut = json;
                    $('#DivLoading').hide();
                },
                error: function (response) {
                }
            });
        }
        else {
            $.ajax({
                "url": '@Url.Content("~/Order/ReturnOrderDetail")',
                data: { 'ItemGUID': ItemGUID, 'ordDetailGUID': GUId },
                "async": false,
                cache: false,
                "dataType": "text",
                "success": function (json) {
                    sOut = json;
                    $('#DivLoading').hide();
                },
                error: function (response) {
                }
            });
        }
        return sOut;
    }

    function fillReturnItemGrid(ordDetailID) {
        var itemGUID = $("#hdnItemGuid_" + ordDetailID).val();
        var orderDetailGUID = $("#hdnOrderDetailGUID_" + ordDetailID).val();
        var orderGUID = $("#hdnOrderGuid_" + ordDetailID).val();
        var isLot = $("#hdnIsLot_" + ordDetailID).val();
        var isDateCode = $("#hdnIsDateCode_" + ordDetailID).val();
        var isSerial = $("#hdnIsSerial_" + ordDetailID).val();
        var binID = $("#ddlBin_" + ordDetailID).val();
        var obj = {
            "OrderDetailID": ordDetailID,
            "ItemGUID": itemGUID,
            "OrderDetailGUID": orderDetailGUID,
            "DateCodeTracking": isDateCode,
            "SerialNumberTracking": isSerial,
            "LotNumberTracking": isLot,
            "ReturnBinID": binID,
            "OrderGUID": orderGUID
        }

        var url = '@Url.Content("~/Order/ReturnItemDetail")';


        $.ajax({
            "url": url,
            "data": JSON.stringify(obj),
            "type": 'POST',
            "async": false,
            "cache": false,
            "dataType": "text",
            "contentType": "application/json",
            "success": function (response) {
                $("#ItemReceivedGrid_" + ordDetailID).html(response);
                $('#DivLoading').hide();
            },
            "error": function (err) {
                $('#DivLoading').hide();
            }

        });
    }

    function fillReturnItemDetailGrid(orderDetailID) {

        var oTableRecved = $('#ReturnedItemDetail_' + orderDetailID).dataTable({
            "bJQueryUI": true,
            "bRetrieve": true,
            "bDestroy": true,
            "bScrollCollapse": true,
            "sScrollX": "100%",
            "sDom": 'R<"top"lp<"clear">>rt<"bottom"i<"clear">>',
            "oColVis": {},
            "aaSorting": [[2, "desc"]],
            "oColReorder": {},
            "sPaginationType": "full_numbers",
            "bProcessing": true,
            "bStateSave": true,
            "oLanguage": {
                "sLengthMenu": '@eTurns.DTO.Resources.ResGridHeader.Show' + ' _MENU_ ' + '@eTurns.DTO.Resources.ResGridHeader.Records',
                "sEmptyTable": '@eTurns.DTO.Resources.ResMessage.NoDataAvailableInTable',
                "sInfo": '@eTurns.DTO.Resources.ResMessage.ShowingNoOfEntries',
                "sInfoEmpty": '@eTurns.DTO.Resources.ResMessage.ShowingZeroEntries'
            },
            "fnStateSaveParams": function (oSettings, oData) {
                oData.oSearch.sSearch = "";
                $.ajax({
                    "url": '@Url.Content("~/Master/SaveGridState")',
                    "type": "POST",
                    data: { Data: JSON.stringify(oData), ListName: 'ReturnedItemDetailGrid' },
                    "async": false,
                    cache: false,
                    "dataType": "json",
                    "success": function (json) {
                        if (json.jsonData != '')
                            o = json;
                    }
                });
            },
            "fnStateLoad": function (oSettings) {
                var o;
                $.ajax({
                    "url": '@Url.Content("~/Master/LoadGridState")',
                    "type": "POST",
                    data: { ListName: 'ReturnedItemDetailGrid' },
                    "async": false,
                    cache: false,
                    "dataType": "json",
                    "success": function (json) {
                        if (json.jsonData != '')
                            o = JSON.parse(json.jsonData);
                    }
                });
                return o;
            }
            // , "aoColumns": ColumnObject
        });

    }

    /*region expand inner grid for return order end*/


    function fillReceivedItemGrid(ordDetailID) {
        var itemGUID = $("#hdnItemGuid_" + ordDetailID).val();
        var orderDetailGUID = $("#hdnOrderDetailGUID_" + ordDetailID).val();
        var orderGUID = $("#hdnOrderGuid_" + ordDetailID).val();
        var isLot = $("#hdnIsLot_" + ordDetailID).val();
        var isDateCode = $("#hdnIsDateCode_" + ordDetailID).val();
        var isSerial = $("#hdnIsSerial_" + ordDetailID).val();
        var binID = $("#ddlBin_" + ordDetailID).val();
        var obj = {
            "OrderDetailID": ordDetailID,
            "ItemGUID": itemGUID,
            "OrderDetailGUID": orderDetailGUID,
            "DateCodeTracking": isDateCode,
            "SerialNumberTracking": isSerial,
            "LotNumberTracking": isLot,
            "ReceiveBinID": binID,
            "OrderGUID": orderGUID
        }

        var url = '@Url.Content("~/Receive/ReceivedItemDetail")';


        $.ajax({
            "url": url,
            "data": JSON.stringify(obj),
            "type": 'POST',
            "async": false,
            "cache": false,
            "dataType": "text",
            "contentType": "application/json",
            "success": function (response) {
                $("#ItemReceivedGrid_" + ordDetailID).html(response);
                $('#DivLoading').hide();
            },
            "error": function (err) {
                $('#DivLoading').hide();
            }

        });
    }

    function fillReceivedItemDetailGrid(orderDetailID) {

        var oTableRecved = $('#ReceivedItemDetail_' + orderDetailID).dataTable({
            "bJQueryUI": true,
            "bRetrieve": true,
            "bDestroy": true,
            "bScrollCollapse": true,
            "sScrollX": "100%",
            "sDom": 'R<"top"lp<"clear">>rt<"bottom"i<"clear">>',
            "oColVis": {},
            "aaSorting": [[2, "desc"]],
            "oColReorder": {},
            "sPaginationType": "full_numbers",
            "bProcessing": true,
            "bStateSave": true,
            "oLanguage": {
                "sLengthMenu": '@eTurns.DTO.Resources.ResGridHeader.Show' + ' _MENU_ ' + '@eTurns.DTO.Resources.ResGridHeader.Records',
                "sEmptyTable": '@eTurns.DTO.Resources.ResMessage.NoDataAvailableInTable',
                "sInfo": '@eTurns.DTO.Resources.ResMessage.ShowingNoOfEntries',
                "sInfoEmpty": '@eTurns.DTO.Resources.ResMessage.ShowingZeroEntries'
            },
            "fnStateSaveParams": function (oSettings, oData) {
                oData.oSearch.sSearch = "";
                $.ajax({
                    "url": '@Url.Content("~/Master/SaveGridState")',
                    "type": "POST",
                    data: { Data: JSON.stringify(oData), ListName: 'ReceivedItemDetailGrid' },
                    "async": false,
                    cache: false,
                    "dataType": "json",
                    "success": function (json) {
                        if (json.jsonData != '')
                            o = json;
                    }
                });
            },
            "fnStateLoad": function (oSettings) {
                var o;
                $.ajax({
                    "url": '@Url.Content("~/Master/LoadGridState")',
                    "type": "POST",
                    data: { ListName: 'ReceivedItemDetailGrid' },
                    "async": false,
                    cache: false,
                    "dataType": "json",
                    "success": function (json) {
                        if (json.jsonData != '')
                            o = JSON.parse(json.jsonData);
                    }
                });
                return o;
            }
            // , "aoColumns": ColumnObject
        });

    }



    function deleteRowsReceived(ordDetailID) {
        var anSelected = fnGetSelected($('#ReceivedItemDetail_' + ordDetailID).dataTable());
        if (anSelected != null) {
            if (anSelected.length > 0) {
                $('#ReceivedOrderInnerGrid_' + ordDetailID).modal();
            }
        }
        return false;
    }



    function NewUpdateReceivedQty(ordDetailID, ordDetailGUID) {
        $.ajax({
            'url': '@Url.Content("~/Order/GetReceivedQuantity")',
            'type': 'POST',
            'data': { 'OrderDetailGUID': ordDetailGUID },
            'async': false,
            'cache': false,
            'success': function (response) {
                if (response.Status = "ok") {
                    var isSerial = $("#hdnIsSerial_" + ordDetailID).val();
                    //$('#spnReceivedQty_' + ordDetailID).text(response.ReturnDTO.ReceivedQuantity);
                    var RecvedQty = parseFloat(response.ReturnDTO.ReceivedQuantity);
                    var ReqstedQty = parseFloat($("#hdnRequestedQty_" + ordDetailID).val());
                    if (isSerial != "True") {
                        $("#txtReceiveQuantity_" + ordDetailID).val((ReqstedQty - RecvedQty).toString());
                    }
                }
            }
        });
    }

    function isDuplicateSerial(ordDetaiID) {

        var txtsr = $("#txtsrnumber_" + ordDetaiID);
        var itemGuid = $('#hdnItemGuid_' + ordDetaiID).val();

        var returnResult = false;
        if ($(txtsr).val() != '') {
            var consign = $("#hdnIsConsign_" + ordDetaiID).val();
            fillReceivedDate("txtsrnumber_", ordDetaiID);
            $.ajax({
                "url": '@Url.Content("~/Inventory/DuplicateCheckSrNumber")',
                data: { SrNumber: $(txtsr).val(), ID: 0, ItemGUID: itemGuid },
                "async": false,
                cache: false,
                "dataType": "text",
                "success": function (response) {
                    if (response == "duplicate") {
                        $(txtsr).css("background-color", "#F7BBC4");
                        $(txtsr).select();
                        $(txtsr).focus();
                        returnResult = false;
                    }
                    else {
                        $(txtsr).css("background-color", "");
                        returnResult = true;
                    }
                },
                error: function (response) {
                    $("#spanGlobalMessage").html(response);
                    returnResult = false;
                }
            });
        }
        else {
            returnResult = true;
        }
        if (returnResult == false) {
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            $("#spanGlobalMessage").html('@ResMessage.DuplicateSerialFound');
            showNotificationDialog();
            //alert('@ResMessage.DuplicateSerialFound');
            $(txtsr).focus();
        }

        return returnResult;
    }

    function fillReceivedDate(txtName, ordDetailID) {
        var txt = $('#' + txtName + ordDetailID);
        if ($(txt).val() != '' && $(txt).val() != '0') {
            var myDate = new Date();
            var prettyDate = (myDate.getMonth() + 1) + '/' + myDate.getDate() + '/' + myDate.getFullYear();
            var seq = $(txt).parent().parent()[0].rowIndex - 1;
            if ($(txt).parent().parent().find('[name*="[' + seq.toString() + '].Received"]').val() == '') {
                $(txt).parent().parent().find('[name*="[' + seq.toString() + '].Received"]').val(prettyDate);
            }
        }
    }

    function fillReceivedDateQuantity(txtName, ordDetailID) {
        var txt = $('#' + txtName + ordDetailID);
        if ($(txt).val() != '' && parseFloat($(txt).val()) > 0) {
            var myDate = new Date();
            var prettyDate = (myDate.getMonth() + 1) + '/' + myDate.getDate() + '/' + myDate.getFullYear();
            var seq = $(txt).parent().parent()[0].rowIndex - 1;
            if ($(txt).parent().parent().find('[name*="[' + seq.toString() + '].Received"]').val() == '') {
                $(txt).parent().parent().find('[name*="[' + seq.toString() + '].Received"]').val(prettyDate);
            }
        }
    }



    $('#PageNumber1').keydown(function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) {
            $("#Gobtn1").click();
            return false;
        }
    });


    $('#btnSaveSelectedBin').off('click');
    $('#btnSaveSelectedBin').on('click', function (e) {
        $('#DivLoading').show();
        var arrItems = new Array();
        var errorMsg = '';
        var isError = false;
        $('#RecieveOrderLineItem' + OrdID + ' tbody tr.row_selected').each(function (i) {

            var RecvBin = '';
            if ($(this).find("#txtReceiveBin").length > 0) {
                RecvBin = $(this).find('#txtReceiveBin').val();
            }
            else if ($(this).find("#slctBinNumber").length > 0) {
                RecvBin = $(this).find('#slctBinNumber').val();
            }

            if (typeof (RecvBin) == "undefined" || RecvBin == null || RecvBin == '' || RecvBin.trim().length < 1) {
                //alert('@string.Format(ResMessage.MsgRequired,ResOrder.Bin)');
                errorMsg = '@string.Format(ResMessage.MsgRequired,ResOrder.Bin)'
                isError = true;
                //e.preventDefault();
                //return false;
            }
            else
            {
                var ordDtlGuid = $(this).find('#hdnGUID').val();
                var itemGuid = $(this).find('#hdnItemGUID').val();
                arrItems.push({ 'GUID': ordDtlGuid, 'BinName': RecvBin, 'ItemGUID': itemGuid });
            }

        });

        if (!isError) {
            if (arrItems.length > 0) {
                $.ajax({
                    "url": "@Url.Content("~/Order/SaveLineItemBin")",
                    "type": 'POST',
                    "dataType": 'json',
                    "contentType": 'application/json',
                    "data": JSON.stringify({ 'lstBins': arrItems, 'OrderGuid': '@Model.GUID' }),
                    "success": function (result) {
                        $("#spanGlobalMessage").removeClass('errorIcon WarningIcon').addClass('succesIcon');
                        $("#spanGlobalMessage").html("@ResReceiveOrderDetails.msgBinSaved");
                        showNotificationDialog();
                        $('#DivLoading').hide();
                    },
                    "error": function (xhr) {
                        alert('@ResCommon.ErrorInProcess');
                        $('#DivLoading').hide();
                    }
                });
            }
            else {
                $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                $("#spanGlobalMessage").html('@ResReceiveOrderDetails.ReqRowToSaveBin');
                showNotificationDialog();
                //alert('@ResReceiveOrderDetails.ReqRowToSaveBin');
                $('#DivLoading').hide();
            }
        }
        else
        {
            $('#DivLoading').hide();
            alert(errorMsg);
        }

        isDirtyForm = false;
    });
    $('#btnDeleteReceivedInLineItem').off('click');
    $('#btnDeleteReceivedInLineItem').on('click', function () {

        var anSelectedOrders = fnGetSelected($('#RecieveOrderLineItem' + OrdID).dataTable());
        var stringOrderIDs = "";
        if (anSelectedOrders.length == 1) {
            $('#DivLoading').show();
            var orderDetailGUID = $(anSelectedOrders[0]).find('#hdnGUID').val();
            var Url = '/Receive/ReceivedItemsByOrderDetail';

            $("#divReceivedItem").data({ 'Guid': orderDetailGUID, 'Url': Url }).dialog("open");
        }
        else {
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            $("#spanGlobalMessage").html('@ResOrder.SelectSingleRow');
            showNotificationDialog();
            //alert('@ResOrder.SelectSingleRow');
        }
        return false;
    });

    $("#Gobtn1").click(function () {
        var pval = $('#PageNumber1').val();
        if (pval == "" || pval.match(/[^0-9]/)) {
            return;
        }
        if (pval == 0)
            return;

        $('#RecieveOrderLineItem' + OrdID).dataTable().fnPageChange(Number(pval - 1));
        $('#PageNumber1').val('');
    });


    $(".searchBlock").on({
        keyup: function (e) {

            var code = (e.keyCode ? e.keyCode : e.which);
            var index = $.inArray(code, NotAllowedCharCodes);
            if (index >= 0) return false;
            if (SearchPattern == 2 || SearchPattern == "2") {
                fnFilterReciveOrderLineItem();
            } else {
                if (code == 13) {
                    fnFilterReciveOrderLineItem();
                }
            }
            if ($("#ReceiveItem_filter").val().length == 0) {
                setTimeout(function () { fnFilterReciveOrderLineItem(); }, 200);
            }

        },
        keydown: function (e) {
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) {
                fnFilterReciveOrderLineItem();
            }
        },
        paste: function (e) {
            setTimeout(function () {
                if (SearchPattern == 2 || SearchPattern == "2") {
                    fnFilterReciveOrderLineItem();
                }
            }, 50);
        },
        drop: function (e) {
            setTimeout(function () {
                if (SearchPattern == 2 || SearchPattern == "2") {
                    fnFilterReciveOrderLineItem();
                }
            }, 50);
        }
    }, "#ReceiveItem_filter");



    $(".xclose #ClearSearchReceive").click(function () {
        $("#ReceiveItem_filter").val('');
        fnFilterReciveOrderLineItem();
        $("#ReceiveItem_filter").focus();
        return false;
    });

    $("#btnClearAll").click(function () {
        $('#DivLoading').hide();
        $('#RecieveOrderLineItem' + OrdID).find("tbody tr").each(function (e) {
            var colr = hexc($(this).css('background-color'));
            if (colr !== '#d3d3d3') {
                $(this).removeAttr('style');
            };
            $(this).removeClass('row_selected');
        });
    });

    $('#aSelectAll').on('click', function (e) {
        $('#RecieveOrderLineItem' + OrdID).find("tbody tr").each(function (e) {
            if ($(this).hasClass('row_selected') == false)
                $(this).addClass('row_selected');

        });

        $(this).css('display', 'none');
        $('#aDeSelectAll').css('display', 'block');
        return false;
    });

    $('#aDeSelectAll').on('click', function (e) {
        $('#RecieveOrderLineItem' + OrdID).find("tbody tr").each(function (e) {
            if ($(this).hasClass('row_selected'))
                $(this).removeClass('row_selected');
        });
        $(this).css('display', 'none');
        $('#aSelectAll').css('display', 'block');
        return false;
    });

    $("#btnSelectAll").click(function () {
        $('#RecieveOrderLineItem' + OrdID).find("tbody tr").each(function (e) {
            if ($(this).hasClass('row_selected') == false)
                $(this).addClass('row_selected');

        });
    });


    $('#btnReturnALL').on('click', function () {
        $('#RecieveOrderLineItem' + OrdID + ' tbody tr').each(function (i) {
            var colr = hexc($(this).css('background-color'));
            if (colr !== '#d3d3d3') {
                $(this).removeAttr('style');
            }
        });


        $('#OrdReceiveProcessing').modal();
        $('#OrdReceiveProcessing').parent().parent().find(".modalCloseImg").css('display', 'none');
        if ($('#RecieveOrderLineItem' + OrderID + ' tbody tr.row_selected').length == 0) {
            closeOrdReceiveInfoModel();
            $('#OrdReceivedInfoDialog').find("#OrdReceivedMSG").html("<b style='color: Red;'>Please select order line item to receive.</b>");
            $('#OrdReceivedInfoDialog').modal();

        }
        else {
            $('#DivLoading').show();
            setTimeout(function () { CheckReceiveIsExceed(); $('#DivLoading').hide(); }, 5000);
        }
        return false;
    });


    $(document).ready(function () {
        $('#ddlOrderStatus').val('@Model.OrderStatus');
        $(".text-boxPriceFormat").priceFormat({
            prefix: '',
            thousandsSeparator: '',
            centsLimit: parseInt($('#hdCostcentsLimit').val(), 10)
        });

        $(".text-boxQuantityFormat").priceFormat({
            prefix: '',
            thousandsSeparator: '',
            centsLimit: parseInt($('#hdQuantitycentsLimit').val(), 10)
        });

        $(".text-boxQuantityFormatSR").priceFormat({
            prefix: '',
            thousandsSeparator: '',
            centsLimit: 0
        });
        $('input.txtSRQtyFormat').on('keypress', function (evt) {
            var keyCode = [evt.keyCode || evt.which];

            if (keyCode == 8 || keyCode == 13 || keyCode == 9)
                return true;
            if (keyCode > 57 || keyCode < 48)
                return false;
            else
                return true;
        });

        $("#LocationDetailsForItemReceive").dialog({
            autoOpen: false, modal: true, draggable: true, resizable: true, width: '82%', height: 710, title: 'Item Locations',

            open: function () {
                var strurl = '@Url.Content("~/Inventory/LocationDetails")';
                if (staginID > 0) {
                    strurl = '@Url.Content("~/Inventory/LocationDetailsMS")';
                }
                $('#DivLoading').show();
                var strdata = $(this).data("cdata");
                $.get(strurl, strdata, function (data) {
                    $("#LocationDetailsForItemReceive").html(data);
                    $('#DivLoading').hide();
                });
            },
            close: function () {
                CallThisFunctionFromModel('success');
                $("#LocationDetailsForItemReceive").empty();
            }
        });

        objOrdRcvDtlGridColumns = GetGridChildGridColumnsObject('RecieveOrderLineItem' + OrdID);
        var gaiSelected = [];

        $('#RecieveOrderLineItem' + OrdID + ' tr').each(function () {
            var UDF1 = '';
            var UDF2 = '';
            var UDF3 = '';
            var UDF4 = '';
            var UDF5 = '';
            if ($(this).find("input#hdnUDF1").val() != '') {
                UDF1 = $(this).find("input#hdnUDF1").val();
            }
            if ($(this).find("input#hdnUDF2").val() != '') {
                UDF2 = $(this).find("input#hdnUDF2").val();
            }
            if ($(this).find("input#hdnUDF3").val() != '') {
                UDF3 = $(this).find("input#hdnUDF3").val();
            }
            if ($(this).find("input#hdnUDF4").val() != '') {
                UDF4 = $(this).find("input#hdnUDF4").val();
            }
            if ($(this).find("input#hdnUDF5").val() != '') {
                UDF5 = $(this).find("input#hdnUDF5").val();
            }

            //if (UDF1 != '') {
            //    $(this).find('#hdnSpnUDF1').text(UDF1);
            //}
            //if (UDF2 != '') {
            //    $(this).find('#hdnSpnUDF2').text(UDF2);
            //}
            //if (UDF3 != '') {
            //    $(this).find('#hdnSpnUDF3').text(UDF3);
            //}
            //if (UDF4 != '') {
            //    $(this).find('#hdnSpnUDF4').text(UDF4);
            //}
            //if (UDF5 != '') {
            //    $(this).find('#hdnSpnUDF5').text(UDF5);
            //}

            if (UDF1 != '') {
                $(this).find('#hdnSpnUDF1OrderDetails').text(UDF1);
            }
            if (UDF2 != '') {
                $(this).find('#hdnSpnUDF2OrderDetails').text(UDF2);
            }
            if (UDF3 != '') {
                $(this).find('#hdnSpnUDF3OrderDetails').text(UDF3);
            }
            if (UDF4 != '') {
                $(this).find('#hdnSpnUDF4OrderDetails').text(UDF4);
            }
            if (UDF5 != '') {
                $(this).find('#hdnSpnUDF5OrderDetails').text(UDF5);
            }

        });

        oTableReceiveOrderLineItems = $('#RecieveOrderLineItem' + OrdID).dataTable({
            "bJQueryUI": true,
            "bRetrieve": true,
            "bDestroy": true,
            "bScrollCollapse": true,
            "sScrollX": "150%",
            "sDom": 'RC<"top"lp<"clear">>rt<"bottom"i<"clear">>T',
            "oColVis": {},
            "aaSorting": [[1, "desc"]],
            "oColReorder": {},
            "sPaginationType": "full_numbers",
            "bProcessing": true,
            "bStateSave": true,
            "oLanguage": {
                "sLengthMenu": '@eTurns.DTO.Resources.ResGridHeader.Show' + ' _MENU_ ' + '@eTurns.DTO.Resources.ResGridHeader.Records',
                "sEmptyTable": '@eTurns.DTO.Resources.ResMessage.NoDataAvailableInTable',
                "sInfo": '@eTurns.DTO.Resources.ResMessage.ShowingNoOfEntries',
                "sInfoEmpty": '@eTurns.DTO.Resources.ResMessage.ShowingZeroEntries'
            },
            "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                $("td.RowNo:first", nRow).html(this.fnSettings()._iDisplayStart + iDisplayIndex + 1);

                if ('@isShowDeleted' === "True") {
                    $(nRow).css('background-color', '#FFCCCC');
                }

                return nRow;
            },
            "aoColumnDefs": [
		        { mDataProp: null, sClass: "read_only center NotHide RowNo", "bSortable": false, sDefaultContent: '', aTargets: [0] }
            ],
            "fnStateSaveParams": function (oSettings, oData) {
                oData.oSearch.sSearch = "";
                if (!bIsReceiveFilter) {
                    $.ajax({
                        "url": '@Url.Content("~/Master/SaveGridState")',
                        "type": "POST",
                        data: { Data: JSON.stringify(oData), ListName: 'ReceiveOrderLineItem' },
                        "async": false,
                        cache: false,
                        "dataType": "json",
                        "success": function (json) {
                            if (json.jsonData != '')
                                o = json;
                        }
                    });
                }
                bIsReceiveFilter = false;

            },
            "fnStateLoad": function (oSettings) {
                var o;
                $.ajax({
                    "url": '@Url.Content("~/Master/LoadGridState")',
                    "type": "POST",
                    data: { ListName: 'ReceiveOrderLineItem' },
                    "async": false,
                    cache: false,
                    "dataType": "json",
                    "success": function (json) {
                        if (json.jsonData != '')
                            o = JSON.parse(json.jsonData);
                    }
                });
                return o;
            },
            "fnInitComplete": function () {
                $('.ColVis').detach().appendTo(".setting-arrow");
                bindAttachmentChange();
                imagePreview();

            }
        });

        $('.DTTT_container').css('z-index', '-1');
        $('#btnblock').css({ 'margin-right': '45px' });

         if ('@isShowDeleted' === 'True') {
            if ('@Model.OrderListItem.Count' === '0') {
                $('#spnNoOfItems').text('0');
            }
            else {
                $('#spnNoOfItems').text('@Model.OrderListItem.Count');
            }
        }
        else {
            $('#spnNoOfItems').text('@Model.NoOfLineItems.GetValueOrDefault(0)');
             $('#spnTotalCost').html('@CurrencySymbol' + ' ' + '@Model.OrderCost.GetValueOrDefault(0).ToString(priceformate, eTurnsWeb.Helper.SessionHelper.RoomCulture)');
        }


        $('#RecieveOrderLineItem' + OrdID).delegate(".hasDatePicker", "focusin", function () {
            $(this).datepicker({
                dateFormat: '@eTurnsWeb.Helper.SessionHelper.RoomDateJSFormat', showButtonPanel: true,
                changeMonth: true,
                changeYear: true,
                clearText: 'Clear', onClose: function () { this.focus(); }
            });
        });

        $(".text-boxPriceFormat").priceFormat({
            prefix: '',
            thousandsSeparator: '',
            centsLimit: parseInt($('#hdCostcentsLimit').val(), 10)
        });
        $(".text-boxQuantityFormat").priceFormat({
            prefix: '',
            thousandsSeparator: '',
            centsLimit: parseInt($('#hdQuantitycentsLimit').val(), 10)
        });

        if (!isNaN(parseInt($('#hdnStaginID').val())) && parseInt($('#hdnStaginID').val()) > 0)
            staginID = parseInt($('#hdnStaginID').val());


        $('#RecieveOrderLineItem' + OrdID).on("click", 'input[type="button"][id^="btnInlineReceive"]', function () {
            var tr = $(this).parent().parent();
            var tr = $(this).parent().parent();
            $("#RecieveOrderLineItem" + OrdID).find("tbody tr").removeClass("row_selected");
            $(tr).addClass('row_selected');
            $('#DivLoading').show();
            if ('@Model.OrderType' == '1') {
                setTimeout(function () { $('#btnReceiveAllNew').click(); $('#DivLoading').hide(); }, 50);
            }
            else {
                setTimeout(function () { $('#btnReturnALL').click(); $('#DivLoading').hide(); }, 50);
            }


            //var tr = $('#tr_' + id);
            //var SRTrack = $(tr).find('#hdnItemSRTrack').val();


            @*if (LOTTrack == "False" || DOTTrack == "False") {
                $("#RecieveOrderLineItem" + OrdID).find("tbody tr").removeClass("row_selected");
                $(tr).addClass('row_selected');
                $('#DivLoading').show();
                if ('@Model.OrderType' == '1') {
                    setTimeout(function () { $('#btnReceiveAllNew').click(); $('#DivLoading').hide(); }, 5000);
                }
                else {
                    setTimeout(function () { $('#btnReturnALL').click(); $('#DivLoading').hide(); }, 100);
                }
            }*@
            //            else {
            //                $("#LocationDetailsForItemReceive").empty();
            //                var ItemGUID = $(tr).find('#hdnItemGUID').val();
            //                var itemType = $(tr).find('#hdnItemType').val();
            //                var binID = ''; // $(tr).find('#hdnBin').val();
            //                var ordDetailId = $(tr).find('#hdnGUID').val();
            //                var idtype = ItemGUID + '#' + itemType + '#' + ordDetailId + '#' + binID;
            //                var strData = { 'ItemID_ItemType': idtype };
            //                $('#LocationDetailsForItemReceive').data("cdata", strData).dialog('open');
            //                return false;
            //            }
        });



        $('#RecieveOrderLineItem' + OrdID).on('focus', "input.OrdDetailAuto", function (e) {

            var ajaxURL = '/Master/GetBinForItemOrStaging';
            var itmGuid = $(this).parent().parent().parent().find('#hdnItemGUID').val();
            var stagingName = $('#txtStagingName').val();
            var includeQty = false;
            var tr = $(this).parent().parent().parent();

            if ('@Model.OrderType' === '2') {
                includeQty = true;
            }
            var hdnIsLoadMoreLocations = $(tr).find("#hdnIsLoadMoreLocations").val();

            $(this).autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: ajaxURL,
                        type: 'POST',
                        data: JSON.stringify({ 'ItemGuid': itmGuid, 'StagingHeaderName': stagingName, 'IncludeQty': includeQty, 'NameStartWith': request.term, 'IsLoadMoreLocations': hdnIsLoadMoreLocations }),
                        contentType: 'application/json',
                        dataType: 'json',
                        success: function (data) {
                            response($.map(data, function (Items) {
                                return {
                                    label: Items.Value,
                                    value: Items.Key
                                }
                            }));
                        },
                        error: function (err) {
                        }
                    });
                },
                autoFocus: false,
                minLength: 1,
                select: function (event, ui) {
                    if (ui.item.value == MoreLocation) {
                        $(tr).find("#hdnIsLoadMoreLocations").val("true");
                        $(this).trigger("focus");
                        $(this).autocomplete("search", " ");
                        return false;
                    }
                    else {
                        $(this).val(ui.item.value);
                    }
                },
                open: function () {
                    $(this).removeClass("ui-corner-all").addClass("ui-corner-top");
                    $('ul.ui-autocomplete').css('overflow-y', 'auto');
                    $('ul.ui-autocomplete').css('max-height', '300px');
                    $('ul.ui-autocomplete').css('z-index', '99999');
                },
                close: function () {
                    $(this).removeClass("ui-corner-top").addClass("ui-corner-all");
                },
                change: function (event, ui) {
                }
            });
        });
        var lastChecked1;
        var starttrvalue1 = "";
        $('#RecieveOrderLineItem' + OrdID).on("tap click", "tbody tr", function (e) {
            $('#btnUnCloseLineItem').css('display', 'none');
            if (e.target.type == "checkbox" || e.target.type == "radio" || e.target.type == "text" || e.target.type == "button" || e.target.type == "textarea" || $(e.target).hasClass("control") == true || e.target.nodeName.toLowerCase() == "img" || $(e.target).is('a') == true || $(e.target).is('span') == true
                || $(e.target).hasClass("selectBox") || e.target.type == "file") {
                e.stopPropagation();
            } else {
                $('#btnDeleteReceivedInLineItem').css('display', 'none');
                if (IsDeleteItemPictureViewRecord)
                    $(this).parent().parent().parent().parent().parent().toggleClass('row_selected');
                else
                    $(this).toggleClass('row_selected');

                if ('@isUnclose' == 'True') {
                    $('#RecieveOrderLineItem' + OrdID + ' tbody tr.row_selected').each(function (i) {
                        var UnCloseVal = $(this).find('#hdnIsCloseItem').val();
                        if (UnCloseVal == 'True') {
                            $('#btnUnCloseLineItem').css('display', 'inline');
                            return;
                        }
                    });

                }

                if ($('#RecieveOrderLineItem' + OrdID + ' tbody tr.row_selected').length == 1) {
                    if ($('#RecieveOrderLineItem' + OrdID + ' tbody tr.row_selected').find('#hdnIsCloseItem').val() == 'False') {
                        $('#btnDeleteReceivedInLineItem').css('display', '');
                    }
                }

                //
                if ($(e.target).hasClass("control") == true || e.target.nodeName.toLowerCase() == "img" || e.target.type == "checkbox" || e.target.type == "radio" || e.target.type == "text" || e.target.type == "button" || $(e.target).is('a') == true || $(e.target).is('span') == true
                    || $(e.target).hasClass("selectBox")
                ) {
                    e.stopPropagation();
                }
                else {
                    if (lastChecked1 !== undefined && lastChecked1 != null && !lastChecked1) {
                        lastChecked1 = this;
                    }

                    if (e.shiftKey) {
                        var start = $('#RecieveOrderLineItem' + OrdID + ' tbody tr').index(this);
                        var end = $('#RecieveOrderLineItem' + OrdID + ' tbody tr').index(lastChecked1);

                        var stringval1 = readCookieforshift("selectstartindex");
                        if (stringval1 != null) {
                            var endindex = $(this).closest('tr').attr('id');
                            createCookieforshift("selectendindex", endindex, 1);
                            if ($("#hdnPageName").val() !== undefined) {
                                var pagename = '';
                                pagename = $("#hdnPageName").val();
                                GetOnlyIdsForPassPagesForshift(pagename, true);
                            }
                        }

                        for (i = Math.min(start, end); i <= Math.max(start, end); i++) {
                            if (!$('#RecieveOrderLineItem' + OrdID + ' tbody tr').eq(i).hasClass('row_selected')) {
                                $('#RecieveOrderLineItem' + OrdID + ' tbody tr').eq(i).addClass("row_selected");
                            }
                        }
                        if (window.getSelection) {
                            if (window.getSelection().empty) {  // Chrome
                                window.getSelection().empty();
                            } else if (window.getSelection().removeAllRanges) {  // Firefox
                                window.getSelection().removeAllRanges();
                            }
                        } else if (document.selection) {  // IE?
                            document.selection.empty();
                        }
                    } else if ((e.metaKey || e.ctrlKey)) {
                        //$(this).toggleClass('row_selected');
                    } else {
                        //$(this).toggleClass('row_selected');


                        if ($(this).hasClass('row_selected')) {
                            (starttrvalue1 == "") ? starttrvalue1 = $(this).closest('tr').attr('id') : starttrvalue1 = starttrvalue1 + "," + $(this).closest('tr').attr('id');
                            createCookieforshift("selectstartindex", starttrvalue1, 1);
                        } else {

                            var stringval = readCookieforshift("selectstartindex");
                            if (stringval != "undefined") {
                                if (stringval != null) {
                                    var tmp = stringval.split(',');
                                    var index = tmp.indexOf($(this).closest('tr').attr('id'));
                                    if (index !== -1) {
                                        tmp.splice(index, 1);
                                        stringval = tmp.join(',');
                                        createCookieforshift("selectstartindex", stringval, 1);
                                    }
                                }
                            }

                        }
                    }

                    lastChecked1 = this;
                }
                //

                return false;
            }
        });

        if (gblActionName.toLowerCase() == "returnorderlist") {
            $('#btnDeleteReceivedInLineItem').val('View Returned')
        }
        $("table#RecieveOrderLineItem" + '@(Model.ID)' + " tr").each(function () {
            var UDF1 = '';
            var UDF2 = '';
            var UDF3 = '';
            var UDF4 = '';
            var UDF5 = '';
            if ($(this).find("input#hdnUDF1").val() != '') {
                UDF1 = $(this).find("input#hdnUDF1").val();
            }

            if ($(this).find("input#hdnUDF2").val() != '') {
                UDF2 = $(this).find("input#hdnUDF2").val();
            }
            if ($(this).find("input#hdnUDF3").val() != '') {
                UDF3 = $(this).find("input#hdnUDF3").val();
            }
            if ($(this).find("input#hdnUDF4").val() != '') {
                UDF4 = $(this).find("input#hdnUDF4").val();
            }
            if ($(this).find("input#hdnUDF5").val() != '') {
                UDF5 = $(this).find("input#hdnUDF5").val();
            }
            if (UDF1 != '')
            {
                $(this).find("input#UDF1OrderDetails").val(UDF1);
                $(this).find("select#UDF1OrderDetails option").filter(function () {
                    return this.text == UDF1;
                }).attr('selected', true);
            }
            if (UDF2 != '') {
                $(this).find("input#UDF2OrderDetails").val(UDF2);
                $(this).find("select#UDF2OrderDetails option").filter(function () {
                    return this.text == UDF2;
                }).attr('selected', true);
            }
            if (UDF3 != '') {
                $(this).find("input#UDF3OrderDetails").val(UDF3);
                $(this).find("select#UDF3OrderDetails option").filter(function () {
                    return this.text == UDF3;
                }).attr('selected', true);
            } if (UDF4 != '') {
                $(this).find("input#UDF4OrderDetails").val(UDF4);
                $(this).find("select#UDF4OrderDetails option").filter(function () {
                    return this.text == UDF4;
                }).attr('selected', true);
            } if (UDF5 != '') {
                $(this).find("input#UDF5OrderDetails").val(UDF5);
                $(this).find("select#UDF5OrderDetails option").filter(function () {
                    return this.text == UDF5;
                }).attr('selected', true);
            }
        });


        $('#IsDeletedRecordsOrdLn').click(function () {
            var _vIsDeleted = false;
            if (typeof ($('#IsDeletedRecordsOrdLn')) != undefined) {
                _vIsDeleted = $('#IsDeletedRecordsOrdLn').is(':checked');
                CallThisFunctionFromModel('success', true, _vIsDeleted)
            }
        });

    });

    function closeModalCloseOderDialog() {
        $.modal.impl.close();
    }

    $('#btnCloseOrder').click(function () {
        $('#CloseOderDialog').modal();
    });

    $('#btnCloseOrderLineItem').click(function () {
        if ($('#RecieveOrderLineItem' + OrdID).find("tbody tr.row_selected").length > 0) {
            $('#CloseOderLineItemDialog').modal();
        }
        else {
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            $("#spanGlobalMessage").html('@ResReceiveOrderDetails.MsgSelectLineItem');
            showNotificationDialog();
            //alert('@ResReceiveOrderDetails.MsgSelectLineItem');
        }
    });

    $('#btnUnCloseLineItem').click(function () {
        if ($('#RecieveOrderLineItem' + OrdID).find("tbody tr.row_selected").length > 0) {
            $('#UnCloseOderLineItemDialog').modal();
        }
        else {
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            $("#spanGlobalMessage").html('@ResReceiveOrderDetails.MsgSelectClosedLineItem');
            showNotificationDialog();
            //alert('@ResReceiveOrderDetails.MsgSelectClosedLineItem');
        }
    });

    $('#bntCloseConfirmYes').click(function () {
        $('#DivLoading').show();
        $.ajax({
            'url': 'UpdateOrderToClose',
            'data': { 'OrderID': OrdID },
            'success': function (result) {
                SetReplenishRedCount();
                closeModalCloseOderDialog();
                $('#DivLoading').hide();
                SwitchOrderTab('OrderCreate', 'frmOrder');
            },
            'error': function (result) {
                closeModalCloseOderDialog();
                $('#DivLoading').hide();
            }

        });
    });


    $('#btnEditReciept').click(function (e) {
        ClickFrom = '';
        var anSelectedRows = fnGetSelected($('#RecieveOrderLineItem' + OrdID).dataTable());
        if (anSelectedRows.length == 1) {
            var recQty = anSelectedRows

            var rowPosition = oTable.fnGetPosition(anSelectedRows[0]);
            var aData = oTable.fnGetData(rowPosition);

            var receivedQty = $(anSelectedRows).find('#spnReceivedQty').text();

            var orderStatus = '@((int)Model.OrderStatus)';
            var colr = hexc($('#RecieveOrderLineItem' + OrdID + ' tbody tr.row_selected').css('background-color'));
            if (isNaN(parseFloat(receivedQty)) || parseFloat(receivedQty) <= 0) {
                $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                $("#spanGlobalMessage").html('@ResReceiveOrderDetails.MsgNoPreviousReceiptToEdit');
                showNotificationDialog();
                //alert('@ResReceiveOrderDetails.MsgNoPreviousReceiptToEdit');
                return false;
            }
            if (colr === '#d3d3d3') {
                $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                $("#spanGlobalMessage").html('@ResReceiveOrderDetails.MsgSelectUnclosedItemValidation');
                showNotificationDialog();
                //alert('@ResReceiveOrderDetails.MsgSelectUnclosedItemValidation');
                return false;
            }

            if (colr !== '#d3d3d3') {
                var itemGuid = $('#RecieveOrderLineItem' + OrdID + ' tbody tr.row_selected').find('#hdnItemGUID').val();
                var orderDetailGuid = $('#RecieveOrderLineItem' + OrdID + ' tbody tr.row_selected').find('#hdnGUID').val();
                $('#divEditReceipt').data({ "ItemGuid": itemGuid, 'OrderDetailGuid': orderDetailGuid }).dialog('open');
                return false;
            }

        }
        else {
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            $("#spanGlobalMessage").html('@ResReceiveOrderDetails.MsgSelectOnlyOneRecord');
            showNotificationDialog();
            //alert('@ResReceiveOrderDetails.MsgSelectOnlyOneRecord');
            return false;
        }

    });

    function bindAttachmentChange() {
        $(".orderdetailsfileattachment").off('change');
        $(".orderdetailsfileattachment").change(function () {
            var validExtension = ReceivedFileExtension.split(',');
            var strValidationMessage = "";
            var totalfiles = document.getElementById($(this).attr("id")).files.length;
            if ($("#validFileList_" + $(this).attr("data-id")).length > 0) {
                $("#validFileList_" + $(this).attr("data-id")).empty();

            }
            if ($(this).attr("id").length > 0 && $(this).attr("id").indexOf("_") > 3 && $(this).attr("id").split("_")[1].length > 1) {
                var orderDetailsGuid = $(this).attr("id").split("_")[1];
                deleteFromRemovedList(orderDetailsGuid);
            }
            for (var i = 0; i < totalfiles; i++) {
                var IsValidFile = true;
                var fileExt = document.getElementById($(this).attr("id")).files[i].name;
                fileExt = fileExt.substring(fileExt.lastIndexOf('.'));
                if (validExtension.indexOf(fileExt.toLowerCase()) <= -1) {
                    IsValidFile = false;
                    strValidationMessage = strValidationMessage + document.getElementById($(this).attr("id")).files[i].name + MsgInvalidFileSelected;
                } else {
                    if ($("#validFileList_" + $(this).attr("data-id")).length > 0) {
                        var deletedID = "delete_" + $(this).attr("data-id");
                        $("#validFileList_" + $(this).attr("data-id")).append("<label>" + document.getElementById($(this).attr("id")).files[i].name + "</label><image class='orderdetailsattachmentdelete' data-id=" + $(this).attr("data-id") + " data-filename=" + document.getElementById($(this).attr("id")).files[i].name + " id=" + deletedID + " src='/content/images/delete.png' alt='Delete'/>");
                    }
                }
            }

            if (strValidationMessage != "") {
                alert(strValidationMessage + MsgvalidFileList.replace("{0}", validExtension.toString()));
            }
        });

        $("#RecieveOrderLineItem" + OrdID).on("click", ".orderdetailsattachmentdelete", function () {
            var ID = $(this).attr("data-id");
            var FILENAME = $(this).attr("data-filename");
            var isavailable = removedReceiveListName.filter(function (item) {
                return item.id == ID && item.fileName === FILENAME
            });
            if (isavailable.length == 0) {
                removedReceiveListName.push({
                    id: ID,
                    fileName: FILENAME
                });
            }
            $(this).prev().remove();
            $(this).remove();
        });


        $("#RecieveOrderLineItem" + OrdID).on("click", ".receivedattachmentdelete", function () {
            var ID = $(this).attr("data-id");
            $('#DivLoading').show();
            $.ajax({
                'url': "/Receive/DeleteFileAttachment",
                'type': 'POST',
                'data': JSON.stringify({ 'FileGuid': ID }),
                'async': false,
                'cache': false,
                'dataType': 'json',
                'contentType': 'application/json',
                'success': function (response) {
                    $('#DivLoading').hide();

                },
                'error': function (err) {
                    $('#DivLoading').hide();
                }
            });
            $(this).prev().remove();
            $(this).remove();
        });
    }

    function DownloadReceivedAttachedDocs(lnk) {
        var rowSelected = fnGetSelected($("#RecieveOrderLineItem" + OrdID).DataTable());
        var arrIds = new Array();
        if (rowSelected.length > 0) {
            for (var i = 0; i < rowSelected.length; i++) {
                debugger
                var ReqGUID = $(rowSelected[i]).find("#spnOrderDetailGUID").text();
                arrIds.push(ReqGUID);
            }
        }

        if (arrIds.length) {
            $.ajax({
                url: '/Receive/DownloadReceiveDocument',
                type: 'Post',
                data: JSON.stringify(arrIds),
                dataType: 'json',
                async: false,
                contentType: 'application/json',
                success: function (result) {
                    if (result.Status) {
                        var isURLHttps = false;
                        var CurrentURL = window.location.href;
                        if (CurrentURL.indexOf("localhost:") < 0
                            && CurrentURL.toLowerCase().indexOf("demo") < 0) {
                            if (CurrentURL.indexOf("https:") >= 0) {
                                isURLHttps = true;
                            }
                        }

                        if (result.ReturnFiles.length > 0) {
                            for (var i = 0; i < result.ReturnFiles.length; i++) {
                                if (isURLHttps == false) {
                                    if (result.ReturnFiles[i].indexOf("https:") >= 0) {
                                        result.ReturnFiles[i] = result.ReturnFiles[i].replace("https:", "http:");
                                    }
                                }
                                if (isURLHttps == true) {
                                    if (result.ReturnFiles[i].indexOf("http:") >= 0) {
                                        result.ReturnFiles[i] = result.ReturnFiles[i].replace("http:", "https:");
                                    }
                                }
                                window.open(result.ReturnFiles[i]);
                            }
                        } else {
                        $("#spanGlobalMessage").removeClass('succesIcon errorIcon').addClass('WarningIcon');
                        $("#spanGlobalMessage").html('@ResCommon.NoDocsToDownload');
                        showNotificationDialog();
                    }
                    }
                },
                error: function (xhr) {
                    alert(MsgResErrorInProcess);
                }
            });
        }
        else {
            alert(MsgSelectRow);

        }
    }




</script>
<script src="@Url.Content("~/Scripts/Receive.js?v=" + eTurnsWeb.Helper.CommonUtility.GetReleaseNumber())" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/ImagePreview.js")" type="text/javascript"></script>