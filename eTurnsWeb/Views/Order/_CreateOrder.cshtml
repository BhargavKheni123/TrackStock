@model eTurns.DTO.OrderMasterDTO
@{
    string CharCodeList = eTurnsWeb.Helper.CommonUtility.GetNotAllowCharList();
    Layout = "~/Views/Shared/_PopupMaster.cshtml";
    string CurrencyDecimalDigits = eTurnsWeb.Helper.SessionHelper.CurrencyDecimalDigits;
    string priceformate1 = "N" + eTurnsWeb.Helper.SessionHelper.CurrencyDecimalDigits.ToString();
    bool AbleToEdit = eTurnsWeb.Helper.SessionHelper.GetModulePermission(eTurnsWeb.Helper.SessionHelper.ModuleList.Orders, eTurnsWeb.Helper.SessionHelper.PermissionType.Update);
    bool AbleToInsert = eTurnsWeb.Helper.SessionHelper.GetModulePermission(eTurnsWeb.Helper.SessionHelper.ModuleList.Orders, eTurnsWeb.Helper.SessionHelper.PermissionType.Insert);
    bool IsableToChangeOrder = eTurnsWeb.Helper.SessionHelper.GetAdminPermission(eTurnsWeb.Helper.SessionHelper.ModuleList.ChangeOrder);
    bool IsableToApprove = eTurnsWeb.Helper.SessionHelper.GetAdminPermission(eTurnsWeb.Helper.SessionHelper.ModuleList.OrderApproval);
    bool IsableToUnCloseOrder = eTurnsWeb.Helper.SessionHelper.GetAdminPermission(eTurnsWeb.Helper.SessionHelper.ModuleList.AllowAnOrderToBeUnclose);
    bool IsPackSlipReq = false;
    bool HasOnTheFlyEntryRight = eTurnsWeb.Helper.SessionHelper.GetAdminPermission(eTurnsWeb.Helper.SessionHelper.ModuleList.OnTheFlyEntry);
    //if (eTurnsWeb.Helper.SessionHelper.CompanyConfig != null && eTurnsWeb.Helper.SessionHelper.CompanyConfig.IsPackSlipRequired.GetValueOrDefault(false))
    //{
    //    IsPackSlipReq = true;
    //}
    bool IsReportView = eTurnsWeb.Helper.SessionHelper.GetModulePermission(eTurnsWeb.Helper.SessionHelper.ModuleList.Reports, eTurnsWeb.Helper.SessionHelper.PermissionType.View);
    bool HasItemCreateRights = eTurnsWeb.Helper.SessionHelper.GetModulePermission(eTurnsWeb.Helper.SessionHelper.ModuleList.ItemMaster, eTurnsWeb.Helper.SessionHelper.PermissionType.Insert);
    string OrderAllowedFileExtension = eTurns.DTO.SiteSettingHelper.OrderAllowedFileExtension;
    string UNCPathRootOrderFileLink = eTurns.DTO.SiteSettingHelper.OrderFilePaths;

    int? PriseSelectionOption = 0;
    string TotalCost = "0.00";
    string TotalPrice = "0.00";
    string CurrencySymbol = "";


    Int64 EnterpriseId = eTurnsWeb.Helper.SessionHelper.EnterPriceID;
    Int64 CompanyID = eTurnsWeb.Helper.SessionHelper.CompanyID;
    Int64 RoomID = eTurnsWeb.Helper.SessionHelper.RoomID;
    UNCPathRootOrderFileLink = UNCPathRootOrderFileLink.Replace("~", string.Empty);
    string OrderFilePath = (UNCPathRootOrderFileLink + EnterpriseId + "/" + CompanyID + "/" + RoomID);

    if (eTurnsWeb.Helper.SessionHelper.CurrencySymbol != null
&& !string.IsNullOrWhiteSpace(eTurnsWeb.Helper.SessionHelper.CurrencySymbol))
    {
        CurrencySymbol = eTurnsWeb.Helper.SessionHelper.CurrencySymbol;
    }

    eTurns.DAL.RoomDAL onjRoomDAL = new eTurns.DAL.RoomDAL(eTurnsWeb.Helper.SessionHelper.EnterPriseDBName);
    RoomModuleSettingsDTO objRoomModuleSettingsDTO = onjRoomDAL.GetRoomModuleSettings(eTurnsWeb.Helper.SessionHelper.CompanyID, eTurnsWeb.Helper.SessionHelper.RoomID, (long)eTurnsWeb.Helper.SessionHelper.ModuleList.Orders);
    if (objRoomModuleSettingsDTO != null)
    {
        PriseSelectionOption = objRoomModuleSettingsDTO.PriseSelectionOption;
    }

    if (PriseSelectionOption != 1 && PriseSelectionOption != 2)
    {
        PriseSelectionOption = 1;
    }

    string callFor = ViewBag.CallFor ?? string.Empty;
}
<script src="@Url.Content("~/Scripts/ImagePreview.js")" type="text/javascript"></script>
<script type="text/javascript" src="@Url.Content("~/Scripts/SiteScripts.js?v=" + eTurnsWeb.Helper.CommonUtility.GetReleaseNumber())"></script>
@using (Ajax.BeginForm("SaveOrder", "Order", new AjaxOptions { HttpMethod = "Post", OnBegin = "onOrderBegin", OnSuccess = "onOrderSuccess", InsertionMode = InsertionMode.Replace, OnFailure = "onOrderFailure" }, new { @id = "frmOrder" }))
{
    @Html.AntiForgeryToken()
    <input type="hidden" value="OrderLineItemList" id="hdnListName" />
    <div class="userHead">
        @Html.ValidationSummary(true)
        @if (Model.ID != 0)
        {
            <div class="infoBlock">
                <ul>
                    <li>
                        <label for="RoomName">
                            @Html.LabelFor(model => model.RoomName)
                        </label>
                        : <span>@(Model.RoomName)</span>
                    </li>
                    <li>
                        <label for="RoomName">
                            @Html.LabelFor(model => model.Created)
                        </label>
                        : <span>@(Model.ReceivedOnDateWeb)</span>
                    </li>
                    <li>
                        <label for="RoomName">
                            @Html.LabelFor(model => model.CreatedByName)
                        </label>
                        : <span>@(Model.CreatedByName)</span>
                    </li>
                    <li>
                        <label for="RoomName">
                            @Html.LabelFor(model => model.LastUpdated)
                        </label>
                        : <span>@(Model.ReceivedOnDate)</span>
                    </li>
                    <li style="border: none">
                        <label for="RoomName">
                            @Html.LabelFor(model => model.UpdatedByName)
                        </label>
                        : <span>@(Model.UpdatedByName)</span>
                    </li>
                    <li style="border: none; text-align: right; display: none;">
                        <a onclick="callPrintTransaction('','OrderMasterList',false,@Model.ID,'','');" href="javascript:void(null);">
                            <img alt="" src="@Url.Content("~/Content/images/print.png")" title="@ResOrder.PrintPurchaseOrder" />
                        </a>
                    </li>
                    @if (IsReportView && !Model.IsDeleted && (Model.IsArchived ?? false) == false)
                    {
                        <li style="border: none; text-align: right;">
                            <a href="javascript:void(null);" id="aRptSingle">
                                <img alt="" src="@Url.Content("~/Content/images/print.png")" title="@ResOrder.PrintPurchaseOrder" />
                            </a>
                        </li>
                    }
                </ul>
            </div>
        }
        <div style="clear: both; padding-top: 15px">
            <a id="ancHideShowContent" style="float: left; margin-top: 8px; margin-left: 10px">
                <img src="/Content/images/drildown_open.jpg" alt="" />
            </a>
            <div class="infoBlock" style="width: 95%; margin-left: 10px; background: none">
                <div id="CollapsedContent" class="edtForm">
                    <ul>
                        <li style="border-right: none;">
                            <label for="label" style="width: 100px; float: left; padding: 1.3% 0;">
                                @Html.LabelFor(model => model.Supplier) <em style="color: Red">*</em> @*@if (@eTurnsWeb.Helper.SessionHelper.GetModulePermission(eTurnsWeb.Helper.SessionHelper.ModuleList.SupplierMaster, eTurnsWeb.Helper.SessionHelper.PermissionType.Insert) && Model.IsRecordNotEditable == false)
                                    {
                                    <a onclick="AddNewFromPopup('Supplier');" id="btnAddNewSupplier" class="addNewLink" style="float: left; padding-left: 0px">(Add New)</a>
                                    }*@
                            </label>
                            @*                            @if (Model.ID > 0) Edit Supplier name untill order gets approved wi-1296*@
                            @if (Model.OrderStatus != (int)OrderStatus.UnSubmitted)
                            {
                                @Html.DropDownListFor(model => model.Supplier, new SelectList(ViewBag.SupplierList, "ID", "SupplierName", Model.Supplier), new { @id = "ddlSupplier", @class = "selectBox", @style = "width:120px", @disabled = "disabled", autofocus = "autofocus" })
                                @Html.HiddenFor(model => model.Supplier)
                            }
                            else
                            {
                                @Html.DropDownListFor(model => model.Supplier, new SelectList(ViewBag.SupplierList, "ID", "SupplierName", Model.Supplier), new { @id = "ddlSupplier", @class = "selectBox", @style = "width:120px", autofocus = "autofocus" })
                                <br />
                                @Html.ValidationMessageFor(model => model.Supplier)
                            }
                        </li>
                        <li id="liOrderNumber" style="border-right: none; padding: 0px">
                            <label for="label" style="width: 100px; float: left; padding: 1.3% 0;">
                                @if (Model.OrderType == (int)OrderType.Order)
                                {
                                    @Html.LabelFor(model => model.OrderNumber) <em style="color: Red">*</em>
                                }
                                else
                                {
                                    @Html.Label(ResOrder.ReturnOrderNumber) <em style="color: Red">*</em>
                                }
                            </label>
                            @*                            @if (Model.ID <= 0 && (Model.AutoOrderNumber != null && Model.AutoOrderNumber.IsBlanketPO))*@
                            @if (Model.OrderStatus == (int)OrderStatus.UnSubmitted && (Model.AutoOrderNumber != null && Model.AutoOrderNumber.IsBlanketPO))
                            {
                                @Html.DropDownListFor(model => model.BlanketOrderNumberID, new SelectList(Model.AutoOrderNumber.BlanketPOs, "ID", "BlanketPO", Model.BlanketOrderNumberID), new { @id = "ddlBlanketPO", @class = "selectBox", @style = "width:120px" })
                                @Html.TextBoxFor(model => model.OrderNumber, new { id = "txtOrderNumber", @class = "text-box", @style = "background:white;display:none", maxlength = 22, @readonly = "readonly" })
                                <br />
                                if (Model.OrderType == (int)OrderType.Order)
                                {
                                    @Html.ValidationMessageFor(model => model.OrderNumber, "The field 'OrderNumber' is required.", new { @id = "spnErrOrderNumber", @style = "display:none;color: #FF0000;" })
                                }
                                else
                                {
                                    @Html.ValidationMessageFor(m => m.OrderNumber, "The field 'Return Order Number' is required.", new { @class = "text-danger" })
                                }
                            }
                            else
                            {
                                if (Model.OrderStatus == (int)OrderStatus.UnSubmitted)
                                {
                                    @Html.TextBoxFor(model => model.OrderNumber, new { id = "txtOrderNumber", @class = "text-box", @style = "background:white", maxlength = 22 })
                                }
                                else
                                {
                                    @Html.TextBoxFor(model => model.OrderNumber, new { id = "txtOrderNumber", @class = "text-box", @style = "background:white", maxlength = 22, @readonly = "readonly" })
                                }
                                @Html.HiddenFor(model => model.BlanketOrderNumberID)
                                <br />
                                if (Model.OrderType == (int)OrderType.Order)
                                {
                                    @Html.ValidationMessageFor(model => model.OrderNumber)
                                }
                                else
                                {
                                    @Html.ValidationMessageFor(model => model.OrderNumber, "The field 'Return Order Number' is required.", new { @id = "spnErrReturnOrderNumber", @style = "display:none;color: #FF0000;" })
                                }
                            }
                            @Html.HiddenFor(model => model.OrderNumber_ForSorting)
                            <br />
                        </li>
                        @if (Model.OrderType == (int)OrderType.Order && SiteSettingHelper.IsBorderStateURL == "1" && SiteSettingHelper.EnableOktaLoginForSpecialUrls.Contains(eTurnsWeb.Helper.SessionHelper.CurrentDomainURL))
                        {
                            <li style="border-right: none; padding: 0px;width:15%">
                                <label for="label" style="width: 110px; float: left; padding: 1.3% 0;">
                                    @Html.LabelFor(model => model.SalesOrderNumber)
                                </label>
                                @Html.TextBoxFor(model => model.SalesOrderNumber, new { id = "txtSalesOrderNumber", @class = "text-box", @style = "background:white;width:30%", maxlength = 22 })
                            <br />
                            </li>
                        }
                        <li style="border-right: none;">
                            <label for="label" style="width: 100px; float: left; padding: 1.3% 0;">
                                @if (Model.OrderType == (int)OrderType.Order)
                                {
                                    @Html.LabelFor(model => model.RequiredDate) <em style="color: Red">*</em>
                                }
                                else
                                {
                                    @Html.Label("Return Date") <em style="color: Red">*</em>
                                }
                            </label>
                            @Html.TextBoxFor(model => model.RequiredDateStr, new { @class = "text-box", id = "txtRequiredDate", @readonly = "readonly", @style = "background:white", maxlength = 128 })
                            @Html.ValidationMessageFor(model => model.RequiredDateStr)
                        </li>
                        <li style="border-right: none;">
                            <label for="label" style="width: 100px; float: left; padding: 1.3% 0;">
                                @if (Model.OrderType == (int)OrderType.Order)
                                {
                                    @Html.LabelFor(model => model.OrderStatus)
                                }
                                else
                                {
                                    @Html.Label(ResOrder.ReturnOrderStatus) <em style="color: Red">*</em>
                                }
                            </label>
                            @Html.DropDownListFor(model => model.OrderStatus, new SelectList(ViewBag.OrderStatusList, "value", "Text", Model.OrderStatus), new { id = "ddlOrderStatus", @class = "selectBox", @style = "width:120px" })
                            @Html.ValidationMessageFor(model => model.OrderStatus)
                        </li>
                        <li style="border-right: none; padding: 0px">
                            @Html.HiddenFor(model => model.ID, new { id = "hiddenID" })
                            @Html.HiddenFor(model => model.GUID)
                            @Html.HiddenFor(model => model.Created)
                            @Html.HiddenFor(model => model.LastUpdated)
                            @Html.HiddenFor(model => model.CreatedBy)
                            @Html.HiddenFor(model => model.LastUpdatedBy)
                            @Html.HiddenFor(model => model.CompanyID)
                            @Html.HiddenFor(model => model.Room)
                            @Html.HiddenFor(model => model.RoomName)
                            @Html.HiddenFor(model => model.CreatedByName)
                            @Html.HiddenFor(model => model.UpdatedByName)
                            @Html.HiddenFor(model => model.IsEDIOrder)
                            @Html.HiddenFor(model => model.IsDeleted)
                            @Html.HiddenFor(model => model.IsArchived)
                            @Html.HiddenFor(model => model.OrderType)
                            @Html.HiddenFor(model => model.IsRecordNotEditable)
                            @Html.HiddenFor(model => model.IsOnlyStatusUpdate)
                            @Html.HiddenFor(model => model.SupplierName)
                            @Html.HiddenFor(model => model.OrderDate)
                            @Html.HiddenFor(model => model.OrderStatusChar)
                            @Html.HiddenFor(model => model.ChangeOrderRevisionNo)
                            @Html.HiddenFor(model => model.IsChangeOrderClick, new { @id = "hdnIsChangeOrdclick" })
                            <input type="hidden" name="hdnIsEDISentOnEditOrderLineItems" id="hdnIsEDISentOnEditOrderLineItems" value="" />
                            <input type="hidden" name="hdnIsEditOrderLineItems" id="hdnIsEditOrderLineItems" value="" />
                            <input type="hidden" name="hdnIsSupplierApprove" id="hdnIsSupplierApprove" value="" />
                            <input type="hidden" name="hdnPrevOrderStatus" id="hdnPrevOrderStatus" value="" />
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="ExpandedContent" style="display: none">
            <ul>
                <li style="border: none">
                    <div class="editorForm">
                        <ul>
                            <li>
                                <div class="editor-label">
                                    @Html.LabelFor(model => model.Comment)
                                </div>
                                <div class="editor-field">
                                    @Html.TextAreaFor(model => model.Comment, new { @class = "text-box", onkeypress = "return NotAllowCharacter(event);", ondrop = "return false;", onblur = "return NotAllowedSpecialCharacters(this);", maxlength = 1024 })
                                    <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.Comment)</span>
                                </div>
                            </li>
                            <li>
                                <div class="editor-label">
                                    @Html.LabelFor(model => model.ReleaseNumber)
                                </div>
                                <div class="editor-field">
                                    @Html.TextBoxFor(model => model.ReleaseNumber, new { id = "txtReleaseNumber", @class = "text-box", @style = "background:white", maxlength = 255 })
                                    <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.ReleaseNumber)</span>
                                </div>
                            </li>
                            <li>
                                <div class="editor-label">
                                    @Html.LabelFor(model => model.ShippingTrackNumber)
                                </div>
                                <div class="editor-field">
                                    @Html.TextBoxFor(model => model.ShippingTrackNumber, new { @class = "text-box" })
                                    <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.ShippingTrackNumber)</span>
                                </div>
                            </li>
                            <li>
                                <div class="editor-label">
                                    @Html.LabelFor(model => model.ShippingVendor)
                                </div>
                                <div class="editor-field" id="divVendor">
                                    @if (HasOnTheFlyEntryRight)
                                    {
                                        <span style='position: relative'>
                                            @Html.TextBoxFor(model => model.ShippingVendorName, new { id = "txtVendorName", @class = "AutoCompleteddl text-box" })
                                            <a id='lnkShowAllOptions' href='javascript:void(0);' style='position: absolute; right: 5px;
                                            top: 0px;' class="ShowAllOptions">
                                                <img src='/Content/images/arrow_down_black.png' alt='select' />
                                            </a>
                                        </span>
                                    }
                                    else
                                    {
                                        <span style='position: relative'>
                                            @Html.DropDownListFor(x => x.ShippingVendorName, new SelectList(ViewBag.VendorList, "Vender", "Vender", Model.ShippingVendorName), new { @class = "selectBox", @id = "slctShippingVendorName" })
                                            <input type="hidden" name="txtShippingVendorName" id="txtShippingVendorName" value="@Model.ShippingVendorName" />
                                        </span>
                                    }
                                    <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.ShippingVendorName)</span>
                                </div>
                            </li>
                            <li>
                                <div class="editor-label">
                                    @Html.LabelFor(model => model.ShipVia)
                                </div>
                                <div class="editor-field">
                                    @if (HasOnTheFlyEntryRight)
                                    {
                                        <span style='position: relative'>
                                            @Html.TextBoxFor(model => model.ShipViaName, new { id = "txtShipViaName", @class = "AutoCompleteddl text-box" })

                                            <a id='lnkShowAllOptions' href='javascript:void(0);' style='position: absolute; right: 5px;
                                            top: 0px;' class="ShowAllOptions">
                                                <img src='/Content/images/arrow_down_black.png' alt='select' />
                                            </a>

                                        </span>

                                    }
                                    else
                                    {
                                        <span style='position: relative'>
                                            @Html.DropDownListFor(x => x.ShipViaName, new SelectList(ViewBag.ShipViaList, "ShipVia", "ShipVia", Model.ShipViaName), new { @class = "selectBox", @id = "slctShipViaList" })
                                            <input type="hidden" name="txtShipViaName" id="txtShipViaName" value="@Model.ShipViaName" />
                                        </span>
                                    }
                                    <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.ShipViaName)</span>
                                </div>
                            </li>
                            <li>
                                <div class="editor-label">
                                    @Html.LabelFor(model => model.StagingID)
                                </div>
                                <div class="editor-field">
                                    @if (HasOnTheFlyEntryRight)
                                    {
                                        if (Model.ID > 0)
                                        {
                                            @Html.TextBoxFor(model => model.StagingName, new { id = "txtStagingName", @class = "text-box", @readonly = "readonly" })
                                        }
                                        else
                                        {

                                            <span style='position: relative'>
                                                @Html.TextBoxFor(model => model.StagingName, new { id = "txtStagingName", @class = "AutoCompleteddl text-box" })

                                                <a id='lnkShowAllOptions' href='javascript:void(0);' style='position: absolute; right: 5px;
                                                top: 0px;' class="ShowAllOptions">
                                                    <img src='/Content/images/arrow_down_black.png' alt='select' />
                                                </a>
                                            </span>

                                        }
                                        <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.StagingName)</span>
                                    }
                                    else
                                    {
                                        if (Model.ID > 0)
                                        {
                                            <span style='position: relative'>
                                                @Html.DropDownListFor(x => x.StagingName, new SelectList(ViewBag.StagingList, "StagingName", "StagingName", Model.StagingName), new { @class = "selectBox", @name = "slctStagingName", @id = "slctStagingName", @disabled = "@disabled" })
                                                <input type="hidden" name="txtStagingName" id="txtStagingName" value="@Model.StagingName" />
                                                @Html.HiddenFor(x => x.StagingName, new { @id = "StagingName", @name = "StagingName" })
                                            </span>
                                        }
                                        else
                                        {
                                            <span style='position: relative'>
                                                @Html.DropDownListFor(x => x.StagingName, new SelectList(ViewBag.StagingList, "StagingName", "StagingName", Model.StagingName), new { @class = "selectBox", @id = "slctStagingName" })
                                                <input type="hidden" name="txtStagingName" id="txtStagingName" value="@Model.StagingName" />
                                            </span>
                                        }
                                    }
                                </div>
                            </li>
                            <li>
                                @if (Model.OrderType == (int)OrderType.Order)
                                {
                                    <div class="editor-label">
                                        @*@Html.LabelFor(model => model.CustomerID)*@
                                        @Html.LabelFor(model => model.CustomerGUID)
                                    </div>
                                    <div class="editor-field">
                                        @if (HasOnTheFlyEntryRight)
                                        {
                                            <span style='position: relative'>
                                                @Html.TextBoxFor(model => model.CustomerName, new { id = "txtCustomerName", @class = "AutoCompleteddl text-box" })

                                                <a id='lnkShowAllOptions' href='javascript:void(0);' style='position: absolute; right: 5px;
                                                top: 0px;' class="ShowAllOptions">
                                                    <img src='/Content/images/arrow_down_black.png' alt='select' />
                                                </a>
                                            </span>
                                        }
                                        else
                                        {
                                            <span style='position: relative'>
                                                @Html.DropDownListFor(x => x.CustomerName, new SelectList(ViewBag.CustomerList, "Customer", "Customer", Model.CustomerName), new { @class = "selectBox", @id = "slctCustomerName" })
                                                <input type="hidden" name="txtCustomerName" id="txtCustomerName" value="@Model.CustomerName" />
                                            </span>
                                        }
                                        <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.CustomerName)</span>
                                    </div>
                                }
                                else
                                {
                                    @Html.HiddenFor(model => model.CustomerGUID)
                                }
                            </li>
                            <li>
                                @if (Model.OrderType == (int)OrderType.Order)
                                {
                                    <div class="editor-label">
                                        @Html.LabelFor(model => model.SalesOrder)
                                    </div>
                                    <div class="editor-field">
                                        @Html.TextBoxFor(model => model.SalesOrder, new { @class = "text-box", maxlength = 100 })
                                        <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.SalesOrder)</span>
                                    </div>
                                }
                            </li>
                            <li>
                                @if (Model.OrderType == (int)OrderType.Order)
                                {
                                    <div class="file-input-wrap editor-label">
                                        @ResOrder.OrderFilesLabel
                                    </div>
                                    <div class="editor-field">
                                        <input type="hidden" id="hdOrderAllowedFileExtension" value="@OrderAllowedFileExtension" />
                                        <input type="file" name="file" id="file" style="display:none;" multiple>
                                        <div class='round-button'>
                                            <label class="round-button-circle" for="file">@ResCommon.ChooseFile</label><label id="lblnofilechoosen" style="padding-left:5px">@ResCommon.Nofilechosen</label>
                                        </div>
                                        <table class="FileUploadList" style="width:43%;margin-left: 30%;margin-top: 12px;">
                                            <thead>
                                                <tr>
                                                    <th style="width:98%;">
                                                        @ResToolMaster.FileName
                                                    </th>

                                                    <th style="width:2%;">
                                                        @ResToolMaster.Delete
                                                    </th>
                                                </tr>
                                            </thead>

                                        </table>
                                    </div>
                                }

                            </li>

                            <li style="display: none">
                                <div class="editor-label">
                                    @Html.CheckBox("chkIsCustomerAddress", false)
                                </div>
                                <div class="editor-field">
                                    @Html.TextAreaFor(model => model.CustomerAddress, new { @class = "text-box", maxlength = 1024, @style = "display:none" })
                                    @Html.ValidationMessageFor(model => model.CustomerGUID)
                                </div>
                            </li>


                            @if (Model.ChangeOrderRevisionNo.GetValueOrDefault(0) > 0)
                            {
                                <li>
                                    <div class="editor-label">
                                        @Html.LabelFor(model => model.ChangeOrderRevisionNo)
                                    </div>
                                    <div class="editor-field">
                                        @Html.TextBoxFor(model => model.ChangeOrderRevisionNo, new { @class = "text-box", @readonly = "readonly", @style = "display:block" })
                                        @Html.ValidationMessageFor(model => model.CustomerGUID)
                                    </div>
                                </li>
                            }
                        </ul>
                    </div>
                    <div class="editorForm padRightNone divClsOrderRigthPan">
                        <ul>
                            <li>
                                <div class="editor-label">
                                    @Html.LabelFor(model => model.PackSlipNumber)
                                </div>
                                <div class="editor-field">
                                    @Html.TextBoxFor(model => model.PackSlipNumber, new { id = "txtPackslipNumber", @class = "text-box", maxlength = 255 })
                                    <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.PackSlipNumber)</span>
                                </div>
                            </li>
                            <li>
                                <div class="editor-label">
                                    @Html.LabelFor(model => model.SupplierAccountGuid)
                                </div>
                                <div class="editor-field">
                                    @*@Html.DropDownListFor(model => model.SupplierAccountGuid, new SelectList(ViewBag.SupplierAccount, "GUID", "AccountNumnerMerge", Model.SupplierAccountGuid), new { @id = "ddlSupplierAccount", @class = "selectBox", @style = "width:120px", autofocus = "autofocus" })*@
                                    @if (Model.OrderStatus >= 4 && (Model.SupplierAccountGuid == null || Model.SupplierAccountGuid == Guid.Empty))
                                    {
                                        @Html.DropDownListFor(model => model.SupplierAccountGuid, new SelectList(new List<eTurns.DTO.SupplierAccountDetailsDTO>
                                        (), "GUID", "AccountNumnerMerge", Model.SupplierAccountGuid), new { @id = "ddlSupplierAccount", @class = "selectBox", @style = "width:120px", autofocus = "autofocus" })
                                    }
                                    else
                                    {
                                        @Html.DropDownListFor(model => model.SupplierAccountGuid, new SelectList(ViewBag.SupplierAccount, "GUID", "AccountNumnerMerge", Model.SupplierAccountGuid), new { @id = "ddlSupplierAccount", @class = "selectBox", @style = "width:120px", autofocus = "autofocus" })
                                    }
                                    <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.SupplierAccountGuid)</span>
                                    @Html.HiddenFor(model => model.SupplierAccountGuid)
                                </div>
                            </li>
                            @Html.Partial("UDFLayout", new eTurns.DTO.ResOrder())
                            <li id="liReject" style="display: none;">
                                <div class="editor-label">
                                    @Html.LabelFor(model => model.RejectionReason)<em style="color: Red">*</em>
                                </div>
                                <div class="editor-field">
                                    @Html.TextAreaFor(model => model.RejectionReason, new { @style = "-webkit-border-radius: 5px;-moz-border-radius: 5px;border-radius: 5px;behavior: url(/pie1.htc);background: #fff;border: 1px solid #dddddd;width: 34%;padding: 5px;" })
                                    @Html.ValidationMessageFor(model => model.RejectionReason)
                                </div>
                            </li>
                        </ul>
                        @Html.Hidden("hdnCopyUDFValuesTemp", "", new { @id = "hdnCopyUDFValuesTemp" })
                    </div>
                </li>
            </ul>
        </div>
        <div class="editorForm" style="width: 98%">
            <ul>
                <li>
                    <div class="editor-label" style="width: 2%">
                        &nbsp;
                    </div>
                    <div class="BtnBlockform">
                        <input type="button" value="@eTurns.DTO.Resources.ResCommon.Cancel" id="btnOrderCancel" class="CreateBtn" />
                        @if (!Model.IsOnlyStatusUpdate && (Model.OrderStatus >= (int)OrderStatus.Approved && Model.OrderStatus < (int)OrderStatus.Closed && !Model.IsArchived.GetValueOrDefault(false))
&& AbleToEdit)
                        {
                            <input type="button" value="@ResCommon.Save" id="btnUpdateComment" class="CreateBtn" />
                        }
                        @if ((!Model.IsRecordNotEditable || Model.IsOnlyStatusUpdate) && ((Model.ID < 1 && AbleToInsert)
|| (Model.ID > 0 && AbleToEdit) || (AbleToInsert && AbleToEdit)) && !Model.IsArchived.GetValueOrDefault(false))
                        {
                            <input type="submit" value="@eTurns.DTO.Resources.ResCommon.Save" id="btnOrderSave" class="CreateBtn" />
                            if (Model.IsRecordNotEditable && Model.IsOnlyStatusUpdate)
                            {
                                <script type="text/javascript">
                                    disableControls('frmOrder');
                                    $('#ddlOrderStatus, #btnOrderSave, #btnOrderCancel,#aRptSingle').removeAttr('disabled');
                                </script>
                            }
                        }
                        else if (Model.OrderStatus == (int)OrderStatus.Closed && IsableToUnCloseOrder && !Model.IsArchived.GetValueOrDefault(false) &&  !(Model.IsDeleted && Model.OrderStatus == (int)OrderStatus.Closed))
                        {
                            <input type="button" value="@ResOrder.UncloseOrder" id="bntUncloseOrderOnlyInEditPage" class="CreateBtn" />
                            <input type="button" value="@eTurns.DTO.ResOrder.EditOrderLineItems" id="btnUncloseOrder" class="CreateBtn" style="display:none" />



                            <script type="text/javascript">
                                disableControls('frmOrder');
                                $('#btnOrderCancel,#aRptSingle').removeAttr('disabled');
                            </script>
                        }
                        else
                        {
                            <script type="text/javascript">
                                disableControls('frmOrder');
                                $('#btnOrderCancel,#aRptSingle').removeAttr('disabled');
                            </script>
                        }
                        @if (Model.OrderStatus != (int)OrderStatus.UnSubmitted && Model.OrderStatus != (int)OrderStatus.Closed)
                        {
                            <script type="text/javascript">
                                disableControls('frmOrder');
                                $('#ddlOrderStatus,#btnOrderSave,#btnOrderCancel,#aRptSingle').removeAttr('disabled');

                            </script>
                        }
                    </div>
                </li>
                @if (Model.ID > 0)
                {
                    <div class="BtnBlockform">
                        @if (!Model.IsRecordNotEditable && (Model.OrderStatus <= (int)OrderStatus.Submitted || Model.OrderStatus == (int)OrderStatus.Transmitted) && !Model.IsArchived.GetValueOrDefault(false))
                        {
                            <input type="button" value="@eTurns.DTO.ResOrder.AddNewItemButton" id="btnAddNewItem" class="CreateBtn" style="float: left;
                                    margin-left: 20px;" />
                            if (Model.OrderType == (int)OrderType.Order)
                            {
                                <div style="padding-top: 2.7px;">
                                    @(Html.Partial("SupplierCatalog", new SupplierCatalogItemDTO() { SourcePageName = "OrderMaster", OpenPopup = true, ButtonText = ResOrder.AddFromCatalogButton, OrderGUID = Model.GUID, OrderSupplier = Model.SupplierName }))
                                </div>
                            }
                        }
                        @if (Model.OrderStatus == (int)OrderStatus.Approved && !Model.IsArchived.GetValueOrDefault(false))
                        {
                            <input type="button" value="Transmit" id="btnTransmit" class="CreateBtn" style="display: none;" />
                        }
                    </div>

                }
            </ul>
        </div>
        <div class="infoBlock" style="margin-bottom: 10px; margin-top: 10px;">
            <ul>
                <li style="width: auto;">
                    <label for="RoomName">
                        <label>
                            @ResOrder.NoOfLineItems
                        </label>
                    </label>
                    : <span id="spnNoOfItems">@Model.NoOfLineItems.GetValueOrDefault(0)</span>
                </li>
                <li style="border: none; width: auto; display:none">
                    <label for="RoomName">
                        @if (Model.OrderType == (int)OrderType.Order)
                        {
                            <label>
                                @eTurns.DTO.ResOrder.OrderCost
                            </label>
                        }
                        else
                        {
                            <label>
                                @eTurns.DTO.ResOrder.ReturnOrderCost
                            </label>
                        }
                    </label>
                    : <span id="spnTotalCost">$ @Model.OrderCost.GetValueOrDefault(0).ToString(priceformate1)</span>
                </li>
                <li style="border: none; width: auto;" id="liOrderCostInfo">
                    <label for="RoomName">
                        <label id="lblOrderTotalSellPrice">@ResOrder.TotalSellPrice</label>
                        <label id="lblOrderTotalCost">@ResOrder.TotalCost</label>
                    </label>
                    : <span id="spnTotalOrderCost">'@CurrencySymbol' + ' ' + @Model.OrderCost.GetValueOrDefault(0).ToString(priceformate1, eTurnsWeb.Helper.SessionHelper.RoomCulture)</span>
                    <span id="spnTotalOrderPrice">'@CurrencySymbol' + ' ' +  @Model.OrderPrice.ToString(priceformate1, eTurnsWeb.Helper.SessionHelper.RoomCulture)</span>
                </li>
            </ul>
        </div>
    </div>
    <div id="divOrderLineItems">
        @ResOrder.NoItemLineAvailable
    </div>
}
<div class="dialog" id="OrdApprdInfoDialog" style="float: left; display: none; width: 450px;">
    <div class="inner" style="width: 450px;">
        <p class="text" id="Message" style="float: left; text-align: left; padding-left: 10px;">
            <b>@ResOrder.ConfirmApprQuantiyMassage </b>
        </p>
        <p class="text" style="float: left; text-align: center; padding-left: 10px;">
            <a href="javascript:void(0)" class="yes" onclick="ModelYesClick()">
                <img src="~/Content/images/yes.png" alt="@eTurns.DTO.Resources.ResCommon.Yes" />@eTurns.DTO.Resources.ResCommon.Yes
            </a>&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)"
                                     class="no" onclick="ModelCancelClick()">
                <img src="~/Content/images/no.png" alt="@eTurns.DTO.Resources.ResCommon.Cancel" />@eTurns.DTO.Resources.ResCommon.Cancel
            </a>
        </p>
    </div>
</div>
<div class="dialog" id="divOrdCancelUnsaveItemInfoDialog" style="float: left; display: none;
    width: 450px;">
    <div class="inner" style="width: 450px;">
        <p class="text" id="Message" style="float: left; text-align: left; padding-left: 10px;">
            @*<b>@ResOrder.ConfirmApprQuantiyMassage </b>*@ <b>
                Newly added items will be deleted,
                Do you want to continue
            </b>
        </p>
        <p class="text" style="float: left; text-align: center; padding-left: 10px;">
            <a href="javascript:void(0)" class="yes" onclick="CancelUnsaveModelYesClick();">
                <img src="~/Content/images/yes.png" alt="@eTurns.DTO.Resources.ResCommon.Yes" />@eTurns.DTO.Resources.ResCommon.Yes
            </a>&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)"
                                     class="no" onclick="CancelUnsaveModelCancelClick()">
                <img src="~/Content/images/no.png" alt="@eTurns.DTO.Resources.ResCommon.No" />@eTurns.DTO.Resources.ResCommon.No
            </a>
        </p>
    </div>
</div>
<div id="ItemModel">
</div>
<div id="divAddNewItemDailog">

</div>
<div id="divEditReceipt">
</div>
<div class="dialog" id="divUnCloseOrderToEdit" style="float: left; display: none;
    width: 450px;">
    <div class="inner" style="width: 450px;">
        <p class="text" id="UCOLIE" style="float: left; text-align: left; padding-left: 10px;">
            <b>a.</b>&nbsp;All received quantities will be unreceived
            <br />
            <b>b.</b>&nbsp;All order items may be edited or deleted
            <br />
            <b>c.</b>&nbsp;New order Items may be added to the order
            <br />
            <b>d.</b>&nbsp;The order will need to be approved once submitted
            <br />
            <b>e.</b>&nbsp;The order will be re-transmitted to the supplier once approved
            <br />
            <b>f.</b>&nbsp;Orders Created from EDI are not to be unclosed
            <br />
        </p>
        <p class="text" style="float: left; text-align: center; padding-left: 10px;">
            <a href="javascript:void(0)" class="yes" onclick="UnCloseOrderToEdit()">
                <img src="~/Content/images/yes.png" alt="@eTurns.DTO.Resources.ResMessage.InformOk" />@eTurns.DTO.Resources.ResMessage.InformOk
            </a>&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)"
                                     class="no" onclick="UnCloseOrderCancel()">
                <img src="~/Content/images/no.png" alt="@eTurns.DTO.Resources.ResCommon.Cancel" />@eTurns.DTO.Resources.ResCommon.Cancel
            </a>
        </p>
    </div>
</div>
@Html.Partial("_RequiredMessages")
<script type="text/javascript">
    var IsArchivedOrder = '@Model.IsArchived.GetValueOrDefault(false)';
    var ResFileName = '@ResToolMaster.FileName';
    var ResDelete = '@ResToolMaster.Delete';
    var MsgInvalidFileSelected = '@ResWorkOrder.MsgInvalidFileSelected';
    var MsgvalidFileList = '@ResWorkOrder.MsgvalidFileList';
    $('#bntUncloseOrderOnlyInEditPage').off('click');
    $('#bntUncloseOrderOnlyInEditPage').on('click', function () {
        var anSelectedRows = fnGetSelected(oTable);
        if (anSelectedRows.length == 1) {
            OrderGUID = $(anSelectedRows[0]).find('#spnOrderGUID').text();
            $.ajax({
                url: 'ToUnclosedOrder',
                'type': 'Post',
                'data': { 'OrderGuid': OrderGUID },
                'dataType': 'json',
                //'contentType': 'application/json',
                'success': function (result) {
                    if (result.Status) {
                        LoadReceiveTab("OrderEdit/" + '@(Model.ID)', "frmOrder")
                        //oTable.fnStandingRedraw();
                    }
                    else {
                        alert(result.Message);
                    }
                },
                'error': function (xhr) {
                    $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                    $("#spanGlobalMessage").html('@ResCommon.ErrorInProcess');
                    showNotificationDialog();
                    //alert('@ResCommon.ErrorInProcess');
                }

            });
        }
    });


    var IsBlanket = '@Model.IsBlanketOrder';
    $("#hdnIsSupplierApprove").val('@Model.IsSupplierApprove');

    $('#btnUpdateComment').on('click', function () {
        _createOrder.expandCollapseForm(true);
        if (_createOrder.isFormValid() == false) {
            return false;
        }

        $('#DivLoading').show();
        var arrItems = new Array();
        var OrderID = '@Model.ID';
        var OrderGUID = '@Model.GUID';
        var strPackslipNumber = $.trim($('#frmOrder').find('#txtPackslipNumber').val());
        var strShipmentTrackingNumber = $.trim($('#frmOrder').find('#ShippingTrackNumber').val());
        var strComment = $.trim($('#frmOrder').find('#Comment').val());


        if ($('#OrderLineItem' + OrdID).val() != undefined) {
            var ItemNodes = $('#OrderLineItem' + OrdID).dataTable().fnGetNodes();
        } else {
            var ItemNodes = $('#RecieveOrderLineItem' + OrderID).dataTable().fnGetNodes();
        }
        for (var i = 0; i < ItemNodes.length; i++) {
            var ID = $(ItemNodes[i]).find('#hdnID').val();
            var ItemGUID = $(ItemNodes[i]).find('#hdnItemGUID').val();
            var OrderGUID = $(ItemNodes[i]).find('#hdnOrderGUID').val();
            var Comment = $.trim($(ItemNodes[i]).find('#Comment').val());

            var vUDF1 = '';
            var vUDF2 = '';
            var vUDF3 = '';
            var vUDF4 = '';
            var vUDF5 = '';

            if ($(ItemNodes[i]).find('#UDF1OrderDetails') != null) {
                if ($(ItemNodes[i]).find('#UDF1OrderDetails').attr("class") == 'selectBox') {
                    vUDF1 = $(ItemNodes[i]).find('#UDF1OrderDetails option:selected').text();
                }
                else {
                    vUDF1 = $(ItemNodes[i]).find('#UDF1OrderDetails').val();
                }
            }

            if ($(ItemNodes[i]).find('#UDF2OrderDetails') != null) {
                if ($(ItemNodes[i]).find('#UDF2OrderDetails').attr("class") == 'selectBox') {
                    vUDF2 = $(ItemNodes[i]).find('#UDF2OrderDetails option:selected').text();
                }
                else {
                    vUDF2 = $(ItemNodes[i]).find('#UDF2OrderDetails').val();
                }
            }

            if ($(ItemNodes[i]).find('#UDF3OrderDetails') != null) {
                if ($(ItemNodes[i]).find('#UDF3OrderDetails').attr("class") == 'selectBox') {
                    vUDF3 = $(ItemNodes[i]).find('#UDF3OrderDetails option:selected').text();
                }
                else {
                    vUDF3 = $(ItemNodes[i]).find('#UDF3OrderDetails').val();
                }
            }

            if ($(ItemNodes[i]).find('#UDF4OrderDetails') != null) {
                if ($(ItemNodes[i]).find('#UDF4OrderDetails').attr("class") == 'selectBox') {
                    vUDF4 = $(ItemNodes[i]).find('#UDF4OrderDetails option:selected').text();
                }
                else {
                    vUDF4 = $(ItemNodes[i]).find('#UDF4OrderDetails').val();
                }
            }

            if ($(ItemNodes[i]).find('#UDF5OrderDetails') != null) {
                if ($(ItemNodes[i]).find('#UDF5OrderDetails').attr("class") == 'selectBox') {
                    vUDF5 = $(ItemNodes[i]).find('#UDF5OrderDetails option:selected').text();
                }
                else {
                    vUDF5 = $(ItemNodes[i]).find('#UDF5OrderDetails').val();
                }
            }
            if (parseFloat(ID) > 0) {
                var data = {
                    "ID": ID, "ItemGUID": ItemGUID, "OrderGUID": OrderGUID, "Comment": Comment, "UDF1": vUDF1, "UDF2": vUDF2,
                    "UDF3": vUDF3, "UDF4": vUDF4, "UDF5": vUDF5
                };
                arrItems.push(data);
            }
        }

        var objOrder = {
            'ID': OrderID, 'GUID': OrderGUID, 'Comment': strComment, 'PackSlipNumber': strPackslipNumber,
            'ShippingTrackNumber': strShipmentTrackingNumber, 'OrderListItem': arrItems
        };

        //setTimeout(function () {
        $.ajax({
            url: 'UpdateSomeFieldsInOrder',
            type: 'Post',
            async: false,
            data: JSON.stringify(objOrder),
            dataType: 'json',
            contentType: "application/json",
            success: function (obj) {
                if (obj.Status) {
                    $("#spanGlobalMessage").removeClass('errorIcon WarningIcon').addClass('succesIcon');
                    $("#spanGlobalMessage").html("@ResOrder.msgSavedSuccessfully");
                    //Delete file
                    if (DeleteoFileId != '') {
                        DeleteExisting(DeleteoFileId, OrderGUID);
                    }
                    //save file upload files
                    saveOrderFiles(OrderID, OrderGUID);
                }
                else {
                    $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                    $("#spanGlobalMessage").html("@ResOrder.msgNotSavedSuccessfully");
                }
                showNotificationDialog();
                $('#DivLoading').hide();
                isDirtyForm = false;
                $('form#frmOrder').removeClass('dirty');
                document.location = '@Url.Content("~/Order/OrderList#list")';
            },
            error: function (xhr) {
                $('#DivLoading').hide();
            }
        });
        // }, 100);

    });

    function ModelCancelClick() {
        $.modal.impl.close();
    }
    function SetReleaseEditable(isReleaseEditable) {
        if (isReleaseEditable === true || isReleaseEditable === 'True') {
            $('#txtReleaseNumber').removeProp('readonly');
        }
        else {
            $('#txtReleaseNumber').prop('readonly',true);

        }

    }
    function ModelYesClick() {
        var ItemNodes = $('#OrderLineItem' + OrdID).dataTable().fnGetNodes();
        for (var i = 0; i < ItemNodes.length; i++) {
            //$('#OrderLineItem' + OrdID + ' tbody tr').each(function () {
            var Qty = $(ItemNodes[i]).find('#txtQty').val();
            if (isNaN(parseFloat(Qty)) === false && parseFloat(Qty) > 0) {
                var ApprQty = $(ItemNodes[i]).find('#txtApprQty').val();
                if (isNaN(parseFloat(ApprQty)) === true || parseFloat(ApprQty) <= 0) {
                    $(ItemNodes[i]).find('#txtApprQty').val(Qty)

                }
            }
        } //);
        $.modal.impl.close();
        $("#btnOrderSave").click();
    }

    var OrderID = '@Model.ID';
    var OrderGUID = '@(Model.GUID.ToString())';
    var OrderStatus = '@Model.OrderStatus';



    //$("#btnOrderSave").on("click", function (e) {
    $(document).off('click', 'input#btnOrderSave');
    $(document).on("click", 'input#btnOrderSave', function (e) {
        _createOrder.expandCollapseForm(true);
        ExpandOrderNarrowSearch();
        SaveOrderDetail(e);
    });


    function SaveOrderDetail(e, isFromEditOrderLineItems) {
        $('#DivLoading').show();
        if ('@Model.OrderType' == '@((int)OrderType.RuturnOrder)') {
            var ordernumberTextbox = $("#txtOrderNumber");
            if (ordernumberTextbox != null && ordernumberTextbox !== undefined && typeof (ordernumberTextbox) !== undefined) {
                $(ordernumberTextbox).attr('data-val-required', "The field Return Order Number is required.");
            }

        }
        var _vIsDeleted = false;
        if (typeof ($('#IsDeletedRecordsOrdLn')) != undefined) {
            _vIsDeleted = $('#IsDeletedRecordsOrdLn').is(':checked');

            if (_vIsDeleted == true) {
                $('#DivLoading').hide();
                $("#spanGlobalMessage").html("@eTurns.DTO.Resources.ResMessage.RemoveDeletedItemFlag");
                showNotificationDialog();
                $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                isError = true;
                if (e.selector == undefined) {
                    e.preventDefault();
                }
                return false;
            }
        }

        var IsSuppApprove = $("#hdnIsSupplierApprove").val();
        $("#hdnPrevOrderStatus").val($('#ddlOrderStatus').val());
        if ('@Model.OrderType' == '@((int)OrderType.Order)') {
            if ($('#ddlOrderStatus').val() === '@((int)OrderStatus.Submitted)' && '@IsableToApprove' == "True" && IsSuppApprove != false && IsSuppApprove.toLowerCase() != "false") {
                $("#hdnPrevOrderStatus").val($('#ddlOrderStatus').val());
                $('#ddlOrderStatus').val('@((int)OrderStatus.Approved)');
            }
        }
        else {
            if ($('#ddlOrderStatus').val() === '@((int)OrderStatus.Submitted)' && '@IsableToApprove' == "True") {
                $('#ddlOrderStatus').val('@((int)OrderStatus.Approved)');
            }
        }


        if (!isNaN(parseInt($('#hiddenID').val())) && IsBlanket == "True") {
            if (!isNaN(parseInt($('#ddlBlanketPO').val())) && parseInt($('#ddlBlanketPO').val()) > 0) {
                $('#spnErrOrderNumber').val('');
                $('#txtOrderNumber').val($('#ddlBlanketPO :selected').text());
                $('#spnErrOrderNumber').css('display', 'none');
            }
            else {
                $('#txtOrderNumber').val('');
                $('#spnErrOrderNumber').css('display', 'inline');
                $('#DivLoading').hide();
                if (e.selector == undefined) {
                    e.preventDefault();
                }
                return false;
            }
        }
        if ((((parseInt('@Model.ID') > 0) || (parseInt('@Model.ID') <= 0)) && IsBlanket == "False" && '@Model.OrderType' == '@((int)OrderType.RuturnOrder)')) {
            if ($('#txtOrderNumber').val() != '') {
                $('#spnErrReturnOrderNumber').css('display', 'none');
                /*
                comment return line for WI-4296
                return true;
                */
            }
            else {

                $('#spnErrReturnOrderNumber').css('display', 'inline');
                $('#DivLoading').hide();
                return false;
            }
        }

        var isError = false;

        if ('@Model.ID' > 0 && OrdID > 0) {
            var LineItems = $('#OrderLineItem' + OrdID).dataTable().fnGetNodes();
            for (var i = 0; i < LineItems.length; i++) {

                var qty = $(LineItems[i]).find('#txtQty').val();

                if (isNaN(parseFloat(qty)) || parseFloat(qty) <= 0) {
                    $('#DivLoading').hide();
                    $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                    $("#spanGlobalMessage").html('@ResOrder.msgRequestedQuantity');
                    showNotificationDialog();
                    //alert('@ResOrder.msgRequestedQuantity');
                    $(LineItems[i]).find('#txtQty').focus();
                    isError = true;
                    return false;
                }
                var binName = $(LineItems[i]).find('#txtBinNumber').val();

                if (typeof (binName) == "undefined" || binName == null || binName == '' || binName.trim().length < 1)
                {
                    //alert('@string.Format(ResMessage.MsgRequired,ResOrder.Bin)');
                    $(LineItems[i]).find('#txtBinNumber').focus();
                    $('#DivLoading').hide();
                    $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                    $("#spanGlobalMessage").html('@string.Format(ResMessage.MsgRequired,ResOrder.Bin)');
                    showNotificationDialog();
                    isError = true;
                    if (e.selector == undefined) {
                        e.preventDefault();
                    }
                    return false;
                }

                var isEnforceDefultOrdQty = $(LineItems[i]).find('#hdnIsEnforceDefultOrdQty').val();
                if (isEnforceDefultOrdQty == 'True' && '@Model.OrderType' == '@((int)OrderType.Order)') {
                    var apprQty = $(LineItems[i]).find('#txtApprQty').val();
                    var itemNumber = $(LineItems[i]).find('#hdnItemNumber').val();
                    var IsAllowOrderCostuom = $(LineItems[i]).find('#hdnIsAllowOrderCostuom').val();
                    var OrderUOMValue = $(LineItems[i]).find('#hdnOrderUOMValue').val();
                    var defultOrderQty = $(LineItems[i]).find('#hdnDefultOrderQty').val();
                    var modulo = 0;

                    if (!isNaN(parseFloat(defultOrderQty)) && parseFloat(defultOrderQty) > 0) {
                        var alertMsg = ' ' + '@ResOrder.QuantityNotMatchedWithDefaultReOrderQty'.replace("{0}", defultOrderQty).replace("{1}", itemNumber)
                        //var alertMsg = ' Qty. is not matched with Default Reorder Qty. Please update it to multiple of ' + defultOrderQty + ' for Item#' + itemNumber;
                        if (!isNaN(parseFloat(apprQty)) && parseFloat(apprQty) > 0) {
                            if (IsAllowOrderCostuom == "True") {
                                modulo = (parseFloat(apprQty) * parseFloat(OrderUOMValue)) % (parseFloat(defultOrderQty));
                            }
                            else {
                                modulo = (parseFloat(apprQty)) % (parseFloat(defultOrderQty));
                            }
                            alertMsg = '@ResCommon.Approved' + ' ' + alertMsg;
                            $(LineItems[i]).find('#txtApprQty').focus();
                        }
                        else if (!isNaN(parseFloat(qty)) && parseFloat(qty) > 0) {
                            if (IsAllowOrderCostuom == "True") {
                                modulo = (parseFloat(qty) * parseFloat(OrderUOMValue)) % (parseFloat(defultOrderQty));
                            }
                            else {
                                modulo = (parseFloat(qty)) % (parseFloat(defultOrderQty));
                            }
                            alertMsg = '@ResCommon.Requested' + ' ' + alertMsg;
                            $(LineItems[i]).find('#txtQty').focus();
                        }

                        if (!isNaN(parseFloat(modulo)) && parseFloat(modulo) > 0) {
                            //alert(alertMsg);
                            $('#DivLoading').hide();
                            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                            $("#spanGlobalMessage").html(alertMsg);
                            showNotificationDialog();
                            isError = true;
                            if (e.selector == undefined) {
                                e.preventDefault();
                            }
                            return false;
                        }
                    }
                }
            }
            if (!isError)
                SaveLatestValueInSession();
        }

        if (!isError) {
            if (isNaN(parseInt($("#ddlOrderStatus").val())) === false && parseInt($("#ddlOrderStatus").val()) === parseInt('@((int)OrderStatus.Approved)')) {
                var ItemNodes = $('#OrderLineItem' + OrdID).dataTable().fnGetNodes();
                var ItemsList = '';
                for (var i = 0; i < ItemNodes.length; i++) {
                    var Qty = $(ItemNodes[i]).find('#txtQty').val();
                    if (isNaN(parseFloat(Qty)) === false && parseFloat(Qty) > 0) {
                        var ApprQty = $(ItemNodes[i]).find('#txtApprQty').val();
                        if (isNaN(parseFloat(ApprQty)) === true || parseFloat(ApprQty) <= 0) {
                            $('#OrdApprdInfoDialog').modal();
                            if (e.selector == undefined) {
                                e.preventDefault();
                            }
                            $('#DivLoading').hide();
                            return false;
                        }
                        if ('@(Model.OrderType.GetValueOrDefault(0))' == '@((int)OrderType.RuturnOrder)') {
                            $('#pItemListApprove').text('');
                            var onHandQty = $(ItemNodes[i]).find('#qtyTempOnHandQuantity_' + i).text();
                            var ItemNumber = $(ItemNodes[i]).find('#hdnItemNumber').val();
                            if (parseFloat(ApprQty) > parseFloat(onHandQty)) {
                                ItemsList += parseInt(i + 1) + "). " + ItemNumber + " :  @ResOrder.MsgApprovedQtygreaterthanonHandQty <br />";
                            }
                        }
                    }
                }
                if (ItemsList != '') {
                    $('#ValidateAppQty').modal();
                    $('#pItemListApprove').html(ItemsList);
                    if (e.selector == undefined) {
                        e.preventDefault();
                    }
                    $('#DivLoading').hide();
                    return false;
                }
            }
        }
        if (!isError && (isFromEditOrderLineItems !== undefined && isFromEditOrderLineItems != null && isFromEditOrderLineItems === true)) {
            $('#frmOrder').submit();
        }
    }

    function SaveLatestValueInSession() {
        var arrItems = new Array();
        $('#DivLoading').show();

        var ItemNodes = $('#OrderLineItem' + OrdID).dataTable().fnGetNodes();
        for (var i = 0; i < ItemNodes.length; i++) {

            var Qty = $(ItemNodes[i]).find('#txtQty').val();
            var ApprQty = $(ItemNodes[i]).find('#txtApprQty').val();
            var ID = $(ItemNodes[i]).find('#hdnID').val();
            var ItemGUID = $(ItemNodes[i]).find('#hdnItemGUID').val();
            var OrderGUID = $(ItemNodes[i]).find('#hdnOrderGUID').val();
            var vtempDetailsGUID = $(ItemNodes[i]).find('#hdnTempDetailsGUID').val();
            var RequiredDate = $(ItemNodes[i]).find('#hiddenDatePicker' + ID).val();
            //var tmpSupplierId = $(ItemNodes[i]).find('#hdnSupplierId').val();
            //var supplierID = (tmpSupplierId !== undefined && tmpSupplierId != null && tmpSupplierId != '' && !isNaN(tmpSupplierId)) ? tmpSupplierId : 0;
            //var supplierPartNo = $(ItemNodes[i]).find('#hdnSupplierPartNo').val();
            //var supplierName = $(ItemNodes[i]).find('#hdnSupplierName').val();

            if ((typeof (RequiredDate) == "undefined" || (typeof (RequiredDate) == undefined))) {
                RequiredDate = $(ItemNodes[i]).find('#hdnRequiredDate').val();
            }
            var IsEDISent = $(ItemNodes[i]).find('#hdnIsEDISent').val();
            var Comment = $(ItemNodes[i]).find('#Comment').val();


            if ($("#hdnIsEDISentOnEditOrderLineItems").val() == "true") {
                IsEDISent = false;
            }
            else if (IsEDISent == "True") {
                IsEDISent = true;
            }
            else {
                IsEDISent = false;
            }
            var vUDF1 = '';
            var vUDF2 = '';
            var vUDF3 = '';
            var vUDF4 = '';
            var vUDF5 = '';

            if ($(ItemNodes[i]).find('#UDF1OrderDetails') != null) {
                if ($(ItemNodes[i]).find('#UDF1OrderDetails').attr("class") == 'selectBox' && $(ItemNodes[i]).find('#UDF1OrderDetails option:selected').text() != undefined) {
                    vUDF1 = $(ItemNodes[i]).find('#UDF1OrderDetails option:selected').text();
                }
                else {
                    if ($(ItemNodes[i]).find('#UDF1OrderDetails').val() != undefined) {
                        vUDF1 = $(ItemNodes[i]).find('#UDF1OrderDetails').val();
                    }
                }
            }

            if ($(ItemNodes[i]).find('#UDF2OrderDetails') != null) {
                if ($(ItemNodes[i]).find('#UDF2OrderDetails').attr("class") == 'selectBox' && $(ItemNodes[i]).find('#UDF2OrderDetails option:selected').text() != undefined) {
                    vUDF2 = $(ItemNodes[i]).find('#UDF2OrderDetails option:selected').text();
                }
                else {
                    if ($(ItemNodes[i]).find('#UDF2OrderDetails').val() != undefined) {
                        vUDF2 = $(ItemNodes[i]).find('#UDF2OrderDetails').val();
                    }
                }
            }

            if ($(ItemNodes[i]).find('#UDF3OrderDetails') != null) {
                if ($(ItemNodes[i]).find('#UDF3OrderDetails').attr("class") == 'selectBox' && $(ItemNodes[i]).find('#UDF3OrderDetails option:selected').text() != undefined) {
                    vUDF3 = $(ItemNodes[i]).find('#UDF3OrderDetails option:selected').text();
                }
                else {
                    if ($(ItemNodes[i]).find('#UDF3OrderDetails').val() != undefined) {
                        vUDF3 = $(ItemNodes[i]).find('#UDF3OrderDetails').val();
                    }
                }
            }

            if ($(ItemNodes[i]).find('#UDF4OrderDetails') != null) {
                if ($(ItemNodes[i]).find('#UDF4OrderDetails').attr("class") == 'selectBox' && $(ItemNodes[i]).find('#UDF4OrderDetails option:selected').text() != undefined) {
                    vUDF4 = $(ItemNodes[i]).find('#UDF4OrderDetails option:selected').text();
                }
                else {
                    if ($(ItemNodes[i]).find('#UDF4OrderDetails').val() != undefined) {
                        vUDF4 = $(ItemNodes[i]).find('#UDF4OrderDetails').val();
                    }
                }
            }

            if ($(ItemNodes[i]).find('#UDF5OrderDetails') != null) {
                if ($(ItemNodes[i]).find('#UDF5OrderDetails').attr("class") == 'selectBox' && $(ItemNodes[i]).find('#UDF5OrderDetails option:selected').text() != undefined) {
                    vUDF5 = $(ItemNodes[i]).find('#UDF5OrderDetails option:selected').text();
                }
                else {
                    if ($(ItemNodes[i]).find('#UDF5OrderDetails').val() != undefined) {
                        vUDF5 = $(ItemNodes[i]).find('#UDF5OrderDetails').val();
                    }
                }
            }
            var binName = $(ItemNodes[i]).find('#txtBinNumber').val();

            if (isNaN(Qty) === false && parseFloat(Qty) > 0) {
                var data = {
                    "ID": ID
                , "ItemGUID": ItemGUID
                , "OrderGUID": OrderGUID
                , "tempDetailsGUID": vtempDetailsGUID
                , "RequestedQuantity": Qty
                , "ApprovedQuantity": ApprQty
                , "BinName": binName
                , "RequiredDateStr": RequiredDate
                , "IsEDISent": IsEDISent
                , "Comment": Comment
                    , "UDF1": vUDF1
                    , "UDF2": vUDF2
                    , "UDF3": vUDF3
                    , "UDF4": vUDF4
                    , "UDF5": vUDF5
                };
                arrItems.push(data);

            }
        }
        if (arrItems.length > 0) {
            $('#DivLoading').show();
            $.ajax({
                url: '@Url.Content("~/Order/SaveLatestValueInSession")',
                data: JSON.stringify({ 'arrDetails': arrItems, 'OrderID': OrdID }),
                dataType: 'json',
                type: 'POST',
                contentType: "application/json",
                async: false,
                cache: false,
                success: function (response) {
                    $('#DivLoading').hide();
                },
                error: function (exh) {
                    $('#DivLoading').hide();
                }

            });
        }

    }
    function onOrderBegin() {
        return $('DivLoading').show();
    }

    function onOrderSuccess(response) {
        IsRefreshGrid = true;
        IsRefreshGrid1 = true;

        showNotificationDialog();
        $("#spanGlobalMessage").html(response.Message);
        $("#spanGlobalMessage").removeClass('errorIcon WarningIcon').addClass('succesIcon');
        var idValue = $("#hiddenID").val();
        $('#DivLoading').hide();
        if (response.Status == "fail") {

            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            $("#Name").val("");
            $("#Name").focus();
            if ($("#hdnIsEditOrderLineItems").val() == "true") {
                ShowEditTab("OrderEdit/" + idValue, "frmOrder");
            }
        }
        else if (idValue == 0) {

            $("#Name").val("");
            $("#Name").focus();
            if (response.Status == "duplicate")
                $("#spanGlobalMessage").removeClass('errorIcon succesIcon').addClass('WarningIcon');
            else {
                //Delete file
                if (DeleteoFileId != '') {
                    DeleteExisting(DeleteoFileId, response.OrderGuid);
                }
                //save file upload files
                saveOrderFiles(response.ID, response.OrderGuid);
                NeedToOpenItemPopupNow = true;
                ShowEditTab("OrderEdit/" + response.ID, "frmOrder");
            }
        }
        else if (idValue > 0) {
            if (response.Status == "duplicate") {
                $("#spanGlobalMessage").removeClass('errorIcon succesIcon').addClass('WarningIcon');
                $("#Name").val("");
                $("#Name").focus();
            }
            else
            {
                var IsUpdateOrderStatus = response.IsUpdateOrderStatus;
                var orderStatusToUpdate = 0;

                if (typeof (IsUpdateOrderStatus) !== "undefined" && IsUpdateOrderStatus != null && IsUpdateOrderStatus === true)
                {
                    if (typeof (response.OrderStatus) !== "undefined" && response.OrderStatus != null && (parseInt(response.OrderStatus) || 0)  > 0)
                    {
                        orderStatusToUpdate = parseInt(response.OrderStatus);
                    }
                }              
                var msg = UpdateLineItemGrid(0, 0, IsUpdateOrderStatus, orderStatusToUpdate,true);

                if (msg.Status != "ok") {
                    $('#DivLoading').hide();
                    $("#spanGlobalMessage").html(msg.Message);
                    showNotificationDialog();
                    $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                }
                else {
                    if (oTable !== undefined && oTable != null)
                        oTable.fnDraw();
                    if (IsRefreshGrid)
                        $('#NarroSearchClear').click();
                    //Delete file
                    if (DeleteoFileId != '') {
                        DeleteExisting(DeleteoFileId, response.OrderGuid);
                    }
                    //save file upload files
                    saveOrderFiles(response.ID, response.OrderGuid);
                    var url = document.location;
                    if (url.toString().indexOf("?FromItem") > 0) {
                        document.location = '@Url.Content("~/Order/OrderList")';
                    }
                    else if (OrderStatus == '@((int)OrderStatus.Transmitted)' && parseInt($('#ddlOrderStatus').val()) == '@((int)OrderStatus.UnSubmitted)') {
                        ShowEditTab("OrderEdit/" + response.ID, "frmOrder");
                    }
                    else {

                        SwitchOrderTab('OrderCreate', 'frmOrder');
                    }
                }
            }
        }
    }

    function saveOrderFiles(Id, OrderGUID) {
        if ($("table.FileUploadList tr[uploaded='false']").length > 0) {
            //send formdata to server-side
            $.ajax({
                url: "/api/fileupload/OrderFileUpload/" + Id + "?OrderGUID="+OrderGUID ,
                type: 'post',
                data: formData,
                dataType: 'html', // we return html from our file
                async: true,
                processData: false,  // tell jQuery not to process the data
                contentType: false,   // tell jQuery not to set contentType
                success: function (data) {
                    formData = new FormData();
                    //$('#upload-result').append('<div class="alert alert-success"><p>File(s) uploaded successfully!</p><br />');
                    //$('#upload-result .alert').append(data);
                },
                error: function (request) {
                    console.log(request.responseText);
                }
            });
        }
    }



    function onOrderFailure(message) {
        $('#DivLoading').hide();
        $("#spanGlobalMessage").html(message.statusText);
        showNotificationDialog();
        $("#Name").focus();
    }

    $('#btnUncloseOrder').on('click', function () {
        $('#divUnCloseOrderToEdit').modal();
        $('.simplemodal-close').css('display', 'none');
    });

    function UnCloseOrderToEdit() {
        _createOrder.expandCollapseForm(false);
        $('#DivLoading').show();
        var arrOrderGuid = new Array();
        arrOrderGuid.push(OrderGUID);
        var success = false;
        $.ajax({
            url: "/Order/NewUnCloseOrderToEdit",
            type: 'Post',
            dataType: 'json',
            contentType: 'application/json',
            data: JSON.stringify({ 'OrederGuid': arrOrderGuid, 'EditType': 'EditLineItems' }),
            async: false,
            success: function (response) {
                if (response.Status == "ok") {
                    $("#spanGlobalMessage").html(response.Message);
                    $("#spanGlobalMessage").removeClass('errorIcon WarningIcon').addClass('succesIcon');
                    success = true;

                    //ShowEditTab("OrderEdit/" + OrderID, "frmOrder");
                }
                else {
                    showNotificationDialog();
                    $("#spanGlobalMessage").html(response.Message);
                    $("#spanGlobalMessage").removeClass('succesIcon').addClass('errorIcon WarningIcon');
                    $('#OrdReceivedInfoDialog').find("#OrdReceivedMSG").html(response.Message);
                }
                $('#DivLoading').hide();
                UnCloseOrderCancel();
            },
            error: function (response) {
                $("#hdnIsEDISentOnEditOrderLineItems").val("false");
                $("#hdnIsEditOrderLineItems").val("false");
                $("#spanGlobalMessage").removeClass('succesIcon').addClass('errorIcon WarningIcon');
                $('#OrdReceivedInfoDialog').find("#OrdReceivedMSG").html(response.Message);
                $('#DivLoading').hide();
            },
            complete: function (response) {
                if (success == true) {
                    if (oTable !== undefined && oTable != null)
                        oTable.fnDraw();

                    $('#ddlOrderStatus').val('@((int)OrderStatus.UnSubmitted)');
                    $("#bntUncloseOrderOnlyInEditPage").hide();
                    $("#btnUncloseOrder").hide();
                    $("#hdnIsEDISentOnEditOrderLineItems").val("true");
                    $("#hdnIsEditOrderLineItems").val("true");
                    SaveOrderDetail($("#btnOrderSave"), true);//$("#btnOrderSave").trigger('click'); // Added for WI-4249
                }
            }
        });
    }

</script>
<script type="text/javascript">

    var URL_Listget = '';
    checkRememberUDFValues($("#hdnPageName").val(), parseInt(OrderID, 10));
    var formData = new FormData();
    var DeleteoFileId = '';


    $(document).off('click', 'input#btnOrderCancel');
    $(document).on('click', 'input#btnOrderCancel', function (e) {
        $('#txtOrderFilter').val('');

        if (typeof CheckUnSavedItemBeforCancel == 'function') {
            var isCheck = CheckUnSavedItemBeforCancel();
            if (isCheck == true)
                DoCancelButton();
        }
        else {
            DoCancelButton();
        }
        ExpandOrderNarrowSearch();
        // Below 2 lines are commented as part of 5551,5552: as this function already achieved in DoCancelButton()
        //$('#txtOrderFilter').val('');
        //$('#myDataTable').dataTable().fnFilter('', null, null, null);
    });

    function DoCancelButton() {
        if (IsRefreshGrid)
            $('#NarroSearchClear').click();

        var url = document.location;
        if (url.toString().indexOf("?FromItem") > 0)
            document.location = '@Url.Content("~/Order/OrderList")';
        else {
            SwitchOrderTab('OrderCreate', 'frmOrder');
        }

        //SwitchTextTab(tabid, action, frmName)
    }

    function CancelUnsaveModelYesClick() {
        $.modal.impl.close();
        TempNarrow = '';
        IsRetainNarrow = false;
        DoCancelButton();
        //setTimeout(function () { $("#btnClearAll").click(); }, 5000);
    }

    function CancelUnsaveModelCancelClick() {
        $.modal.impl.close();
        //setTimeout(function () { $("#btnClearAll").click(); }, 5000);
    }





    function OpenItemPopup() {
        ClearVariables();
        $("#ItemModel").empty();
        var strUrl = '@Url.Action("LoadItemMasterModel")';
        strUrl = strUrl + '?ParentId=' + OrderID;

        $('#ItemModel').data({ "url": strUrl, "strupc": '' }).dialog('open');

        if ($("input#global_filter").length > 0) {
            $("input#global_filter").focus();

            setTimeout(function () {
                $("input#global_filter").focus();

            }, 600);

        }
        if ($("input.searchinput").length > 0) {
            $("input.searchinput").focus();
            setTimeout(function () {
                $("input.searchinput").focus();
            }, 600);

        }


    }

    function CallThisFunctionFromModel(msg, isfromedit, isOnlyDeleted, IsAfterDelete) {

        if (msg == 'success') {
            if (typeof (isOnlyDeleted) == undefined)
                isOnlyDeleted = false;

            if ($('#IsDeletedRecords').is(':checked')) {
                isOnlyDeleted = true;
            }
            $('#DivLoading').show();
            $('#divOrderLineItems').empty();
            var url = '@Url.Action("LoadOrderLineItems")'; // + '?orderID=' + OrderID;

            // This for Receive
            if ($('#hdnIsChangeOrdclick').val() == "True" && parseInt($('#ddlOrderStatus').val()) == '@((int)OrderStatus.Transmitted)') {
                url = '@Url.Action("LoadOrderLineItems")';
            }
            else if (parseInt($('#ddlOrderStatus').val()) > parseInt('@((int)OrderStatus.Approved)') && parseInt($('#ddlOrderStatus').val()) < parseInt('@((int)OrderStatus.Closed)')) {
                url = '@Url.Action("LoadOrderLineItemsForReceive")';
            }
            URL_Listget = url;
            var isArchivedOrder = '@Model.IsArchived.GetValueOrDefault(false)';
            $.get(url, { 'orderID': OrderID, 'IsShowDeleted': isOnlyDeleted, 'IsArchivedOrder': isArchivedOrder, 'IsAfterDelete': IsAfterDelete}, function (data) {
                $('#divOrderLineItems').html(data);
                $('#DivLoading').hide();
                if ('@callFor' == 'editOrderItem' && isfromedit == true) {
                    if ($("#btnUncloseOrder").length > 0) {
                        $("#btnUncloseOrder").trigger("click");
                    }
                }
                else if ('@callFor' == 'UnCloseOrder') {
                    if ($("#bntUncloseOrderOnlyInEditPage").length > 0) {
                        $("#bntUncloseOrderOnlyInEditPage").trigger("click");
                    }
                }

                if (isOnlyDeleted) {
                    $("#IsDeletedRecordsOrdLn").attr("checked", 'checked');
                }

            });
        }
        else if (json.Status == 'fail') {
            alert(json.Message);
            return false;
        }
    }

    $('#btnTransmit').click(function () {
        $.ajax({
            'url': 'UpdateOrderToTransmited',
            'data': { 'OrderGUID': '@Model.GUID.ToString()' },
            'success': function (result) {
                SetReplenishRedCount();
                SwitchOrderTab('OrderCreate', 'frmOrder');
            },
            'error': function (result) {
                alert('error');
            }
        });
    });

    $('#ddlSupplier').change(function () {
        if (!isNaN(parseInt($(this).val())) && parseInt($(this).val()) > 0) {
            $('#DivLoading').show();
            $.get('GetOrderNumber', { SupplierID: $(this).val(), tOrderStatus: parseInt($('#ddlOrderStatus').val()) }, function (data) {
                $('#liOrderNumber').html('');
                $('#liOrderNumber').html(data);
                $('#DivLoading').hide();
            });
            $('#ddlSupplierAccount').empty();
            $('#ddlSupplierAccount').html('');
            if ($("select#ddlSupplier").val() != '' && $("select#ddlSupplier").val() != null && $("select#ddlSupplier").val() != undefined) {
                $.ajax({
                    url: "/Order/ShowData",
                    data: { "SupplierID": $("select#ddlSupplier").val() },
                    type: "Get",
                    success: function (data) {

                        for (var i = 0; i < data.length; i++) {
                            var opt = new Option(data[i].AccountNumnerMerge, data[i].GUID);
                            $('#ddlSupplierAccount').append(opt);

                        }
                        $('#ddlSupplierAccount').val('@Model.SupplierAccountGuid');

                    }
                });

                $.ajax({
                    url: "/Order/GetSupplierDefaultOrderRequiredDays",
                    data: { "SupplierID": $("select#ddlSupplier").val() },
                    type: "Get",
                    success: function (data) {
                        if (data.OrderRequiredDate != null && data.OrderRequiredDate != undefined) {
                            //alert(data.OrderRequiredDate);
                            //var dateTemp = parseInt(data.OrderRequiredDate.replace('/Date(', '').replace(')/', ''));
                            //$('#txtRequiredDate').datepicker('setDate', new Date(dateTemp));
                            $('#txtRequiredDate').datepicker('setDate', data.OrderRequiredDate);
                            SetReleaseEditable(data.IsOrderReleaseNumberEditable);
                        }
                        else {
                            $('#txtRequiredDate').datepicker('setDate', null);
                        }
                    }
                });

                $.ajax({
                    url: "/Order/GetSupplierApproveRight",
                    data: { "SupplierID": $("select#ddlSupplier").val() },
                    type: "Get",
                    success: function (data) {
                        if (data.IsSupplierRight != null && data.IsSupplierRight != undefined) {
                            $("#hdnIsSupplierApprove").val(data.IsSupplierRight);
                        }
                        else {
                            $("#hdnIsSupplierApprove").val(false);
                        }
                    }
                });

            }
        }
        else {
            $("#hdnIsSupplierApprove").val(false);
        }
    });

    $('#ddlBlanketPO').change(function () {
        if (!isNaN(parseInt($(this).val())) && parseInt($(this).val()) > 0) {
            $('#DivLoading').show();
            $('#txtOrderNumber').val($('#ddlBlanketPO :selected').text());
            $('#spnErrOrderNumber').css('display', 'none');
            $.get("GetReleaseNumber", { 'OrderNumber': $('#txtOrderNumber').val() }, function (data) {
                if (data.Success = "True") {
                    $('#txtReleaseNumber').val(data.ReleaseNumber);
                }
                $('#DivLoading').hide();
            });
        }
        else {
            $('#txtReleaseNumber').val('');
            $('#txtOrderNumber').val('');
            $('#spnErrOrderNumber').css('display', 'inline');
            $('#DivLoading').hide();
            return false;
        }
    });

    function OpenAddNewItemPopup(curobj) {
        $("#ItemModel").dialog("close");
        SetUdfValuesInTempHidden();
        $('#divAddNewItemDailog').data("data", { SourcePageName: 'Order', 'OrderGUID': '@Model.GUID', 'OrderSupplier': escape('@Model.Supplier') }).dialog('open');
    }

    function SetUDFValuesToUDFControl() {
        var strUdfValues = $('div.divClsOrderRigthPan').find('input#hdnCopyUDFValuesTemp').val();
        if ($.trim(strUdfValues).length <= 0)
            return;

        var UDFObject = JSON.parse(strUdfValues);
        if ($('div.divClsOrderRigthPan').find('div#UDFDiv').length > 0) {

            if ($('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF1").length > 0) {
                $('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF1").val(UDFObject.OrderUDF1);
            }
            if ($('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF2").length > 0) {
                $('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF2").val(UDFObject.OrderUDF2);
            }
            if ($('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF3").length > 0) {
                $('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF3").val(UDFObject.OrderUDF3);
            }
            if ($('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF4").length > 0) {
                $('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF4").val(UDFObject.OrderUDF4);
            }
            if ($('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF5").length > 0) {
                udf5 = $('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF5").val(UDFObject.OrderUDF5);
            }
        }
    }

    function SetUdfValuesInTempHidden() {
        var udf1 = '';
        var udf2 = '';
        var udf3 = '';
        var udf4 = '';
        var udf5 = '';
        if ($('div.divClsOrderRigthPan').find('div#UDFDiv').length > 0) {

            if ($('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF1").length > 0) {

                udf1 = $('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF1").val();
            }
            if ($('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF2").length > 0) {

                udf2 = $('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF2").val();
            }
            if ($('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF3").length > 0) {

                udf3 = $('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF3").val();
            }
            if ($('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF4").length > 0) {

                udf4 = $('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF4").val();
            }
            if ($('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF5").length > 0) {
                //if ($('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF5")[0].nodeName === "SELECT")
                //    udf5 = $('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF5 option:selected").text();
                //else
                udf5 = $('div.divClsOrderRigthPan').find('div#UDFDiv').find("#UDF5").val();
            }

            var obj = new Object();
            //obj = { "OrderUDF1": udf1, "OrderUDF2": udf2, "OrderUDF3": udf3, "OrderUDF4": udf4, "OrderUDF5": udf5 };
            obj.OrderUDF1 = udf1;
            obj.OrderUDF2 = udf2;
            obj.OrderUDF3 = udf3;
            obj.OrderUDF4 = udf4;
            obj.OrderUDF5 = udf5;

            $('div.divClsOrderRigthPan').find('input#hdnCopyUDFValuesTemp').val(JSON.stringify(obj));
        }

    }

    $(document).ready(function () {
        window.location.hash = '';
        $('form').areYouSure();
        $("#txtRequiredDate").datepicker({
            dateFormat: '@eTurnsWeb.Helper.SessionHelper.RoomDateJSFormat', showButtonPanel: true,
            changeMonth: true,
            changeYear: true,
            clearText: 'Clear', onClose: function () { $("#txtRequiredDate").datepicker("hide"); this.blur(); }
        });
        SetReleaseEditable('@Model.IsOrderReleaseNumberEditable');

        if ('@Model.OrderType' == '@((int)OrderType.RuturnOrder)')
        {
            var ordernumberTextbox = $("#txtOrderNumber");
            if (ordernumberTextbox != null && ordernumberTextbox !== undefined && typeof (ordernumberTextbox) !== undefined)
            {
                $(ordernumberTextbox).attr('data-val-required', "The field Return Order Number is required.");
            }

        }

        $('#spnTotalOrderCost').html('@CurrencySymbol' + ' ' +  '@TotalCost');
        $('#spnTotalOrderPrice').html('@CurrencySymbol' + ' ' +  '@TotalPrice');
        if ('@PriseSelectionOption.ToString()' == '1') {
            $('#lblOrderTotalSellPrice').show();
            $('#spnTotalOrderPrice').show();

            $('#lblOrderTotalCost').hide();
            $('#spnTotalOrderCost').hide();
        }
        else if ('@PriseSelectionOption.ToString()' == '2') {
            $('#lblOrderTotalSellPrice').hide();
            $('#spnTotalOrderPrice').hide();

            $('#lblOrderTotalCost').show();
            $('#spnTotalOrderCost').show();
        }

        $('.ShowAllOptions').click(function () {
            $(this).siblings('.AutoCompleteddl').trigger("focus");
            $(this).siblings(".AutoCompleteddl").autocomplete("search", " ");
        });
        if ($('#hdnIsChangeOrdclick').val() == "True" && parseInt($('#ddlOrderStatus').val()) == '@((int)OrderStatus.Transmitted)') {
            $('#btnTransmit').css('display', 'none');
        }
        else if (parseInt($('#ddlOrderStatus').val()) > 2) {
            $(':input', '#frmOrder').not('#btnOrderCancel, #btnTransmit, #Comment,#txtPackslipNumber,#ShippingTrackNumber').attr('disabled', 'disabled');
            //$(':input', '#frmOrder').not('#Comment,#txtPackslipNumber,#ShippingTrackNumber').removeAttr('readonly');
            $(':button', '#frmOrder').not('#btnOrderCancel, #btnTransmit').css('display', 'none');
            $(':submit', '#frmOrder').css('display', 'none');
            $('.addNewLink', '#frmOrder').css('display', 'none');
        }

        if (parseInt($('#ddlOrderStatus').val()) == '@((int)OrderStatus.Approved)' && '@(Model.IsOnlyStatusUpdate)' == "True") {
            $(':submit', '#frmOrder').css('display', '');
            $('#ddlOrderStatus,#btnOrderSave,#aRptSingle').removeAttr('disabled');
        }

        if (parseInt($('#ddlOrderStatus').val()) == '@((int)OrderStatus.Closed)' && '@(IsableToUnCloseOrder)' == 'True') {
            $('#btnUncloseOrder,#bntUncloseOrderOnlyInEditPage').css('display', '');
            $('#btnUncloseOrder,#bntUncloseOrderOnlyInEditPage,#aRptSingle').removeAttr('disabled');
        }
        else {
            $('#btnUncloseOrder,#bntUncloseOrderOnlyInEditPage').css('display', 'none');
            $('#btnUncloseOrder,#bntUncloseOrderOnlyInEditPage').attr('disabled', 'disabled');

        }

        if (parseInt($('#ddlOrderStatus').val()) != '@((int)OrderStatus.Closed)')
        {
            $("#file").removeAttr('disabled');
        }

        setTimeout(function () {

            $('#ddlSupplier').focus();
        }, 100);

        $("form").submit(function (e) {
            $.validator.unobtrusive.parse("#frmOrder");
            if ($(this).valid()) {
                $(':input', '#frmOrder').removeAttr('disabled');
                rememberUDFValues($("#hdnPageName").val(), parseInt(OrderID, 10));
            }
            else {
                $('#DivLoading').hide();
            }
            e.preventDefault();

        });
        var itemModeldialogTitle = '@eTurns.DTO.ResOrder.ItemModelHeader';
        if ('@Model.OrderType' == '2') {
            itemModeldialogTitle = '@eTurns.DTO.ResOrder.ItemModelHeaderRO'
        }

        $("#ItemModel").dialog({
            autoOpen: false, modal: true, draggable: true, resizable: true, width: '82%', height: 710, title: itemModeldialogTitle,
            open: function () {
                $('#DivLoading').show();
                var strUrl = $(this).data("url");
                var strupc = $(this).data("strupc");
                $.get(strUrl, function (data) {
                    $("#ItemModel").html(data);
                    if (strupc == undefined || strupc == '') {
                        $.get('@Url.Action("GetSupplierCatalog", "SupplierCatalog")?PageName=OrderMaster&Openpopup=true&Buttonname=' + escape("@ResOrder.AddFromCatalogButton") + '&OrderGUID=' + OrderGUID, function (data) {
                            $("#ItemModel").prepend(data);
                            if ('@(HasItemCreateRights)' == 'True') {
                                $("#ItemModel").prepend('&nbsp;&nbsp;<input type="button" value="@ResOrder.AddNewItemButton" id="btnCreateItem" class="btnGeneral"style="margin-top: 1.3% !important; " onclick="OpenAddNewItemPopup(this);" />')
                            }
                        });
                    }
                    else {
                        if ($("#ItemModel_filter") != undefined) {
                            $("#ItemModel_filter").val(strupc);
                            fnFilterGlobalIM();
                        }
                    }
                });
            },
            close: function () {
                $("#ItemModel").empty();
                CallThisFunctionFromModel('success');
                SetUDFValuesToUDFControl();
            }
        });


        $("#divAddNewItemDailog").dialog({
            autoOpen: false,
            modal: true,
            draggable: true,
            resizable: true,
            width: '82%',
            height: 710,
            title: '@ResQuoteMaster.TitleCreateNewItem',
            open: function () {
                $('#DivLoading').show();

                $("#divAddNewItemDailog").load('@Url.Action("ItemCreate", "Inventory")?SourcePageName=' + $(this).data("data").SourcePageName + '&OrderGUID=' + $(this).data("data").OrderGUID + '&OrderSupplier=' + $(this).data("data").OrderSupplier, function () {
                    $('#DivLoading').hide();
                    $("#divAddNewItemDailog").dialog("option", "width", "82%");
                    $("#divAddNewItemDailog").dialog("option", "height", 710);
                    $("#divAddNewItemDailog").dialog('option', 'position', 'center');
                });
            },
            close: function () {
                $("#divAddNewItemDailog").html("");
                OpenItemPopup();
            }
        });
        if (parseInt(OrderID, 10) <= 0) {
            $('#ExpandedContent').css('display', '');
            $('#ancHideShowContent').css('display', 'none');
        }
        else {
            $('#ExpandedContent').css('display', 'none');
            $('#ancHideShowContent').css('display', '');
            $('#DivLoading').show();
            CallThisFunctionFromModel('success', true);

            //// need to call below block in case of New Item saved and open POPUP Item ... START
            if (NeedToOpenItemPopupNow) {
                NeedToOpenItemPopupNow = false;
                setTimeout("OpenItemPopup()", 3000);
                return false;
            }
            //// need to call below block in case of New Item saved and open POPUP Item ... END
        }


        //if (OrderID <= 0 && $('#txtOrderNumber').val().length <= 0) {
        if (OrderID <= 0) {
            $('#txtOrderNumber').removeAttr('readonly');
            $(this).find('#ddlSupplier').focus();

        }
        if (OrderStatus == '@((int)OrderStatus.Transmitted)') {
            $('#btnOrderSave').val('Change Order');
            $('#btnUpdateComment').css('display', 'none');
        }

        if ($('#txtOrderNumber').css('display') == 'none') {
            setTimeout(function () {
                $("#ui-datepicker-div").css('display', 'none');
                $('#ddlBlanketPO').focus();
            }, 1);
        }

        $("#CtabNew").on('focus', "input.AutoCompleteddl", function (e) {
            var ctrlID = $(this).attr('id');
            var type = "";
            var ajaxURL = '';

            if (ctrlID == "txtStagingName") {
                type = 'Staging';
                ajaxURL = '/Inventory/GetAllStagingHeaders';
            }
            else if (ctrlID == "txtShipViaName") {
                type = 'ShipVia';
                ajaxURL = '/Master/GetAllShipVia';
            }
            else if (ctrlID == "txtCustomerName") {
                type = 'Customer';
                ajaxURL = '/Master/GetAllCustomers';
            }
            else if (ctrlID == "txtVendorName") {
                type = 'Vendor';
                ajaxURL = '/Master/GetAllVendors';
            }

            $(this).autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: ajaxURL,
                        contentType: 'application/json',
                        dataType: 'json',
                        data: { NameStartWith: request.term },
                        success: function (data) {
                            response($.map(data, function (Items) {
                                if (type == 'Staging') {
                                    return {
                                        label: Items.StagingName,
                                        value: Items.StagingName,
                                        selval: Items.GUID
                                    }
                                }
                                else if (type == 'ShipVia') {
                                    return {
                                        label: Items.ShipVia,
                                        value: Items.ShipVia,
                                        selval: Items.ID
                                    }
                                }
                                else if (type == 'Customer') {
                                    return {
                                        label: Items.Customer,
                                        value: Items.Customer,
                                        selval: Items.GUID
                                    }
                                }
                                else if (type == 'Vendor') {
                                    return {
                                        label: Items.Vender,
                                        value: Items.Vender,
                                        selval: Items.ID
                                    }
                                }
                            }));
                        },
                        error: function (err) {
                        }
                    });
                },
                autoFocus: false,
                minLength: 1,
                select: function (event, ui) {
                },
                open: function () {
                    $(this).removeClass("ui-corner-all").addClass("ui-corner-top");
                },
                close: function () {
                    $(this).removeClass("ui-corner-top").addClass("ui-corner-all");
                },
                change: function (event, ui) {
                }
            });
        });

        $("#CtabNew").on({
            mouseover: function () {
                getItemInventoryStagingLocation($(this), "");
            },
            focus: function () {
                getItemInventoryStagingLocation($(this), "");
            },
            change: function () {
                if (typeof ($(this).parent().find("input[id='txtBinNumber']")) != "undefined") {
                    $(this).parent().find("input[id='txtBinNumber']").val($(this).val());
                }
                if (typeof ($(this).parent().find("input[id='txtReceiveBin']")) != "undefined") {
                    $(this).parent().find("input[id='txtReceiveBin']").val($(this).val());
                }
            }
        }, "#slctBinNumber");
        $("#CtabNew").on({
            mouseover: function () {
                getItemInventoryStagingLocationWithQty($(this), "");
            },
            focus: function () {
                getItemInventoryStagingLocationWithQty($(this), "");
            },
            change: function () {
                if (typeof ($(this).parent().find("input[id='txtBinNumber']")) != "undefined") {
                    $(this).parent().find("input[id='txtBinNumber']").val($(this).val());
                }
                if (typeof ($(this).parent().find("input[id='txtReceiveBin']")) != "undefined") {
                    $(this).parent().find("input[id='txtReceiveBin']").val($(this).val());
                }
            }
        }, "#slctItemBinNumber");

        $('#divEditReceipt').dialog({
            autoOpen: false,
            modal: true,
            draggable: true,
            resizable: true,
            width: '90%',
            height: 400,
            title: "@ResOrder.EditReceipts",
            open: function () {
                $('#DivLoading').show();
                var itemGuid = $(this).data("ItemGuid");
                var orderDetailGuid = $(this).data("OrderDetailGuid");

                $.ajax({
                    "url": '@Url.Content("~/Receive/OpenDialogForEditReceipt")',
                    "data": { 'ItemGuid': itemGuid, 'OrderDetailGuid': orderDetailGuid },
                    "type": 'Post',
                    "async": false,
                    "cache": false,
                    "dataType": "text",
                    //"contentType": 'application/json',
                    success: function (result) {
                        $('#DivLoading').hide();
                        $('#divEditReceipt').html(result)
                    },
                    error: function (xhr) {
                        $('#DivLoading').hide();
                    }

                });
            },
            close: function () {
                $(this).empty();
                $('#divEditReceipt').empty();
                $('#DivLoading').hide();
                if ($(this).data("Success")) {
                    $(this).data({ "Success": false })
                    $('#divOrderLineItems').empty();
                    $.get('@Url.Action("LoadOrderLineItemsForReceive")', { 'orderID': OrderID }, function (data) {
                        $('#divOrderLineItems').html(data);
                    });
                }
            }
        });
        if ('@AbleToEdit' == "True") {
            if ('@Model.OrderStatus' != '@((int)OrderStatus.UnSubmitted)' && '@Model.OrderStatus' != '@((int)OrderStatus.Submitted)' && '@Model.OrderStatus' != '@((int)OrderStatus.Closed)' && '@Model.IsArchived.GetValueOrDefault(false)' != 'true' ) {
                if ($('#btnOrderSave').css('display') == 'none' && $('#btnOrderSave').val() == 'Change Order') {
                    $('#btnUpdateComment').css('display', 'block');
                }

                $('#Comment,#ShippingTrackNumber,#txtPackslipNumber, #btnUpdateComment, #btnOrderCancel,#aRptSingle').removeAttr('disabled');
            }
            var orderStatusInt = (parseInt('@((int)Model.OrderStatus)') || 0);
            var approvedStatusInt = (parseInt('@((int)OrderStatus.Approved)') || 0);
            var closedStatusInt = (parseInt('@((int)OrderStatus.Closed)') || 0);
            var saveOrderBtn = $('#btnOrderSave');
            if ((typeof (saveOrderBtn) == "undefined" || saveOrderBtn == null || typeof (saveOrderBtn.css('display')) == "undefined" || saveOrderBtn.css('display') == 'none')
                    && '@Model.IsOnlyStatusUpdate' != "True" && (orderStatusInt >= approvedStatusInt && orderStatusInt < closedStatusInt) && '@Model.IsArchived.GetValueOrDefault(false)' != 'true')
            {
                $('#btnUpdateComment').css('display', 'block');
                $('#Comment,#ShippingTrackNumber,#txtPackslipNumber, #btnUpdateComment').removeAttr('disabled');
            }
        }
        if ('@((int)Model.OrderStatus)' >= 4 && ('@Model.SupplierAccountGuid' == '' || '@Model.SupplierAccountGuid' == '00000000-0000-0000-0000-000000000000')) {
            $('#ddlSupplierAccount').empty();
            $('#ddlSupplierAccount').html('');
        }
        else {
            $('#ddlSupplierAccount').empty();
            $('#ddlSupplierAccount').html('');
            if ($("select#ddlSupplier").val() != '' && $("select#ddlSupplier").val() != null && $("select#ddlSupplier").val() != undefined) {
                $.ajax({
                    url: "/Order/ShowData",
                    data: { "SupplierID": $("select#ddlSupplier").val() },
                    type: "Get",
                    success: function (data) {

                        for (var i = 0; i < data.length; i++) {
                            var opt = new Option(data[i].AccountNumnerMerge, data[i].GUID);
                            $('#ddlSupplierAccount').append(opt);

                        }
                        $('#ddlSupplierAccount').val('@Model.SupplierAccountGuid');
                        if ('@Model.SupplierAccountGuid' == '' || '@Model.SupplierAccountGuid' == '00000000-0000-0000-0000-000000000000') {

                            $.ajax({
                                url: "/Order/GetDefaultAccount",
                                data: { "SupplierID": $("select#ddlSupplier").val() },
                                datatype: 'json',
                                contentType: 'application/json',
                                type: "Get",
                                success: function (data) {
                                    $('#ddlSupplierAccount').val(data.SuppAccGuid);

                                }
                            });
                        }
                    }
                });
            }
        }
        $("#DivPullSelection").dialog({
            autoOpen: false,
            show: "blind",
            hide: "explode",
            height: 700,
            title: "Return Items",
            width: 900,
            modal: true,
            open: function () {
            },
            beforeClose: function () {
            },
            close: function () {
                $("#DivPullSelection").empty();
            }
        });


        // grab the file input and bind a change event onto it
        $('#file').bind("change", function () {
            // new html5 formdata object.
            //$("ul.FileUploadList").empty();
            $("table.FileUploadList tr td.dataTables_empty").remove();
            var Li = '';
            var OrderAllowedFileExtension = $("#hdOrderAllowedFileExtension").val();
            var validExts = OrderAllowedFileExtension.split(',');
            var strValidationMessage = "";

            for (var i = 0, len = document.getElementById('file').files.length, avalbleimg = $("table.FileUploadList tr").length; i < len; i++, avalbleimg++) {
                var IsValidFile = true;
                var fileExt = document.getElementById('file').files[i].name;
                if ($("#lblnofilechoosen").length > 0) {
                    $("#lblnofilechoosen").text(fileExt);
                }
                fileExt = fileExt.substring(fileExt.lastIndexOf('.'));
                if (validExts.indexOf(fileExt.toLowerCase()) <= -1) {
                    IsValidFile = false;
                    strValidationMessage = strValidationMessage + document.getElementById('file').files[i].name + MsgInvalidFileSelected;
                }
                if (IsValidFile == true) {
                    var localdate = moment.utc().format('YYYY_MM_DD_HH_mm_ss');
                    localdate += localdate + avalbleimg;
                    Li += "<tr id=" + localdate + "  uploaded='false'>";
                    Li += "<td style='width:98%;text-align:left;'>" + document.getElementById('file').files[i].name + "</td><td style='width:2%'><a href='javascript:;' onclick='DeleteCurrentFile(\"" + localdate + "\");'><img src='/content/images/delete.png' /></a></td>";
                    Li += "</tr>";
                    formData.append("file" + localdate, document.getElementById('file').files[i]);
                }
            }
            if (strValidationMessage != "") {
                alert(strValidationMessage + MsgvalidFileList.replace("{0}", validExts.toString()));
            }
            $("table.FileUploadList").append(Li);
            //$("table.FileUploadList").fnDestroy();
            $("table.FileUploadList").dataTable();
            //disable sorting
            $("table.FileUploadList thead tr").empty();
            var resfileName = "File Name";
            if (typeof ResFileName != 'undefined') {
                resfileName = ResFileName;
            }

            var resDelete = "Delete";
            if (typeof ResDelete != 'undefined') {
                resDelete = ResDelete;
            }
            $("table.FileUploadList thead tr").append("<td style='width: 260px;padding-right: 195px;'><strong>" + resfileName + "</strong></td><td><strong>" + resDelete + "</strong></td>")
        });

    });

    if ($("table.FileUploadList").length != undefined) {
        if (OrderGUID != '00000000-0000-0000-0000-000000000000' && $("table.FileUploadList tbody tr").length < 1) {
            //call for uploaded File list
            OrderFilePath = '@OrderFilePath';
            $.ajax({
                url: "GetOrderFiles",
                type: 'post',
                data: { 'OrderGuid': OrderGUID },
                dataType: 'json',
                async: false,
                success: function (data) {
                    var Li = '';
                    $.each(data.DDData, function (i, val) {

                        Li += "<tr id='" + val + "' uploaded='true'>";
                        Li += "<td style='width:98%;text-align:left;'>" +
                            "<a class='preview' href='/Consume/Get?path=" + OrderFilePath + "/" + OrderID + "/" + i + "' target='_blank'>" + i + "</a>" +
                            "</td><td style='width:2%'>" +
                            "<a href='javascript:;' onclick='DeleteExistingFile(\"" + val + "\");'>" +
                            "<img src='/content/images/delete.png' /></a></td>";
                        //Li += "<td style='width:98%;text-align:left;'><a class='preview' href='" + OrderFilePath + "/" + OrderID + "/" + i + "' target='_blank'>" + i + "</a></td><td style='width:2%'><a href='javascript:;' onclick='DeleteExistingFile(\"" + val + "\");'><img src='/content/images/delete.png' /></a></td>";
                        Li += "</tr>";
                    });
                    $("table.FileUploadList").append(Li);
                    imagePreview();
                    $("table.FileUploadList").dataTable({ "bPaginate": false, "bInfo": false, "oLanguage": { "sEmptyTable": MsgNoDataAvailableInTable } });
                },
                error: function (request) {
                    console.log(request.responseText);
                }
            });
        } else if (OrderGUID == '00000000-0000-0000-0000-000000000000' && $("table.FileUploadList tbody tr").length < 1){
            $("table.FileUploadList").dataTable({ "bPaginate": false, "bInfo": false, "oLanguage": { "sEmptyTable": MsgNoDataAvailableInTable } });
        }
        //Disable Sorting
        var resfileName = "File Name";
        if (typeof ResFileName != 'undefined') {
            resfileName = ResFileName;
        }
        var resDelete = "Delete";
        if (typeof ResDelete != 'undefined') {
            resDelete = ResDelete;
        }
        $("table.FileUploadList thead tr").empty();
        $("table.FileUploadList thead tr").append("<td style='width: 260px;padding-right: 195px;'><strong>" + resfileName + "</strong></td><td><strong>" + resDelete + "</strong></td>")
    }

    function DeleteCurrentFile(currentPos) {
        formData.delete("file" + currentPos);
        $("table.FileUploadList tr#" + currentPos + "").remove();
        $("table.FileUploadList").dataTable();
    }

    // To track delete file
    function DeleteExistingFile(FileId) {
        $("table.FileUploadList tr#" + FileId + "").remove();
        if (DeleteoFileId != '') {
            DeleteoFileId += ',' + FileId;
        }
        else {
            DeleteoFileId = FileId;
        }
    }

    function DeleteExisting(FileId, OrderGUID) {
         $.ajax({
            url: 'DeleteExistingFiles',
            type: 'Post',
            data: { 'FileId': FileId, 'OrderGuid': OrderGUID },
            dataType: 'json',
            success: function (response) {
            }
        });
    }



</script>
<div id="NewMasterPopUP">
</div>
<script type="text/javascript">
    $("#NewMasterPopUP").dialog({
        autoOpen: false,
        show: "blind",
        hide: "explode",
        height: 600,
        width: 800,
        modal: true,
        open: function () {
            $(this).parent().find("span.ui-dialog-title").html("Add New " + $(this).data("data"));
        },
        close: function () {
            $('#DivLoading').show();
            RefreshDropdownList($(this).data("data"), $(this).data("IDVal"));
            $(this).data("data", null);
            $(this).data("IDVal", null);
            $(this).parent().find("span.ui-dialog-title").html('');
        }
    });
    function AddNewFromPopup(PopupFor) {
        $('#DivLoading').show();
        var _URL = ''
        if (PopupFor == 'ShipVia') {
            _URL = '@Url.Action("../Master/ShipViaCreate")';
        }
        else if (PopupFor == 'Supplier') {
            _URL = '@Url.Action("../Master/SupplierCreate")';
        }
        else if (PopupFor == 'Customer') {
            _URL = '@Url.Action("../Master/CustomerMasterCreate")';
        }
        else {
            return false;
        }
        $('#NewMasterPopUP').load(_URL, function () {
            $('#NewMasterPopUP').data("data", PopupFor).dialog('open');
            $('#DivLoading').hide();
        });
    }
    function RefreshDropdownList(PopupFor, IDVal) {
        if (IDVal != undefined) {
            var _ControlID = '';
            if (PopupFor == 'ShipVia') {
                _ControlID = "ddlShipVia";
            }
            else if (PopupFor == 'Supplier') {
                _ControlID = "Supplier";
            }
            else if (PopupFor == 'Customer') {
                _ControlID = "ddlCustomerList";
            }
            var arrdata = IDVal.split("~");
            var listData = $('select[id*="' + _ControlID + '"]');
            $(listData).each(function () {
                $(this).append($("<option />").val(arrdata[0]).text(arrdata[1]));
            });
        }
        $('#DivLoading').hide();
    }

</script>
<div class="dialog" id="OrdReceiveProcessing" style="display: none;">
    <div class="inner">
        <p class="text" id="OrdReceiveGWait" style="text-align: left; padding-left: 10px;">
            <b style="color: Red;">
                @*Kindly wait, order receive transaction is going on.....*@
                @eTurns.DTO.Resources.ResMessage.PleaseWaitTransGoingOn
            </b>
        </p>
        <p class="text" id="OrdReceiveGWaitImg" style="text-align: center; padding-left: 10px;">
            <img src="@Url.Content("~/Content/images/ajax.gif")" alt="loding" />
        </p>
    </div>
</div>
<div class="dialog" id="OrdReceivedInfoDialog" style="display: none; width: 470px;">
    <div class="inner" style="width: 470px;">
        <p class="text" id="OrdReceivedMSG" style="text-align: left; padding-left: 10px;overflow:auto;max-height:400px;">
        </p>
        <p class="text" style="text-align: center; padding-left: 10px;">
            <a href="javascript:void(0)" class="no" onclick="closeFromOk()">
                <img src="~/Content/images/yes.png" alt="@ResCommon.Ok" />@ResCommon.Ok
            </a>
        </p>
    </div>
</div>
<div class="dialog" id="OrdReturnBinErrorInforDailog" style="display: none; width: 470px;">
    <div class="inner" style="width: 470px;">
        <p class="text" id="OrdReceivedMSG" style="text-align: left; padding-left: 10px;">
        </p>
        <p class="text" style="text-align: center; padding-left: 10px;">
            <a href="javascript:void(0)" class="no" onclick="closeReturnBinError()">
                <img src="~/Content/images/yes.png" alt="@ResCommon.Close" />@ResCommon.Close
            </a>
        </p>
    </div>
</div>
<div class="dialog" id="CloseOderDialog" style="display: none;">
    <div class="inner">
        <p class="text">
            @ResOrder.ConfirmCloseOrder
        </p>
        <a href="JavaScript:void(0)" id="bntCloseConfirmYes" class="yes yesornooryes">
            <img src="~/Content/images/yes.png" alt="@eTurns.DTO.Resources.ResMessage.ConfirmYes" />
            @eTurns.DTO.Resources.ResMessage.ConfirmYes
        </a><a href="javascript:void(0)" class="no" onclick="closeModalCloseOderDialog();">
            <img src="~/Content/images/no.png" alt="@eTurns.DTO.Resources.ResMessage.ConfirmNo" />@eTurns.DTO.Resources.ResMessage.ConfirmNo
        </a>
    </div>
</div>
<div class="dialog" id="CloseOderLineItemDialog" style="display: none;">
    <div class="inner">
        <p class="text">
            @ResOrder.ConfirmCloseselectedOrderItem
        </p>
        <a href="JavaScript:void(0)" id="bntCloseLineItemConfirmYes" class="yes yesornooryes">
            <img src="~/Content/images/yes.png" alt="Yes" />
            @eTurns.DTO.Resources.ResMessage.ConfirmYes
        </a><a href="javascript:void(0)" class="no" onclick="closeModalCloseOderDialog();">
            <img src="~/Content/images/no.png" alt="No" />@eTurns.DTO.Resources.ResMessage.ConfirmNo
        </a>
    </div>
</div>
<div class="dialog" id="UnCloseOderLineItemDialog" style="display: none;">
    <div class="inner">
        <p class="text">
            @ResOrder.ConfirmUnCloseOrderItem
        </p>
        <a href="JavaScript:void(0)" id="bntUnCloseItemConfirmYes" class="yes yesornooryes">
            <img src="~/Content/images/yes.png" alt="Yes" />
            @eTurns.DTO.Resources.ResMessage.ConfirmYes
        </a><a href="javascript:void(0)" class="no" onclick="closeModalCloseOderDialog();">
            <img src="~/Content/images/no.png" alt="No" />@eTurns.DTO.Resources.ResMessage.ConfirmNo
        </a>
    </div>
</div>
<div id="ExceedRecieveInfoDialog" title="Received Exceed" class="dialog" style="float: left;
    display: none; width: 500px;">
    <div class="inner" style="width: 500px;">
        <p class="text" style="float: left; width: 98%; text-align: left; padding: 0px 0px 5px 10px;">
            <b>This receive will exceed the approved quantity of the following item(s): </b>
        </p>
        <p id="pItemList" class="text" style="float: left; width: 98%; font-weight: bold;
            text-align: left; padding: 0px 0px 20px 10px;">
        </p>
        <p class="text" style="float: left; width: 98%; text-align: center; padding-left: 10px;">
            <a href="javascript:void(0)" class="yes" onclick="ExceedRecieveModelYesClick()">
                <img src="~/Content/images/yes.png" alt="@ResCommon.Ok" />@ResCommon.Ok
            </a>&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)"
                                     class="no" onclick="closeOrdReceiveInfoModel()">
                <img src="~/Content/images/no.png" alt="@ResCommon.Cancel" />@ResCommon.Cancel
            </a>
        </p>
    </div>
</div>
<div id="ExceedReturnInfoDialog" title="Received Exceed" class="dialog" style="float: left;
    display: none; width: 500px;">
    <div class="inner" style="width: 500px;">
        <p class="text" style="float: left; width: 98%; text-align: left; padding: 0px 0px 5px 10px;">
            <b>This return will exceed the approved quantity of the following item(s): </b>
        </p>
        <p id="pItemListReturn" class="text" style="float: left; width: 98%; font-weight: bold;
            text-align: left; padding: 0px 0px 20px 10px;">
        </p>
        <p class="text" style="float: left; width: 98%; text-align: center; padding-left: 10px;">
            <a href="javascript:void(0)" class="yes" onclick="ExceedRecieveModelYesClick()">
                <img src="~/Content/images/yes.png" alt="@eTurns.DTO.Resources.ResCommon.Yes" />@eTurns.DTO.Resources.ResMessage.InformOk
            </a>&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)"
                                     class="no" onclick="closeOrdReceiveInfoModel()">
                <img src="~/Content/images/no.png" alt="@eTurns.DTO.Resources.ResCommon.Cancel" />@eTurns.DTO.Resources.ResCommon.Cancel
            </a>
        </p>
    </div>
</div>
<div id="ValidateAppQty" title="Validate Approve Quantity" class="dialog" style="float: left;
    display: none; width: 500px;">
    <div class="inner" style="width: 500px;">
        <p id="pItemListApprove" class="text" style="float: left; width: 98%; font-weight: bold;
            text-align: left; padding: 0px 0px 20px 10px;">
        </p>
    </div>
</div>
<div id="divPreRecieveInfo">
</div>
<div id="DivPullSelection">

</div>
<script language="javascript" type="text/javascript">
    //Receive
    var staginID = 0;
    var ValidateSerialLotNumberUrl = '@Url.Action("ValidateSerialLotNumber", "Pull")';
    var OrdID = '@Model.ID';
    var OrdItemsForRcvURL = '@Url.Action("LoadOrderLineItemsForReceive")';
    function closeOrdReceiveInfoModel() {
        $.modal.impl.close();
    }

    function ExceedRecieveModelYesClick() {
        $.modal.impl.close();
        setTimeout(function () { $("#btnClearAll").click(); }, 2000);
    }

    function closeReturnBinError() {
        $.modal.impl.close();
        $('#DivLoading').hide();
    }
    function closeFromOk() {
        $('#DivLoading').show();
        $.modal.impl.close();
        setTimeout(function () {
            clearALL();
        }, 2000);
    }


    function clearALL() {
        $('#DivLoading').show();
        $('#divOrderLineItems').empty();
        $.get(OrdItemsForRcvURL, { 'orderID': OrdID }, function (data) {
            $('#divOrderLineItems').html(data);
            $('#DivLoading').hide();
        });
    }

    function ExceedRecieveModelYesClick() {
        closeOrdReceiveInfoModel();
        $('#OrdReceiveProcessing').modal();
        $('#OrdReceiveProcessing').parent().parent().find(".modalCloseImg").css('display', 'none');
        ReceiveItems();
    }

    function CheckReceiveIsExceed() {
        var arr = new Array();
        var IsRecivedExceed = false;
        var ItemsList = '';
        var returnErrorMsg = '';
        $('#pItemList').text('');
        $('#pItemListReturn').text('');
        var hasPullPopup = false;
        $('#RecieveOrderLineItem' + OrderID + ' tbody tr.row_selected').each(function (i) {

            var colr = hexc($(this).css('background-color'));
            if (colr !== '#d3d3d3') {

                if ('@(Model.OrderType)' == '@((int)OrderType.RuturnOrder)') {
                    var binName = $(this).find('#txtReceiveBin').val();
                    if (binName.length <= 0)
                        returnErrorMsg = returnErrorMsg + "<b style='color: Olive;'>" + (i + 1) + ". " + $(this).find('#hdnItemNumber').val() + ": : Please select bin to return.</br>"
                }
                var orderDetailID = $(this).find('#hdnID').val();
                var qty = $(this).find("#txtReceiveQty" + orderDetailID).val();

                var receivedQty = $(this).find('#spnReceivedQty').text();
                var approvedQty = $(this).find('#spnApprovedQty').text();

                if (!isNaN(parseFloat(approvedQty)) && parseFloat(approvedQty) <= 0) {
                    approvedQty = 0;
                }
                if (!isNaN(parseFloat(receivedQty)) && parseFloat(receivedQty) <= 0) {
                    receivedQty = 0;
                }
                if (!isNaN(parseFloat(qty)) && parseFloat(qty) <= 0) {
                    qty = 0;
                }
                var totalReceive = parseFloat(receivedQty) + parseFloat(qty);

                if (parseFloat(totalReceive) > parseFloat(approvedQty)) {
                    IsRecivedExceed = true;
                    ItemsList += parseInt(i + 1) + ') ' + $(this).find('#hdnItemNumber').val() + '<br />';
                }
                var isCloseItem = $(this).find('#hdnIsCloseItem').val();
                if (!hasPullPopup && isCloseItem == "False" && '@(Model.OrderType)' == '@((int)OrderType.RuturnOrder)') {
                    var isSerial = $(this).find('#hdnItemSRTrack').val();
                    var isLotTrack = $(this).find('#hdnItemLOTTrack').val();
                    var isDCT = $(this).find('#hdnItemDOCTrack').val();
                    if (isSerial == "True" || isLotTrack == "True" || isDCT == "True") {
                        hasPullPopup = true;
                    }
                }
            }
            // return IsRecivedExceed;
        });

        if (IsRecivedExceed) {
            closeOrdReceiveInfoModel();
            if ('@(Model.OrderType)' == '@((int)OrderType.Order)') {
                $('#ExceedRecieveInfoDialog').modal();
                $('#pItemList').html(ItemsList);
            }
            else if ('@(Model.OrderType)' == '@((int)OrderType.RuturnOrder)') {
                $('#ExceedReturnInfoDialog').modal();
                $('#pItemListReturn').html(ItemsList);

            }

            $('#DivLoading').hide();
            return false;
        }
        else if (returnErrorMsg.length > 0) {
            closeOrdReceiveInfoModel();
            $('#OrdReturnBinErrorInforDailog').find("#OrdReceivedMSG").html(returnErrorMsg);
            $('#OrdReturnBinErrorInforDailog').modal();
            $('#DivLoading').hide();
            return false;
        }
        else {
            if (!hasPullPopup)
                ReceiveItems();
            else {
                ReturnSerialLotExpiryItem();
            }

        }
    }

    function GetUDFValue(tr, udfName) {
        var udfVal = '';
        if ($(tr).find("#" + udfName).length > 0 > 0) {
            if ($(tr).find("#" + udfName)[0].nodeName === "SELECT")
                udfVal = $(tr).find("#" + udfName + " option:selected").text();
            else
                udfVal = $(tr).find("#" + udfName).val();
        }

        return udfVal;
    }
    var isDeleteSrLotRow = false;

    function ReturnSerialLotExpiryItem() {

        var ItemToRuturn = new Array();
        $('#RecieveOrderLineItem' + OrderID + ' tbody tr.row_selected').each(function (index, tr) {
            var orderDetailID = $(this).find('#hdnID').val();
            var orderDetailGUID = $(this).find('#hdnGUID').val();
            var vBinId = $(this).find('#hdnBin').val();
            var vUDF1 = GetUDFValue(tr, 'UDF1');
            var vUDF2 = GetUDFValue(tr, 'UDF2');
            var vUDF3 = GetUDFValue(tr, 'UDF3');
            var vUDF4 = GetUDFValue(tr, 'UDF4');
            var vUDF5 = GetUDFValue(tr, 'UDF5');
            var vItemGUID = $(this).find("#hdnItemGUID").val();
            var vBinName = $(this).find("#txtReceiveBin").val();

            var qtyToReturn = $(tr).find("#txtReceiveQty" + orderDetailID).val();
            var packslipnumber = $(this).find("#txtPackslip" + orderDetailID).val();
            var returnDate = $(this).find('#txtReceiveDate' + orderDetailID).val();
            var approvedQty = $(this).find('#spnRequestedQty').text();
            var returnedQty = $(this).find('#spnReceivedQty').text();
            var orderNumber = '@Model.OrderNumber';
            var releaseNumber = '@Model.ReleaseNumber';
            var supplierName = '@Model.SupplierName';
            var orderGuid = '@Model.GUID';
            var isSerial = $(this).find('#hdnItemSRTrack').val();
            var isLotTrack = $(this).find('#hdnItemLOTTrack').val();
            var isDCT = $(this).find('#hdnItemDOCTrack').val();
            var itemNumber = $(this).find('#hdnItemNumber').val();

            ItemToRuturn.push({
                ItemGUID: vItemGUID, ReturnDate: returnDate, OrderDetailID: orderDetailID, BinID: vBinId, OrderDetailGUID: orderDetailGUID, BinNumber: vBinName,
                PackSlipNumber: packslipnumber, UDF1: vUDF1, UDF2: vUDF2, UDF3: vUDF3, UDF4: vUDF4, UDF5: vUDF5, OrderGuid: orderGuid,
                ReturnedQty: returnedQty, ApprovedQty: approvedQty, QtyToReturn: qtyToReturn, OrderNumber: orderNumber, ReleaseNumber: releaseNumber,
                Supplier: supplierName, IsLotTrack: isLotTrack, IsSRTrack: isSerial, IsDCTrack: isDCT, ItemNumber: itemNumber
            });

        });


        if (ItemToRuturn.length > 0) {
            $.ajax({
                url: 'OpenPopupToReturnItem',
                type: 'Post',
                data: JSON.stringify(ItemToRuturn),
                dataType: 'html',
                contentType: 'application/json',
                success: function (result) {
                    closeOrdReceiveInfoModel();
                    $('#DivPullSelection').html(result);
                    $("#DivPullSelection").dialog('open');
                },
                error: function (xhr) {
                    alert(xhr.status + ' ' + xhr.statusText);
                }
            })
        }
    }

    function ReceiveItems() {
        var arr = new Array();
        $('#RecieveOrderLineItem' + OrderID + ' tbody tr.row_selected').each(function (i) {
            var colr = hexc($(this).css('background-color'));
            if (colr !== '#d3d3d3') {
                var DOCtrack = $(this).find('#hdnItemDOCTrack').val();
                var LOTTrack = $(this).find('#hdnItemLOTTrack').val();
                var orderDetailID = $(this).find('#hdnID').val();
                var lotnumber = '';
                var expireDATE = '';

                if (DOCtrack == 'True') {
                    expireDATE = $(this).find("#txtExpireDate" + orderDetailID).val();
                }
                if (LOTTrack == "True") {
                    lotnumber = $(this).find("#txtLotNumber" + orderDetailID).val();
                }

                var qty = $(this).find("#txtReceiveQty" + orderDetailID).val();
                var receiveDate = $(this).find("#txtReceiveDate" + orderDetailID).val();
                var cost = $(this).find("#hdnItemCost" + orderDetailID).val();
                if ($(this).find("#txtCostBox" + orderDetailID) != undefined) {
                    cost = $(this).find("#txtCostBox" + orderDetailID).val();
                }

                var binName = $.trim($(this).find('#txtReceiveBin').val());
                var srNumber = '';
                packslip = $(this).find("#txtPackslip" + orderDetailID).val();
                var udf1 = '';
                var udf2 = '';
                var udf3 = '';
                var udf4 = '';
                var udf5 = '';
                if ($(this).find("#UDF1").length > 0 > 0) {
                    if ($(this).find("#UDF1")[0].nodeName === "SELECT")
                        udf1 = $(this).find("#UDF1 option:selected").text();
                    else
                        udf1 = $(this).find("#UDF1").val();
                }

                if ($(this).find("#UDF2").length > 0 > 0) {
                    if ($(this).find("#UDF2")[0].nodeName === "SELECT")
                        udf2 = $(this).find("#UDF2 option:selected").text();
                    else
                        udf2 = $(this).find("#UDF2").val();
                }
                if ($(this).find("#UDF3").length > 0 > 0) {
                    if ($(this).find("#UDF3")[0].nodeName === "SELECT")
                        udf3 = $(this).find("#UDF3 option:selected").text();
                    else
                        udf3 = $(this).find("#UDF3").val();
                }
                if ($(this).find("#UDF4").length > 0 > 0) {
                    if ($(this).find("#UDF4")[0].nodeName === "SELECT")
                        udf4 = $(this).find("#UDF4 option:selected").text();
                    else
                        udf4 = $(this).find("#UDF4").val();
                }
                if ($(this).find("#UDF5").length > 0 > 0) {
                    if ($(this).find("#UDF5")[0].nodeName === "SELECT")
                        udf5 = $(this).find("#UDF5 option:selected").text();
                    else
                        udf5 = $(this).find("#UDF5").val();
                }

                var obj = {
                    LotNumber: lotnumber
                           , ExpirationDate: expireDATE
                           , OrderDetailID: orderDetailID
                           , Quantity: qty
                           , ReceiveDate: receiveDate
                           , Cost: cost
                           , BinName: binName
                           , SerialNumber: srNumber
                           , PackSlipNumber: packslip
                           , UDF1: udf1
                           , UDF2: udf2
                           , UDF3: udf3
                           , UDF4: udf4
                           , UDF5: udf5
                           , IsOnlyFromUI: true
                };

                arr.push(obj);
            }

        });


        var isStag = false;
        if (!isNaN(parseInt('@Model.StagingID')) && parseInt('@Model.StagingID') > 0)
            isStag = true;

        var strurl = '@Url.Content("~/Order/ReceiveOrderedLineItems")';


        $.ajax({
            url: strurl,
            data: JSON.stringify({ 'NewReceiveDetail': arr, 'OrderID': OrdID, 'IsStaging': isStag }),
            dataType: 'json',
            contentType: 'application/json',
            type: 'POST',
            async: false,
            success: function (result) {
                if (result.Status == 'true') {
                    $('#divOrderLineItems').empty();
                    $.get('@Url.Action("LoadOrderLineItemsForReceive")', { 'orderID': OrderID }, function (data) {
                        $('#divOrderLineItems').html(data);

                        $('#RecieveOrderLineItem' + OrderID + ' tbody tr').each(function (i) {
                            var OrdDtlGUID = $(this).find('#hdnGUID').val();
                            var isInArray = $.grep(result.RowColors, function (e) { return e.key == OrdDtlGUID; });
                            if (isInArray.length == 1) {
                                $(this).css('background-color', isInArray[0].value);
                                $(this).removeClass('row_selected');
                            }
                        });
                        if (!isNaN(parseInt(result.OrderStatus)) && parseInt(result.OrderStatus) > 0) {
                            $('#ddlOrderStatus').val(result.OrderStatus);
                        }
                        SetReplenishRedCount();
                        closeOrdReceiveInfoModel();
                        $('#OrdReceivedInfoDialog').find("#OrdReceivedMSG").html(result.Message);
                        $('#OrdReceivedInfoDialog').modal();
                        $('#DivLoading').hide();

                    });
                }
                else {

                    $('#RecieveOrderLineItem' + OrderID + ' tbody tr').each(function (i) {
                        var ItemGUID = $(this).find('#hdnItemGUID').val();
                        var isInArray = $.grep(result.RowColors, function (e) { return e.key == ItemGUID; });
                        if (isInArray.length == 1) {
                            $(this).css('background-color', isInArray[0].value);
                            $(this).removeClass('row_selected');
                        }
                    });

                    closeOrdReceiveInfoModel();
                    $('#OrdReceivedInfoDialog').find("#OrdReceivedMSG").html(result.Message);
                    $('#OrdReceivedInfoDialog').modal();
                }
                isDirtyForm = false;
            },
            error: function (err) {
                closeOrdReceiveInfoModel();
                $('#OrdReceivedInfoDialog').find("#OrdReceivedMSG").html('Error');
                $('#OrdReceivedInfoDialog').modal();
                $('#DivLoading').hide();
            }
        });
    }

    function isDuplicateLot(txtLot, id) {
        if ($(txtLot).val() != '') {
            $('#DivLoading').show();
            $('#RecieveOrderLineItem' + OrdID + ' tbody tr').each(function () {
                var LOTTrack = $(this).find('#hdnItemLOTTrack').val();
                if (LOTTrack == "True") {
                    var trid = $(this).find('#hdnID').val();
                    var txtLotNumber = $(this).find("#txtLotNumber" + trid);
                    if (txtLot.id != $(txtLotNumber)[0].id && $(txtLot).val() == txtLotNumber.val()) {
                        $(txtLot).val('');
                        $('#DivLoading').hide();
                        $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                        $("#spanGlobalMessage").html('@ResMessage.DuplicateLotFound');
                        showNotificationDialog();
                        //alert('@ResMessage.DuplicateLotFound');
                        $(txtLot).focus();
                        return false;
                    }
                }
            });
        }
        if ($(txtLot).val() != '') {
            $.ajax({
                "url": '@Url.Content("~/Inventory/DuplicateCheckLotNumber")',
                data: { LotNumber: $(txtLot).val(), ID: id },
                "async": false,
                cache: false,
                "dataType": "text",
                "success": function (response) {
                    if (response == "duplicate") {
                        $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                        $("#spanGlobalMessage").html('@ResMessage.DuplicateLotFound');
                        showNotificationDialog();
                        //alert('@ResMessage.DuplicateLotFound');
                        $(txtLot).val('');
                        $(txtLot).focus();
                        $('#DivLoading').hide();
                        return false;
                    }
                    else {
                        $('#DivLoading').hide();
                        return false;
                    }
                },
                error: function (response) {
                    $('#DivLoading').hide();
                    $("#spanGlobalMessage").html(response);
                }
            });
        }
        else {
            return true;
        }
    }

    /* global search function */
    function fnFilterReciveOrderLineItem() {
        //set filter only if more than 2 characters are pressed
        if (typeof $("#ReceiveItem_filter") != 'undefined' && ($("#ReceiveItem_filter").val().length > 2 || $("#ReceiveItem_filter").val().length == 0)) {

            bIsReceiveFilter = true;
            var searchtext = $("#ReceiveItem_filter").val().replace(/'/g, "''");
            $('#RecieveOrderLineItem' + OrdID).dataTable().fnFilter(
                            searchtext,
                            null,
                            null,
                            null
                        );

            $('#RecieveOrderLineItem' + OrdID + ' td').removeHighlight();

            if (searchtext.length > 0)
                $('#RecieveOrderLineItem' + OrdID + ' tbody tr > td:not(td#orderlinecommenttd)').highlight($("#ReceiveItem_filter").val());
                //$('#RecieveOrderLineItem' + OrdID + ' td').highlight($("#ReceiveItem_filter").val());

        }
    }


    function UpdateReceiveQty(ItemGUID) {
        $.get('@Url.Action("LoadOrderLineItemsForReceive")', { 'orderID': OrderID }, function (data) {
            $('#divOrderLineItems').html(data);
            $('#RecieveOrderLineItem' + OrdID + ' tr').each(function (i) {
                var itmGuid = $(this).find('#hdnItemGUID').val();
                if (itmGuid == ItemGUID) {
                    var lnkimg = $(this).find('#aPlusMinus');
                    $(lnkimg).click();
                }
            });
            $('#DivLoading').hide();
        });

    }





    function NewReceive(ordDetailID) {
        $('#DivLoading').show();

        var isSerial = $("#hdnIsSerial_" + ordDetailID).val();
        var consqty = null;
        var custqty = null;
        var expirationDate = null;
        var qty = 0;
        var lotNumber = "";
        var srNumber = "";
        var consign = $("#hdnIsConsign_" + ordDetailID).val();

        var isLot = $("#hdnIsLot_" + ordDetailID).val();
        var isDateCode = $("#hdnIsDateCode_" + ordDetailID).val();
        var ordDetailGUID = $("#hdnOrderDetailGUID_" + ordDetailID).val();
        var itemGUID = $("#hdnItemGuid_" + ordDetailID).val();
        //var binID = $("#ddlBin_" + ordDetailID).val();

        var binName = $('#txtReceiveBinNumber_' + ordDetailID).val();
        var packSlipNumber = $('#txtPackslip_' + ordDetailID).val();
        var receivecost = $("#txtCostBox_" + ordDetailID).val();
        var recvDate = $("#txtReceived_" + ordDetailID).val();
        var itemType = $("#hdnItemType_" + ordDetailID).val();
        // var RecvedQty = parseFloat($("#spnReceivedQty_" + ordDetailID).text());
        var ReqstedQty = parseFloat($("#hdnRequestedQty_" + ordDetailID).val());
        var ApprovedQty = parseFloat($("#hdnApprovedQty_" + ordDetailID).val());
        var ReceivedQty = parseFloat($("#hdnReceivedQty_" + ordDetailID).val());
        var UDF1 = '';
        var UDF2 = '';
        var UDF3 = '';
        var UDF4 = '';
        var UDF5 = '';
        var ispackSlipNumberMandatory = $("#hdnIsPackSlipNumberMandatory_" + ordDetailID).val();

        if ($('#NewReceiveEntry' + ordDetailID).find('#UDF1').length > 0) {
            if ($('#NewReceiveEntry' + ordDetailID).find('#UDF1')[0].nodeName === "SELECT")
                UDF1 = $('#NewReceiveEntry' + ordDetailID).find('#UDF1').find("option:selected").text();
            else
                UDF1 = $('#NewReceiveEntry' + ordDetailID).find('#UDF1').val();
        }

        if ($('#NewReceiveEntry' + ordDetailID).find('#UDF2').length > 0) {
            if ($('#NewReceiveEntry' + ordDetailID).find('#UDF2')[0].nodeName === "SELECT")
                UDF2 = $('#NewReceiveEntry' + ordDetailID).find('#UDF2').find("option:selected").text();
            else
                UDF2 = $('#NewReceiveEntry' + ordDetailID).find('#UDF2').val();
        }

        if ($('#NewReceiveEntry' + ordDetailID).find('#UDF3').length > 0) {
            if ($('#NewReceiveEntry' + ordDetailID).find('#UDF3')[0].nodeName === "SELECT")
                UDF3 = $('#NewReceiveEntry' + ordDetailID).find('#UDF3').find("option:selected").text();
            else
                UDF3 = $('#NewReceiveEntry' + ordDetailID).find('#UDF3').val();
        }

        if ($('#NewReceiveEntry' + ordDetailID).find('#UDF4').length > 0) {
            if ($('#NewReceiveEntry' + ordDetailID).find('#UDF4')[0].nodeName === "SELECT")
                UDF4 = $('#NewReceiveEntry' + ordDetailID).find('#UDF4').find("option:selected").text();
            else
                UDF4 = $('#NewReceiveEntry' + ordDetailID).find('#UDF4').val();
        }

        if ($('#NewReceiveEntry' + ordDetailID).find('#UDF5').length > 0) {
            if ($('#NewReceiveEntry' + ordDetailID).find('#UDF5')[0].nodeName === "SELECT")
                UDF5 = $('#NewReceiveEntry' + ordDetailID).find('#UDF5').find("option:selected").text();
            else
                UDF5 = $('#NewReceiveEntry' + ordDetailID).find('#UDF5').val();
        }

        var stagID = $("#hdnStagingID_" + ordDetailID).val();
        var isError = false;
        var ErrorMassage = "";
        var arrLocDetail = new Array();
        if ($.trim($("#txtReceived_" + ordDetailID).val()).length <= 0) {
            isError = true;
            ErrorMassage += "<b style='color: Red;'>Please enter bin number.</b><br/>"
        }

        if (isSerial == "True") {
            srNumber = $("#txtsrnumber_" + ordDetailID).val();
            if (srNumber.length <= 0) {
                isError = true;
                ErrorMassage += "<b style='color: Red;'>Please enter serial number.</b><br/>"
            }
            else {
                var txtSRNumber = $("#txtsrnumber_" + ordDetailID);
                if (txtSRNumber.css('background-color') === "rgb(247, 187, 196)") {
                    $("#spanGlobalMessage").html("@ResMessage.DuplicateSerialFound");
                    $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                    showNotificationDialog();
                    $("#DivLoading").hide();
                    $("#txtsrnumber_" + ordDetailID).focus();
                    return false;
                }
                else
                    qty = 1;
            }
        }
        else {
            qty = $("#txtReceiveQuantity_" + ordDetailID).val();
            if (isNaN(qty) || qty <= 0) {
                isError = true;
                ErrorMassage += "<b style='color: Red;'>Please enter quantity to receive.</b><br/>"
            }
        }

        //        if ('@IsPackSlipReq.ToString()'.toUpperCase() == "TRUE" && packSlipNumber.length <= 0) {
        //            isError = true;
        //            ErrorMassage += "<b style='color: Red;'>Please enter packslip # to receive.</b><br/>"
        //        }

        if (ispackSlipNumberMandatory.toUpperCase() == "TRUE" && packSlipNumber.length <= 0) {
            isError = true;
            ErrorMassage += "<b style='color: Red;'>Please enter packslip # to receive.</b><br/>"
        }
        if (isLot == "True") {
            lotNumber = $("#txtlotnumber_" + ordDetailID).val();
            if (lotNumber.length <= 0) {
                isError = true;
                ErrorMassage += "<b style='color: Red;'>Please enter lot number.</b><br/>"
            }
        }
        if (isDateCode == "True") {
            expirationDate = $("#txtExpiration_" + ordDetailID).val();
            if (expirationDate.length <= 0) {
                isError = true;
                ErrorMassage += "<b style='color: Red;'>Please select exire date.</b><br/>"
            }
        }

        if (consign == "True") {
            consqty = qty;
        }
        else {
            custqty = qty;
        }

        if (isError) {
            ErrorMassage = '<b>This item is not able to receive, due to following reasons.</b><br />' + ErrorMassage;
            $('#OrdReceivedInfoDialog').find("#OrdReceivedMSG").html(ErrorMassage);
            $('#DivLoading').hide();
            $('#OrdReceivedInfoDialog').modal();
        }
        else {
            var isTrue = false;
            //if (confirm(msg)) {

            if (isNaN(parseFloat(ApprovedQty)) || parseFloat(ApprovedQty) < 0) {
                ApprovedQty = 0;
            }

            if (isNaN(parseFloat(ReceivedQty)) || parseFloat(ReceivedQty) < 0) {
                ReceivedQty = 0;
            }

            if (isNaN(parseFloat(qty)) || parseFloat(qty) < 0) {
                qty = 0;
            }

            if (parseFloat(ApprovedQty) < (parseFloat(qty) + parseFloat(ReceivedQty))) {
                var msg = 'This receive will exceed the approved quantity.';
                if (confirm(msg)) {
                    isTrue = true;
                }
            }
            else {
                isTrue = true;
            }

            if (isTrue) {
                $('#OrdReceiveProcessing').modal();
                $('#OrdReceiveProcessing').parent().parent().find(".modalCloseImg").css('display', 'none');


                var obj = {
                    "BinNumber": binName,
                    "CustomerOwnedQuantity": custqty,
                    "ConsignedQuantity": consqty,
                    "LotNumber": lotNumber,
                    "SerialNumber": srNumber,
                    "ExpirationDate": expirationDate,
                    "ReceivedDate": recvDate,
                    "Expiration": expirationDate,
                    "Received": recvDate,
                    "Cost": receivecost,
                    "ItemGUID": itemGUID,
                    "ItemType": itemType,
                    "SerialNumberTracking": isSerial,
                    "LotNumberTracking": isLot,
                    "DateCodeTracking": isDateCode,
                    "OrderDetailGUID": ordDetailGUID,
                    "ItemCost": receivecost,
                    "PackSlipNumber": packSlipNumber,
                    "UDF1": UDF1,
                    "UDF2": UDF2,
                    "UDF3": UDF3,
                    "UDF4": UDF4,
                    "UDF5": UDF5,
                    "IsOnlyFromUI": true

                };
                arrLocDetail.push(obj);
                var url = '@Url.Content("~/Inventory/ItemLocationDetailsSaveOrder")';
                if (!isNaN(stagID) && parseInt(stagID) > 0) {
                    url = '@Url.Content("~/Inventory/ItemLocationDetailsSaveForMSCredit")';
                }
                $.ajax({
                    "url": url,
                    "data": JSON.stringify(arrLocDetail),
                    "type": 'POST',
                    "async": false,
                    "cache": false,
                    "dataType": "json",
                    "contentType": "application/json",
                    "success": function (response) {
                        if (response.Status === "OK") {
                            $('#DivLoading').show();
                            SetReplenishRedCount();
                            $('#divOrderLineItems').empty();
                            url = '@Url.Action("LoadOrderLineItemsForReceive")';
                            $.get(url, { 'orderID': OrdID }, function (data) {
                                $('#divOrderLineItems').html(data);
                                $('#DivLoading').hide();
                                closeOrdReceiveInfoModel();
                                ShowHideInnerGrid(this, ordDetailID);
                                $('#DivLoading').hide();
                            });
                        }
                        else if (response.Status === "UDFError") {
                            closeOrdReceiveInfoModel();
                            ErrorMassage = '<b>This item is not able to receive, due to following reasons.</b><br />' + response.Message;
                            $('#OrdReceivedInfoDialog').find("#OrdReceivedMSG").html(ErrorMassage);
                            $('#DivLoading').hide();
                            $('#OrdReceivedInfoDialog').modal();
                            return false;
                        }

                    },
                    "error": function (error) {
                        closeOrdReceiveInfoModel();
                        $('#DivLoading').hide();
                        $('#OrdReceivedInfoDialog').find("#OrdReceivedMSG").html("<b style='color: Red;'>Server error</b>");
                        $('#OrdReceivedInfoDialog').modal();
                        return false;
                    },
                    "completed": function (obj) {

                    }

                });
            }
            else {
                closeOrdReceiveInfoModel();
                $('#DivLoading').hide();
                return false;
            }

        }
    }

    function DeleteYesSelectedRows(ordDetailID) {
        $('#DivLoading').show();
        $.modal.impl.close();
        var anSelected = fnGetSelected($('#ReceivedItemDetail_' + ordDetailID).dataTable());
        var stringGUIDs = "";
        if (anSelected.length > 0) {
            for (var i = 0; i <= anSelected.length - 1; i++) {
                stringGUIDs = stringGUIDs + $(anSelected[i]).find("#hdnGUID").val() + ",";
            }
        }

        if (stringGUIDs.length > 0) {
            var ordDetailGUID = $("#hdnOrderDetailGUID_" + ordDetailID).val();
            var itemGUID = $("#hdnItemGuid_" + ordDetailID).val();

            $.ajax({
                'url': '@Url.Content("~/Order/DeleteRecieveAndUpdateReceivedQty")',
                'type': 'POST',
                'data': { 'ItemGUID': itemGUID, 'ordDetailGUID': ordDetailGUID, 'deleteIDs': stringGUIDs },
                'async': false,
                'cache': false,
                'dataType': 'text',
                'success': function (response) {
                    if (response == "ok") {
                        NewUpdateReceivedQty(ordDetailID, ordDetailGUID);
                        for (var i = 0; i <= anSelected.length - 1; i++) {
                            $('#ReceivedItemDetail_' + ordDetailID).dataTable().fnDeleteRow(anSelected[i]);
                        }
                        if (anSelected.length > 0)
                            $("#spanGlobalMessage").html("@ResCommon.RecordDeletedSuccessfully".replace("{0}","(" + anSelected.length + ")"));

                        // $('#ReceivedItemDetail_' + ordDetailID).dataTable().fnDraw();
                        $('#DivLoading').hide();
                        showNotificationDialog();
                        url = '@Url.Action("LoadOrderLineItemsForReceive")';
                        $.get(url, { 'orderID': OrdID }, function (data) {
                            $('#divOrderLineItems').html(data);
                            $('#DivLoading').hide();
                            closeOrdReceiveInfoModel();
                            ShowHideInnerGrid(this, ordDetailID);
                            $('#DivLoading').hide();
                            return false;
                        });
                    }
                },
                'error': function (err) {
                    $('#DivLoading').hide();
                }
            });
        }

    }
    function getItemInventoryStagingLocation1(dropdownobj, binNumber, itmGuid, orderGuid) {

        var selval = $(dropdownobj).val();
        if (!$(dropdownobj).hasClass("populated")) {
            $(dropdownobj).html("");
            var stroptions = "";
            var stroptions = "<option value=''></option>";

            $.ajax({
                "url": '/Receive/GetItemLocations',
                "type": "POST",
                "data": { 'OrderGuid': orderGuid, 'ItemGuid': itmGuid, 'NameStartWith': '' },
                "async": false,
                "cache": false,
                "dataType": "json",
                "success": function (response) {
                    $(response).each(function (indx, obj) {
                        if (selval == obj.Key) {
                            stroptions = stroptions + "<option selected='selected' value='" + obj.Key + "'>" + obj.Key + "</option>";
                        }
                        else {
                            stroptions = stroptions + "<option value='" + obj.Key + "'>" + obj.Key + "</option>";
                        }

                    });
                    $(dropdownobj).html(stroptions);
                    $(dropdownobj).addClass("populated");
                },
                "error": function (response) {
                }
            });
        }
    }

    function getItemInventoryStagingLocationAC(objTxtselector, reqUrl, ReqData, nameKey) {
        var itmGuid = $(objTxtselector).parent().parent().find('#hdnItemGUID').val();
        var stagingName = $('#txtStagingName').val();
        var includeQty = false;
        $(objTxtselector).autocomplete({
            source: function (request, response) {
                $('#DivLoading').show();

                $.ajax({
                    "url": reqUrl,
                    "type": "POST",
                    "contentType": 'application/json',
                    "dataType": 'json',
                    "data": { 'ItemGuid': itmGuid, 'StagingHeaderName': stagingName, 'IncludeQty': includeQty, 'NameStartWith': binNumber },
                    "success": function (data) {

                        response(
                        $.map(data, function (Items) {
                            return {
                                label: Items.BinNumber,
                                value: Items.BinNumber
                            }
                        }));
                        $('#DivLoading').hide();
                    },
                    error: function (err) {
                        console.log(err);
                        $('#DivLoading').hide();
                    }
                });
            },
            autoFocus: false,
            minLength: 0,
            select: function (event, ui) {
            },
            open: function () {
                $(this).removeClass("ui-corner-all").addClass("ui-corner-top");
                $('ul.ui-autocomplete').css('overflow-y', 'auto');
                $('ul.ui-autocomplete').css('max-height', '300px');
            },
            close: function () {
            },
            change: function (event, ui) {

            }
        }).bind("focus", function () {
            $(objTxtselector).autocomplete("search");
        });
    }
    function getItemInventoryStagingLocation(dropdownobj, binNumber) {

        var itmGuid = $(dropdownobj).parents("tr").find('#hdnItemGUID').val();
        var stagingName = $('#txtStagingName').val();
        var includeQty = false;
        var selval = $(dropdownobj).val();
        if (!$(dropdownobj).hasClass("populated")) {
            $(dropdownobj).html("");
            var stroptions = "";
            var stroptions = "<option value=''></option>";

            $.ajax({
                "url": '/Master/GetBinForItemOrStaging',
                "type": "POST",
                "data": { 'ItemGuid': itmGuid, 'StagingHeaderName': stagingName, 'IncludeQty': includeQty, 'NameStartWith': binNumber },
                "async": false,
                "cache": false,
                "dataType": "json",
                "success": function (response) {
                    $(response).each(function (indx, obj) {
                        if (selval == obj.Key) {
                            stroptions = stroptions + "<option selected='selected' value='" + obj.Key + "'>" + obj.Key + "</option>";
                        }
                        else {
                            stroptions = stroptions + "<option value='" + obj.Key + "'>" + obj.Key + "</option>";
                        }

                    });
                    $(dropdownobj).html(stroptions);
                    $(dropdownobj).addClass("populated");
                },
                "error": function (response) {
                }
            });
        }
    }


    function getItemInventoryStagingLocationWithQty(dropdownobj, binNumber) {

        var itmGuid = $(dropdownobj).parents("tr").find('#hdnItemGUID').val();
        var stagingName = $('#txtStagingName').val();
        var includeQty = true;
        var IsLoadMoreLocations = false;
        var selval = $(dropdownobj).val();
        if (!$(dropdownobj).hasClass("populated")) {
            $(dropdownobj).html("");
            var stroptions = "";
            var stroptions = "<option value=''></option>";

            $.ajax({
                "url": '/Master/GetBinForItemOrStaging',
                "type": "POST",
                "data": { 'ItemGuid': itmGuid, 'StagingHeaderName': stagingName, 'IncludeQty': includeQty, 'NameStartWith': binNumber, 'IsLoadMoreLocations': IsLoadMoreLocations },
                "async": false,
                "cache": false,
                "dataType": "json",
                "success": function (response) {
                    $(response).each(function (indx, obj) {
                        if (selval == obj.Key) {
                            stroptions = stroptions + "<option selected='selected' value='" + obj.Key + "'>" + obj.Key + "</option>";
                        }
                        else {
                            stroptions = stroptions + "<option value='" + obj.Key + "'>" + obj.Key + "</option>";
                        }

                    });
                    $(dropdownobj).html(stroptions);
                    $(dropdownobj).addClass("populated");
                },
                "error": function (response) {
                }
            });
        }
    }

    $('#bntUnCloseItemConfirmYes').click(function () {
        $('#DivLoading').show();
        var orderDetailID = '';

        $('#RecieveOrderLineItem' + OrderID).find("tbody tr.row_selected").each(function (e) {
            // if (orderDetailID.length > 0) {
            //     orderDetailID = orderDetailID + ",";
            // }
            if ($(this).find('#hdnID').val() != undefined) {
                if (orderDetailID.length > 0) {
                    orderDetailID = orderDetailID + ",";
                }
                orderDetailID = orderDetailID + $(this).find('#hdnID').val();
            }
        });
        if (orderDetailID.length > 0) {
            $.ajax({
                'url': 'UnCloseOrderLineItems',
                'data': { 'ids': orderDetailID, 'CallFrom': 'Order' },
                'success': function (result) {
                    if (result.ItemError != '') {
                        alert(result.ItemError);
                    }
                    if (!isNaN(parseInt(result.OrderStatus)) && parseInt(result.OrderStatus) > 0) {
                        $('#ddlOrderStatus').val(result.OrderStatus);
                    }
                    closeModalCloseOderDialog();
                    if (!isNaN(parseInt(result.OrderStatus)) && parseInt(result.OrderStatus) == 8) {
                        ShowEditTab('OrderEdit/' + OrderID, 'frmOrder');
                        $('#tab11').hide();
                    }
                    else {
                        CallThisFunctionFromModel('success')
                    }
                    $('#DivLoading').hide();
                },
                'error': function (result) {
                    closeModalCloseOderDialog();
                    $('#DivLoading').hide();
                }

            });
        }
        else {
            closeModalCloseOderDialog();
            $('#DivLoading').hide();
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            $("#spanGlobalMessage").html('@ResReceiveOrderDetails.MsgSelectLineItem');
            showNotificationDialog();
            //alert('@ResReceiveOrderDetails.MsgSelectLineItem');

        }
    });
    $('#bntCloseLineItemConfirmYes').click(function () {
        $('#DivLoading').show();
        var orderDetailID = '';

        $('#RecieveOrderLineItem' + OrderID).find("tbody tr.row_selected").each(function (e) {
            // if (orderDetailID.length > 0) {
            //     orderDetailID = orderDetailID + ",";
            // }
            if ($(this).find('#hdnID').val() != undefined) {
                if (orderDetailID.length > 0) {
                    orderDetailID = orderDetailID + ",";
                }
                orderDetailID = orderDetailID + $(this).find('#hdnID').val();
            }
        });
        if (orderDetailID.length > 0) {
            $.ajax({
                'url': 'CloseOrderDetailLineItems',
                'data': { 'ids': orderDetailID, 'CallFrom': 'Order' },
                'success': function (result) {
                    if (!isNaN(parseInt(result.OrderStatus)) && parseInt(result.OrderStatus) > 0) {
                        $('#ddlOrderStatus').val(result.OrderStatus);
                    }
                    closeModalCloseOderDialog();
                    if (!isNaN(parseInt(result.OrderStatus)) && parseInt(result.OrderStatus) == 8) {
                        ShowEditTab('OrderEdit/' + OrderID, 'frmOrder');
                        $('#tab11').hide();
                    }
                    else {
                        CallThisFunctionFromModel('success')
                    }
                    $('#DivLoading').hide();
                },
                'error': function (result) {
                    closeModalCloseOderDialog();
                    $('#DivLoading').hide();
                }

            });
        }
        else {
            closeModalCloseOderDialog();
            $('#DivLoading').hide();
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            $("#spanGlobalMessage").html('@ResReceiveOrderDetails.MsgSelectLineItem');
            showNotificationDialog();
            //alert('@ResReceiveOrderDetails.MsgSelectLineItem');

        }

    });

    $('#RecieveOrderLineItem' + OrderID).live('contextmenu', function (e) {
        if ($("body").hasClass('DTTT_Print')) {
            e.preventDefault();
            return false;
        }

        var x = e.pageX - this.offsetLeft;
        var y = e.pageY - this.offsetTop;
        $('#divCtxMenu').css({ 'top': e.pageY, 'left': e.pageX }).fadeIn('slow');
        e.preventDefault();

    });






    function GetToFillPreReceiveFroOrder(tr, aData) {
        var arrObj = new Array();
        var RecvQty = 0;
        var IsShowNormalItemPopUp = 0;
        var orderDetailID = $(tr).find('#hdnID').val();

        if ($(tr).find("input[type='text'][id^='txtReceiveQty']").length > 0) {
            RecvQty = $(tr).find("input[type='text'][id^='txtReceiveQty']").val();
        }
        if ($(tr).find("#hdnIsShowNormalItemPopUp" + orderDetailID) != undefined && $(tr).find("#hdnIsShowNormalItemPopUp" + orderDetailID).length > 0) {
            IsShowNormalItemPopUp = $(tr).find("#hdnIsShowNormalItemPopUp" + orderDetailID).val();
        }
        var toFillReceiveDetail = { "Quantity": RecvQty, "IsShowNormalItemPopUp": IsShowNormalItemPopUp };
        arrObj.push(toFillReceiveDetail);
        var RecvItemNumber = $(tr).find('#hdnItemNumber').val();
        var RecvCost = 0;
        if ($(tr).find("#txtCostBox" + orderDetailID) != undefined && $(tr).find("#txtCostBox" + orderDetailID).length > 0) {
            RecvCost = $(tr).find("#txtCostBox" + orderDetailID).val();
        }
        else if ($(tr).find("#hdnItemCost" + orderDetailID) != undefined && $(tr).find("#hdnItemCost" + orderDetailID).length > 0) {
            RecvCost = $(tr).find("#hdnItemCost" + orderDetailID).val();
        }
        else if ($(tr).find("#hdnItemCost" + orderDetailID) != undefined && $(tr).find("#hdnItemCost" + orderDetailID).length > 0) {
            RecvCost = $(tr).find("#hdnItemCost" + orderDetailID).val();
        }

        /// WI-6215 Related Changes Start ///
        var CurrentReceiveCost = 0;
        var OldReceiveCost = 0;
        var IsReceivedCostChange = false;
        if ($(tr).find("#txtCostBox" + orderDetailID) != undefined && $(tr).find("#txtCostBox" + orderDetailID).length > 0) {
            CurrentReceiveCost = $(tr).find("#txtCostBox" + orderDetailID).val();
        }
        if ($(tr).find("#txtInTransitQuantity_" + orderDetailID) != undefined && $(tr).find("#txtInTransitQuantity_" + orderDetailID).length > 0) {
            RecvInTransitQty = $(tr).find("#txtInTransitQuantity_" + orderDetailID).val();
        }
        if ($(tr).find("#hdnOrderCost" + orderDetailID) != undefined && $(tr).find("#hdnOrderCost" + orderDetailID).length > 0) {
            OldReceiveCost = $(tr).find("#hdnOrderCost" + orderDetailID).val();
        }
        var CurrencyDecimalDigits =@CurrencyDecimalDigits;
        if (CurrencyDecimalDigits == null || CurrencyDecimalDigits == "") {
            CurrencyDecimalDigits = 0;
        }
        if (parseFloat(CurrentReceiveCost).toFixed(CurrencyDecimalDigits)
            != parseFloat(OldReceiveCost).toFixed(CurrencyDecimalDigits)) {
            IsReceivedCostChange = true;
        }
        /// WI-6215 Related Changes END ///

        var RecvOrderNumber = '@Model.OrderNumber';
        var RecvReleaseNumber = '@Model.ReleaseNumber';
        var RecvIsPackslipMandatory = $(tr).find("#hdnIsPackSlipNumberMandatory_" + orderDetailID).val();

        var RecvItemTypeSerialLot = '';
        var RecvSerialNumberTracking = false;
        var RecvLotNumberTracking = false;
        var RecvDateCodeTracking = false;

        var isLot = $(tr).find("#hdnItemLOTTrack").val();
        var isDateCode = $(tr).find("#hdnItemDOCTrack").val();
        var isSerial = $(tr).find("#hdnItemSRTrack").val();

        if (isSerial == 'True') {
            RecvItemTypeSerialLot = "Serial#";
            RecvSerialNumberTracking = true;
        }
        else if (isLot == 'True') {
            RecvItemTypeSerialLot = "Lot#";
            RecvLotNumberTracking = true;
        }

        if (isDateCode == 'True') {
            if (RecvItemTypeSerialLot.length > 0)
                RecvItemTypeSerialLot = RecvItemTypeSerialLot + " " + lblAndExpiration;
            else
                RecvItemTypeSerialLot = RecvItemTypeSerialLot + " " + lblExpirationDate;
            RecvDateCodeTracking = true;
        }

        if (RecvItemTypeSerialLot.length > 0) {
            RecvItemTypeSerialLot = RecvItemTypeSerialLot + " " + lblTrackingItem;
        }
        var RecvRequestedQty = $(tr).find("#spnRequestedQty").text();
        var RecvApprovedQty = $(tr).find("#spnApprovedQty").text();
        var RecvReceivedQty = $(tr).find("#spnReceivedQty").text();

        var RecvItemGUID = $(tr).find("#hdnItemGUID").val();
        var RecvOrderDetailGUID = $(tr).find("#hdnGUID").val();
        var RecvOrderGUID = $(tr).find("#hdnOrderGUID").val();
        var RecvOrderStatus = '@Model.OrderStatus';
        var RecvUDF1 = getRecUDFSelectedVal(tr, "UDF1");
        var RecvUDF2 = getRecUDFSelectedVal(tr, "UDF2");
        var RecvUDF3 = getRecUDFSelectedVal(tr, "UDF3");
        var RecvUDF4 = getRecUDFSelectedVal(tr, "UDF4");
        var RecvUDF5 = getRecUDFSelectedVal(tr, "UDF5");
        var RecvBin = '';
        if ($(tr).find("#txtReceiveBin").length > 0) {
            RecvBin = $(tr).find('#txtReceiveBin').val();
        }
        else if ($(tr).find("#slctBinNumber").length > 0) {
            RecvBin = $(tr).find('#slctBinNumber').val();
        }

        var POLineItemNumbers = $(tr).find("#POLineItemNumbers").attr("data-value");
        var RecvPackSlip = $(tr).find('#txtPackslip' + orderDetailID).val();
        var RecvDate = getCurrentDate();

        if ($(tr).find("input[type = 'text'][id^='txtReceiveDate']").length > 0) {
            RecvDate = $(tr).find("input[type = 'text'][id^='txtReceiveDate']").val();
        }

        var RecvComment = '';
        if ($(tr).find("#Comment").length > 0) {
            RecvComment = $(tr).find('#Comment').val().trim();
        }

        var toFillPreReceive = {
            "ItemNumber": RecvItemNumber, "OrderNumber": RecvOrderNumber,
            "ReleaseNumber": RecvReleaseNumber,
            "ItemTypeSerialLot": RecvItemTypeSerialLot, "IsPackSlipMandatory": RecvIsPackslipMandatory,
            "SerialNumberTracking": RecvSerialNumberTracking, "LotNumberTracking": RecvLotNumberTracking,
            "DateCodeTracking": RecvDateCodeTracking, "IsModelShow": false, "Cost": RecvCost,
            "Comment": RecvComment,
            "BinNumber": RecvBin, "ReceivedDate": RecvDate, "PackSlipNumber": RecvPackSlip,
            "UDF1": RecvUDF1, "UDF2": RecvUDF2, "UDF3": RecvUDF3, "UDF4": RecvUDF4, "UDF5": RecvUDF5,
            "ItemGUID": RecvItemGUID, "OrderDetailGUID": RecvOrderDetailGUID, "OrderGUID": RecvOrderGUID,
            "OrderStatus": RecvOrderStatus, "RequestedQty": RecvRequestedQty, "ApproveQty": RecvApprovedQty,
            "ReceiveQty": RecvReceivedQty, "MakePreReceiveDetail": arrObj
            , "IsReceivedCostChange": IsReceivedCostChange, "InTransitQuantity": RecvInTransitQty, "POLineItemNumber": POLineItemNumbers
        };
        return toFillPreReceive;
    }






    //$("#ColumnOrderSetup1").off('click')
    //$("#ColumnOrderSetup1").on('click', function () {

    $('#divOrderLineItems').off('click', 'a#ColumnOrderSetup1');
    $('#divOrderLineItems').on('click', 'a#ColumnOrderSetup1', function () {
        var dtName = 'OrderLineItem' + OrderID;

        var lstName = 'OrderLineItemList';
        var clmobjName = 'objOrdDtlGridColumns';

        if (parseInt($('#ddlOrderStatus').val()) > parseInt('@((int)OrderStatus.Approved)') && parseInt($('#ddlOrderStatus').val()) < parseInt('@((int)OrderStatus.Closed)')) {
            dtName = 'RecieveOrderLineItem' + OrderID;
            lstName = 'ReceiveOrderLineItem';
            clmobjName = 'objOrdRcvDtlGridColumns';
        }

        $("#divDetailGridReorderPopup").data({ 'DataTableName': dtName, 'ListName': lstName, 'ColumnObjectName': clmobjName }).dialog("open");
        return false;
    });



    //$('#divDetailGridReorderPopup').off('click', 'input#btnSaveDetailGridColumnOrder');
    //$('#divDetailGridReorderPopup').on('click', 'input#btnSaveDetailGridColumnOrder', function () {
    //    var DTName = $('#divDetailGridReorderPopup').find('#DTName').val();
    //    var _ListName = $('#divDetailGridReorderPopup').find('#ListName').val();
    //    UpdateDetailGridColumnOrder(DTName, _ListName);
    //});

    function FillDetailGridDiv() {

        var _vCOIsDeleted = false;
        var isArchivedOrder = '@Model.IsArchived.GetValueOrDefault(false)';
        if (typeof ($('#IsDeletedRecordsOrdLn')) != undefined) {
            _vCOIsDeleted = $('#IsDeletedRecordsOrdLn').is(':checked');
        }
        $('#divOrderLineItems').empty();
        var url = '@Url.Action("LoadOrderLineItems")';
        if ($('#hdnIsChangeOrdclick').val() == "True" && parseInt($('#ddlOrderStatus').val()) == '@((int)OrderStatus.Transmitted)') {
            url = '@Url.Action("LoadOrderLineItems")';
        }
        else if (parseInt($('#ddlOrderStatus').val()) > parseInt('@((int)OrderStatus.Approved)') && parseInt($('#ddlOrderStatus').val()) < parseInt('@((int)OrderStatus.Closed)')) {
            url = '@Url.Action("LoadOrderLineItemsForReceive")';
        }

        $.get(url, { 'orderID': OrderID, 'IsShowDeleted': _vCOIsDeleted, 'IsArchivedOrder': isArchivedOrder }, function (data) {
            $('#divOrderLineItems').html(data);
            $("#divDetailGridReorderPopup").dialog("close");
            if (_vCOIsDeleted) {
                $("#IsDeletedRecordsOrdLn").attr("checked", 'checked');
            }
            $('#DivLoading').hide();
        });


    }

</script>
<script type="text/javascript">


    function PrepareReturnDataTable(objPullItemDTO) {
        var columnarrIL = new Array();
        columnarrIL.push({
            mDataProp: null, sClass: "read_only", sDefaultContent: '', fnRender: function (obj, val) {
                if (objPullItemDTO.ViewRight == "ViewOverwrite") {
                    var strReturn = "<span style='position:relative'>";
                    strReturn = strReturn + "<input type='text' value='" + obj.aData.LotOrSerailNumber + "' id='txtLotOrSerailNumber' name='txtLotOrSerailNumber' class='text-boxinner AutoSerialLot' />";
                    strReturn = strReturn + '<a id="lnkShowAllOptions" href="javascript:void(0);" style="position:absolute; right:5px; top:0px;" class="ShowAllOptionsSL" ><img src="/Content/images/arrow_down_black.png" alt="select" /></a></span>';
                    return strReturn;
                }
                else if (objPullItemDTO.ViewRight == "NoRight") // && IsCheckViewRight == false)
                {
                    var strReturn = "<span style='position:relative'>";
                    strReturn = strReturn + "<input type='text' value='" + obj.aData.LotOrSerailNumber + "' id='txtLotOrSerailNumberNoRight' name='txtLotOrSerailNumberNoRight' class='text-boxinner' />";
                    //strReturn = strReturn + '<a id="lnkShowAllOptions" href="javascript:void(0);" style="position:absolute; right:5px; top:0px;" class="ShowAllOptionsSL" ><img src="/Content/images/arrow_down_black.png" alt="select" /></a></span>';
                    return strReturn;
                }
                else if (objPullItemDTO.ViewRight == "ViewOnly") {
                    var strReturn = "<input type='text' value='" + obj.aData.LotOrSerailNumber + "' id='txtLotOrSerailNumberViewOnly' name='txtLotOrSerailNumberViewOnly' class='text-boxinner' />";
                    return strReturn;
                }
                else {
                    var strReturn = "<input type='text' value='" + obj.aData.LotOrSerailNumber + "' id='txtLotOrSerailNumberViewOnly' name='txtLotOrSerailNumberViewOnly' class='text-boxinner' />";
                    return strReturn;
                }
            }
        });
        columnarrIL.push({ mDataProp: "BinNumber", sClass: "read_only" });
        columnarrIL.push({
            mDataProp: null, sClass: "read_only", sDefaultContent: '', fnRender: function (obj, val) {
                var strReturn = "<span name='spnLotSerialQuantity' id='spnLotSerialQuantity_" + obj.aData.ID + "'>" + obj.aData.LotSerialQuantity + "</span>";
                return strReturn;
            }
        });
        columnarrIL.push({
            mDataProp: null, sClass: "read_only", sDefaultContent: '', fnRender: function (obj, val) {
                var strReturn = "<input type='hidden' name='hdnRowUniqueId' value='" + obj.aData.ID + "_" + obj.aData.ItemGUID + "_" + obj.aData.BinID + "' />";
                strReturn = strReturn + "<input type='hidden' name='hdnLotNumberTracking' value='" + obj.aData.LotNumberTracking + "' />";
                strReturn = strReturn + "<input type='hidden' name='hdnSerialNumberTracking' value='" + obj.aData.SerialNumberTracking + "' />";
                strReturn = strReturn + "<input type='hidden' name='hdnDateCodeTracking' value='" + obj.aData.DateCodeTracking + "' />";
                strReturn = strReturn + "<input type='hidden' name='hdnExpiration' value='" + obj.aData.Expiration + "' />";
                strReturn = strReturn + "<input type='hidden' name='hdnExpirationDate' value='" + obj.aData.strExpirationDate + "' />";
                strReturn = strReturn + "<input type='hidden' name='hdnBinNumber' value='" + obj.aData.BinNumber + "' />";

                if (objPullItemDTO.SerialNumberTracking == BoolTrueString) {
                    strReturn = strReturn + "<input type='text' value='" + FormatedCostQtyValues(obj.aData.PullQuantity, 2) + "' id='txtPullQty_" + obj.aData.ID + "' name='txtPullQty' class='text-boxinner pull-quantity' readonly='readonly' />";
                }
                else {
                    strReturn = strReturn + "<input type='text' value='" + FormatedCostQtyValues(obj.aData.PullQuantity, 2) + "' id='txtPullQty_" + obj.aData.ID + "' name='txtPullQty' class='text-boxinner pull-quantity' />";
                }
                return strReturn;
            }
        });
        columnarrIL.push({ mDataProp: "Received", sClass: "read_only" });
        columnarrIL.push({ mDataProp: "Expiration", sClass: "read_only" });

        var Curtable = $('#' + objPullItemDTO.tableID).dataTable({
            "bPaginate": false,
            "bLengthChange": false,
            "bFilter": false,
            "bSort": false,
            "bInfo": false,
            "bAutoWidth": false,
            "sScrollX": "100%",
            "bRetrieve": true,
            "bDestroy": true,
            "bProcessing": true,
            "bServerSide": true,
            "aoColumns": columnarrIL,
            "sAjaxSource": '@Url.Content("~/Pull/PullLotSrSelection")',
            "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                if (aData.IsConsignedLotSerial == true) {
                    nRow.className = "even trconsigned";
                }
            },
            "fnInitComplete": function (oSettings) {
                var strAllSelected = "";
                $("#hdnSelectedId_" + objPullItemDTO.ItemGUID).val();
                if (objPullItemDTO.LotNumberTracking != BoolTrueString && objPullItemDTO.SerialNumberTracking != BoolTrueString) {
                    $('#' + objPullItemDTO.tableID).dataTable().fnSetColumnVis(0, false);
                }
                if (objPullItemDTO.DateCodeTracking != BoolTrueString) {
                    $('#' + objPullItemDTO.tableID).dataTable().fnSetColumnVis(5, false);
                }
            },
            "fnServerData": function (sSource, aoData, fnCallback, oSettings) {
                aoData.push({ "name": "ItemGUID", "value": objPullItemDTO.ItemGUID });
                aoData.push({ "name": "BinID", "value": objPullItemDTO.BinID });
                aoData.push({ "name": "PullQuantity", "value": FormatedCostQtyValues($("#txtPoolQuantity_" + objPullItemDTO.ItemGUID).val(), 2) });
                aoData.push({ "name": "InventoryConsuptionMethod", "value": objPullItemDTO.InventoryConsuptionMethod });
                aoData.push({ "name": "CurrentLoaded", "value": $("#hdnCurrentLoadedIds_" + objPullItemDTO.ItemGUID).val() });
                aoData.push({ "name": "ViewRight", "value": objPullItemDTO.ViewRight });
                aoData.push({ "name": "IsDeleteRowMode", "value": isDeleteSrLotRow });
                oSettings.jqXHR = $.ajax({
                    dataType: 'json',
                    type: "POST",
                    url: sSource,
                    cache: false,
                    "data": aoData,
                    "headers": { "__RequestVerificationToken": $("input[name='__RequestVerificationToken'][type='hidden']").val() },
                    success: fnCallback,
                    beforeSend: function () {
                        $('.dataTables_scroll').css({ "opacity": 0.2 });
                    },
                    complete: function () {
                        $('.dataTables_scroll').css({ "opacity": 1 });
                        isDeleteSrLotRow = false;
                        $('.ShowAllOptionsSL').click(function () {
                            $(this).siblings('.AutoSerialLot').trigger("focus");
                            $(this).siblings(".AutoSerialLot").autocomplete("search", "");
                        });

                        if (objPullItemDTO.ViewRight == "ViewOnly") {
                            $("input[type='text'][name='txtLotOrSerailNumberViewOnly']").keypress(function () {
                                return false;
                            });

                            $("#DivPullSelection input[type='text'][name='txtPullQty']").keypress(function () {
                                return false;
                            });
                        }

                    }
                });
            }
        });
    }


    function PullAllNewFlow() {
        var ArrItem = new Array();
        var arrItemDetails;
        var ErrorMessage = ValidateAllPull();

        if (ErrorMessage == "") {
            $("#DivPullSelection").find("table[id^='tblItemPullheader']").each(function (indx, tblHeader) {
                arrItemDetails = new Array();
                var ID = $(tblHeader).prop("id").split('_')[1];
                var SpanQty = $(tblHeader).find("#txtPoolQuantity_" + ID);

                var dt = $("#tblItemPull_" + ID).dataTable();
                //var currentData = dt.fnGetData();

                var strpullobj = JSON.parse($(tblHeader).find("input[name='hdnPullMasterDTO']").val());

                if (strpullobj.RequisitionDetailGUID != null && strpullobj.RequisitionDetailGUID != undefined && strpullobj.RequisitionDetailGUID != '' && strpullobj.RequisitionDetailGUID != '00000000-0000-0000-0000-000000000000') {
                    strpullobj.WorkOrderDetailGUID = null;
                }
                else if (strpullobj.WorkOrderDetailGUID != null && strpullobj.WorkOrderDetailGUID != undefined && strpullobj.WorkOrderDetailGUID != '' && strpullobj.WorkOrderDetailGUID != '00000000-0000-0000-0000-000000000000') {
                    strpullobj.RequisitionDetailGUID = null;
                }
                else {
                    strpullobj.WorkOrderDetailGUID = null;
                    strpullobj.RequisitionDetailGUID = null;
                }

                $("#tblItemPull_" + ID).find("tbody").find("tr").each(function (index, tr) {
                    var txtPullQty = $(tr).find("input[type='text'][name='txtPullQty']").val();
                    var hdnLotNumberTracking = $(tr).find("input[name='hdnLotNumberTracking']").val();
                    var hdnSerialNumberTracking = $(tr).find("input[name='hdnSerialNumberTracking']").val();
                    var hdnDateCodeTracking = $(tr).find("input[name='hdnDateCodeTracking']").val();
                    var txtPullQty = $(tr).find("input[type='text'][name='txtPullQty']").val();
                    var hdnBinNumber = $(tr).find("input[name='hdnBinNumber']").val();
                    var hdnExpiration = $(tr).find("input[name='hdnExpiration']").val();

                    if (txtPullQty != "") {
                        var txtLotOrSerailNumber = "";
                        if (hdnLotNumberTracking == "true" || hdnSerialNumberTracking == "true")
                            var txtLotOrSerailNumber = $.trim($(tr).find("input[type='text'][name^='txtLotOrSerailNumber']").val());

                        var vSerialNumber = "";
                        var vLotNumber = "";
                        var vExpiration = "";

                        if (hdnSerialNumberTracking == "true")
                            vSerialNumber = $.trim(txtLotOrSerailNumber);
                        if (hdnLotNumberTracking == "true")
                            vLotNumber = $.trim(txtLotOrSerailNumber);
                        if (hdnDateCodeTracking == "true")
                            vExpiration = hdnExpiration;

                        var obj = {
                            "LotOrSerailNumber": $.trim(txtLotOrSerailNumber), "BinNumber": hdnBinNumber, "PullQuantity": parseFloat(txtPullQty.toString())
                                        , "LotNumberTracking": hdnLotNumberTracking, "SerialNumberTracking": hdnSerialNumberTracking, "DateCodeTracking": hdnDateCodeTracking
                                        , "Expiration": hdnExpiration, "SerialNumber": $.trim(vSerialNumber), "LotNumber": $.trim(vLotNumber)
                                        , "ItemGUID": strpullobj.ItemGUID, "BinID": strpullobj.BinID, "ID": strpullobj.BinID
                        };

                        arrItemDetails.push(obj);
                    }
                });

                var pullQty = parseFloat($(SpanQty).val().toString());

                var PullItem = {
                    ID: indx,
                    ItemGUID: strpullobj.ItemGUID,
                    OrderDetailGUID: strpullobj.OrderDetailGUID,
                    ItemID: strpullobj.ItemID,
                    ItemNumber: strpullobj.ItemNumber,
                    BinID: strpullobj.BinID,
                    BinNumber: strpullobj.BinNumber,
                    QtyToReturn: pullQty,
                    lstItemPullDetails: arrItemDetails,
                };
                ArrItem.push(PullItem);
            });

            if (ArrItem.length > 0) {
                PullMultipleItemNew(ArrItem);
            }
        }
        else {
            //alert(ErrorMessage);
            $("#spanGlobalMessage").html(ErrorMessage);
            $('div#target').fadeToggle();
            $("div#target").delay(DelayTime).fadeOut(FadeOutTime);
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
        }
    }

    function PullSingleItem(indx, ArrItem) {
        var SingleItemArrItem = ArrItem[indx];
        $.ajax({
            type: "POST",
            url: PullSerialsAndLotsUrl,
            contentType: 'application/json',
            dataType: 'json',
            data: JSON.stringify(SingleItemArrItem),
            success: function (RetData) {
                if (RetData.ErrorList.length > 0) {

                }
                else {
                    alert(RetData.ErrorList.length);
                }

            },
            error: function (err) {
                alert(err);
            },
            complete: function () {
                if ((indx + 1) < ArrItem.length) {
                    PullSingleItem((indx + 1), ArrItem);
                }
            }
        });
    }

    function PullMultipleItemNew(ArrItem) {
        $('#DivLoading').show();
        var PullSerialsAndLotsNewUrl = '@Url.Action("ReturnSerialsAndLots", "Order")';
        $.ajax({
            type: "POST",
            url: PullSerialsAndLotsNewUrl,
            contentType: 'application/json',
            dataType: 'json',
            data: JSON.stringify(ArrItem),
            success: function (RetData) {
                var errorMessage = "";

                $.each(RetData, function (indx, RetDataItem) {
                    if (RetDataItem.ErrorList.length > 0) {
                        $.each(RetDataItem.ErrorList, function (indx, ErrorListItem) {
                            errorMessage += ErrorListItem.ErrorMessage + "<br />";
                        });
                    }
                    else {
                        $("#divItem_" + RetDataItem.ItemGUID).attr('style', '');
                        $("#divItem_" + RetDataItem.ItemGUID).html("");
                    }
                });
                $('#DivLoading').hide();
                if (errorMessage != "") {
                    $.modal.impl.close();
                    errorMessage = "<b>@ResReceiveOrderDetails.ValidateSomeItemnotReturn</b><br /><br />" + errorMessage;
                    $('#dlgCommonErrorMsgPopup').find("#pOkbtn").css('display', '');
                    $('#dlgCommonErrorMsgPopup').find("#pErrMessage").html(errorMessage);
                    $('#dlgCommonErrorMsgPopup').modal();
                    $('#dlgCommonErrorMsgPopup').css("z-index", "1104");
                    $('#simplemodal-overlay').css("z-index", "1103");
                    $('#simplemodal-container').css("z-index", "1104");
                }
                else {
                    if ($("input[type='hidden'][name^='hdnPullMasterDTO']").length > 0) {
                        $.modal.impl.close();
                        if (RetData.length > 0) {
                            $('#dlgCommonErrorMsgPopup').find("#pOkbtn").css('display', '');
                            $('#dlgCommonErrorMsgPopup').find("#pErrMessage").html("<b>@ResReceiveOrderDetails.MsgQuantityReturnSuccessfully</b><br /><br />");
                            $('#dlgCommonErrorMsgPopup').modal();
                        }
                        $('#dlgCommonErrorMsgPopup').css("z-index", "1104");
                        $('#simplemodal-overlay').css("z-index", "1103");
                        $('#simplemodal-container').css("z-index", "1104");

                    }
                    else {
                        $("#spanGlobalMessage").html("@ResReceiveOrderDetails.MsgAllQuantityReturnSuccessfully");
                        $('div#target').fadeToggle();
                        $("div#target").delay(DelayTime).fadeOut(FadeOutTime);
                        $("#spanGlobalMessage").removeClass('errorIcon WarningIcon').addClass('succesIcon');
                        $('#DivPullSelection').dialog('close');
                        //$('#ItemModeDataTable').dataTable().fnStandingRedraw();

                        ShowEditTab("OrderEdit/" + OrdID, "frmOrder");//clearALL();
                    }
                }
            },
            error: function (err) {
                $('#DivLoading').hide();
                $.modal.impl.close();
                $('#dlgCommonErrorMsgPopup').find("#pOkbtn").css('display', '');
                //$('#dlgCommonErrorMsg').find("#pYesNobtn").css('display', 'none');
                $('#dlgCommonErrorMsgPopup').find("#pErrMessage").html("@ResCommon.ErrorinSave");
                $('#dlgCommonErrorMsgPopup').modal();
                $('#dlgCommonErrorMsgPopup').css("z-index", "1004");
                $('#simplemodal-overlay').css("z-index", "1003");
                $('#simplemodal-container').css("z-index", "1004");
            },
            complete: function () {
            }
        });
    }

    function ValidateSinglePull(vItemGUID) {
        var returnVal = true;
        var errormsg = "";
        var isMoreQty = false;
        var dtID = "#tblItemPull_" + vItemGUID;

        var SpanQty = $("#DivPullSelection").find("#txtPoolQuantity_" + vItemGUID);

        var TotalEntered = 0;
        $("#tblItemPull_" + vItemGUID).find("tbody").find("tr").each(function (index, tr) {
            var txtPullQty = $(tr).find("input[type='text'][name='txtPullQty']").val();
            var spnLotSerialQuantity = $(tr).find("span[name='spnLotSerialQuantity']").text();

            if (parseFloat(txtPullQty) > parseFloat(spnLotSerialQuantity)) {
                errormsg = "\n" + "@ResReceiveOrderDetails.MsgCannotReturnMoreQtyThenAvaQty";
                isMoreQty = true;
                return errormsg;
            }

            TotalEntered = TotalEntered + parseFloat(txtPullQty);
        });

        if (isMoreQty == false) {
            var pullQty = parseFloat($(SpanQty).val().toString());
            if (TotalEntered != pullQty) {
                errormsg = errormsg + "\n " + "@ResReceiveOrderDetails.ValidateTotalEnterwithActualReturnQty".replace("{0}", TotalEntered).replace("{1}", pullQty);
            }
        }
        else {
            errormsg = "@ResReceiveOrderDetails.MsgCannotReturnMoreQtyThenAvaQty";
        }

        return errormsg;
    }

    function ValidateAllPull() {
        var returnVal = true;
        var errormsg = "";
        var isMoreQty = false;
        $("#DivPullSelection").find("table[id^='tblItemPullheader']").each(function (indx, tblHeader) {
            var ID = $(tblHeader).prop("id").split('_')[1];
            var SpanQty = $(tblHeader).find("#txtPoolQuantity_" + ID);

            var TotalEntered = 0;
            $("#tblItemPull_" + ID).find("tbody").find("tr").each(function (index, tr) {
                var txtPullQty = $(tr).find("input[type='text'][name='txtPullQty']").val();
                var spnLotSerialQuantity = $(tr).find("span[name='spnLotSerialQuantity']").text();

                if (parseFloat(txtPullQty) > parseFloat(spnLotSerialQuantity)) {
                    errormsg = "\n" + "@ResReceiveOrderDetails.MsgCannotReturnMoreQtyThenAvaQty";
                    isMoreQty = true;
                    return errormsg;
                }

                TotalEntered = TotalEntered + parseFloat(txtPullQty);
            });

            if (isMoreQty == false) {
                var pullQty = parseFloat($(SpanQty).val().toString());
                if (TotalEntered != pullQty) {
                    ////errormsg = errormsg + "\nentered :" + TotalEntered + "\tPull Qty :" + pullQty;
                    errormsg = errormsg + "\n " + "@ResReceiveOrderDetails.ValidateTotalEnterwithActualReturnQty".replace("{0}", TotalEntered).replace("{1}", pullQty);;
                }
            }
            else {
                errormsg = "@ResReceiveOrderDetails.MsgCannotReturnMoreQtyThenAvaQty";
            }

        });

        return errormsg;
    }


    var charCode = '@CharCodeList';
    $(document).ready(function () {

        var intNotAllowededCode = charCode.split(',');
        if (intNotAllowededCode != null && intNotAllowededCode.length > 0) {
            specialKeys = new Array();
            for (i = 0; i < intNotAllowededCode.length; i++) {
                specialKeys.push(parseInt(intNotAllowededCode[i])); //Backspace
            }
        }
        $("#DivPullSelection").off('change', "input[type='text'][name^='txtLotOrSerailNumber']");
        $("#DivPullSelection").on('change', "input[type='text'][name^='txtLotOrSerailNumber']", function (e) {
            var objCurtxt = $(this);
            var oldValue = $(objCurtxt).val();
            var ids = $(this).parent().parent().parent().find("input[type='hidden'][name='hdnRowUniqueId']").val().split('_');
            var dtThisItem = $("#tblItemPull_" + ids[1].toString()).dataTable();
            var currentTR = $(objCurtxt).parent().parent().parent()[0];
            var row_id = dtThisItem.fnGetPosition(currentTR);

            if ($.trim(oldValue) == '')
                return;

            var isDuplicateEntry = false;
            var OtherPullQuantity = 0;
            $("#tblItemPull_" + ids[1].toString() + " tbody tr").each(function (i) {
                if (i != row_id) {
                    var tr = $(this);
                    var SerialOrLotNumber = $(tr).find('#' + objCurtxt.prop("id")).val();
                    if (SerialOrLotNumber == $(objCurtxt).val()) {
                        isDuplicateEntry = true;
                    }
                    else {
                        var txtPullQty = $(tr).find("input[type='text'][name='txtPullQty']").val();
                        OtherPullQuantity = OtherPullQuantity + parseFloat(txtPullQty);
                    }
                }
            });

            if (isDuplicateEntry == true) {

                if ($("#hdnTrackingType_" + ids[1].toString()).val() == "LotNumberTracking") {
                    //alert("Duplicate lot number.");
                    $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                    $("#spanGlobalMessage").html('@ResMessage.DuplicateLotFound');
                    showNotificationDialog();
                }
                else if ($("#hdnTrackingType_" + ids[1].toString()).val() == "SerialNumberTracking") {
                    //alert("Duplicate serial number.");
                    $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                    $("#spanGlobalMessage").html('@ResMessage.DuplicateSerialFound');
                    showNotificationDialog();
                }
                else {
                    $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                    $("#spanGlobalMessage").html('@ResMessage.DuplicateNumber');
                    showNotificationDialog();
                    //alert("Duplicate number.");
                }

                $(objCurtxt).val("");
                $(objCurtxt).focus();
            }
            else {
                $.ajax({
                    type: "POST",
                    url: ValidateSerialLotNumberUrl,
                    contentType: 'application/json',
                    dataType: 'json',
                    data: "{ ItemGuid: '" + ids[1].toString() + "', SerialOrLotNumber: '" + $(objCurtxt).val() + "',BinID: '" + ids[2].toString() + "' }",
                    success: function (RetData) {
                        if (RetData.ID > 0) {
                            IsCheckViewRight = false;

                            var spnPoolQuantity = parseFloat($("#txtPoolQuantity_" + ids[1].toString()).val());
                            if ((spnPoolQuantity - OtherPullQuantity) > 0) {
                                if ((spnPoolQuantity - OtherPullQuantity) < RetData.PullQuantity)
                                    RetData.PullQuantity = spnPoolQuantity - OtherPullQuantity;
                            }
                            else {
                                RetData.PullQuantity = 0;
                            }

                            dtThisItem.fnUpdate(RetData, row_id, undefined, false, false);
                            IsCheckViewRight = true;

                            $('.ShowAllOptionsSL').click(function () {
                                $(this).siblings('.AutoSerialLot').trigger("focus");
                                $(this).siblings(".AutoSerialLot").autocomplete("search", "");
                            });

                            if (RetData.IsConsignedLotSerial) {
                                $(currentTR).addClass("trconsigned");
                            }
                            else {
                                $(currentTR).removeClass("trconsigned");
                            }
                        }
                        else {
                            $(objCurtxt).val("");
                            $(objCurtxt).focus();
                        }
                    },
                    error: function (err) {
                        alert(err);
                    }
                });
            }
        });

        $("#DivPullSelection").off('focus', "input[type='text'][name^='txtLotOrSerailNumber']");
        $("#DivPullSelection").on('focus', "input[type='text'][name^='txtLotOrSerailNumber']", function (e) {
            var objCurtxt = $(this);
            var ids = $(this).parent().parent().parent().find("input[type='hidden'][name='hdnRowUniqueId']").val().split('_');
            var aPos = $("#tblItemPull_" + ids[1].toString()).dataTable().fnGetPosition($(this).parent().parent().parent()[0]);
            var aData = $("#tblItemPull_" + ids[1].toString()).dataTable().fnGetData(aPos);

            var dtItemPull = "#tblItemPull_" + ids[1].toString();
            var strSerialLotNos = "";

            $(dtItemPull).find("tbody").find("tr").each(function (index, tr) {

                if (index != aPos) {
                    var hdnLotNumberTracking = $(tr).find("input[name='hdnLotNumberTracking']").val();
                    var hdnSerialNumberTracking = $(tr).find("input[name='hdnSerialNumberTracking']").val();
                    var hdnDateCodeTracking = $(tr).find("input[name='hdnDateCodeTracking']").val();

                    if (hdnLotNumberTracking == "true" || hdnSerialNumberTracking == "true") {
                        var txtLotOrSerailNumber = $.trim($(tr).find("input[type='text'][name^='txtLotOrSerailNumber']").val());
                        if (txtLotOrSerailNumber != undefined)
                            strSerialLotNos = strSerialLotNos + txtLotOrSerailNumber + "|#|";
                    }
                    else if (hdnDateCodeTracking == "true") {
                        var hdnExpiration = $(tr).find("input[name='hdnExpiration']").val();
                        if (hdnExpiration != undefined)
                            strSerialLotNos = strSerialLotNos + hdnExpiration + "|#|";
                    }
                    else {
                        var hdnBinNumber = $(tr).find("input[name='hdnBinNumber']").val();
                        if (hdnBinNumber != undefined)
                            strSerialLotNos = strSerialLotNos + hdnBinNumber + "|#|";
                    }
                }

            });

            if ($(this).hasClass("AutoSerialLot")) {
                $(this).autocomplete({
                    source: function (request, response) {
                        $.ajax({
                            url: '/Pull/GetLotOrSerailNumberList',
                            contentType: 'application/json',
                            dataType: 'json',
                            data: {
                                maxRows: 1000,
                                name_startsWith: request.term,
                                ItemGuid: ids[1].toString(),
                                BinID: ids[2].toString(),
                                prmSerialLotNos: strSerialLotNos
                            },
                            success: function (data) {
                                response($.map(data, function (item) {
                                    return {
                                        label: $.trim(item.LotOrSerailNumber),
                                        value: $.trim(item.LotOrSerailNumber),
                                        selval:$.trim(item.LotOrSerailNumber)
                                    }
                                }));
                            },
                            error: function (err) {

                            }
                        });
                    },
                    autoFocus: false,
                    minLength: 0,
                    select: function (event, ui) {
                        //                    $(objCurtxt).parent().parent().find("input[type='hidden'][name='hdnStagingBin']").val(ui.item.selval);
                        //                    $(objCurtxt).parent().parent().find("input[type='hidden'][name='hdnStagingBinName']").val(ui.item.label);
                    },
                    open: function () {
                        $(this).removeClass("ui-corner-all").addClass("ui-corner-top");
                        $(this).autocomplete('widget').css('z-index', 9000);
                        $('ul.ui-autocomplete').css('overflow-y', 'auto');
                        $('ul.ui-autocomplete').css('max-height', '300px');
                    },
                    close: function () {
                        $(this).removeClass("ui-corner-top").addClass("ui-corner-all");
                        $(objCurtxt).trigger("change");
                    }
                });
            }
        });

        $("#DivPullSelection").off("click", "input[type='button'][name='btnLoadMoreLots']");
        $("#DivPullSelection").on("click", "input[type='button'][name='btnLoadMoreLots']", function () {

            var vItemGUID = $(this).prop("id").split('_')[1];
            var dtID = "#tblItemPull_" + vItemGUID;
            var strIds = "";
            var IsLotNumberTracking = false;
            var IsSerialNumberTracking = false;
            var IsDateCodeTracking = false;
            var isError = false;
            $(dtID).find("tbody").find("tr").each(function (index, tr) {

                var hdnLotNumberTracking = $(tr).find("input[name='hdnLotNumberTracking']").val();
                var hdnSerialNumberTracking = $(tr).find("input[name='hdnSerialNumberTracking']").val();
                var hdnDateCodeTracking = $(tr).find("input[name='hdnDateCodeTracking']").val();
                var txtPullQty = $(tr).find("input[type='text'][name='txtPullQty']").val();

                if (hdnLotNumberTracking == "true")
                    IsLotNumberTracking = true;
                if (hdnSerialNumberTracking == "true")
                    IsSerialNumberTracking = true;
                if (hdnDateCodeTracking == "true")
                    IsDateCodeTracking = true;

                if (IsLotNumberTracking == true) {
                    var txtLotNumber = $.trim($(tr).find("input[type='text'][name^='txtLotOrSerailNumber']").val());
                    if (txtLotNumber == "" || txtLotNumber == null) {
                        $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                        $("#spanGlobalMessage").html('@ResReceiveOrderDetails.MsgEnterLotNumber');
                        showNotificationDialog();
                        //alert("Please enter Lot Number.");
                        isError = true;
                        return false;
                    }
                }
                if (IsSerialNumberTracking == true) {
                    var txtSerailNumber = $.trim($(tr).find("input[type='text'][name^='txtLotOrSerailNumber']").val());
                    if (txtSerailNumber == "" || txtSerailNumber == null) {
                        $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                        $("#spanGlobalMessage").html('@ResReceiveOrderDetails.MsgSerialNumberValidation');
                        showNotificationDialog();
                        //alert("Please enter Serial Number.");
                        isError = true;
                        return false;
                    }
                }
                if (IsDateCodeTracking == true) {
                    var txtExpiration = $.trim($(tr).find("input[type='text'][name^='txtExpirationDate']").val());
                    if (txtExpiration == "" || txtExpiration == null) {
                        var hdnExpiration = $(tr).find("input[name='hdnExpiration']").val();
                        if (hdnExpiration == "" || hdnExpiration == null) {
                            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                            $("#spanGlobalMessage").html('@ResReceiveOrderDetails.MsgExpireDateValidation');
                            showNotificationDialog();
                            //alert("Please enter Expiration Date.");
                            isError = true;
                            return false;
                        }
                    }
                }


                if (txtPullQty != undefined) {
                    if (txtPullQty == "") {
                        txtPullQty = "0";
                    }
                    if ((hdnLotNumberTracking == "true" && hdnDateCodeTracking == "false")
                        || (hdnSerialNumberTracking == "true" && hdnDateCodeTracking == "false")) {
                        var txtLotOrSerailNumber = $.trim($(tr).find("input[type='text'][name^='txtLotOrSerailNumber']").val());
                        if (txtLotOrSerailNumber != undefined && !IsLotSerialExistsInCurrentLoaded(strIds, txtLotOrSerailNumber)) {
                            strIds = strIds + txtLotOrSerailNumber + "_" + txtPullQty + ",";
                        }
                    }
                    else if ((hdnLotNumberTracking == "true" && hdnDateCodeTracking == "true")
                        || (hdnSerialNumberTracking == "true" && hdnDateCodeTracking == "true")) {
                        var hdnExpiration = $(tr).find("input[name='hdnExpirationDate']").val();
                        var txtLotOrSerailNumber = $.trim($(tr).find("input[type='text'][name^='txtLotOrSerailNumber']").val());
                        if (txtLotOrSerailNumber != undefined && hdnExpiration != undefined && !IsLotSerialExistsInCurrentLoaded(strIds, hdnExpiration)) {
                            strIds = strIds + txtLotOrSerailNumber + "_" + hdnExpiration + "_" + txtPullQty + ",";
                        }
                    }
                    else if (hdnLotNumberTracking == "false" && hdnSerialNumberTracking == "false" && hdnDateCodeTracking == "true") {
                        var hdnExpiration = $(tr).find("input[name='hdnExpirationDate']").val();
                        if (hdnExpiration != undefined) {
                            strIds = strIds + hdnExpiration + "_" + txtPullQty + ",";
                        }
                    }
                    else {
                        var hdnBinNumber = $(tr).find("input[name='hdnBinNumber']").val();
                        if (hdnBinNumber != undefined && !IsLotSerialExistsInCurrentLoaded(strIds, hdnBinNumber))
                            strIds = strIds + hdnBinNumber + "_" + txtPullQty + ",";
                    }
                }
            });
            if (isError == false) {
                $("#hdnCurrentLoadedIds_" + vItemGUID).val(strIds);

                var dt = $(dtID).dataTable();
                dt.fnStandingRedraw();
            }
        });
        function IsLotSerialExistsInCurrentLoaded(strIds, SerialLot) {
            if (SerialLot.trim() == '')
                return true;

            if (strIds.trim() == '')
                return false

            var ArrIds = strIds.split(',');
            var i = 0;
            for (i = 0; i < ArrIds.length; i++) {
                if (ArrIds[i].split('_')[0].toLowerCase() == SerialLot.toLowerCase()) {
                    return true;
                }
            }
            return false;
        }
        $("#DivPullSelection").off("click", "input[type='button'][name='btnPullPopup']");
        $("#DivPullSelection").on("click", "input[type='button'][name='btnPullPopup']", function () {
            //RequisitionDetailsGUID
            var vItemGUID = $(this).prop("id").split('_')[1];
            var dtID = "#tblItemPull_" + vItemGUID;

            var ArrItem = new Array();
            var arrItemDetails;
            var ErrorMessage = ValidateSinglePull(vItemGUID);

            if (ErrorMessage == "") {

                arrItemDetails = new Array();
                var ID = vItemGUID;
                var SpanQty = $("#DivPullSelection").find("#txtPoolQuantity_" + vItemGUID);

                var dt = $("#tblItemPull_" + vItemGUID).dataTable();
                //var currentData = dt.fnGetData();

                var strpullobj = JSON.parse($("#hdnPullMasterDTO_" + vItemGUID).val());

                if (strpullobj.RequisitionDetailGUID != null && strpullobj.RequisitionDetailGUID != undefined && strpullobj.RequisitionDetailGUID != '' && strpullobj.RequisitionDetailGUID != '00000000-0000-0000-0000-000000000000') {
                    strpullobj.WorkOrderDetailGUID = null;
                }
                else if (strpullobj.WorkOrderDetailGUID != null && strpullobj.WorkOrderDetailGUID != undefined && strpullobj.WorkOrderDetailGUID != '' && strpullobj.WorkOrderDetailGUID != '00000000-0000-0000-0000-000000000000') {
                    strpullobj.RequisitionDetailGUID = null;
                }
                else {
                    strpullobj.WorkOrderDetailGUID = null;
                    strpullobj.RequisitionDetailGUID = null;
                }

                $("#tblItemPull_" + vItemGUID).find("tbody").find("tr").each(function (index, tr) {
                    var txtPullQty = $(tr).find("input[type='text'][name='txtPullQty']").val();
                    var hdnLotNumberTracking = $(tr).find("input[name='hdnLotNumberTracking']").val();
                    var hdnSerialNumberTracking = $(tr).find("input[name='hdnSerialNumberTracking']").val();
                    var hdnDateCodeTracking = $(tr).find("input[name='hdnDateCodeTracking']").val();
                    var txtPullQty = $(tr).find("input[type='text'][name='txtPullQty']").val();
                    var hdnBinNumber = $(tr).find("input[name='hdnBinNumber']").val();
                    var hdnExpiration = $(tr).find("input[name='hdnExpiration']").val();

                    if (txtPullQty != "") {
                        var txtLotOrSerailNumber = "";
                        if (hdnLotNumberTracking == "true" || hdnSerialNumberTracking == "true")
                            var txtLotOrSerailNumber = $.trim($(tr).find("input[type='text'][name^='txtLotOrSerailNumber']").val());

                        var vSerialNumber = "";
                        var vLotNumber = "";
                        var vExpiration = "";

                        if (hdnSerialNumberTracking == "true")
                            vSerialNumber = txtLotOrSerailNumber;
                        if (hdnLotNumberTracking == "true")
                            vLotNumber = txtLotOrSerailNumber;
                        if (hdnDateCodeTracking == "true")
                            vExpiration = hdnExpiration;

                        var obj = {
                            "LotOrSerailNumber": $.trim(txtLotOrSerailNumber), "BinNumber": hdnBinNumber, "PullQuantity": parseFloat(txtPullQty.toString())
                                        , "LotNumberTracking": hdnLotNumberTracking, "SerialNumberTracking": hdnSerialNumberTracking, "DateCodeTracking": hdnDateCodeTracking
                                        , "Expiration": hdnExpiration, "SerialNumber": $.trim(vSerialNumber), "LotNumber": $.trim(vLotNumber)
                                        , "ItemGUID": strpullobj.ItemGUID, "BinID": strpullobj.BinID, "ID": strpullobj.BinID
                        };

                        arrItemDetails.push(obj);
                    }
                });

                var pullQty = parseFloat($(SpanQty).val().toString());

                var PullItem = {
                    ID: 1,
                    ItemGUID: strpullobj.ItemGUID,
                    OrderDetailGUID: strpullobj.OrderDetailGUID,
                    ItemID: strpullobj.ItemID,
                    ItemNumber: strpullobj.ItemNumber,
                    BinID: strpullobj.BinID,
                    BinNumber: strpullobj.BinNumber,
                    QtyToReturn: pullQty,
                    lstItemPullDetails: arrItemDetails,
                };

                ArrItem.push(PullItem);

                if (ArrItem.length > 0) {
                    PullMultipleItemNew(ArrItem);
                }
            }
            else {
                $("#spanGlobalMessage").html(ErrorMessage);
                $('div#target').fadeToggle();
                $("div#target").delay(DelayTime).fadeOut(FadeOutTime);
                $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                //alert(ErrorMessage);
            }
        });

        $("#DivPullSelection").off("click", "input[type='button'][name='btnPullAllPopUp']");
        $("#DivPullSelection").on("click", "input[type='button'][name='btnPullAllPopUp']", function () {
            PullAllNewFlow();
        });

        $("#DivPullSelection").off("click", "input[type='button'][name='btnCancelPullPopup']");
        $("#DivPullSelection").on("click", "input[type='button'][name='btnCancelPullPopup']", function () {
            $("#DivPullSelection").empty();
            $('#DivPullSelection').dialog('close');
            $('#ItemModeDataTable').dataTable().fnStandingRedraw();
        });

        $("#DivPullSelection").off('click', "input[type='button'][name='btnValidateThis']");
        $("#DivPullSelection").on('click', "input[type='button'][name='btnValidateThis']", function (e) {
            var dt = $("#tblItemPull_" + $(this).prop("id").split('_')[1]).dataTable();
            var currentData = dt.fnGetData();
            var TotalEntered = 0;
            $(currentData).each(function (indx, obj) {
                TotalEntered = TotalEntered + parseFloat(obj.PullQuantity);
            });
            var pullQty = parseFloat($("#DivPullSelection").find("#txtPoolQuantity_" + $(this).prop("id").split('_')[1]).val().toString());
            //alert("Entered :" + TotalEntered + ", Pull Qty :" + pullQty);
            if (TotalEntered != pullQty) {
                alert("Please enter correct pull quantity");
            }
            else {
                alert("Validated");
            }

        });

        $("#DivPullSelection").off('click', "input[type='button'][name='btnvalidateAll']");
        $("#DivPullSelection").on('click', "input[type='button'][name='btnvalidateAll']", function (e) {
            var returnmsg = ValidateAllPull();
            if (returnmsg == "")
                returnmsg = "Validated All";
            alert(returnmsg);
        });

        $("#DivPullSelection").off("change", "input[type='text'][name='txtPullQty']");
        $("#DivPullSelection").on("change", "input[type='text'][name='txtPullQty']", function () {
            var ids = $(this).parent().parent().find("input[type='hidden'][name='hdnRowUniqueId']").val().split('_');
            var aPos = $("#tblItemPull_" + ids[1].toString()).dataTable().fnGetPosition($(this).parent().parent()[0]);
            $("#tblItemPull_" + ids[1].toString()).dataTable().fnGetData(aPos).PullQuantity = $(this).val();
        });

        $("#DivPullSelection").off("tap click", ".tbl-item-pull tbody tr");
        $("#DivPullSelection").on("tap click", ".tbl-item-pull tbody tr", function (e) {

            if (e.target.type == "checkbox" || e.target.type == "radio" || e.target.type == "text") {
                e.stopPropagation();
            }
            else if (e.currentTarget.getElementsByTagName("input").btnLoad != undefined) {
                e.stopPropagation();
            }
            else {
                if ((e.metaKey || e.ctrlKey)) {
                    $(this).toggleClass('row_selected');
                } else {
                    $(this).toggleClass('row_selected');
                }
            }
            return false;
        });

        $("#DivPullSelection").off('click', "input[type='button'][name='btnDeleteLots']");
        $("#DivPullSelection").on('click', "input[type='button'][name='btnDeleteLots']", function (e) {

            var vItemGUID = $(this).prop("id").split('_')[1];
            var dtID = "#tblItemPull_" + vItemGUID;

            var TotalRows = $(dtID + ' tbody tr').length;
            var SelectedRows = $(dtID + ' tbody tr.row_selected').length;
            var RemainingRows = TotalRows - SelectedRows;

            if ($(dtID + ' tbody tr.row_selected').length <= 0) {
                alert("@ResPullMaster.MsgSelectRowToDelete");
            }
            else {
                if (RemainingRows >= 1) {
                    $(dtID).find("tbody").find("tr.row_selected").each(function (index, tr) {
                        $(tr).remove();
                    });

                    var strIds = "";
                    $(dtID).find("tbody").find("tr").each(function (index, tr) {

                        var hdnLotNumberTracking = $(tr).find("input[name='hdnLotNumberTracking']").val();
                        var hdnSerialNumberTracking = $(tr).find("input[name='hdnSerialNumberTracking']").val();
                        var hdnDateCodeTracking = $(tr).find("input[name='hdnDateCodeTracking']").val();
                        var txtPullQty = $(tr).find("input[type='text'][name='txtPullQty']").val();

                        if (txtPullQty == "")
                            txtPullQty = "0";

                        if ((hdnLotNumberTracking == "true" && hdnDateCodeTracking == "false")
                            || (hdnSerialNumberTracking == "true" && hdnDateCodeTracking == "false")) {
                            var txtLotOrSerailNumber = $.trim($(tr).find("input[type='text'][name^='txtLotOrSerailNumber']").val());
                            if (txtLotOrSerailNumber != undefined && !IsLotSerialExistsInCurrentLoaded(strIds, txtLotOrSerailNumber)) {
                                strIds = strIds + txtLotOrSerailNumber + "_" + txtPullQty + ",";
                            }
                        }
                        else if ((hdnLotNumberTracking == "true" && hdnDateCodeTracking == "true")
                            || (hdnSerialNumberTracking == "true" && hdnDateCodeTracking == "true")) {
                            var hdnExpiration = $(tr).find("input[name='hdnExpirationDate']").val();
                            var txtLotOrSerailNumber = $.trim($(tr).find("input[type='text'][name^='txtLotOrSerailNumber']").val());
                            if (txtLotOrSerailNumber != undefined && hdnExpiration != undefined && !IsLotSerialExistsInCurrentLoaded(strIds, hdnExpiration)) {
                                strIds = strIds + txtLotOrSerailNumber + "_" + hdnExpiration + "_" + txtPullQty + ",";
                            }
                        }
                        else if (hdnLotNumberTracking == "false" && hdnSerialNumberTracking == "false" && hdnDateCodeTracking == "true") {
                            var hdnExpiration = $(tr).find("input[name='hdnExpirationDate']").val();
                            if (hdnExpiration != undefined) {
                                strIds = strIds + hdnExpiration + "_" + txtPullQty + ",";
                            }
                        }
                        else {
                            var hdnBinNumber = $(tr).find("input[name='hdnBinNumber']").val();
                            if (hdnBinNumber != undefined && !IsLotSerialExistsInCurrentLoaded(strIds, hdnBinNumber)) {
                                strIds = strIds + hdnBinNumber + "_" + txtPullQty + ",";
                            }
                        }
                    });
                    $("#hdnCurrentLoadedIds_" + vItemGUID).val(strIds);
                    isDeleteSrLotRow = true;
                    var dtThisItem = $(dtID).dataTable();
                    dtThisItem.fnStandingRedraw();
                }
                else {
                    alert("@ResToolMaster.MsgRowShouldExists");
                }
            }
        });


    });

    $(document).on('click', 'input#btnAddNewItem', function () {
        return OpenItemPopup();
    });

    $('div.infoBlock').off('click', '#aRptSingle');
    $('div.infoBlock').on('click', '#aRptSingle', function () {
        if ('@Model.OrderType' == '@((int)OrderType.Order)') {
            ReportExecutionSingleRecord('Order', '@Model.ID');
        }
        else if ('@Model.OrderType' == '@((int)OrderType.RuturnOrder)') {
            ReportExecutionSingleRecord('ReturnOrder', '@Model.ID');
        }
    });

    var _createOrder = (function () {

        var self = {};

        self.isFormValid = function () {
            $.validator.unobtrusive.parse("#frmOrder");
            return $("#frmOrder").valid();
        }

        self.expandCollapseForm = function (isExpand) {
            if (isExpand) {
                if ($('#ExpandedContent').css('display') == 'none') {
                    $('#ExpandedContent').css('display', '');
                    $('#ancHideShowContent img').attr('src', '/Content/images/drildown_close.jpg');
                }
            }
            else {
                if ($('#ExpandedContent').css('display') != 'none') {
                    $('#ExpandedContent').css('display', 'none');
                    $('#ancHideShowContent img').attr('src', '/Content/images/drildown_open.jpg');
                }
            }
        }

        return self;

    })();

    _Common.addRequiredSign();

</script>
<style>
    .round-button {
        width: auto;
        display: table-cell;
    }

    .round-button-circle {
        width: 100%;
        border-radius: 7%;
        overflow: hidden;
        background: #f8f8f8;
        box-shadow: 0 0 3px grey;
        border-color: black;
        padding: 2px 10px 3px 10px;
        border-style: solid;
        border-width: thin;
    }

    #preview {
        position: absolute;
        border: 1px solid #ccc;
        background: #333;
        padding: 5px;
        display: none;
        color: #fff;
    }
</style>
