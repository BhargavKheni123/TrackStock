@{
    var version = eTurnsWeb.Helper.CommonUtility.GetReleaseNumber();
    ViewBag.Title = eTurns.DTO.ResReceiveOrderDetails.PageTitle;
    var settings = new GridHeaderSettings() { dataViewType = DataViewType.None, DisplayDeleteButton = false, DisplaySettings = true, DisplayContextMenu = false, DisplayColumnSetupButton = true, DisplayPrintBlock = false, ColumnSetupFor = "ItemMasterModelList" };
    var modelCommon = new eTurns.DTO.CommonDTO { PageName = "ItemMaster", ListName="ReceiveItemWithoutOrder", ItemModelCallFromPageName = "receive" };
    bool isCost = eTurnsWeb.Helper.SessionHelper.GetAdminPermission(eTurnsWeb.Helper.SessionHelper.ModuleList.HideCostMarkUpSellPrice);
    bool IsPackSlipReq = false;
    bool HasOnTheFlyEntryRight = eTurnsWeb.Helper.SessionHelper.GetAdminPermission(eTurnsWeb.Helper.SessionHelper.ModuleList.OnTheFlyEntry);
    //if (eTurnsWeb.Helper.SessionHelper.CompanyConfig != null && eTurnsWeb.Helper.SessionHelper.CompanyConfig.IsPackSlipRequired.GetValueOrDefault(false))
    //{
    //    IsPackSlipReq = true;
    //}
    bool isUpdate = false;
    bool isInsert = false;
    isUpdate = eTurnsWeb.Helper.SessionHelper.GetModulePermission(eTurnsWeb.Helper.SessionHelper.ModuleList.Receive, eTurnsWeb.Helper.SessionHelper.PermissionType.Update);
    isInsert = eTurnsWeb.Helper.SessionHelper.GetModulePermission(eTurnsWeb.Helper.SessionHelper.ModuleList.Receive, eTurnsWeb.Helper.SessionHelper.PermissionType.Insert);
    string CurrencyDecimalDigits = eTurnsWeb.Helper.SessionHelper.CurrencyDecimalDigits;
}
<div class="searchWrapper">
    <div class="searchBlock">
        <span class="label">@eTurns.DTO.Resources.ResCommon.Search </span>
        <div class="searchinputB">
            <input type="text" class="searchinput" id="searchInAllItems" />
            <a href="javascript:void(0);" class="xclose">
                <img src="~/Content/images/x.png" alt="X" id="clearSearchInAllItems" />
            </a>
        </div>
    </div>
</div>
@Html.ItemModelGridTopHeader(settings)
<script src="@Url.Content("~/Scripts/PageScripts/NarrowSearchForItemModel.js?v=" + version)" type="text/javascript"></script>
@Html.Partial("NarrowSearchForItemModel", modelCommon)
<div class="userContent ">
    <table id="ItemModeDataTable" class="display">
        <thead>
            <tr>
                <th>
                    @eTurns.DTO.Resources.ResCommon.RowNo
                </th>
                <th class="NotSortable NotHide">
                    @ResItemMaster.Expand
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.ItemNumber
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.Description
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.OnHandQuantity
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.OnOrderQuantity
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.SuggestedOrderQuantity
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.MinimumQuantity
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.MaximumQuantity
                </th>
                <th>
                    @eTurns.DTO.ResCategoryMaster.Category
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.AverageUsage
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.Cost
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.Markup
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.SellPrice
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.ExtendedCost
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.AverageCost
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.Supplier
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.SupplierPartNo
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.ManufacturerName
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.ManufacturerNumber
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.InTransitquantity
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.OnTransferQuantity
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.RequisitionedQuantity
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.CriticalQuantity
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.SerialNumberTracking
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.LotNumberTracking
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.DateCodeTracking
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.IsLotSerialExpiryCost
                </th>
                <th>
                    @eTurns.DTO.ResGLAccount.GLAccount
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.ItemType
                </th>
                <th>
                    @eTurns.DTO.Resources.ResCommon.ID
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.PricePerTerm
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.DefaultReorderQuantity
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.DefaultPullQuantity
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.Consignment
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.StagedQuantity
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.IsTransfer
                </th>
                <th>
                    @eTurns.DTO.ResItemMaster.IsPurchase
                </th>
                <th>
                    @eTurns.DTO.Resources.ResCommon.RoomName
                </th>
                <th>
                    @eTurns.DTO.Resources.ResCommon.CreatedOn
                </th>
                <th>
                    @eTurns.DTO.Resources.ResCommon.UpdatedOn
                </th>
                <th>
                    @eTurns.DTO.Resources.ResCommon.UpdatedBy
                </th>
                <th>
                    @eTurns.DTO.Resources.ResCommon.CreatedBy
                </th>
                <th>
                    @eTurns.DTO.ResUnitMaster.Unit
                </th>
                @Html.RenderColumnsHeader("ItemMaster", typeof(eTurns.DTO.ResItemMaster))
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>
<div id="ItemQty">
</div>
<script type="text/javascript" language="javascript">
    var anItemOpen = [];
    var oItemsTable = null;
    var objColumnsNewReceive = {}

    //$("#ColumnOrderSetupIM").live('click', function () {
    //    $("#divReorderPopup").dialog('open');
    //    return false;
    //});


    function GenerateColumnForNewRecieve() {
        $('#ColumnSortableIM li').each(function (index) {
            $(this).remove();
        });
        var div = document.createElement('div');
        div.id = "CheckAll";
        div.innerHTML = "<input type='hidden' value ='ColumnSortableIM' id='hiddenDivName' /><a href='javascript:;' onclick='CheckAll(this);'  id='CheckAll' >CheckAll</a>&nbsp;<a href='javascript:;' onclick='UnCheckAll(this);' id='UnCheckAll' >UnCheckAll</a>" +
                        "&nbsp;&nbsp;&nbsp;<input type='checkbox' onclick='ShowAllHidden(this);' id='ShowAllHidden' checked='checked' />Show All Hidden";
        $('div.sortableContainer').find("div#CheckAll").remove();
        $('div.sortableContainer').prepend(div);

        for (i = 0, iLen = $('#ItemModeDataTable').dataTable().fnSettings().aoColumns.length; i < iLen; i++) {
            var oColumn = $('#ItemModeDataTable').dataTable().fnSettings().aoColumns[i];
            var li = document.createElement('li');
            li.id = GetColumnIndexNewRecive(oColumn.sTitle.trim());
            li.innerHTML = oColumn.sTitle.trim();
            var LiClassName = 'ui-state-default'
            if (oColumn.sClass.indexOf('NotHide') >= 0 || (oColumn.nTh != null && oColumn.nTh.className.indexOf('NotHide') >= 0)) {
                LiClassName = LiClassName + ' HiddenLi';
            }
            li.className = LiClassName;

            if (oColumn.sClass.indexOf('NotHide') >= 0 || (oColumn.nTh != null && oColumn.nTh.className.indexOf('NotHide') >= 0)) {
                li.innerHTML = '<input type="checkbox" class="checkBox" checked="checked" id="' + GetColumnIndexNewRecive(oColumn.sTitle.trim()) + '_" disabled="disabled" />' + oColumn.sTitle.trim();
            }
            else {
                if (oColumn.bVisible) {
                    li.innerHTML = '<input type="checkbox" class="checkBox" checked="checked" id="' + GetColumnIndexNewRecive(oColumn.sTitle.trim()) + '_" />' + oColumn.sTitle.trim();
                }
                else
                    li.innerHTML = '<input type="checkbox" class="checkBox" id="' + GetColumnIndexNewRecive(oColumn.sTitle.trim()) + '_" />' + oColumn.sTitle.trim();
            }
            $('#ColumnSortableIM').append(li);
        }
    }

    var GetColumnIndexNewRecive = function (ColumnName) {
        return objColumnsNewReceive[ColumnName];
    };

    function UpdateColumnOrderIM(_ListName) {
        if ($("#divRefreshBlockIM").css("display").toUpperCase() == 'BLOCK')
            $("#divRefreshBlockIM").toggle();
        var _Order = $('#ColumnSortableIM').sortable("toArray");
        var __Order = _Order.toString().split(",");
        for (var i = 0; i < __Order.length; i++) {
            __Order[i] = parseInt(__Order[i], 10);
        }

        $('#ItemModeDataTable').dataTable().fnSettings().oLoadedState.ColReorder = __Order;

        var _abVisCols = [];
        for (i = 0, iLen = $('#ItemModeDataTable').dataTable().fnSettings().aoColumns.length; i < iLen; i++) {
            var checked = $('#ColumnSortableIM').find('input.checkBox[id="' + i + '_"]').is(":checked");
            _abVisCols.push(checked);
        }
        $('#ItemModeDataTable').dataTable().fnSettings().oLoadedState.abVisCols = _abVisCols;

        $.ajax({
            "url": '@Url.Content("~/Master/SaveGridState")',
            data: { Data: JSON.stringify($('#ItemModeDataTable').dataTable().fnSettings().oLoadedState), ListName: 'ItemsListForNewReceive' },
            "dataType": "json",
            cache: false,
            "async": false,
            "success": function (json) {
                o = json;
                $("#ColumnSortableModalIM").dialog("close");
                callbacknew();
            }
        });
    }

    $("#ColumnOrderSetupIM").on('click', function () {
        $("#ColumnSortableModalIM").dialog("open");
        return false;
    });

    $(document).ready(function () {

        $("#ColumnSortableModalIM").dialog({
            autoOpen: false,
            modal: true,
            width: 500,
            height: dHeight,
            title: '@eTurns.DTO.Resources.ResCommon.ReorderColumnPopupHeader',
            draggable: false,
            resizable: false,
            open: function () {
                GenerateColumnForNewRecieve();
                $("#ColumnSortableIM").sortable({ axis: "y", containment: "parent" });
            }
        });



        anItemOpen = [];
        objColumnsNewReceive = GetGridHeaderColumnsObject('ItemModeDataTable', 'New Receive Columns', 'ItemsListForNewReceive', 'callbacknew()');
        oItemsTable = $('#ItemModeDataTable').dataTable({
            "bJQueryUI": true,
            "bScrollCollapse": true,
            "sScrollX": "99%",
            "sDom": 'RC<"top"lp<"clear">>rt<"bottom"i<"clear">>T',
            "oColVis": {},
            "aaSorting": [[2, "asc"]],
            "oColReorder": {},
            "sPaginationType": "full_numbers",
            "bProcessing": true,
            "bStateSave": true,
            "oLanguage": {
                "sLengthMenu": '@eTurns.DTO.Resources.ResGridHeader.Show' + ' _MENU_ ' + '@eTurns.DTO.Resources.ResGridHeader.Records',
                "sEmptyTable": '@eTurns.DTO.Resources.ResMessage.NoDataAvailableInTable',
                "sInfo": '@eTurns.DTO.Resources.ResMessage.ShowingNoOfEntries',
                "sInfoEmpty": '@eTurns.DTO.Resources.ResMessage.ShowingZeroEntries'
            },
            "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                if (aData.IsDeleted == true && aData.IsArchived == true)
                    nRow.className = "GridDeleatedArchivedRow";
                else if (aData.IsDeleted == true)
                    nRow.className = "GridDeletedRow";
                else if (aData.IsArchived == true)
                    nRow.className = "GridArchivedRow";
                $("td.RowNo:first", nRow).html(this.fnSettings()._iDisplayStart + iDisplayIndex + 1);
                return nRow;
            },
            "fnStateSaveParams": function (oSettings, oData) {
                oData.oSearch.sSearch = "";
                $.ajax({
                    "url": '@Url.Content("~/Master/SaveGridState")',
                    "type": "POST",
                    data: { Data: JSON.stringify(oData), ListName: 'ItemsListForNewReceive' },
                    "async": false,
                    cache: false,
                    "dataType": "json",
                    "success": function (json) {
                        o = json;
                    }
                });
            },
            "fnStateLoad": function (oSettings) {
                var o;
                $.ajax({
                    "url": '@Url.Content("~/Master/LoadGridState")',
                    "type": "POST",
                    data: { ListName: 'ItemsListForNewReceive' },
                    "async": false,
                    cache: false,
                    "dataType": "json",
                    "success": function (json) {
                        if (json.jsonData != '')
                            o = JSON.parse(json.jsonData);
                    }
                });
                return o;
            },
            "bServerSide": true,
            "sAjaxSource": '@Url.Content("~/Receive/NewReceiveItemsListAjax")',
            "fnServerData": function (sSource, aoData, fnCallback, oSettings) {
                var arrCols = new Array();
                var objCols = this.fnSettings().aoColumns;
                for (var i = 0; i <= objCols.length - 1; i++) {
                    arrCols.push(objCols[i].mDataProp);
                }
                for (var j = 0; j <= aoData.length - 1; j++) {
                    if (aoData[j].name == "sColumns") {
                        aoData[j].value = arrCols.join("|");
                        break;
                    }
                }
                if (oSettings.aaSorting.length != 0) {
                    var sortValue = "";
                    for (var i = 0; i <= oSettings.aaSorting.length - 1; i++) {
                        if (sortValue.length > 0)
                            sortValue += ", "
                        sortValue += arrCols[oSettings.aaSorting[i][0]] + ' ' + oSettings.aaSorting[i][1];

                    }
                    aoData.push({ "name": "SortingField", "value": sortValue });
                }
                else
                    aoData.push({ "name": "SortingField", "value": "0" });


                oSettings.jqXHR = $.ajax({
                    "dataType": 'json',
                    "type": "POST",
                    "url": sSource,
                    cache: false,
                    "data": aoData,
					"headers": { "__RequestVerificationToken": $("input[name='__RequestVerificationToken'][type='hidden']").val() },
                    "success": fnCallback,
                    beforeSend: function () {
                        $('#myDataTable').removeHighlight();
                        $('.dataTables_scroll').css({ "opacity": 0.2 });
                    },
                    complete: function () {
                        $('.dataTables_scroll').css({ "opacity": 1 });
                        if ($("#global_filter").val() != '') {
                            $('#myDataTable').highlight($("#global_filter").val());
                        }
                        if ($("#searchInAllItems").val() != '') {
                            $('#ItemModeDataTable td').highlight($("#searchInAllItems").val());
                        }

                        $('#DivLoading').hide();
                    }
                })
            },
            "fnInitComplete": function () {
                $('.ColVis').detach().appendTo(".setting-arrow");
            },
            "aoColumns": [
                { mDataProp: null, sClass: "read_only center NotHide RowNo", "bSortable": false, sDefaultContent: '' },
                {
                    "mDataProp": null, "bSortable": false, "sClass": "read_only control center NotHide", "sDefaultContent": '',
                    "fnRender": function (obj, val) {
                        if (obj.aData.ItemType == 4 || obj.aData.ItemType == "Labor") {
                            return '';
                        }
                        else { return '<img src="' + sImageUrl + 'drildown_open.jpg' + '">'; }
                    }
                },
			{
			    "mDataProp": "ItemNumber", "sClass": "read_only NotHide", "sDefaultContent": '', "bSortable": true, "bSearchable": false,
			    "fnRender": function (obj, val) {
			        return val; // "<a id='aEditLink' onclick='return ShowEditTabGUID(&quot;ItemEdit?ItemGUID=" + obj.aData.GUID.toString() + "&quot;,&quot;frmItem&quot;)' href='JavaScript:void(0);'>" + obj.aData.ItemNumber + "</a>" + " <input type='hidden' id='ItemGUID' value='" + obj.aData.GUID.toString() + "' />" + " <input type='hidden' id='hdnItemID' value='" + obj.aData.ID.toString() + "' />";
			    }
			},
            { "mDataProp": "Description", "sClass": "read_only" },
            {
                "mDataProp": "OnHandQuantity", "sClass": "read_only NotHide", "sDefaultContent": '',
                "fnRender": function (obj, val) {
                    if (obj.aData.OnHandQuantity != null && obj.aData.OnHandQuantity != NaN)
                        return "<span id='spnOnHand_" + obj.aData.ID + "'>" + FormatedCostQtyValues(obj.aData.OnHandQuantity, 2) + "</span>";
                    else
                        return "<span id='spnOnHand_" + obj.aData.ID + "'>" + FormatedCostQtyValues(0, 2) + "</span>";
                }
            },
            {
                "mDataProp": "OnOrderQuantity", "sClass": "read_only NotHide", "sDefaultContent": '',
                "fnRender": function (obj, val) {
                    //return val;
                    if (isNaN(parseFloat(val)))
                        val = 0;
                    if (val > 0) {
                        return "<a id='aOnOrderQty_" + obj.aData.GUID + "' href='javascript:void(0)' onclick='javascript:return DisplayOnOrderQty(this)' >" + FormatedCostQtyValues(val, 2) + "</span>";
                    }
                    else {
                        return FormatedCostQtyValues(val, 2);
                    }
                }
            },
            {
                "mDataProp": "SuggestedOrderQuantity", "sClass": "read_only", "sDefaultContent": '',
                "fnRender": function (obj, val) {
                    if (obj.aData.SuggestedOrderQuantity != null && obj.aData.SuggestedOrderQuantity != NaN)
                        return "<span id='spnSuggested_" + obj.aData.ID + "'>" + FormatedCostQtyValues(obj.aData.SuggestedOrderQuantity, 2) + "</span>";
                    else
                        return "<span id='spnSuggested_" + obj.aData.ID + "'>" + FormatedCostQtyValues(0, 2) + "</span>";
                }
            },
             {
                 "mDataProp": "MinimumQuantity", "sClass": "read_only",
                 "fnRender": function (obj, val) {
                     if (obj.aData.MinimumQuantity != null && obj.aData.MinimumQuantity != NaN)
                         return FormatedCostQtyValues(obj.aData.MinimumQuantity, 2);
                     else
                         return FormatedCostQtyValues(0, 2);
                 }
             },
             {
                 "mDataProp": "MaximumQuantity", "sClass": "read_only",
                 "fnRender": function (obj, val) {
                     if (obj.aData.MaximumQuantity != null && obj.aData.MaximumQuantity != NaN)
                         return FormatedCostQtyValues(obj.aData.MaximumQuantity, 2);
                     else
                         return FormatedCostQtyValues(0, 2);
                 }
             },
             { "mDataProp": "CategoryName", "sClass": "read_only" },
             {
                 "mDataProp": "AverageUsage", "sClass": "read_only",
                 "fnRender": function (obj, val) {
                     if (obj.aData.AverageUsage != null && obj.aData.AverageUsage != NaN)
                         return "<span id='spnAverageUsage" + obj.aData.GUID + "'>" + FormatedCostQtyValues(obj.aData.AverageUsage, 4) + "</span>";
                     else
                         return "<span id='spnAverageUsage" + obj.aData.GUID + "'>" + FormatedCostQtyValues(0, 4) + "</span>";
                 }
             },
             {
                 "mDataProp": "Cost", "sClass": "read_only isCost",
                 "fnRender": function (obj, val) {
                     if (obj.aData.Cost != null && obj.aData.Cost != NaN)
                         return FormatedCostQtyValues(obj.aData.Cost, 1);
                     else
                         return FormatedCostQtyValues(0, 1);
                 }
             },
             { "mDataProp": "Markup", "sClass": "read_only isCost" },
             {
                 "mDataProp": "SellPrice", "sClass": "read_only isCost",
                 "fnRender": function (obj, val) {
                     if (obj.aData.SellPrice != null && obj.aData.SellPrice != NaN)
                         return "<span id='spnSellPrice" + obj.aData.GUID + "'>" + FormatedCostQtyValues(obj.aData.SellPrice, 1) + "</span>";
                     else
                         return "<span id='spnSellPrice" + obj.aData.GUID + "'>" + FormatedCostQtyValues(0, 1) + "</span>";
                 }
             },
             {
                 "mDataProp": "ExtendedCost", "sClass": "read_only isCost",
                 "fnRender": function (obj, val) {
                     if (obj.aData.ExtendedCost != null && obj.aData.ExtendedCost != NaN)
                         return "<span id='spnExtendedCost" + obj.aData.GUID + "'>" + FormatedCostQtyValues(obj.aData.ExtendedCost, 1) + "</span>";
                     else
                         return "<span id='spnExtendedCost" + obj.aData.GUID + "'>" + FormatedCostQtyValues(0, 1) + "</span>";
                 }
             },
             {
                 "mDataProp": "AverageCost", "sClass": "read_only isCost",
                 "fnRender": function (obj, val) {
                     if (obj.aData.AverageCost != null && obj.aData.AverageCost != NaN)
                         return "<span id='spnAverageCost" + obj.aData.GUID + "'>" + FormatedCostQtyValues(obj.aData.AverageCost, 1) + "</span>";
                     else
                         return "<span id='spnAverageCost" + obj.aData.GUID + "'>" + FormatedCostQtyValues(0, 1) + "</span>";
                 }
             },
             { "mDataProp": "SupplierName", "sClass": "read_only" },
             { "mDataProp": "SupplierPartNo", "sClass": "read_only" },
             { "mDataProp": "ManufacturerName", "sClass": "read_only" },
             { "mDataProp": "ManufacturerNumber", "sClass": "read_only" },
             {
                 "mDataProp": "InTransitquantity", "sClass": "read_only", "sDefaultContent": '',
                 "fnRender": function (obj, val) {
                     return "<a id='aInTransitQty_" + obj.aData.GUID + "' href='javascript:void(0)' onclick='javascript:return DisplayInTransitQty(this)' >" + val + "</span>";
                 }
             },
             {
                 "mDataProp": "OnTransferQuantity", "sClass": "read_only", "sDefaultContent": '',
                 "fnRender": function (obj, val) {
                     return "<a id='aOnTransferQty_" + obj.aData.GUID + "' href='javascript:void(0)' onclick='javascript:return DisplayOnTransferQty(this)' >" + val + "</span>";
                 }
             },
             { "mDataProp": "RequisitionedQuantity", "sClass": "read_only" },
             {
                 "mDataProp": "CriticalQuantity", "sClass": "read_only",
                 "fnRender": function (obj, val) {
                     if (obj.aData.CriticalQuantity != null && obj.aData.CriticalQuantity != NaN)
                         return FormatedCostQtyValues(obj.aData.CriticalQuantity, 2);
                     else
                         return FormatedCostQtyValues(0, 2);
                 }
             },
             {
                 "mDataProp": "SerialNumberTracking", "sClass": "read_only"
                  , "fnRender": function (obj, val) {
                      return GetBoolInFormat(obj, val);
                  }
             },
             {
                 "mDataProp": "LotNumberTracking", "sClass": "read_only"
                 , "fnRender": function (obj, val) {
                     return GetBoolInFormat(obj, val);
                 }
             },
             {
                 "mDataProp": "DateCodeTracking", "sClass": "read_only"
                 , "fnRender": function (obj, val) {
                     return GetBoolInFormat(obj, val);
                 }
             },
             { "mDataProp": "IsLotSerialExpiryCost", "sClass": "read_only" },
             { "mDataProp": "GLAccount", "sClass": "read_only" },
             {
                 "mDataProp": "ItemType", "sClass": "read_only"
                                    , "fnRender": function (obj, val) {
                                        if (val == 1)
                                            return "Item";
                                        else if (val == 2)
                                            return "Quick List";
                                        else if (val == 3)
                                            return "Kit";
                                        else if (val == 4)
                                            return "Labor";
                                        else
                                            return "";
                                    }
             },
             { "mDataProp": "ID", "sClass": "read_only" },
             { "mDataProp": "CostUOMName", "sClass": "read_only" },
             {
                 "mDataProp": "DefaultReorderQuantity", "sClass": "read_only",
                 "fnRender": function (obj, val) {
                     if (obj.aData.DefaultReorderQuantity != null && obj.aData.DefaultReorderQuantity != NaN)
                         return FormatedCostQtyValues(obj.aData.DefaultReorderQuantity, 2);
                     else
                         return FormatedCostQtyValues(0, 2);
                 }
             },
             {
                 "mDataProp": "DefaultPullQuantity", "sClass": "read_only",
                 "fnRender": function (obj, val) {
                     if (obj.aData.DefaultPullQuantity != null && obj.aData.DefaultPullQuantity != NaN)
                         return FormatedCostQtyValues(obj.aData.DefaultPullQuantity, 2);
                     else
                         return FormatedCostQtyValues(0, 2);
                 }
             },
             {
                 "mDataProp": "Consignment", "sClass": "read_only"
                 , "fnRender": function (obj, val) {
                     return GetBoolInFormat(obj, val);
                 }
             },
             {
                 "mDataProp": "StagedQuantity", "sClass": "read_only",
                 "fnRender": function (obj, val) {
                     if (obj.aData.StagedQuantity != null && obj.aData.StagedQuantity != NaN)
                         return FormatedCostQtyValues(obj.aData.StagedQuantity, 2);
                     else
                         return FormatedCostQtyValues(0, 2);
                 }
             },
             {
                 "mDataProp": "IsTransfer", "sClass": "read_only"
                  , "fnRender": function (obj, val) {
                      return GetBoolInFormat(obj, val);
                  }
             },
               {
                   "mDataProp": "IsPurchase", "sClass": "read_only"
                  , "fnRender": function (obj, val) {
                      return GetBoolInFormat(obj, val);
                  }
               },
             { "mDataProp": "RoomName", "sClass": "read_only" },
			  {
			      "mDataProp": "Created", "sClass": "read_only",
			      "fnRender": function (obj, val) {
			          //return GetDateInFullFormat(val);
			          return obj.aData.CreatedDate;
			      }
			  },
			  {
			      "mDataProp": "Updated", "sClass": "read_only",
			      "fnRender": function (obj, val) {
			          //return GetDateInFullFormat(val);
			          return obj.aData.UpdatedDate;
			      }
			  },
             { "mDataProp": "UpdatedByName", "sClass": "read_only" },
             { "mDataProp": "CreatedByName", "sClass": "read_only" },
             { "mDataProp": "Unit", "sClass": "read_only" }

             @(Html.RenderColumnsArray("ItemMaster"))
            ]
        }).makeEditable();


        $('#refreshGridIM').live('click', function () {
            oItemsTable.fnDraw();
            //fillItemMaster(false);

        });

        $('.DTTT_container').css('z-index', '-1');
        //alert('@isCost');
        if ('@isCost' == '@Boolean.FalseString') {
            HideColumnUsingClassName("ItemModeDataTable");
        }
        /*Functions used for nasted data binding START*/
        $('#ItemModeDataTable').on('click', 'td.control', function (event) {
            if ($(this).find('img').length <= 0)
                return;

            $('#DivLoading').show();
            var nTr = this.parentNode;
            var i = $.inArray(nTr, anItemOpen);
            if (i === -1) {
                $('img', this).attr('src', sImageUrl + "drildown_close.jpg");
                oItemsTable.fnOpen(nTr, fnInnerGrid(oItemsTable, nTr), '');
                anItemOpen.push(nTr);
            }
            else {
                $('img', this).attr('src', sImageUrl + "drildown_open.jpg");
                oItemsTable.fnClose(nTr);
                anItemOpen.splice(i, 1);
                $('#DivLoading').hide();
            }
        });

        //var timeouttc;
        var txtFilerId = 'searchInAllItems';
        var myDataTableId = 'ItemModeDataTable';
        var $searchInAllItems = $('#' + txtFilerId);
        var $ItemModeDataTable = $('#' + myDataTableId);

        _Common.setGloblaSearch(txtFilerId, myDataTableId, function (txtSearch) {
            //$ItemModeDataTable.dataTable().fnFilter(txtSearch, null, null, null);
            DoNarrowSearchIM();
            },
            function (txtSearch) {
                //$ItemModeDataTable.dataTable().fnFilter(txtSearch, null, null, null);
                DoNarrowSearchIM();
            }
        );



        //$searchInAllItems.bind('textchange', function () {
        //    clearTimeout(timeouttc);
        //    var self = this;
        //    timeouttc = setTimeout(function () {
        //        if (SearchPattern == 2 || SearchPattern == "2") {
        //            //var searchtext = $searchInAllItems.val().replace(/'/g, "''");
        //            //if (searchtext.length > 2 || searchtext.length == 0) {
        //            //    $('#ItemModeDataTable').dataTable().fnFilter(searchtext, null, null, null);
        //            //}

        //            var filterVal = _Common.getGlobalFilterVal(false, txtFilerId);
        //            var filterValTrimmed = _Common.getGlobalFilterVal(true, txtFilerId);
        //            _Common.trimStartGlobalFilter(txtFilerId);

        //            if (filterValTrimmed.length > 2 || filterVal.length === 0) {
        //                var searchtext = filterValTrimmed.replace(/'/g, "''");
        //                $ItemModeDataTable.dataTable().fnFilter(searchtext, null, null, null);
        //            }
        //            else {
        //                _Common.highlightTextInTable(txtFilerId, myDataTableId);

        //            }

        //        }
        //        else {
        //            //$('#searchInAllItems').unbind("keypress");
        //            //$('#searchInAllItems').keypress(function (event) {
        //            //    var keycode = (event.keyCode ? event.keyCode : event.which);
        //            //    if (keycode == 13) {
        //            //        var searchtext = $("#searchInAllItems").val().replace(/'/g, "''");
        //            //        setTimeout(function () { $('#ItemModeDataTable').dataTable().fnFilter(searchtext, null, null, null); }, 200);
        //            //    }
        //            //});
        //            if ($searchInAllItems.val().length == 0) {
        //                setTimeout(function () { $ItemModeDataTable.dataTable().fnFilter('', null, null, null); }, 200);
        //            }
        //        }

        //    }, 500);
        //});

        //if (SearchPattern != 2 && SearchPattern != "2") {
        //    //    $('#searchInAllItems').unbind("keypress");
        //    //$('#searchInAllItems').keypress(function (event) {
        //    $searchInAllItems.unbind("keyup").bind("keyup", function (event) {

        //        clearTimeout(timeouttc);

        //        timeouttc = setTimeout(function () {

        //            var KeyCode = (event.keyCode ? event.keyCode : event.which);
        //            var filterVal = _Common.getGlobalFilterVal(false, txtFilerId);
        //            var filterValTrimmed = _Common.getGlobalFilterVal(true, txtFilerId);
        //            _Common.trimStartGlobalFilter(txtFilerId);

        //            if ((filterValTrimmed.length > 0 && KeyCode === 13)  || filterVal.length === 0) {
        //                //if (keycode == 13) {
        //                var searchtext = filterValTrimmed.replace(/'/g, "''");
        //                $ItemModeDataTable.dataTable().fnFilter(searchtext, null, null, null);
        //            }
        //            else {
        //                _Common.highlightTextInTable(txtFilerId, myDataTableId);
        //            }

        //        }, 200);
        //    });
        //}


        $("#clearSearchInAllItems").click(funClearFilterCIM);

        $("#ItemQty").dialog({
            autoOpen: false, modal: true, draggable: true, resizable: true, width: '60%', height: 450, title: 'Quantity Detail',
            open: function () {

                $('#DivLoading').show();
                var itemGuid = $(this).data("itemGuid");
                var strUrl = $(this).data("url");
                $.get(strUrl, { ItemGuid: itemGuid }, function (data) {
                    $('#DivLoading').hide();
                    $("#ItemQty").html(data);

                });
            },
            close: function () {
                $("#ItemQty").empty();
            }
        });
    });

    function DisplayOnOrderQty(obj) {
        $("#ItemQty").empty();
        var itemGuid = obj.id.split('_');
        $('#ItemQty').data({ "itemGuid": itemGuid[1], "url": '/Inventory/ItemOnOrderQty' }).dialog('open');
        return false;
    }
    //Start Below is the New Recieve Withot order JS Function


    function funClearFilterCIM() {

        //Check length first
        if ($("#searchInAllItems").val().length > 0) {
            $("#searchInAllItems").val('');
            DoNarrowSearchIM();//$('#ItemModeDataTable').dataTable().fnFilter($("#searchInAllItems").val(), null, null, null);
        }
        $("#searchInAllItems").focus();
        $('#ItemModeDataTable td').removeHighlight();
        return false;
    }

    function fnInnerGrid(oItemsTable, nTr) {
        var oData = oItemsTable.fnGetData(nTr);
        var sOut = '';
        $('#DivLoading').show();
        $.ajax({
            "url": '@Url.Content("~/Receive/ReceiveNewItemWithoutOrderInnerGrid")',
            "type": 'GET',
            "data": { "ItemGuid": oData.GUID, "ItemType": oData.ItemType },
            "async": false,
            "cache": false,
            "dataType": "text",
            "success": function (json) {
                sOut = json;
                $('#DivLoading').hide();
            },
            error: function (response) {
                $('#DivLoading').hide();
            }
        });
        return sOut;
    }


    function NewSRReceiveWithoutOrder(itemID, obj) {
        $("#DivLoading").show();
        var tr = $(obj).parent().parent();
        var id = $(tr).attr('id');
        var cnt = id.split("_")[2];
        var orderNumber = "";//$(tr).find("#txtordernumber_" + itemID).val();
        var isBlanketOrder = $("#hdnIsBlanketPO_" + itemID).val();
        if (isBlanketOrder == "True") {
            var blanketPO = $("#ddlBlanketPO_" + itemID).val();
            if (!isNaN(parseInt(blanketPO)) && parseInt(blanketPO) > 0) {
                orderNumber = $("select[id='ddlBlanketPO_" + itemID + "'] :selected").text();
            }
            else {
                orderNumber = "";
            }
        }
        else {
            orderNumber = $("#txtSROrderNumber_" + itemID).val();
        }

        var orderNumberforsort = $("#hdnordernumberforsort_" + itemID).val();
        if ($.trim(orderNumber).length <= 0) {
            $("#spanGlobalMessage").html("@ResReceiveOrderDetails.ReqOrderNumber");
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            showNotificationDialog();
            $("#DivLoading").hide();
            $("#txtSROrderNumber_" + itemID).focus();
            return false;
        }
        if ($.trim($(tr).find('#txtSRBin_' + itemID + '_' + cnt).val()).length <= 0) {
            $("#spanGlobalMessage").html("@ResReceiveOrderDetails.ReqReceiveBinName");
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            showNotificationDialog();
            $("#DivLoading").hide();
            $(tr).find('#txtSRBin_' + itemID + '_' + cnt).focus();
            return false;
        }

        var orderDetailGUID = $("#hdnSROrderDetailGUID_" + itemID).val();
        var orderGUID = $("#hdnSROrderGUID_" + itemID).val();
        var reqQty = $("#txtSRReqQty_" + itemID).val();
        var itemGUID = $(tr).find("#hdnSRItemGuid_" + itemID + "_" + cnt).val();
        var isDCTrack = $(tr).find("#hdnSRIsDateCode_" + itemID + "_" + cnt).val();
        var isSerial = $(tr).find("#hdnSRIsSerial_" + itemID + "_" + cnt).val();
        var srNumber = "";
        var expiredate = "";

        var recvQty = 0;
        var recvDate = $(tr).find("#txtSRReceived_" + itemID + "_" + cnt).val();
        var recvcost = $(tr).find("#txtSRCostBox_" + itemID + "_" + cnt).val();
        if ($(tr).find("#txtSRCostBox_" + itemID + "_" + cnt).length > 0) {
            recvcost = $(tr).find("#txtSRCostBox_" + itemID + "_" + cnt).val();
        }
        else if ($(tr).find("#hdnSRCostBox_" + itemID + "_" + cnt).length > 0) {
            recvcost = $(tr).find("#hdnSRCostBox_" + itemID + "_" + cnt).val();
        }
        var binID = '0'; // $(tr).find("#ddlSRBin_" + itemID + "_" + cnt).val();
        var binName = $.trim($(tr).find('#txtSRBin_' + itemID + '_' + cnt).val());
        var packSlipNmbr = $("#txtPackslip_" + itemID).val();
        var shipTrackNmbr = $("#txtShipTrack_" + itemID).val();
        srNumber = $(tr).find("#txtSRNumber_" + itemID + '_' + cnt).val();
        var isPackSlipNumberMandatory = $(tr).find("#hdnIsPackSlipNumberMandatory_" + itemID + "_" + cnt).val();
        var supplierID = $.trim($(tr).find("#txtSupplier_" + itemID).val());

        var UDF1 = '';
        var UDF2 = '';
        var UDF3 = '';
        var UDF4 = '';
        var UDF5 = '';

        if ($('#NewSRReceiveEntry' + itemID).find('#UDF1_' + itemID + "_" + cnt).length > 0) {
            if ($('#NewSRReceiveEntry' + itemID).find('#UDF1_' + itemID + "_" + cnt)[0].nodeName === "SELECT")
                UDF1 = $('#NewSRReceiveEntry' + itemID).find('#UDF1_' + itemID + "_" + cnt).find("option:selected").text();
            else
                UDF1 = $('#NewSRReceiveEntry' + itemID).find('#UDF1_' + itemID + "_" + cnt).val();
        }

        if ($('#NewSRReceiveEntry' + itemID).find('#UDF2_' + itemID + "_" + cnt).length > 0) {
            if ($('#NewSRReceiveEntry' + itemID).find('#UDF2_' + itemID + "_" + cnt)[0].nodeName === "SELECT")
                UDF2 = $('#NewSRReceiveEntry' + itemID).find('#UDF2_' + itemID + "_" + cnt).find("option:selected").text();
            else
                UDF2 = $('#NewSRReceiveEntry' + itemID).find('#UDF2_' + itemID + "_" + cnt).val();
        }

        if ($('#NewSRReceiveEntry' + itemID).find('#UDF3_' + itemID + "_" + cnt).length > 0) {
            if ($('#NewSRReceiveEntry' + itemID).find('#UDF3_' + itemID + "_" + cnt)[0].nodeName === "SELECT")
                UDF3 = $('#NewSRReceiveEntry' + itemID).find('#UDF3_' + itemID + "_" + cnt).find("option:selected").text();
            else
                UDF3 = $('#NewSRReceiveEntry' + itemID).find('#UDF3_' + itemID + "_" + cnt).val();
        }

        if ($('#NewSRReceiveEntry' + itemID).find('#UDF4_' + itemID + "_" + cnt).length > 0) {
            if ($('#NewSRReceiveEntry' + itemID).find('#UDF4_' + itemID + "_" + cnt)[0].nodeName === "SELECT")
                UDF4 = $('#NewSRReceiveEntry' + itemID).find('#UDF4_' + itemID + "_" + cnt).find("option:selected").text();
            else
                UDF4 = $('#NewSRReceiveEntry' + itemID).find('#UDF4_' + itemID + "_" + cnt).val();
        }
        if ($('#NewSRReceiveEntry' + itemID).find('#UDF5_' + itemID + "_" + cnt).length > 0) {
            if ($('#NewSRReceiveEntry' + itemID).find('#UDF5_' + itemID + "_" + cnt)[0].nodeName === "SELECT")
                UDF5 = $('#NewSRReceiveEntry' + itemID).find('#UDF5_' + itemID + "_" + cnt).find("option:selected").text();
            else
                UDF5 = $('#NewSRReceiveEntry' + itemID).find('#UDF5_' + itemID + "_" + cnt).val();
        }


        //         if ('@IsPackSlipReq.ToString()'.toUpperCase() == 'TRUE' && packSlipNmbr.length <= 0) {
        //             $("#spanGlobalMessage").text("@ResReceiveOrderDetails.MsgEnterPayslipNumber");
        //                $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
        //                showNotificationDialog();
        //                $("#DivLoading").hide();
        //                $(tr).find("#txtPackslip_" + itemID).focus();
        //                return false;
        //        }
        if (supplierID.length <= 0) {
            $("#spanGlobalMessage").html("@ResReceiveOrderDetails.MsgEnterSupplier");
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            showNotificationDialog();
            $("#DivLoading").hide();
            $(tr).find("#txtSupplier_" + itemID).focus();
            $('#btnReceive_' + itemID).removeAttr('disabled')
            return false;
        }

        if (isPackSlipNumberMandatory.toUpperCase() == 'TRUE' && packSlipNmbr.length <= 0) {
            $("#spanGlobalMessage").html("@ResReceiveOrderDetails.MsgEnterPayslipNumber");
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            showNotificationDialog();
            $("#DivLoading").hide();
            $(tr).find("#txtPackslip_" + itemID).focus();
            return false;
        }

        var defaultReOrderQty = $('#hdnDefaultReorderQty_' + itemID).val();
        var IsEnforceReorderQty = $('#hdnIsEnforceReorderQty_' + itemID).val();
        var IsAllowOrderCostuom = $('#hdnIsAllowOrderCostuom_' + itemID).val();


        if (isNaN(parseFloat(reqQty)) || reqQty <= 0) {

            $("#spanGlobalMessage").html("@ResReceiveOrderDetails.ReqRequestedQuantity");
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            showNotificationDialog();
            $("#DivLoading").hide();
            $("#txtSRReqQty_" + itemID + "_" + cnt).focus();
            return false;
        }
        else if (IsEnforceReorderQty == "True" && parseFloat(defaultReOrderQty) > 0) {
            var reqQty_Org = parseFloat(reqQty);
            var z = parseFloat(reqQty) % parseFloat(defaultReOrderQty);
            if (z != 0) {
                var devideval = parseInt(parseInt(reqQty) / parseInt(defaultReOrderQty)) + 1;
                reqQty = defaultReOrderQty * devideval;
                if(IsAllowOrderCostuom == "True" && isSerial == "True")
                {
                    reqQty = reqQty_Org;
                }
                else
                {
                    $("#txtSRReqQty_" + itemID).val(reqQty);
                }
                //$("#spanGlobalMessage").text("Please enter receive quantity multiplying by " + defaultReOrderQty);
                //$("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                //showNotificationDialog();
                //$("#DivLoading").hide();
                //$(tr).find("#txtReceiveQuantity_" + itemID).focus();
                //$('#btnReceive_' + itemID).removeAttr('disabled')
                //return false;

            }
        }

        if (srNumber.length <= 0) {

            $("#spanGlobalMessage").html("@ResReceiveOrderDetails.MsgSerialNumberValidation");
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            showNotificationDialog();
            $("#DivLoading").hide();
            $(tr).find("#txtSRNumber_" + itemID + "_" + cnt).focus();
            return false;
        }
        else {
            var txtSRNumber = $(tr).find("#txtSRNumber_" + itemID + "_" + cnt);
            if (txtSRNumber.css('background-color') === "rgb(247, 187, 196)") {
                $("#spanGlobalMessage").html("@ResReceiveOrderDetails.MsgDuplicateSerialNumberValidation");
                $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                showNotificationDialog();
                $("#DivLoading").hide();
                $(tr).find("#txtSRNumber_" + itemID + "_" + cnt).focus();
                return false;
            }
        }
        var IsExpTrack = false;
        if (isDCTrack === "True") {
            IsExpTrack = true;
            expiredate = $(tr).find("#txtSRExpiration_" + itemID + "_" + cnt).val();
            if (expiredate.length <= 0) {

                $("#spanGlobalMessage").html("@ResReceiveOrderDetails.MsgExpireDateValidation");
                $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                showNotificationDialog();
                $("#DivLoading").hide();
                $(tr).find("#txtSRExpiration_" + itemID + "_" + cnt).focus();
                return false;
            }
        }

        recvQty = 1;

        var arrObj = new Array();
        var objROTDDTO = {
            "BinID": binID, "SerialNumber": $.trim(srNumber)
                            , "Expiration": expiredate, "Received": recvDate, "Cost": recvcost
                            , "ItemGUID": itemGUID, "ReceivedDate": recvDate
                            , "UDF1": UDF1, "UDF2": UDF2, "UDF3": UDF3, "UDF4": UDF4, "UDF5": UDF5, "IsOnlyFromUI": true
        };

        arrObj.push(objROTDDTO);
        var objRODDTO = {
            "OrderNumber": orderNumber, "OrderGUID": orderGUID, "ItemGUID": itemGUID
                        , "ReceiveBinID": binID, "ReceivedQuantity": recvQty, "RequestedQuantity": reqQty
                           , "OrderRequiredDateStr": recvDate, "OrderDetailGUID": orderDetailGUID
                           , "ReceiveBinName": binName, "PackSlipNumber": packSlipNmbr, "ShippingTrackNumber": shipTrackNmbr
                           , "OrderNumber_ForSorting": orderNumberforsort, "DateCodeTracking": IsExpTrack
                        , "ReceivedItemDetail": arrObj, "IsOnlyFromUI": true, "ItemSupplierID": supplierID
        };
        return SaveOrderFromNewReceive(objRODDTO, itemID, true, tr, cnt);

    }

    function NewNotSRReceiveWithoutOrder(itemID, obj) {
        $('#btnReceive_' + itemID).attr('disabled', 'disabled')
        $("#DivLoading").show();
        var tr = $(obj).parent().parent();
        var orderNumber = "";//$(tr).find("#txtordernumber_" + itemID).val();
        var isBlanketOrder = $(tr).find("#hdnIsBlanketPO_" + itemID).val();
        if (isBlanketOrder == "True") {
            var blanketPO = $(tr).find("#ddlBlanketPO_" + itemID).val();
            if (!isNaN(parseInt(blanketPO)) && parseInt(blanketPO) > 0) {
                orderNumber = $(tr).find("select[id='ddlBlanketPO_" + itemID+"'] :selected").text();
            }
            else {
                orderNumber = "";
            }
        }
        else {
            orderNumber = $(tr).find("#txtordernumber_" + itemID).val();
        }

        var orderNumberforSort = $(tr).find("#hdnordernumberforsort_" + itemID).val();

        if ($.trim(orderNumber).length <= 0) {
            $("#spanGlobalMessage").html("@ResReceiveOrderDetails.ReqOrderNumber");
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            showNotificationDialog();
            $("#DivLoading").hide();
            $("#txtordernumber_" + itemID).focus();
            $('#btnReceive_' + itemID).removeAttr('disabled')
            return false;
        }
        if ($.trim($(tr).find("#txtBin_" + itemID).val()).length <= 0) {
            $("#spanGlobalMessage").html("@ResReceiveOrderDetails.ReqReceiveBinName");
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            showNotificationDialog();
            $("#DivLoading").hide();
            $(tr).find("#txtBin_" + itemID).focus();
            $('#btnReceive_' + itemID).removeAttr('disabled')
            return false;
        }

        var orderID = $(tr).find("#hdnOrderGUID_" + itemID).val();
        var orderGUID = $(tr).find("#hdnOrderID_" + itemID).val();

        var itemGUID = $(tr).find("#hdnItemGuid_" + itemID).val();
        var isLot = $(tr).find("#hdnIsLot_" + itemID).val();
        var isDCTrack = $(tr).find("#hdnIsDateCode_" + itemID).val();
        var expiredate = "";
        var lotNumber = "";
        var reqQty = 0;
        var recvQty = 0;
        var recvDate = $(tr).find("#txtReceived_" + itemID).val();
        var recvcost = 0;//$(tr).find("#txtCostBox_" + itemID).val();
        if ($(tr).find("#txtCostBox_" + itemID).length > 0) {
            recvcost = $(tr).find("#txtCostBox_" + itemID).val();
        }
        else if ($(tr).find("#hdnCostBox_" + itemID).length > 0) {
            recvcost = $(tr).find("#hdnCostBox_" + itemID).val();
        }

        /// WI-6215 Related Changes Start ///
        var CurrentReceiveCost = 0;
        var OldReceiveCost = 0;
        var IsReceivedCostChange = false;
        if ($(tr).find("#txtCostBox_" + itemID).length > 0) {
            CurrentReceiveCost = $(tr).find("#txtCostBox_" + itemID).val();
        }
        if ($(tr).find("#hdnCostBox_" + itemID).length > 0) {
            OldReceiveCost = $(tr).find("#hdnCostBox_" + itemID).val();
        }
        var CurrencyDecimalDigits =@CurrencyDecimalDigits;
        if (CurrencyDecimalDigits == null || CurrencyDecimalDigits == "") {
            CurrencyDecimalDigits = 0;
        }
        if (parseFloat(CurrentReceiveCost).toFixed(CurrencyDecimalDigits)
            != parseFloat(OldReceiveCost).toFixed(CurrencyDecimalDigits)) {
            IsReceivedCostChange = true;
        }

        var binID = '0'; //$(tr).find("#ddlBin_" + itemID).val();
        var binName = $.trim($(tr).find("#txtBin_" + itemID).val());
        var packSlipNmbr = $(tr).find("#txtPackslip_" + itemID).val();
        var shipTrackNmbr = $(tr).find("#txtShipTrack_" + itemID).val();
        var isPackSlipNumberMandatory = $(tr).find("#hdnIsPackSlipNumberMandatory_" + itemID).val();
        var supplierID = $.trim($(tr).find("#txtSupplier_" + itemID).val());

        var UDF1 = '';
        var UDF2 = '';
        var UDF3 = '';
        var UDF4 = '';
        var UDF5 = '';

        if ($('#NewReceiveEntry' + itemID).find('#UDF1_' + itemID).length > 0) {
            if ($('#NewReceiveEntry' + itemID).find('#UDF1_' + itemID)[0].nodeName === "SELECT")
                UDF1 = $('#NewReceiveEntry' + itemID).find('#UDF1_' + itemID).find("option:selected").text();
            else
                UDF1 = $('#NewReceiveEntry' + itemID).find('#UDF1_' + itemID).val();
        }

        if ($('#NewReceiveEntry' + itemID).find('#UDF2_' + itemID).length > 0) {
            if ($('#NewReceiveEntry' + itemID).find('#UDF2_' + itemID)[0].nodeName === "SELECT")
                UDF2 = $('#NewReceiveEntry' + itemID).find('#UDF2_' + itemID).find("option:selected").text();
            else
                UDF2 = $('#NewReceiveEntry' + itemID).find('#UDF2_' + itemID).val();
        }


        if ($('#NewReceiveEntry' + itemID).find('#UDF3_' + itemID).length > 0) {
            if ($('#NewReceiveEntry' + itemID).find('#UDF3_' + itemID)[0].nodeName === "SELECT")
                UDF3 = $('#NewReceiveEntry' + itemID).find('#UDF3_' + itemID).find("option:selected").text();
            else
                UDF3 = $('#NewReceiveEntry' + itemID).find('#UDF3_' + itemID).val();
        }


        if ($('#NewReceiveEntry' + itemID).find('#UDF4_' + itemID).length > 0) {
            if ($('#NewReceiveEntry' + itemID).find('#UDF4_' + itemID)[0].nodeName === "SELECT")
                UDF4 = $('#NewReceiveEntry' + itemID).find('#UDF4_' + itemID).find("option:selected").text();
            else
                UDF4 = $('#NewReceiveEntry' + itemID).find('#UDF4_' + itemID).val();
        }

        if ($('#NewReceiveEntry' + itemID).find('#UDF5_' + itemID).length > 0) {
            if ($('#NewReceiveEntry' + itemID).find('#UDF5_' + itemID)[0].nodeName === "SELECT")
                UDF5 = $('#NewReceiveEntry' + itemID).find('#UDF5_' + itemID).find("option:selected").text();
            else
                UDF5 = $('#NewReceiveEntry' + itemID).find('#UDF5_' + itemID).val();
        }
        if (supplierID.length <= 0) {
            $("#spanGlobalMessage").html("@ResReceiveOrderDetails.MsgEnterSupplier");
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            showNotificationDialog();
            $("#DivLoading").hide();
            $(tr).find("#txtSupplier_" + itemID).focus();
            $('#btnReceive_' + itemID).removeAttr('disabled')
            return false;
        }

        //        if ('@IsPackSlipReq.ToString()'.toUpperCase() == 'TRUE' && packSlipNmbr.length <= 0) {
        //             $("#spanGlobalMessage").text("@ResReceiveOrderDetails.MsgEnterPayslipNumber");
        //                $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
        //                showNotificationDialog();
        //                $("#DivLoading").hide();
        //                $(tr).find("#txtPackslip_" + itemID).focus();
        //                return false;
        //        }

        if (isPackSlipNumberMandatory.toUpperCase() == 'TRUE' && packSlipNmbr.length <= 0) {
            $("#spanGlobalMessage").html("@ResReceiveOrderDetails.MsgEnterPayslipNumber");
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            showNotificationDialog();
            $("#DivLoading").hide();
            $(tr).find("#txtPackslip_" + itemID).focus();
            $('#btnReceive_' + itemID).removeAttr('disabled')
            return false;
        }

        if (isLot === "True") {
            lotNumber = $(tr).find("#txtlotnumber_" + itemID).val();

            if (lotNumber.length <= 0) {

                $("#spanGlobalMessage").html("@ResReceiveOrderDetails.MsgEnterLotNumber");
                $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                showNotificationDialog();
                $("#DivLoading").hide();
                $(tr).find("#txtlotnumber_" + itemID).focus();
                $('#btnReceive_' + itemID).removeAttr('disabled')
                return false;
            }
        }
        var IsExpTrack = false;
        if (isDCTrack === "True") {
            IsExpTrack = true;
            expiredate = $(tr).find("#txtExpiration_" + itemID).val();
            if (expiredate.length <= 0) {

                $("#spanGlobalMessage").html("@ResReceiveOrderDetails.MsgExpireDateValidation");
                $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                showNotificationDialog();
                $("#DivLoading").hide();
                $(tr).find("#txtExpiration_" + itemID).focus();
                $('#btnReceive_' + itemID).removeAttr('disabled')
                return false;
            }
        }

        recvQty = $(tr).find("#txtReceiveQuantity_" + itemID).val();
        reqQty = $(tr).find("#txtReceiveQuantity_" + itemID).val();
        var defaultReOrderQty = $(tr).find('#hdnDefaultReorderQty_' + itemID).val();
        var IsEnforceReorderQty = $(tr).find('#hdnIsEnforceReorderQty_' + itemID).val();
        var IsAllowOrderCostuom = $(tr).find('#hdnIsAllowOrderCostuom_' + itemID).val();

        if (isNaN(parseFloat(reqQty)) || reqQty <= 0) {

            $("#spanGlobalMessage").html("@ResReceiveOrderDetails.ReqReceiveQuantity");
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            showNotificationDialog();
            $("#DivLoading").hide();
            $(tr).find("#txtReceiveQuantity_" + itemID).focus();
            $('#btnReceive_' + itemID).removeAttr('disabled')
            return false;
        }
        else if (IsAllowOrderCostuom == "True" && parseFloat(defaultReOrderQty) > 0) {
            reqQty = reqQty * defaultReOrderQty
        }
        else if (IsEnforceReorderQty == "True" && parseFloat(defaultReOrderQty) > 0) {
            var z = parseFloat(reqQty) % parseFloat(defaultReOrderQty);
            if (z != 0) {

                var devideval = parseInt(parseInt(reqQty) / parseInt(defaultReOrderQty)) + 1;
                reqQty = defaultReOrderQty * devideval;

                //$("#spanGlobalMessage").text("Please enter receive quantity multiplying by " + defaultReOrderQty);
                //$("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                //showNotificationDialog();
                //$("#DivLoading").hide();
                //$(tr).find("#txtReceiveQuantity_" + itemID).focus();
                //$('#btnReceive_' + itemID).removeAttr('disabled')
                //return false;

            }
        }


        var arrObj = new Array();

        var objROTDDTO = {
            "BinID": binID, "LotNumber": $.trim(lotNumber), "Expiration": expiredate, "Received": recvDate, "Cost": recvcost
                            , "ItemGUID": itemGUID, "ReceivedDate": recvDate
            , "UDF1": UDF1, "UDF2": UDF2, "UDF3": UDF3, "UDF4": UDF4, "UDF5": UDF5, "IsOnlyFromUI": true
            , "IsReceivedCostChange": IsReceivedCostChange
        };

        arrObj.push(objROTDDTO);

        var objRODDTO = {
            "OrderNumber": orderNumber, "OrderGUID": orderGUID, "ItemGUID": itemGUID
                        , "ReceiveBinID": binID, "RequestedQuantity": reqQty, "ReceivedQuantity": recvQty
                        , "OrderRequiredDateStr": recvDate, 'ReceiveBinName': binName
                        , "PackSlipNumber": packSlipNmbr, "ShippingTrackNumber": shipTrackNmbr
                        , "OrderNumber_ForSorting": orderNumberforSort, "DateCodeTracking": IsExpTrack
                        , "ReceivedItemDetail": arrObj, "IsOnlyFromUI": true, "ItemSupplierID": supplierID
        };

        return SaveOrderFromNewReceive(objRODDTO, itemID, false, tr, 0);
        $('#btnReceive_' + itemID).removeAttr('disabled')
    }

    function SaveOrderFromNewReceive(objRODDTO, itemID, IsSerial, tr, oldcnt) {
        var newtrID = '';
        $("#DivLoading").show();
        $.ajax({
            "url": '@Url.Content("~/Receive/SaveNewReceiveWithoutOrder")'
            , "type": "POST"
            , "dataType": "json"
            , "contentType": "application/json"
            , "data": JSON.stringify(objRODDTO)
            , "async": false
            , "cache": false
            , "success": function (response) {
                $('#btnReceive_' + itemID).removeAttr('disabled')
                UDFInsertNewForGrid($('#NewReceiveEntry' + itemID));
                if (response.Status === "UDFError") {
                    $('#DivLoading').hide();

                    alert(response.Message);
                    return false;
                }
                if (response.Status === "Error") {
                    $('#DivLoading').hide();

                    alert(response.Message);
                    return false;
                }

                if (!IsSerial) {
                    $('#ItemModeDataTable').dataTable().fnStandingRedraw()
                    var onHandQty = parseFloat($('#ItemModeDataTable').find("#spnOnHand_" + itemID).text());
                    var ReceivedQty = parseFloat(response.ReceivedQty);
                    $('#ItemModeDataTable').find("#spnOnHand_" + itemID).text(onHandQty + ReceivedQty);
                    $("#DivLoading").hide();
                    $("#spanGlobalMessage").html('@(eTurns.DTO.Resources.ResMessage.SaveMessage)');
                    $("#spanGlobalMessage").removeClass('errorIcon WarningIcon').addClass('succesIcon');
                    showNotificationDialog();
                    $('#ItemModeDataTable').find("#" + itemID).find("img").click();

                    return false;
                }
                else {

                    var reqQty = $("#txtSRReqQty_" + itemID).val();
                    reqQty = response.RequestedQty;
                    var onHandQty = parseFloat($('#ItemModeDataTable').find("#spnOnHand_" + itemID).text());
                    $('#ItemModeDataTable').find("#spnOnHand_" + itemID).text(onHandQty + 1);
                    var onSuggestedQty = parseFloat($('#ItemModeDataTable').find("#spnSuggested_" + itemID).text());
                    if (!isNaN(onSuggestedQty) && parseFloat(onSuggestedQty) > 0) {
                        $('#ItemModeDataTable').find("#spnSuggested_" + itemID).text(onSuggestedQty - 1);
                    }

                    if (parseInt(reqQty) <= parseInt(response.ReceivedQty)) {
                        $("#spanGlobalMessage").html("@ResReceiveOrderDetails.MsgAllSerialsReceived");
                        $("#spanGlobalMessage").removeClass('errorIcon WarningIcon').addClass('succesIcon');
                        showNotificationDialog();
                        $('#ItemModeDataTable').find("#" + itemID).find("img").click();
                        $('#ItemModeDataTable').dataTable().fnStandingRedraw();
                        $("#DivLoading").hide();
                        return false;
                    }
                    else {
                        $("#spanGlobalMessage").html('@(eTurns.DTO.Resources.ResMessage.SaveMessage)');
                    }

                    $("#spanGlobalMessage").removeClass('errorIcon WarningIcon').addClass('succesIcon');
                    showNotificationDialog();
                    $("#hdnSROrderGUID_" + itemID).val(response.OrderGUID);
                    $("#hdnSROrderDetailGUID_" + itemID).val(response.OrderDetailGUID);
                    $("#hdnSROrderDetailRecvQty_" + itemID).val(response.ReceivedQty);
                    $("#txtSROrderNumber_" + itemID).attr('readonly', 'readonly');
                    $("#txtSRReqQty_" + itemID).attr('readonly', 'readonly');
                    $("#txtSRRecvQty_" + itemID).val(response.ReceivedQty);

                    $(".myDatePicker").datepicker("destroy");
                    $(".DirectReciveSRAuto").autocomplete("destroy");

                    var id = $(tr).prop("id");
                    var splitId = id.split("_");
                    var cur_num = oldcnt;
                    var cloned = $(tr).clone(true, true).get(0);
                    ++cur_num;
                    cloned.id = splitId[0] + "_" + splitId[1] + "_" + cur_num;;
                    $(cloned).find("input,select,a").each(function (index, element) {
                        if (element.id) {
                            var matches = element.id.match(/(.+)_\d+/);
                            if (matches && matches.length >= 2) {
                                element.id = matches[1] + "_" + cur_num;
                            }
                        }
                        if (element.name) {
                            var matches = element.name.match(/(.+)_\d+/);
                            if (matches && matches.length >= 2) {
                                element.name = matches[1] + "_" + cur_num;
                            }
                        }
                    });

                    $(cloned).find("#hdnIsLoadMoreLocations").val("false");

                    $(cloned).appendTo('#NewSRReceiveEntry' + itemID);
                    $("#txtSRNumber_" + itemID + "_" + cur_num).val('');
                    $("#txtSRNumber_" + itemID + "_" + cur_num).focus();
                    $(tr).find("input[type='button'],select").attr("disabled", "disabled");
                    $(tr).find("input[type='text']").attr("disabled", "disabled");
                    $(tr).find("#btnSRReceive_" + itemID + "_" + oldcnt).css("display", "none");
                    $(".myDatePicker").datepicker({
                        dateFormat: '@eTurnsWeb.Helper.SessionHelper.RoomDateJSFormat', showButtonPanel: true,
                        changeMonth: true,
                        changeYear: true,
                        clearText: 'Clear', onClose: function () { this.focus(); }
                    });
                    $("#txtSRNumber_" + itemID + "_" + cur_num).focus();
                    $("#DivLoading").hide();
                    isDirtyForm = false;
                    return false;
                }

            }
            , "error": function (xhr) {
                $('#btnReceive_' + itemID).removeAttr('disabled')
                $("#spanGlobalMessage").html("@ResCommon.ErrorInProcess");
                $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                showNotificationDialog();
                $("#DivLoading").hide();
                return false;
            }
        });
    }

    function GetOrderNumber(itemID, isSerial, supplierID) {
        $("#DivLoading").show();
        $.ajax({
            "url": '@Url.Content("~/Receive/GetOrderNumber")'
            , "type": "GET"
            , "dataType": "json"
            , "contentType": "application/json"
            , "data": { 'ItemID': itemID, 'SupplierID': supplierID }
            , "async": false
            , "cache": false
            , "success": function (response) {
                if (isSerial) {
                    $("#txtSROrderNumber_" + itemID).val(response.OrderNumber);
                }
                else {
                    $("#txtordernumber_" + itemID).val(response.OrderNumber);
                }

                $("#hdnordernumberforsort_" + itemID).val(response.OrderNumberForSort);

                $("#DivLoading").hide();
                return false;
            }
            , "error": function (xhr) {
                $("#DivLoading").hide();
                return false;
            }
        });
        return false;
    }


    function isDuplicateSR(obj, ordDetaiID) {

        var tr = $(obj).parent().parent();
        var tr = $(obj).parent().parent();
        var id = $(tr).attr('id');
        var cnt = id.split("_")[2];
        var txtsr = $(tr).find("#txtSRNumber_" + ordDetaiID + "_" + cnt);
        var itemGuid = $(tr).find("#hdnSRItemGuid_" + ordDetaiID + "_" + cnt).val();

        var returnResult = false;
        if ($(txtsr).val() != '') {
            var consign = $(tr).find("#hdnSRIsConsign_" + ordDetaiID + "_" + cnt).val();
            $.ajax({
                "url": '@Url.Content("~/Inventory/DuplicateCheckSrNumber")',
                data: { SrNumber: $(txtsr).val(), ID: 0, ItemGUID: itemGuid },
                "async": false,
                cache: false,
                "dataType": "text",
                "success": function (response) {
                    if (response == "duplicate") {
                        $(txtsr).css("background-color", "#F7BBC4");
                        //$(txtsr).select();
                        //$(txtsr).focus();
                        return false;
                        returnResult = false;
                    }
                    else {
                        $(txtsr).css("background-color", "");
                        returnResult = true;
                    }
                },
                error: function (response) {
                    $("#spanGlobalMessage").html(response);
                    returnResult = false;
                }
            });
        }
        else {
            returnResult = true;
        }
        if (returnResult == false) {
            // alert('Duplicate Serial Number Found');
            $("#spanGlobalMessage").html('@ResMessage.DuplicateSerialFound');
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            showNotificationDialog();
        }

        return returnResult;
    }

    function RegisterDatePicker() {
        $('.myDatePicker').live("focusin", function () {
            $(this).datepicker(
                        {
                            dateFormat: 'mm/dd/yy',
                            showButtonPanel: true,
                            clearText: 'Clear',
                            onClose: function () {
                                $(this).attr('val');
                                $(this).attr('id');
                            }
                        });
        });
    }

    function DisplayInTransitQty(obj) {
        $("#ItemQty").empty();
        var itemGuid = obj.id.split('_');
        //$('#ItemQty').data({ "itemGuid": itemGuid[1], "url": '@Url.Content("~/Inventory/ItemInTransitQty")' }).dialog('open');
        $('#ItemQty').data({ "itemGuid": itemGuid[1], "url": '@Url.Content("~/Inventory/ItemOnTransferInTransitQty")' }).dialog('open');
        return false;
    }

    function DisplayOnTransferQty(obj) {
        $("#ItemQty").empty();
        var itemGuid = obj.id.split('_');
        $('#ItemQty').data({ "itemGuid": itemGuid[1], "url": '@Url.Content("~/Inventory/ItemOnTransferQty")' }).dialog('open');
        return false;
    }

</script>
