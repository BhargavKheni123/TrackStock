@model eTurns.DTO.LoginModel
@using CaptchaMvc.HtmlHelpers
@using CaptchaMvc
@{
    Layout = null;
    ViewBag.Title = "Login";

    var modelCommon = new eTurns.DTO.CommonDTO { PageName = "Login" };
    List<UserMasterDTO> lstAllUsers = (List<UserMasterDTO>)ViewBag.AllUsers;
    bool ShowInputs = false;
    string LoginPostMethod = "UserLoginAuthanticate";
    if (ViewBag.LoginWithSelection != "1")
    {
        ShowInputs = true;
    }
    else
    {
        ShowInputs = false;
    }
    ShowInputs = true;
    if (ViewBag.IsMasterDbLogin == "1")
    {
        LoginPostMethod = "UserLoginAuthanticateMasterDataBase";
    }
    string RetURL = string.Empty;
    if (!string.IsNullOrWhiteSpace(Convert.ToString(Request.QueryString["ReturnUrl"])))
    {
        RetURL = Convert.ToString(Request.QueryString["ReturnUrl"]);
    }

    LoginPostMethod = "UserLogin";
    string Status = string.Empty;
    string Message = string.Empty;
    if (!string.IsNullOrWhiteSpace(Convert.ToString(ViewBag.Status)))
    {
        Status = Convert.ToString(ViewBag.Status);
    }
    if (!string.IsNullOrWhiteSpace(Convert.ToString(ViewBag.Message)))
    {
        Message = Convert.ToString(ViewBag.Message);
    }
    string currentDomain = HttpContext.Current.Request.Url.Host.ToLower();
}
<!DOCTYPE html>
<link href="@Url.Content("~/Content/OpenAccess/LoginNews.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/OpenAccess/loginstylesNews.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Content/OpenAccess/jquery-1.7.1.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/OpenAccess/jquery.cookie.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/OpenAccess/sha1-min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/OpenAccess/moment-with-locales.min.js")" type="text/javascript"></script>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Login</title>
    <style type="text/css">
        html {
            display: none;
            visibility: hidden;
        }
    </style>
</head>
<body>

    @using (Html.BeginForm(LoginPostMethod, "Master", FormMethod.Post, new { @id = "frmUserLogin" }))
    {
        @Html.AntiForgeryToken()
        <div class="wrapper">
            <div id="container" class="clearfix">
                <div id="contentWrap" class="clearfix">

                    <div class="mainGreybgHeader">
                        <div class="headerleftlogo">
                            <h1 id="logo" class="alignLeft">
                                <a href="https://www.eturns.com/" target="_blank" title="@eTurns.DTO.Resources.ResLayout.LogoTitle">
                                    <img src="~/Content/OpenAccess/eturnslogo.jpg" alt="@eTurns.DTO.Resources.ResLayout.LogoImgAlt" style="width:75%;" />
                                </a>
                            </h1>
                            <h1 class="simpleoptimisedheader">
                                Automated Replenishment of Stockrooms and Trucks.
                            </h1>
                            <div class="loginContent alignLeft">
                                <div class="login alignLeft">
                                    <h2 class="alignLeft">
                                        Login
                                    </h2>
                                    <div class="loginForm clear">
                                        <ul>
                                            <li>
                                                <div id="ErrorMSG" style="color: Red">
                                                </div>
                                            </li>
                                        </ul>
                                        <ul>
                                            <li class="alignLeft">
                                                <span>
                                                    <img alt="username" class="icon" src="@Url.Content("~/Content/OpenAccess/username-icon.png")" />
                                                </span>
                                            </li>
                                            <li class="alignLeft">
                                                @Html.TextBoxFor(model => model.Email, new { @id = "txtUserName", @placeholder = "User name", @autocomplete = "off", @class = "inputtext" })

                                            </li>
                                        </ul>
                                        <ul>
                                            <li class="alignLeft">
                                                <span>
                                                    <img alt="password" class="icon" src="@Url.Content("~/Content/OpenAccess/password.png")" />
                                                </span>
                                            </li>
                                            <li class="alignLeft">
                                                @Html.PasswordFor(model => model.Password, new { @id = "txtPassword", @placeholder = "Password", @autocomplete = "off", @class = "inputtext" })

                                            </li>
                                        </ul>


                                        <ul style="display: none;">
                                            <li class="alignLeft">
                                                <span>
                                                    <img alt="username" class="icon" src="@Url.Content("~/Content/OpenAccess/password.png")" />
                                                </span>
                                            </li>
                                            <li class="alignLeft">
                                                <div style="float: left;">
                                                    @Html.Captcha(ResLoginForms.RefressCaptchaImage, "Please enter the above generated code in below textbox", 3, "Captcha required", true, null)
                                                </div>
                                            </li>
                                        </ul>
                                        <ul>
                                            <li class="alignLeft">
                                                <span style="margin-right:23px;">
                                                    &nbsp;
                                                </span>
                                            </li>
                                            <li class="alignLeft">

                                                @Html.CheckBoxFor(model => model.IsRemember, new { @id = "chkRemember" })
                                                <label for="chkRemember">
                                                    Remember me
                                                </label>

                                            </li>
                                        </ul>
                                        <ul>

                                            <li class="alignLeft" style="padding-left:30px;">
                                                <input type="submit" class="searchBtn" value="Login" id="btnLogin" />
                                                @Html.HiddenFor(model => model.ReturnUrl, new { @Value = RetURL })
                                            </li>
                                            <li class="alignLeft" style="margin-left:16px;">
                                                <a href="@Url.Action("ForgotPassword", "Master")">
                                                    Forgot
                                                    Password
                                                </a>
                                            </li>
                                        </ul>
                                        <ul>
                                            <li class="alignLeft">Like eTurns? Please spread the word and review us <a href="https://reviews.capterra.com/new/148776" target="_blank">here</a></li>
                                            <li class="alignLeft">For great eTurns tips and advice <a href="https://mailchi.mp/eturns/trackstock-enews" target="_blank">sign up for our e-newsletter.</a></li>

                                        </ul>
                                    </div>
                                </div>

                            </div>

                        </div>
                        <div class="headerrightnews">

                            @{Html.RenderAction("eTurnsNewsBlogs", "Master");}

                        </div>

                    </div>

                </div>

                <div id="contentWrap" class="clearfix">

                    <div class="content">

                        <div class="mainGreybg" style="min-height: 234px;">
                            <div class="loginBg" style="min-height: 230px;">
                                <div class="imgContent alignLeft">
                                    <section>
                                        <div id="technology-chart" class="container main-section">
                                            <div class="row">
                                                <div class="col-12">
                                                    <h1 class="text-center text-eturns-red">eTurns TrackStock offers levels of automated replenishment</h1>
                                                </div>
                                            </div>
                                            <div class="row py-4">
                                                <div class="col-lg-3 d-none d-lg-block">
                                                    <p class="text-center">manual</p>
                                                    <div class="bracket"></div>
                                                </div>
                                                <div class="col-lg-6 d-none d-lg-block">
                                                    <p class="text-center">semi-automated</p>
                                                    <div class="bracket"></div>
                                                </div>
                                                <div class="col-lg-3 d-none d-lg-block">
                                                    <p class="text-center">automated</p>
                                                    <div class="bracket"></div>
                                                </div>
                                            </div>

                                            <div class="row">

                                                <div class="col-lg-3">
                                                    <div class="d-lg-none">
                                                        <p class="text-center">manual</p>
                                                        <div class="bracket"></div>
                                                    </div>
                                                    <p class="text-center"><a target="_blank" href="https://www.eturns.com/solutions/vendorcustomer-managed-inventory"> <img src="@Url.Content("~/Content/OpenAccess/technology-replenish.png")" class="img-fluid"></a></p>
                                                    <h3 class="text-center text-eturns-blue border-bottom-blue">Trackstock<br>Replenish</h3>
                                                    <ul>
                                                        <li>Scan barcodes to reorder using phone camera &amp; mobile app</li>
                                                        <li>CMI &amp; VMI</li>
                                                    </ul>
                                                </div>

                                                <div class="col-lg-3">
                                                    <div class="d-lg-none pt-4">
                                                        <p class="text-center">semi-automated</p>
                                                        <div class="bracket"></div>
                                                    </div>
                                                    <p class="text-center"><a target="_blank" href="https://www.eturns.com/solutions/automated-replenishment"> <img src="@Url.Content("~/Content/OpenAccess/technology-manage.png")" class="img-fluid"></a></p>
                                                    <h3 class="text-center text-eturns-green border-bottom-green">Trackstock<br>Manage</h3>
                                                    <ul>
                                                        <li>Scan barcodes to order, use &amp; receive inventory which tracks real-time inventory status.</li>
                                                        <li>Can bill on consigned usage</li>
                                                    </ul>
                                                </div>

                                                <div class="col-lg-3">
                                                    <div class="d-lg-none pt-4">
                                                        <p class="text-center">semi-automated</p>
                                                        <div class="bracket"></div>
                                                    </div>
                                                    <p class="text-center"><a target="_blank" href="https://www.eturns.com/solutions/rfid-inventory-management"><img src="@Url.Content("~/Content/OpenAccess/technology-rfid.jpg")" class="img-fluid"></a></p>
                                                    <h3 class="text-center text-eturns-purple border-bottom-purple">Trackstock<br>RFID</h3>
                                                    <ul>
                                                        <li>1 scan to order/use/receive by waving tagged bin past RFID tower</li>
                                                    </ul>
                                                </div>

                                                <div class="col-lg-3">
                                                    <div class="d-lg-none pt-4">
                                                        <p class="text-center">automated</p>
                                                        <div class="bracket"></div>
                                                    </div>
                                                    <p class="text-center"><a target="_blank" href="https://www.eturns.com/solutions/iot-inventory-management"><img src="@Url.Content("~/Content/OpenAccess/technology-evmi.jpg")" class="img-fluid"></a></p>
                                                    <h3 class="text-center text-eturns-red border-bottom-red">Trackstock<br>eVMI</h3>
                                                    <ul>
                                                        <li>Weight sensors under bins track use and reorder automatically based on min/max.</li>
                                                        <li>Complete physical inventory on each item 2x/day</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </section>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

            <div id="footer" class="clearfix">
                <div class="copyright">
                    &copy; Copyright © @eTurns.DAL.DateTimeUtility.DateTimeNow.Year.ToString() eTurns.com.
                    All rights reserved.
                </div>
            </div>
            <!-- footer ends -->

            <!-- Welcome message -->
            @*<div id="overlay"></div>
            |<div class="welcomeMessage">
            <span class="closeBtn"><img src="/Content/OpenAccess/close_btn.png" /></span>
                 <div class="welMsg">Welcome!</div> Let's get you started using <span class="redFont">eTurns</span> TrackStock for frictionless replenishment of Amazon products.
</div>*@

        </div>

                                }
    <script type="text/javascript">
        var currentDomain = '@currentDomain'
        $(document).ready(function () {
            if (self == top) {
                document.documentElement.style.display = 'block';
                document.documentElement.style.visibility = 'visible';
            }
            else {
                top.location = self.location;
            }
            if ('@Status' == "fail") {
                $("#ErrorMSG").html('@Message');
                setTimeout(function () {
                    window.location.href = window.location.href;
                }, 1000);
            }

            var sdfsdf = document.all;
            $.fn.serializeObject = function () {
                var o = {};
                var a = this.serializeArray({ checkboxesAsBools: true });
                $.each(a, function () {
                    if (o[this.name]) {
                        if (!o[this.name].push) {
                            o[this.name] = [o[this.name]];
                        }
                        o[this.name].push(this.value || '');
                    } else {
                        o[this.name] = this.value || '';
                    }
                });

                return o;
            };

            $.fn.serializeArray = function (options) {
                var o = $.extend({
                    checkboxesAsBools: false
                }, options || {});

                var rselectTextarea = /select|textarea/i;
                var rinput = /text|hidden|password|search/i;

                return this.map(function () {
                    return this.elements ? $.makeArray(this.elements) : this;
                })
                .filter(function () {
                    return this.name && !this.disabled &&
                        (this.checked
                        || (o.checkboxesAsBools && this.type === 'checkbox')
                        || rselectTextarea.test(this.nodeName)
                        || rinput.test(this.type));
                })
                    .map(function (i, elem) {
                        var val = $(this).val();
                        return val == null ?
                        null :
                        $.isArray(val) ?
                        $.map(val, function (val, i) {
                            return { name: elem.name, value: val };
                        }) :
            {
                name: elem.name,
                value: (o.checkboxesAsBools && this.type === 'checkbox') ? //moar ternaries!
                    (this.checked ? 'true' : 'false') :
                    val
            };
                    }).get();
            };


            if ('@ShowInputs' == '@Boolean.TrueString') {
                $("#txtUserName").focus();
            }
            else {
                $("#Email").focus();
            }
            /*START - REMOVE COOKIE */
            document.cookie = "eturnsUserName=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Strict;";
            document.cookie = "eturnsPassword=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Strict;";
            /*END - REMOVE COOKIE */

            /*START - SET COOKIE */
            //var UserName = getCookie('eturnsUserName');
            //var Password = getCookie('eturnsPassword');

            //if (!$.cookie('eturnsUserName')) {

            //}
            //if (UserName != '' && Password != '') {
            //if (UserName != '') {
            //    $("#txtUserName").val(UserName);
            //}
            //if (Password != '') {
            //    $("#txtPassword").val(Password);
            //}
            var rememberMe = getCookie('RememberMe');

            if (rememberMe !== undefined && rememberMe != null && rememberMe == "true") {
                $('#chkRemember').attr('checked', 'checked');
            }

            /*END - SET COOKIE */


            /* welcaome message close */

            //$(".closeBtn").click(function () {
            //    $("#overlay, .welcomeMessage").hide();
            //});


        });
        $("form").submit(function (e) {
            $.cookie('lastajaxcallstarttime', moment.utc().format("YYYY-MM-DD HH:mm:ss Z"), { path: '/', SameSite: 'Strict' });
            if ($('#chkRemember').prop("checked")) {
                $.cookie('RememberMe', true, { SameSite: 'Strict' });
                //$.cookie('eturnsUserName', $("#txtUserName").val());
                //if (currentDomain != "arrowcares.arrow.com") {
                //    $.cookie('eturnsPassword', $("#txtPassword").val());
                //}
                //else {
                //    $.cookie('eturnsPassword', '');
                //}
            }
            else {
                $.cookie('RememberMe', false, { SameSite: 'Strict' });
                //$.cookie('eturnsUserName', '');
                //$.cookie('eturnsPassword', '');
            }

            if ('@ShowInputs' == '@Boolean.TrueString') {
                //alert(hex_sha1($("#txtPassword").val()));
                $("#txtPassword").val(hex_sha1($("#txtPassword").val()));
            }
            if (RedirectToAnother() == true) {
                return true;
            }
            else {
                return false;
            }
        });

        $("#Email").change(function () {
            $("#txtUserName").val($(this).find("option:selected").text());
            $("#txtPassword").val($(this).val());
            $("#frmUserLogin").submit();
        });

        function OnBegin() {

        }

        function CancelClick() {
            $("#ErrorMSG").html("");
            return false;
        }

        function RedirectToAnother() {
            var UserBlank = false;
            var PassBlank = false;
            var msg = "";

            if ($("#txtUserName").val() == '' || $("#txtUserName").val().toLowerCase() == 'email') {
                UserBlank = true;
            }
            if ($("#txtPassword").val() == '' || $("#txtPassword").val().toLowerCase() == 'password') {
                PassBlank = true;
            }
            if (UserBlank == true && PassBlank == true) {
                msg = "Email and Password is mandatory";
            }
            else if (UserBlank == true) {
                msg = "Email is mandatory";
            }
            else if (PassBlank == true) {
                msg = "Password is mandatory";
            }
            if (msg != "") {
                $("#ErrorMSG").html(msg);
                return false;
            }
            else {
                return true;
                //var form = $("#frmUserLogin").serializeArray({ checkboxesAsBools: true });
                //                var headers = {};
                //                var token = $('[name="__RequestVerificationToken"]').val();
                //                headers["__RequestVerificationToken"] = token;

                @*$.ajax({
                    type: "POST",
                    url: "/Master/" + '@LoginPostMethod',
                    //                    data: "{'Email': '" + $("#txtUserName").val() + "' ,'Password':'" + $("#txtPassword").val() + "','IsRemember':" + $('#chkRemember').is(':checked') + ",'__RequestVerificationToken' : '" + encodeURIComponent($('[name="__RequestVerificationToken"]').val()) + "'}",
                    data: form,
                    //                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    //                    headers: headers,
                    cache: false,
                    success: function (message) {

                        if (message.Message.toLowerCase() == "fail") {
                            msg = "UserName or Password is invalid";
                            $("#ErrorMSG").html(msg);
                            return false;
                        }
                        else {

                            if (message.HasLicenceAccepted) {
                                $.ajax({
                                    type: "POST",
                                    url: "/Master/CheckPasswordChange",
                                    data: "",
                                    contentType: "application/json; charset=utf-8",
                                    dataType: "json",
                                    success: function (message) {
                                        if (message.Message == "ok") {
                                            window.location = '/Master/ChangePassword';
                                        }
                                        else {
                                            //window.location = '/Master/InventoryAnalysis';
                                            //window.location = '/Master/Dashboard';
                                            //window.location = '/Inventory/ItemMasterList';
                                            window.location = '/Master/RedirectToPage';
                                        }

                                    },
                                    error: function (response) {
                                        // through errror message
                                    }
                                });



                            }
                            else {

                                window.location = '/Master/TermsAndCondition';
                                //window.location = '/Master/_LicencingTermsandConditions';

                            }




                            // window.location = '/Replenish/CartItemList';
                        }
                    },
                    error: function (response) {
                        // through errror message
                    }
                });*@

            }
        }

        function getCookie(name) {
            var arg = name + "=";
            var alen = arg.length;
            var clen = document.cookie.length;
            var i = 0;
            while (i < clen) {
                var j = i + alen;
                if (document.cookie.substring(i, j) == arg) {
                    return getCookieVal(j);
                }
                i = document.cookie.indexOf(" ", i) + 1;
                if (i == 0) break;
            }
            return null;
        }

        function getCookieVal(offset) {
            var endstr = document.cookie.indexOf(";", offset);
            if (endstr == -1) { endstr = document.cookie.length; }
            return unescape(document.cookie.substring(offset, endstr));
        }

        function setCookie(name, value, days) {
            if (typeof days != "undefined") { //if set persistent cookie
                var expireDate = new Date();
                expireDate.setDate(expireDate.getDate() + days);
                document.cookie = name + "=" + value + "; path=/; expires=" + expireDate.toGMTString() + " ;SameSite=Strict;";
            }
            else //else if this is a session only cookie
                document.cookie = name + "=" + value + "; path=/ ;SameSite=Strict;";
        }
        $('#btnForgotPassword').click(function (e) {
            location.href = '@Url.Action("ForgotPassword", "Master")';
        });

    </script>
</body>
</html>
