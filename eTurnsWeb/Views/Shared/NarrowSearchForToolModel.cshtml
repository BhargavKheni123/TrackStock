@model eTurns.DTO.CommonDTO
<div class="leftopenContent" style="display: none;">
    <a class="openBtn" id="ExpandNarrowSearchTM">
        <img src="~/Content/images/open.png" />
    </a>
</div>
@{
    string modelText = string.Empty;
    if (!String.IsNullOrEmpty(Model.Text))
    {
        modelText = Model.Text;
    }
    RouteValueDictionary obj = new RouteValueDictionary();
    obj = ViewContext.Controller.ControllerContext.RouteData.Values;
    string ControllerName = Convert.ToString(obj["controller"]);
    string ActionName = Convert.ToString(obj["action"]);
}
<div class="IteamBlock">
    <a class="closedBtn" id="CollapseNarrowSearchTM">
        <img src="~/Content/images/closed.png" />
    </a>
    <h2>@eTurns.DTO.Resources.ResNarrowSearch.NarrowSearchHeader2</h2>
    @*<h3>@eTurns.DTO.Resources.ResNarrowSearch.NarrowSearchHeader2</h3>*@
    <ul id="NarrowUL">
        @if (Model.PageName == "ToolMaster" || Model.PageName == "ToolAssetORD")
        {
            @*<li>@eTurns.DTO.ResToolCheckInHistory.CheckOutStatus
                    <select id="ToolsStatus" class="selectBox"  onchange="SSNarroSearch(this);">
                        <option value="0"></option>
                        <option value="Check Out">Check Out</option>
                        <option value="Check Out">Check In</option>
                    </select>
                </li>*@
            <li attrsortOrder="1">
                <p class="handle"><img /></p>
                <select id="ToolsCategoryTM" class="showloadmore" data-unique="toolscategorytm" multiple="multiple" name="example-basic" size="5"></select>
                <div class="accordion" id="accordion">
                    <a href='#' class='downarrow'>
                        <img src="~/Content/images/down-arrow.gif" alt="" height="24">
                    </a>
                    <div class='dropcontent' id="ToolsCategoryCollapseTM">
                    </div>
                </div>
            </li>
            <li attrsortOrder="2">
                <p class="handle"><img /></p>
                <div class="stockroom">
                    <div class="editor-field">
                        @eTurns.DTO.ResToolMaster.Cost:
                        <select id="ToolsCostTM" class="selectBox" onchange="CostNarroSearch(this);">
                            <option value="0_-1"></option>
                            <option value="1000_1000">>$1000 </option>
                            <option value="750_999">>$750 to 999 </option>
                            <option value="500_749">>$500 to 749 </option>
                            <option value="250_499">>$250 to 499 </option>
                            <option value="0_249">$0 to 249 </option>
                        </select>
                    </div>
                </div>
            </li>
            <li attrsortOrder="3">
                <p class="handle"><img /></p>
                <select id="ToolCheckoutTM" multiple="multiple" name="example-basic" size="5">
                    <option value="1">Checked out</option>
                    <option value="2">Checked out to Maintenance</option>
                    <option value="3">Group fully checked out</option>
                    <option value="4">None checked out</option>
                </select>
                <div class="accordion" id="accordion">
                    <a href='#' class='downarrow'>
                        <img src="~/Content/images/down-arrow.gif" alt="" height="24">
                    </a>
                    <div class='dropcontent' id="ToolCheckoutCollapseTM">
                    </div>
                </div>

            </li>
            <li attrsortOrder="4">
                <p class="handle"><img /></p>
                <select id="ToolsTechnicianTM" multiple="multiple" name="example-basic" size="5"></select>
                <div class="accordion" id="accordion">
                    <a href='#' class='downarrow'>
                        <img src="~/Content/images/down-arrow.gif" alt="" height="24">
                    </a>
                    <div class='dropcontent' id="ToolsTechnicianCollapseTM">
                    </div>
                </div>
            </li>
             
            <li attrsortOrder="5">
                <p class="handle"><img /></p>
                <select id="ToolsLocationTM" class="showloadmore" data-unique="toolslocationtm" multiple="multiple" name="example-basic" size="5"></select>
                <div class="accordion" id="accordion">
                    <a href='#' class='downarrow'>
                        <img src="~/Content/images/down-arrow.gif" alt="" height="24">
                    </a>
                    <div class='dropcontent' id="ToolsLocationCollapseTM">
                    </div>
                </div>
            </li>
        }
        <li attrsortOrder="101">
            
            <select id="UserCreatedTM" multiple="multiple" name="example-basic" size="5"></select>
            <div class="accordion" id="accordion">
                <a href='#' class='downarrow'>
                    <img src="~/Content/images/down-arrow.gif" alt="" height="24">
                </a>
                <div class='dropcontent' id="UserCreatedCollapseTM">
                </div>
            </div>
        </li>
        <li attrsortOrder="102">
           
            <select id="UserUpdatedTM" multiple="multiple" name="example-basic" size="5"></select>
            <div class="accordion" id="accordion">
                <a href='#' class='downarrow'>
                    <img src="~/Content/images/down-arrow.gif" alt="" height="24">
                </a>
                <div class='dropcontent' id="UserUpdatedCollapseTM">
                </div>
            </div>
        </li>
        <li style="float: left;" attrsortOrder="103">
           
            <div class="dateForm">
                <span class="dateText">@eTurns.DTO.Resources.ResNarrowSearch.DateCreated</span>
                <div style="float: right; margin-top: -24px; cursor: pointer;">
                    <img id="DateCreatedClearIM" src="~/Content/images/XClear.png" alt="@ResNarrowSearch.Clear" />
                </div>
                <div class="divLabel" style="padding-bottom: 4px;">
                    <label for="From" class="labelText">
                        @eTurns.DTO.Resources.ResNarrowSearch.From
                    </label>
                    <input id="DateCFromIM" type="text" value="" name="From" data-val-length-max="20"
                           data-val="true" class="text-box" />
                    <a href="javascript:;" title="" class="datePicker" id="ancDateCFromIM">
                        <img src="~/Content/images/date-picker-icon.png" alt="" title="" />
                    </a>
                </div>
                <div class="divLabel">
                    <label for="To" class="labelText">
                        @eTurns.DTO.Resources.ResNarrowSearch.To
                    </label>
                    <input id="DateCToIM" type="text" value="" name="To" data-val-length-max="20" data-val="true"
                           class="text-box" />
                    <a href="javascript:;" title="" class="datePicker" id="ancDateCToIM">
                        <img src="~/Content/images/date-picker-icon.png" alt="" title="" />
                    </a>
                </div>
            </div>
        </li>
        <li style="float: left;" attrsortOrder="104">
            
            <div class="dateForm">
                <span class="dateText">@eTurns.DTO.Resources.ResNarrowSearch.DateUpdated</span>
                <div style="float: right; margin-top: -24px; cursor: pointer;">
                    <img id="DateUpdatedClearIM" src="~/Content/images/XClear.png" alt="@ResNarrowSearch.Clear" />
                </div>
                <div class="divLabel" style="padding-bottom: 4px;">
                    <label for="From" class="labelText">
                        @eTurns.DTO.Resources.ResNarrowSearch.From
                    </label>
                    <input id="DateUFromIM" type="text" value="" name="From" data-val-length-max="20"
                           data-val="true" class="text-box" />
                    <a href="javascript:;" title="" class="datePicker" id="ancDateUFromIM">
                        <img src="~/Content/images/date-picker-icon.png" alt="" title="" />
                    </a>
                </div>
                <div class="divLabel">
                    <label for="To" class="labelText">
                        @eTurns.DTO.Resources.ResNarrowSearch.To
                    </label>
                    <input id="DateUToIM" type="text" value="" name="To" data-val-length-max="20" data-val="true"
                           class="text-box" />
                    <a href="javascript:;" title="" class="datePicker" id="ancDateUToIM">
                        <img src="~/Content/images/date-picker-icon.png" alt="" title="" />
                    </a>
                </div>
            </div>
        </li>
      @Html.RenderUDFForNarrowSearchForItemModel(Model.PageName, "_Tool","")
        @Html.RenderUDFForNarrowSearchForItemModel(Model.PageName, "_ToolCheckOut","")
    </ul>
    <input id="NarroSearchClearTM" type="button" value="@ResNarrowSearch.Clear" class="CreateBtn" />
    @*<input id="NarroSearchGo" type="button" value="Search" class="CreateBtn" />*@
</div>
<style>
    .IteamBlock li {
        width: 93% !important;
    }

    .handle {
        height: 20px;
        width: 3%;
        vertical-align: middle;
        /*background-image: url("../../Content/images/Drage.png");*/
        cursor: move;
        float: right;
    }

        .handle img {
            height: 20px;
            width: 6%;
            display: block;
            position: absolute;
            background-repeat: no-repeat;
            margin: 0;
            padding: 0;
        }
</style>
<script type="text/javascript">
    //NARROW BY SEARCH
    var UserCreatedBy = '@eTurns.DTO.Resources.ResNarrowSearch.UserCreatedby';
    var UserUpdatedby = '@eTurns.DTO.Resources.ResNarrowSearch.UserUpdatedby';
    var UpdatedBy = '@eTurns.DTO.Resources.ResNarrowSearch.Updatedby';
    var CreatedBy = '@eTurns.DTO.Resources.ResNarrowSearch.Createdby';
    var selected = '@eTurns.DTO.Resources.ResNarrowSearch.selected';


    var Manufacturer = '@eTurns.DTO.Resources.ResNarrowSearch.Manufacturer';
    var Supplier = '@eTurns.DTO.Resources.ResNarrowSearch.Supplier';
    var Category = '@eTurns.DTO.Resources.ResNarrowSearch.Category';
    var ItemType = '@eTurns.DTO.Resources.ResNarrowSearch.ItemType';

    var StageHeaderLocation = '@eTurns.DTO.ResMaterialStagingDetail.MaterialStagingDetailHeader';
    var StageLocation = '@eTurns.DTO.ResMaterialStagingDetail.StagingBinName';
    var ToolsCategory = '@eTurns.DTO.Resources.ResNarrowSearch.ToolsCategory';
    var TechnicianList = '@eTurns.DTO.Resources.ResNarrowSearch.Technician';
    var ToolsMaintenance = '@eTurns.DTO.Resources.ResNarrowSearch.ToolsMaintenance';
    var ToolsLocation = '@eTurns.DTO.Resources.ResNarrowSearch.ToolsLocation';

    //GetNarroHTML('UserMaster', 'UserName', 1, 1);
    var ICLNarroValues = "";

    //$(document).ready(function () {
    //    CallNarrowfunctionsIM();
    //});

    function CallNarrowfunctionsIM() {
        var _IsArchived = false;
        var _IsDeleted = false;

        if (typeof ($('#IsArchivedRecords')) != undefined)
            _IsArchived = $('#IsArchivedRecords').is(':checked');

        if (typeof ($('#IsDeletedRecords')) != undefined)
            _IsDeleted = $('#IsDeletedRecords').is(':checked');

        GetNarrowDDDataIM('@Model.PageName', '@eTurnsWeb.Helper.SessionHelper.CompanyID', '@eTurnsWeb.Helper.SessionHelper.RoomID', _IsArchived, _IsDeleted, '@Model.ControlID');
        GetNarroHTMLForUDFIM('@Model.PageName', '@eTurnsWeb.Helper.SessionHelper.CompanyID', '@eTurnsWeb.Helper.SessionHelper.RoomID', _IsArchived, _IsDeleted);

        if (_IsDeleted || _IsArchived) {
            $('#deleteRows').attr("style", "display:none");
            AllowDeletePopup = false;
        }
        else {
            $('#deleteRows').attr("style", "display:''");
            AllowDeletePopup = true;
        }

        //$(".tab5").hide();

    }

    $('#NarroSearchGo').click(function () {
        DoNarrowSearchTM();
    });

    $('#DateCFromIM,#DateCToIM').change(function () {

        var DateCFromValidIM = true;//Date.isValid($('#DateCFromIM').val(),format);
        var DateCToValidIM = true;//Date.isValid($('#DateCToIM').val(),format);
        try {
            $.datepicker.parseDate(RoomDateJSFormat, $('#DateCFromIM').val());
            DateCFromValidIM = true;
        } catch (e) {
            DateCFromValidIM = false;
        }

        try {
            $.datepicker.parseDate(RoomDateJSFormat, $('#DateCToIM').val());
            DateCToValidIM = true;
        } catch (e) {
            DateCToValidIM = false;
        }
        if (DateCFromValidIM && DateCToValidIM) {
            // $("#ItemModel_filter").val('');
            DoNarrowSearchTM();
        }
        else {
            if (!DateCFromValidIM)
                $('#DateCFromIM').val('');
            if (!DateCToValidIM)
                $('#DateCToIM').val('');
        }
    });

    $('#DateUFromIM,#DateUToIM').change(function () {

        var DateUFromValidIM = true;//Date.isValid($('#DateUFromIM').val(),format);
        var DateUToValidIM = true;//Date.isValid($('#DateUToIM').val(),format);
        try {
            $.datepicker.parseDate(RoomDateJSFormat, $('#DateUFromIM').val());
            DateUFromValidIM = true;
        } catch (e) {
            DateUFromValidIM = false;
        }

        try {
            $.datepicker.parseDate(RoomDateJSFormat, $('#DateUToIM').val());
            DateUToValidIM = true;
        } catch (e) {
            DateUToValidIM = false;
        }
        if (DateUFromValidIM && DateUToValidIM) {
            //  $("#ItemModel_filter").val('');
            DoNarrowSearchTM();
        }
        else {
            if (!DateUFromValidIM)
                $('#DateUFromIM').val('');
            if (!DateUToValidIM)
                $('#DateUToIM').val('');
        }
    });

    //CLEAR NARROW SEARCH
    $('#NarroSearchClearTM').click(function () {

        if ($('#DateCFromIM').val() != '') $('#DateCFromIM').val('');
        if ($('#DateCToIM').val() != '') $('#DateCToIM').val('');
        if ($('#DateUFromIM').val() != '') $('#DateUFromIM').val('');
        if ($('#DateUToIM').val() != '') $('#DateUToIM').val('');

        if (typeof ($("#UserCreatedTM").multiselect("getChecked").length) != undefined && $("#UserCreatedTM").multiselect("getChecked").length > 0) {
            $("#UserCreatedTM").multiselect("uncheckAll");
            $("#UserCreatedCollapseTM").html('');
        }

        if (typeof ($("#UserUpdatedTM").multiselect("getChecked").length) != undefined && $("#UserUpdatedTM").multiselect("getChecked").length > 0) {
            $("#UserUpdatedTM").multiselect("uncheckAll");
            $("#UserUpdatedCollapseTM").html('');
        }

        $("select[name='udflist_Tool']").each(function (index) {
            if (typeof ($(this).multiselect("getChecked").length) != undefined && $(this).multiselect("getChecked").length > 0) {
                var UDFUniqueID = this.getAttribute('UID');
                $(this).multiselect("uncheckAll");
                $('#' + UDFUniqueID + 'Collapse_Tool').html('');
            }
        });
        $("select[name='udflist_ToolCheckOut']").each(function (index) {
            if (typeof ($(this).multiselect("getChecked").length) != undefined && $(this).multiselect("getChecked").length > 0) {
                var UDFUniqueID = this.getAttribute('UID');
                $(this).multiselect("uncheckAll");
                $('#' + UDFUniqueID + 'Collapse_Tool').html('');
            }
        });
        if (typeof ($("#PullSupplierTM").multiselect("getChecked").length) != undefined && $("#PullSupplierTM").multiselect("getChecked").length > 0) {
            $("#PullSupplierTM").multiselect("uncheckAll");
            $("#PullSupplierCollapseTM").html('');
        }

        if (typeof ($("#StageLocationHeaderTM").multiselect("getChecked").length) != undefined && $("#StageLocationHeaderTM").multiselect("getChecked").length > 0) {
            $("#StageLocationHeaderTM").multiselect("uncheckAll");
            $("#StageLocationHeaderCollapseTM").html('');
            IsStagingLocationOnly = false;
        }

        if (typeof ($("#StageLocationTM").multiselect("getChecked").length) != undefined && $("#StageLocationTM").multiselect("getChecked").length > 0) {
            $("#StageLocationTM").multiselect("uncheckAll");
            $("#StageLocationCollapseTM").html('');
            IsStagingLocationOnly = false;
        }

        if (typeof ($("#ManufacturerTM").multiselect("getChecked").length) != undefined && $("#ManufacturerTM").multiselect("getChecked").length > 0) {
            $("#ManufacturerTM").multiselect("uncheckAll");
            $("#ManufacturerCollapseTM").html('');
        }

        if (typeof ($("#PullCategoryTM").multiselect("getChecked").length) != undefined && $("#PullCategoryTM").multiselect("getChecked").length > 0) {
            $("#PullCategoryTM").multiselect("uncheckAll");
            $("#PullCategoryCollapseTM").html('');
        }
        if (typeof ($("#ItemLocationsIC").multiselect("getChecked").length) != undefined && $("#ItemLocationsIC").multiselect("getChecked").length > 0) {
            $("#ItemLocationsIC").multiselect("uncheckAll");
            $("#ItemLocationsICCollapseTM").html('');
        }

        if ($('#PullCost') != undefined) {
            $('#PullCost').val('0_-1');
        }

        if ($('#StockStatus') != undefined) {
            $('#StockStatus').val('0');
        }

        if (typeof ($("#ItemTypeTM").multiselect("getChecked").length) != undefined && $("#ItemTypeTM").multiselect("getChecked").length > 0) {
            $("#ItemTypeTM").multiselect("uncheckAll");
            $("#ItemTypeCollapseTM").html('');
        }

        if (typeof ($("#ToolsCategoryTM").multiselect("getChecked").length) != undefined && $("#ToolsCategoryTM").multiselect("getChecked").length > 0) {
            $("#ToolsCategoryTM").multiselect("uncheckAll");
            $("#ToolsCategoryCollapseTM").html('');
        }
        if (typeof ($("#ToolCheckoutTM").multiselect("getChecked").length) != undefined && $("#ToolCheckoutTM").multiselect("getChecked").length > 0) {
            $("#ToolCheckoutTM").multiselect("uncheckAll");
            $("#ToolCheckoutCollapseTM").html('');
        }
        if (typeof ($("#ToolsTechnicianTM").multiselect("getChecked").length) != undefined && $("#ToolsTechnicianTM").multiselect("getChecked").length > 0) {
            $("#ToolsTechnicianTM").multiselect("uncheckAll");
            $("#ToolsTechnicianCollapseTM").html('');
        }
        if (typeof ($("#ToolsLocationTM").multiselect("getChecked").length) != undefined && $("#ToolsLocationTM").multiselect("getChecked").length > 0) {
            $("#ToolsLocationTM").multiselect("uncheckAll");
            $("#ToolsLocationCollapseTM").html('');
        }
        ////////////////////////////////////////////

        $('input[type="search"]').val('').trigger('keyup');

        if ($('#ItemModel_filter').val() != '') $('#ItemModel_filter').val('');
        //
        if ($('#Cart_ItemModel_filter').val() != '') $('#Cart_ItemModel_filter').val('');

        var searchText = '';
        if ($('input#ItemModel_filter').length > 0) {
            searchText = $('input#ItemModel_filter').val();
        }
        //NarrowSearchInGridIM(searchText);
        if ($('#ToolModeDataTablePopup').length > 0) {
            $('#ToolModeDataTablePopup').dataTable().fnFilter(searchText, null, null, null)
        }
        else if ($('#ToolModeDataTable').length > 0) {
            $('input#searchInAllTools').val("");
            $('#ToolModeDataTable').dataTable().fnFilter("", null, null, null);
            $('#ToolModeDataTable td').removeHighlight();
        }
    });

    //CREATE DATE PICKER

    $('#DateCFromIM').blur(function () {
    }).datepicker({
        changeMonth: true,
        changeYear: true, dateFormat: RoomDateJSFormat
    });
    $('#DateCToIM').blur(function () {
    }).datepicker({
        changeMonth: true,
        changeYear: true, dateFormat: RoomDateJSFormat
    });
    $('#DateUFromIM').blur(function () {
    }).datepicker({
        changeMonth: true,
        changeYear: true, dateFormat: RoomDateJSFormat
    });
    $('#DateUToIM').blur(function () {
    }).datepicker({
        changeMonth: true,
        changeYear: true, dateFormat: RoomDateJSFormat
    });


    $('#ancDateCFromIM').click(function () {
        $('#DateCFromIM').focus();
    });
    $('#ancDateCToIM').click(function () {
        $('#DateCToIM').focus();
    });
    $('#ancDateUFromIM').click(function () {
        $('#DateUFromIM').focus();
    });
    $('#ancDateUToIM').click(function () {
        $('#DateUToIM').focus();
    });


    $('#DateCreatedClearIM').click(function () {
        if ($('#DateCFromIM').val() != '' || $('#DateCToIM').val() != '') {
            $('#DateCFromIM').val('');
            $('#DateCToIM').val('');
            //NarrowSearchInGrid('');
            DoNarrowSearchTM();
        }
    });
    $('#DateUpdatedClearIM').click(function () {
        if ($('#DateUFromIM').val() != '' || $('#DateUToIM').val() != '') {
            $('#DateUFromIM').val('');
            $('#DateUToIM').val('');
            //NarrowSearchInGrid('');
            DoNarrowSearchTM();
        }
    });



    function SSNarroSearch(SSDDLObject) {

        //oTable.fnFilter($(CostDDLObject).val(),null,null,null);
        if ($(SSDDLObject).val() != "0") {
            SSNarroSearchValue = $(SSDDLObject).val();
            DoNarrowSearchTM();
        }
        else {
            SSNarroSearchValue = '';
            DoNarrowSearchTM();
        }
    }
    function SSNarroSearchAvgUsage(SSDDLObject) {

        //oTable.fnFilter($(CostDDLObject).val(),null,null,null);
        if ($(SSDDLObject).val() != "0_-1") {
            AvgUsageNarroSearchValue = $(SSDDLObject).val();
            DoNarrowSearchTM();
        }
        else {
            AvgUsageNarroSearchValue = '';
            DoNarrowSearchTM();
        }
    }
    function SSNarroSearchTurns(SSDDLObject) {

        //oTable.fnFilter($(CostDDLObject).val(),null,null,null);
        if ($(SSDDLObject).val() != "0_-1") {
            TurnsNarroSearchValue = $(SSDDLObject).val();
            DoNarrowSearchTM();
        }
        else {
            TurnsNarroSearchValue = '';
            DoNarrowSearchTM();
        }
    }

    function CostNarroSearchIM(CostDDLObject) {
        //oTable.fnFilter($(CostDDLObject).val(),null,null,null);
        if ($(CostDDLObject).val() != "0_-1") {
            CostNarroSearchValue = $(CostDDLObject).val();
            DoNarrowSearchTM();
        }
        else {
            CostNarroSearchValue = '';
            DoNarrowSearchTM();
        }
    }

    function GetNarrowHTMLForUserType() {

        $.ajax({
            'url': '/Master/GetNarrowDDData',
            data: { TableName: '@Model.PageName', TextFieldName: 'UserType', IsArchived: false, IsDeleted: false },
            success: function (response) {
                var s = '';
                $.each(response.DDData, function (ValData, ValCount) {
                    var ArrData = ValData.toString().split('[###]');
                    s += '<option value="' + ArrData[1] + '">' + ArrData[0] + ' (' + ValCount + ')' + '</option>';
                });

                //Destroy widgets before reapplying the filter
                $("#UserType").empty();
                $("#UserType").multiselect('destroy');
                $("#UserType").multiselectfilter('destroy');

                $("#UserType").append(s);
                $("#UserType").multiselect
                (
                    {
                        noneSelectedText: 'User type', selectedList: 5,
                        selectedText: function (numChecked, numTotal, checkedItems) {
                            return 'User type ' + numChecked + ' ' + selected;
                        }
                    },
                    {
                        checkAll: function (ui) {
                            $("#UserTypeCollapse").html('');
                            for (var i = 0; i <= ui.target.length - 1; i++) {
                                if ($("#UserTypeCollapse").text().indexOf(ui.target[i].text) == -1) {
                                    $("#UserTypeCollapse").append("<span>" + ui.target[i].text + "</span>");
                                }
                            }
                            $("#UserTypeCollapse").show();
                        }
                    }
                )
                .bind("multiselectclick multiselectcheckall multiselectuncheckall", function (event, ui) {
                    if (ui.checked) {
                        if ($("#UserTypeCollapse").text().indexOf(ui.text) == -1) {
                            $("#UserTypeCollapse").append("<span>" + ui.text + "</span>");
                        }
                    }
                    else {
                        if (ui.checked == undefined) {
                            $("#UserTypeCollapse").html('');
                        }
                        else if (!ui.checked) {
                            var text = $("#UserTypeCollapse").html();
                            text = text.replace("<span>" + ui.text + "</span>", '');
                            $("#UserTypeCollapse").html(text);
                        }
                        else
                            $("#UserTypeCollapse").html('');
                    }
                    UserTypeNarroValues = $.map($(this).multiselect("getChecked"), function (input) {

                        return input.value;
                    })

                    if ($("#UserTypeCollapse").text().trim() != '')
                        $("#UserTypeCollapse").show();
                    else
                        $("#UserTypeCollapse").hide();


                    if ($("#UserTypeCollapse").find('span').length <= 2) {
                        $("#UserTypeCollapse").scrollTop(0).height(50);
                    }
                    else {
                        $("#UserTypeCollapse").scrollTop(0).height(100);
                    }
                    clearGlobalIfNotInFocus();
                    DoNarrowSearchTM();
                }).multiselectfilter();
            },
            error: function (response) {
                // through errror message
            }
        });
    }
    /* Narrow Search For Item Type Filter START */
    function GetNarroHTMLForItemTypeIM() {
        var CurTab = '';
        var ModelTextTemp = '@Model.Text';
        if (ModelTextTemp == null)
            ModelTextTemp = "eTurns";

        var qlType = '1';
        if (gblActionName.toLowerCase() === "assetlist" || gblActionName.toLowerCase() === "toollist") {
            qlType = '2';
        }
        else if (gblActionName.toLowerCase() == "inventorycountlist") {
            qlType = '3';
        }

        var ItemCallFrom = '';
        if ('@Model.ItemModelCallFromPageName' == 'NewPULL') {
            ItemCallFrom = 'newpull';
        }
        else {
            ItemCallFrom = '@Model.ControlID';
        }

        if ('@Model.PageName' == 'ToolMaster') {
            CurTab = 'ToolList';
        }
        

        $.ajax({
            'url': '/Master/GetNarrowDDDataIMItemType',
            data: { TableName: '@Model.PageName', TextFieldName: 'ItemType', IsArchived: false, IsDeleted: false, RequisitionCurrentTab:CurTab, QLType: qlType, ParentID: '@Model.ID', ItemModelCallFrom: ItemCallFrom },
            success: function (response) {
                var s = '';

                if (response.DDData != null) {
                    $.each(response.DDData, function (i, val) {
                        if (i == "1")
                            s += '<option value="' + i + '"> Item (' + val + ')' + '</option>';

                        //if (i == "2" && gblActionName.toLowerCase() != "cartitemlist")
                        //if (i == "2" && '@Model.ControlID' !== 'MOVEMTR' && '@Model.ControlID' == 'transferlist')
                        //if (i == "2" && '@Model.ControlID' !== 'MOVEMTR' && '@Model.ControlID' != 'TRF' && val > 0)
                        if (i == "2" && '@Model.ControlID' !== 'MOVEMTR' && val > 0)
                            s += '<option value="' + i + '"> Quick List (' + val + ')' + '</option>';

                        if (i == "3") {
                            if (ModelTextTemp != "Kit")
                                s += '<option value="' + i + '"> Kit (' + val + ')' + '</option>';
                        }
                        if (i == "4" && '@Model.ControlID' !== 'MOVEMTR' && gblActionName.toLowerCase() != "orderlist" && gblActionName.toLowerCase() != "cartitemlist")
                            s += '<option value="' + i + '"> Labor (' + val + ')' + '</option>';
                    });
                }
                $("#ItemTypeTM").append(s);
                $("#ItemTypeTM").multiselect
                (
                {
                    noneSelectedText: ItemType, selectedList: 5,
                    selectedText: function (numChecked, numTotal, checkedItems) {
                        return ItemType + ' ' + numChecked + ' ' + selected;
                    }
                },
                {
                    checkAll: function (ui) {
                        $("#ItemTypeCollapseTM").html('');
                        for (var i = 0; i <= ui.target.length - 1; i++) {
                            if ($("#ItemTypeCollapseTM").text().indexOf(ui.target[i].text) == -1) {
                                $("#ItemTypeCollapseTM").append("<span>" + ui.target[i].text + "</span>");
                            }
                        }
                        $("#ItemTypeCollapseTM").show();
                    }
                }
            )
            .bind("multiselectclick multiselectcheckall multiselectuncheckall", function (event, ui) {
                if (ui.checked) {
                    if ($("#ItemTypeCollapseTM").text().indexOf(ui.text) == -1) {
                        $("#ItemTypeCollapseTM").append("<span>" + ui.text + "</span>");
                    }
                }
                else {
                    if (ui.checked == undefined) {
                        $("#ItemTypeCollapseTM").html('');
                    }
                    else if (!ui.checked) {
                        var text = $("#ItemTypeCollapseTM").html();
                        text = text.replace("<span>" + ui.text + "</span>", '');
                        $("#ItemTypeCollapseTM").html(text);
                    }
                    else
                        $("#ItemTypeCollapseTM").html('');
                }
                ItemTypeNarroSearchValue = $.map($(this).multiselect("getChecked"), function (input) {
                    return input.value;
                })

                if ($("#ItemTypeCollapseTM").text().trim() != '')
                    $("#ItemTypeCollapseTM").show();
                else
                    $("#ItemTypeCollapseTM").hide();


                if ($("#ItemTypeCollapseTM").find('span').length <= 2) {
                    $("#ItemTypeCollapseTM").scrollTop(0).height(50);
                }
                else {
                    $("#ItemTypeCollapseTM").scrollTop(0).height(100);
                }
                // clearGlobalIfNotInFocus();
                DoNarrowSearchTM();
            }).multiselectfilter();
            },
            error: function (response) {
                // through errror message
            }
        });




        $("#ItemTypeTM").multiselect


    }


    function GetItemLocationsForCount(ShowStagLocs, ShowLabourItems) {

        if (ShowLabourItems == null || ShowLabourItems == undefined)
            ShowLabourItems = true;

        var ItemCallFrom = '';
        if ('@Model.ItemModelCallFromPageName' == 'NewPULL') {
            ItemCallFrom = 'newpull';
        }
        else {
            ItemCallFrom = '@Model.ControlID';
        }

        $.ajax({
            'url': '/Master/GetLocationsinItemMaster',
            data: { ShowStagLocs: ShowStagLocs, ShowLabourItems: ShowLabourItems, "ItemModelCallFrom": ItemCallFrom, ParentID: '@Model.ID' },
            success: function (response) {

                var s = '';
                $.each(response, function (ValData, ValCount) {
                    var ArrData = ValData.toString().split('[###]');
                    s += '<option value="' + ArrData[1] + '">' + ArrData[0] + ' (' + ValCount + ')' + '</option>';
                });


                //Destroy widgets before reapplying the filter
                $("#ItemLocationsIC").empty();
                $("#ItemLocationsIC").multiselect('destroy');
                $("#ItemLocationsIC").multiselectfilter('destroy');

                $("#ItemLocationsIC").append(s);
                $("#ItemLocationsIC").multiselect
            (
                {
                    noneSelectedText: 'Location', selectedList: 5,
                    selectedText: function (numChecked, numTotal, checkedItems) {
                        return 'Location ' + numChecked + ' ' + selected;
                    }
                },
                {
                    checkAll: function (ui) {
                        $("#ItemLocationsICCollapseTM").html('');
                        for (var i = 0; i <= ui.target.length - 1; i++) {
                            if ($("#ItemLocationsICCollapseTM").text().indexOf(ui.target[i].text) == -1) {
                                $("#ItemLocationsICCollapseTM").append("<span>" + ui.target[i].text + "</span>");
                            }
                        }
                        $("#ItemLocationsICCollapseTM").show();
                    }
                }
            )
            .bind("multiselectclick multiselectcheckall multiselectuncheckall", function (event, ui) {
                if (ui.checked) {
                    if ($("#ItemLocationsICCollapseTM").text().indexOf(ui.text) == -1) {
                        $("#ItemLocationsICCollapseTM").append("<span>" + ui.text + "</span>");
                    }
                }
                else {
                    if (ui.checked == undefined) {
                        $("#ItemLocationsICCollapseTM").html('');
                    }
                    else if (!ui.checked) {
                        var text = $("#ItemLocationsICCollapseTM").html();
                        text = text.replace("<span>" + ui.text + "</span>", '');
                        $("#ItemLocationsICCollapseTM").html(text);
                    }
                    else
                        $("#ItemLocationsICCollapseTM").html('');
                }
                ICLNarroValues = $.map($(this).multiselect("getChecked"), function (input) {
                    return input.value;
                })

                if ($("#ItemLocationsICCollapseTM").text().trim() != '')
                    $("#ItemLocationsICCollapseTM").show();
                else
                    $("#ItemLocationsICCollapseTM").hide();


                if ($("#ItemLocationsICCollapseTM").find('span').length <= 2) {
                    $("#ItemLocationsICCollapseTM").scrollTop(0).height(50);
                }
                else {
                    $("#PullSupplierCollapseTM").scrollTop(0).height(100);
                }
                //clearGlobalIMIfNotInFocus();
                DoNarrowSearchTM();
            }).multiselectfilter();
            },
            error: function (response) {

                // through errror message
            }
        });
    }
    /* Narrow Search For Item Type Filter END */


    function GetPullNarrowSearchDataIM(_TableName, _IsArchived, _IsDeleted) {
        var ItemCallFrom = '';
        if ('@Model.ItemModelCallFromPageName' == 'NewPULL') {
            ItemCallFrom = 'newpull';
        }
        else {
            ItemCallFrom = '@Model.ControlID';
        }

        $.ajax({
            'url': '/Master/GetNarrowDDData',
            data: { TableName: _TableName, TextFieldName: 'StageLocationHeader', IsArchived: _IsArchived, IsDeleted: _IsDeleted, "ItemModelCallFrom": ItemCallFrom, ParentID: '@Model.ID' },
            success: function (response) {
                var s = '';
                $.each(response.DDData, function (ValData, ValCount) {
                    var ArrData = ValData.toString().split('[###]');
                    s += '<option value="' + ArrData[1] + '">' + ArrData[0] + ' (' + ValCount + ')' + '</option>';
                });


                //Destroy widgets before reapplying the filter
                $("#StageLocationHeaderTM").empty();
                $("#StageLocationHeaderTM").multiselect('destroy');
                $("#StageLocationHeaderTM").multiselectfilter('destroy');

                $("#StageLocationHeaderTM").append(s);
                $("#StageLocationHeaderTM").multiselect
            (
                {
                    noneSelectedText: StageHeaderLocation, selectedList: 5,
                    selectedText: function (numChecked, numTotal, checkedItems) {
                        return StageHeaderLocation + ' ' + numChecked + ' ' + selected;
                    }
                },
                {
                    checkAll: function (ui) {
                        $("#StageLocationHeaderCollapseTM").html('');
                        for (var i = 0; i <= ui.target.length - 1; i++) {
                            if ($("#StageLocationHeaderCollapseTM").text().indexOf(ui.target[i].text) == -1) {
                                $("#StageLocationHeaderCollapseTM").append("<span>" + ui.target[i].text + "</span>");
                            }
                        }
                        $("#StageLocationHeaderCollapseTM").show();
                    }
                }
            )
            .bind("multiselectclick multiselectcheckall multiselectuncheckall", function (event, ui) {
                if (ui.checked) {
                    if ($("#StageLocationHeaderCollapseTM").text().indexOf(ui.text) == -1) {
                        $("#StageLocationHeaderCollapseTM").append("<span>" + ui.text + "</span>");
                    }
                }
                else {
                    if (ui.checked == undefined) {
                        $("#StageLocationHeaderCollapseTM").html('');
                    }
                    else if (!ui.checked) {
                        var text = $("#StageLocationHeaderCollapseTM").html();
                        text = text.replace("<span>" + ui.text + "</span>", '');
                        $("#StageLocationHeaderCollapseTM").html(text);
                    }
                    else
                        $("#StageLocationHeaderCollapseTM").html('');

                    IsStagingLocationOnly = false;
                }
                StageLocationHeaderNarroValues = $.map($(this).multiselect("getChecked"), function (input) {
                    return input.value;
                })

                if ($("#StageLocationHeaderCollapseTM").text().trim() != '')
                    $("#StageLocationHeaderCollapseTM").show();
                else
                    $("#StageLocationHeaderCollapseTM").hide();


                if ($("#StageLocationHeaderCollapseTM").find('span').length <= 2) {
                    $("#StageLocationHeaderCollapseTM").scrollTop(0).height(50);
                }
                else {
                    $("#StageLocationHeaderCollapseTM").scrollTop(0).height(100);
                }
                //clearGlobalIMIfNotInFocus();
                DoNarrowSearchTM();
            }).multiselectfilter();
            },
            error: function (response) {
                // through errror message
            }
        });

        $.ajax({
            'url': '/Master/GetNarrowDDData',
            data: { TableName: _TableName, TextFieldName: 'StageLocation', IsArchived: _IsArchived, IsDeleted: _IsDeleted, "ItemModelCallFrom": ItemCallFrom, ParentID: '@Model.ID' },
            success: function (response) {
                var s = '';
                $.each(response.DDData, function (ValData, ValCount) {
                    var ArrData = ValData.toString().split('[###]');
                    s += '<option value="' + ArrData[1] + '">' + ArrData[0] + ' (' + ValCount + ')' + '</option>';
                });


                //Destroy widgets before reapplying the filter
                $("#StageLocationTM").empty();
                $("#StageLocationTM").multiselect('destroy');
                $("#StageLocationTM").multiselectfilter('destroy');

                $("#StageLocationTM").append(s);
                $("#StageLocationTM").multiselect
            (
                {
                    noneSelectedText: StageLocation, selectedList: 5,
                    selectedText: function (numChecked, numTotal, checkedItems) {
                        return StageLocation + ' ' + numChecked + ' ' + selected;
                    }
                },
                {
                    checkAll: function (ui) {
                        $("#StageLocationCollapseTM").html('');
                        for (var i = 0; i <= ui.target.length - 1; i++) {
                            if ($("#StageLocationCollapseTM").text().indexOf(ui.target[i].text) == -1) {
                                $("#StageLocationCollapseTM").append("<span>" + ui.target[i].text + "</span>");
                            }
                        }
                        $("#StageLocationCollapseTM").show();
                    }
                }
            )
            .bind("multiselectclick multiselectcheckall multiselectuncheckall", function (event, ui) {
                if (ui.checked) {
                    if ($("#StageLocationCollapseTM").text().indexOf(ui.text) == -1) {
                        $("#StageLocationCollapseTM").append("<span>" + ui.text + "</span>");
                    }
                }
                else {
                    if (ui.checked == undefined) {
                        $("#StageLocationCollapseTM").html('');
                    }
                    else if (!ui.checked) {
                        var text = $("#StageLocationCollapseTM").html();
                        text = text.replace("<span>" + ui.text + "</span>", '');
                        $("#StageLocationCollapseTM").html(text);
                    }
                    else
                        $("#StageLocationCollapseTM").html('');

                    IsStagingLocationOnly = false;
                }
                StageLocationNarroValues = $.map($(this).multiselect("getChecked"), function (input) {
                    return input.value;
                })

                if ($("#StageLocationCollapseTM").text().trim() != '')
                    $("#StageLocationCollapseTM").show();
                else
                    $("#StageLocationCollapseTM").hide();


                if ($("#StageLocationCollapseTM").find('span').length <= 2) {
                    $("#StageLocationCollapseTM").scrollTop(0).height(50);
                }
                else {
                    $("#StageLocationCollapseTM").scrollTop(0).height(100);
                }
                //clearGlobalIMIfNotInFocus();
                DoNarrowSearchTM();
            }).multiselectfilter();
            },
            error: function (response) {
                // through errror message
            }
        });


    }


    function GetNarrowDDDataIM_Common(_TableName, _IsArchived, _IsDeleted) {

        var ItemCallFrom = '';
        var CurTab = '';
        if ('@Model.ItemModelCallFromPageName' == 'NewPULL') {
            ItemCallFrom = 'newpull';
        }
        else if ('@Model.ItemModelCallFromPageName' == 'NewCART') {
            ItemCallFrom = 'newcart';
        }
       else if ('@Model.ItemModelCallFromPageName' == 'Kit') {
            ItemCallFrom = 'newpull';
        }
        else {
            ItemCallFrom = '@Model.ControlID';
        }
        var Table = 'ToolAssetOrder';
        if (_TableName != 'ToolAssetORD') {
            Table = 'ToolMaster';
        }
        if (Table == 'ToolMaster') {
            CurTab = 'ToolList';
        }
        

         $.ajax({
            'url': '/Master/GetNarrowDDData',
            data: { TableName: Table, TextFieldName: 'ToolCategory', IsArchived: _IsArchived, IsDeleted: _IsDeleted, RequisitionCurrentTab: CurTab, ParentID: '@Model.ID' },
            success: function (response) {
            var s = '';
            $.each(response.DDData, function (ValData, ValCount) {
                var ArrData = ValData.toString().split('[###]');
                s += '<option value="' + ArrData[1] + '">' + ArrData[0] + ' (' + ValCount + ')' + '</option>';
            });
            //Destroy widgets before reapplying the filter
            $("#ToolsCategoryTM").empty();
            $("#ToolsCategoryTM").multiselect('destroy');
            $("#ToolsCategoryTM").multiselectfilter('destroy');

                $("#ToolsCategoryTM").append(s);

                var currentDataCount = $('select#ToolsCategoryTM option').length;
                if (parseInt(currentDataCount) < parseInt(loadNarrowSearchDataCount)) {
                    $(".alltoolscategorytm").hide();
                    $(".moretoolscategorytm").hide();
                }

                $("#ToolsCategoryTM").multiselect(
                    {
                        noneSelectedText: ToolsCategory, selectedList: 5,
                        selectedText: function (numChecked, numTotal, checkedItems) {
                            return ToolsCategory + ': ' + numChecked + ' ' + selected;
                        }
                    },
                    {
                        checkAll: function (ui) {
                            $("#ToolsCategoryCollapseTM").html('');
                            for (var i = 0; i <= ui.target.length - 1; i++) {
                                if ($("#ToolsCategoryCollapseTM").text().indexOf(ui.target[i].text) == -1) {
                                    $("#ToolsCategoryCollapseTM").append("<span>" + ui.target[i].text + "</span>");
                                }
                            }
                            $("#ToolsCategoryCollapseTM").show();
                        }
                    }
                )
                    .unbind("multiselectclick multiselectcheckall multiselectuncheckall multiselectloadmore multiselectloadall")
                    .bind("multiselectclick multiselectcheckall multiselectuncheckall multiselectloadmore multiselectloadall", function (event, ui) {
                        if (event.type == 'multiselectloadmore' || event.type == 'multiselectloadall') {
                            var currentDataCount = $('select#ToolsCategoryTM option').length;
                            var _selectedSP = $.map($(this).multiselect("getChecked"), function (input) {
                                return input.value;
                            });

                            var _loaddataCount = parseInt(currentDataCount) + parseInt(loadNarrowSearchDataCount);
                            if (event.type == 'multiselectloadall') {
                                _loaddataCount = -1;
                                $(".alltoolscategorytm").hide();
                                $(".moretoolscategorytm").hide();
                            }
                            $.ajax({
                                'url': '/Master/GetNarrowDDData',
                                data: { TableName: Table, TextFieldName: 'ToolCategory', IsArchived: _IsArchived, IsDeleted: _IsDeleted, RequisitionCurrentTab: CurTab, ParentID: '@Model.ID' },
                                success: function (response) {
                                    var s = '';
                                    $.each(response.DDData, function (ValData, ValCount) {

                                        var ArrData = ValData.toString().split('[###]');
                                        if ($.inArray(ArrData[1], _selectedSP) > -1) {
                                            s += '<option selected="selected" value="' + ArrData[1] + '">' + ArrData[0] + ' (' + ValCount + ')' + '</option>';
                                        }
                                        else {
                                            s += '<option value="' + ArrData[1] + '">' + ArrData[0] + ' (' + ValCount + ')' + '</option>';
                                        }
                                    });

                                    //Destroy widgets before reapplying the filter
                                    $("#ToolsCategoryTM").empty();
                                    $("#ToolsCategoryTM").append(s);
                                    $("#ToolsCategoryTM").multiselect("refresh");
                                    $("#ToolsCategoryTM").multiselectfilter("refresh");

                                    var currentNewDataCount = $('select#ToolsCategoryTM option').length;

                                    if (parseInt(currentDataCount) >= parseInt(currentNewDataCount)) {
                                        $(".alltoolscategorytm").hide();
                                        $(".moretoolscategorytm").hide();
                                    }
                                },
                                error: function (response) {
                                    // through errror message
                                }
                            });

                        }
                        else {
                            if (ui.checked) {
                                if ($("#ToolsCategoryCollapseTM").text().indexOf(ui.text) == -1) {
                                    $("#ToolsCategoryCollapseTM").append("<span>" + ui.text + "</span>");
                                }
                            }
                            else {
                                if (ui.checked == undefined) {
                                    $("#ToolsCategoryCollapseTM").html('');
                                }
                                else if (!ui.checked) {
                                    var text = $("#ToolsCategoryCollapseTM").html();
                                    text = text.replace("<span>" + ui.text + "</span>", '');
                                    $("#ToolsCategoryCollapseTM").html(text);
                                }
                                else
                                    $("#ToolsCategoryCollapse").html('');
                            }
                        }
                        ToolCategoryValue = $.map($(this).multiselect("getChecked"), function (input) {
                            return input.value;
                        })

                        if ($("#ToolsCategoryCollapseTM").text().trim() != '')
                            $("#ToolsCategoryCollapseTM").show();
                        else
                            $("#ToolsCategoryCollapseTM").hide();


                        if ($("#ToolsCategoryCollapseTM").find('span').length <= 2) {
                            $("#ToolsCategoryCollapseTM").scrollTop(0).height(50);
                        }
                        else {
                            $("#ToolsCategoryCollapseTM").scrollTop(0).height(100);
                        }
                        if (event.type != 'multiselectloadmore' && event.type != 'multiselectloadall') {
                            clearGlobalIfNotInFocus();
                            DoNarrowSearchTM();
                        }
                    }).multiselectfilter();
            },
        error: function (response) {
            // through errror message
            }
        });       

        $("#ToolsTechnicianTM").empty();
        $("#ToolsTechnicianTM").multiselect('destroy');
        $("#ToolsTechnicianTM").multiselectfilter('destroy');
        $("#ToolsTechnicianTM").multiselect(
            {
                noneSelectedText: TechnicianList, selectedList: 5,
                selectedText: function (numChecked, numTotal, checkedItems) {
                    return TechnicianList + ': ' + numChecked + ' ' + selected;
                }
            },
            {
                checkAll: function (ui) {
                    $("#ToolsTechnicianCollapseTM").html('');
                    for (var i = 0; i <= ui.target.length - 1; i++) {
                        if ($("#ToolsTechnicianCollapseTM").text().indexOf(ui.target[i].text) == -1) {
                            $("#ToolsTechnicianCollapseTM").append("<span>" + ui.target[i].text + "</span>");
                        }
                    }
                    $("#ToolsTechnicianCollapseTM").show();
                }
            },
            {
                beforeopen: function () {
                    if ($("#ToolsTechnicianTM option").length == 0) {
                        $.ajax({
                            'url': '/Master/GetNarrowDDData',
                            data: { TableName: Table, TextFieldName: 'ToolsTechnician', IsArchived: _IsArchived, IsDeleted: _IsDeleted, RequisitionCurrentTab: CurTab, ParentID: '@Model.ID' },
                            success: function (response) {
                                var s = '';
                                $.each(response.DDData, function (ValData, ValCount) {
                                    var ArrData = ValData.toString().split('[###]');
                                    s += '<option value="' + ArrData[1] + '">' + ArrData[0] + ' (' + ValCount + ')' + '</option>';
                                });
                                $("#ToolsTechnicianTM").empty();
                                $("#ToolsTechnicianTM").append(s);
                                $("#ToolsTechnicianTM").multiselect("refresh");
                                $("#ToolsTechnicianTM").multiselectfilter("refresh");
                            },
                            error: function (response) {
                                // through errror message
                            }
                        });
                    }
                }
            }
        )
            .unbind("multiselectclick multiselectcheckall multiselectuncheckall")
            .bind("multiselectclick multiselectcheckall multiselectuncheckall", function (event, ui) {
                if (ui.checked) {
                    if ($("#ToolsTechnicianCollapseTM").text().indexOf(ui.text) == -1) {
                        $("#ToolsTechnicianCollapseTM").append("<span>" + ui.text + "</span>");
                    }
                }
                else {
                    if (ui.checked == undefined) {
                        $("#ToolsTechnicianCollapseTM").html('');
                    }
                    else if (!ui.checked) {
                        var text = $("#ToolsTechnicianCollapseTM").html();
                        text = text.replace("<span>" + ui.text + "</span>", '');
                        $("#ToolsTechnicianCollapseTM").html(text);
                    }
                    else
                        $("#ToolsTechnicianCollapseTM").html('');
                }
                ToolTechnicianValue = $.map($(this).multiselect("getChecked"), function (input) {
                    return input.value;
                })
                if ($("#ToolsTechnicianCollapseTM").text().trim() != '')
                    $("#ToolsTechnicianCollapseTM").show();
                else
                    $("#ToolsTechnicianCollapseTM").hide();


                if ($("#ToolsTechnicianCollapseTM").find('span').length <= 2) {
                    $("#ToolsTechnicianCollapseTM").scrollTop(0).height(50);
                }
                else {
                    $("#ToolsTechnicianCollapseTM").scrollTop(0).height(100);
                }
                clearGlobalIfNotInFocus();
                DoNarrowSearchTM();

                if (ToolTechnicianValue.length == 1) {
                    $("input#btnToolCheckInAllBottom").show();
                }
                else {
                    $("input#btnToolCheckInAllBottom").hide();
                }
            }).multiselectfilter();
        if (_TableName == "TechnicianMaster") {
            $.ajax({
                'url': '/Master/GetDDData',
                data: { TableName: 'TechnicianMaster', TextFieldName: 'Technician', ParentID: '@Model.ID' },
                success: function (response) {
                    var s = '';
                    $.each(response.DDData, function (i, val) {
                        s += '<option value="' + val.ID + '">' + val.Text + '</option>';
                    });
                    $("#ToolsTechnicianTM").append(s);
                    $("#ToolsTechnicianTM").multiselect(
                        {
                            noneSelectedText: TechnicianList, selectedList: 5,
                            selectedText: function (numChecked, numTotal, checkedItems) {
                                return TechnicianList + numChecked + ' ' + selected;
                            }
                        }
                    )
                        .bind("multiselectclick multiselectcheckall multiselectuncheckall", function (event, ui) {
                            TechicianValue = $.map($(this).multiselect("getChecked"), function (input) {
                                return input.value;
                            })
                        });
                },
                error: function (response) {
                    // through errror message
                }
            });
        }
        if (_TableName != 'ToolAssetORD') {
            Table = 'ToolMaster';
        }
        var CurTab = '';
        if (Table == 'ToolMaster') {
            CurTab = 'ToolList';
        }
        
    $.ajax({
        'url': '/Master/GetNarrowDDData',
        data: { TableName: Table, TextFieldName: 'Location', IsArchived: _IsArchived, IsDeleted: _IsDeleted, RequisitionCurrentTab: CurTab, ParentID: '@Model.ID' },
        success: function (response) {
            var s = '';
            $.each(response.DDData, function (ValData, ValCount) {
                var ArrData = ValData.toString().split('[###]');
                s += '<option value="' + ArrData[1] + '">' + ArrData[0] + ' (' + ValCount + ')' + '</option>';
            });

            //Destroy widgets before reapplying the filter
            $("#ToolsLocationTM").empty();
            $("#ToolsLocationTM").multiselect('destroy');
            $("#ToolsLocationTM").multiselectfilter('destroy');

            $("#ToolsLocationTM").append(s);
            var currentDataCount = $('select#ToolsLocationTM option').length;
            if (parseInt(currentDataCount) < parseInt(loadNarrowSearchDataCount)) {
                $(".alltoolslocationtm").hide();
                $(".moretoolslocationtm").hide();
            }
            $("#ToolsLocationTM").multiselect(
                {
                    noneSelectedText: ToolsLocation, selectedList: 5,
                    selectedText: function (numChecked, numTotal, checkedItems) {
                        return ToolsLocation + ': ' + numChecked + ' ' + selected;
                    }
                },
                {
                    checkAll: function (ui) {
                        $("#ToolsLocationCollapse").html('');
                        for (var i = 0; i <= ui.target.length - 1; i++) {
                            if ($("#ToolsLocationCollapseTM").text().indexOf(ui.target[i].text) == -1) {
                                $("#ToolsLocationCollapseTM").append("<span>" + ui.target[i].text + "</span>");
                            }
                        }
                        $("#ToolsLocationCollapseTM").show();
                    }
                }
            )
                .unbind("multiselectclick multiselectcheckall multiselectuncheckall multiselectloadmore multiselectloadall")
                .bind("multiselectclick multiselectcheckall multiselectuncheckall multiselectloadmore multiselectloadall", function (event, ui) {
                    if (event.type == 'multiselectloadmore' || event.type == 'multiselectloadall') {
                        var currentDataCount = $('select#ToolsLocationTM option').length;
                        var _selectedSP = $.map($(this).multiselect("getChecked"), function (input) {
                            return input.value;
                        });

                        var _loaddataCount = parseInt(currentDataCount) + parseInt(loadNarrowSearchDataCount);
                        if (event.type == 'multiselectloadall') {
                            _loaddataCount = -1;
                            $(".alltoolslocationtm").hide();
                            $(".moretoolslocationtm").hide();
                        }
                        $.ajax({
                            'url': '/Master/GetNarrowDDData',
                            data: { TableName: Table, TextFieldName: 'Location', IsArchived: _IsArchived, IsDeleted: _IsDeleted, RequisitionCurrentTab: CurTab, ParentID: '@Model.ID', LoadDataCount: _loaddataCount },
                            success: function (response) {
                                var s = '';
                                $.each(response.DDData, function (ValData, ValCount) {

                                    var ArrData = ValData.toString().split('[###]');
                                    if ($.inArray(ArrData[1], _selectedSP) > -1) {
                                        s += '<option selected="selected" value="' + ArrData[1] + '">' + ArrData[0] + ' (' + ValCount + ')' + '</option>';
                                    }
                                    else {
                                        s += '<option value="' + ArrData[1] + '">' + ArrData[0] + ' (' + ValCount + ')' + '</option>';
                                    }
                                });

                                //Destroy widgets before reapplying the filter
                                $("#ToolsLocationTM").empty();
                                $("#ToolsLocationTM").append(s);
                                $("#ToolsLocationTM").multiselect("refresh");
                                $("#ToolsLocationTM").multiselectfilter("refresh");

                                var currentNewDataCount = $('select#ToolsLocationTM option').length;

                                if (parseInt(currentDataCount) >= parseInt(currentNewDataCount)) {
                                    $(".alltoolslocationtm").hide();
                                    $(".moretoolslocationtm").hide();
                                }
                            },
                            error: function (response) {
                                // through errror message
                            }
                        });

                    }
                    else {
                        if (ui.checked) {
                            if ($("#ToolsLocationCollapseTM").text().indexOf(ui.text) == -1) {
                                $("#ToolsLocationCollapseTM").append("<span>" + ui.text + "</span>");
                            }
                        }
                        else {
                            if (ui.checked == undefined) {
                                $("#ToolsLocationCollapseTM").html('');
                            }
                            else if (!ui.checked) {
                                var text = $("#ToolsLocationCollapseTM").html();
                                text = text.replace("<span>" + ui.text + "</span>", '');
                                $("#ToolsLocationCollapseTM").html(text);
                            }
                            else
                                $("#ToolsLocationCollapseTM").html('');
                        }
                    }
                        LocationValue = $.map($(this).multiselect("getChecked"), function (input) {
                            return input.value;
                        })
                    if ($("#ToolsLocationCollapseTM").text().trim() != '')
                        $("#ToolsLocationCollapseTM").show();
                    else
                        $("#ToolsLocationCollapseTM").hide();


                    if ($("#ToolsLocationCollapseTM").find('span').length <= 2) {
                        $("#ToolsLocationCollapseTM").scrollTop(0).height(50);
                    }
                    else {
                        $("#ToolsLocationCollapseTM").scrollTop(0).height(100);
                    }
                    if (event.type != 'multiselectloadmore' && event.type != 'multiselectloadall') {
                        clearGlobalIfNotInFocus();
                        DoNarrowSearchTM();
                    }
                }).multiselectfilter();
        },
        error: function (response) {
            // through errror message
        }
        });
        if (_TableName != 'ToolAssetORD') {
            Table = 'ToolMaster';
        }
        var CurTab = '';
        if (Table == 'ToolMaster') {
            CurTab = 'ToolList';
        } 
        
        $.ajax({
        'url': '/Master/GetNarrowDDData',
        data: { TableName: Table, TextFieldName: 'ToolMaintenance', IsArchived: _IsArchived, IsDeleted: _IsDeleted, RequisitionCurrentTab: CurTab, ParentID: '@Model.ID' },
        success: function (response) {
            var s = '';
            $.each(response.DDData, function (ValData, ValCount) {
                var ArrData = ValData.toString().split('###');
                s += '<option value="' + ArrData[1] + '">' + ArrData[0] + ' (' + ValCount + ')' + '</option>';
            });

            //Destroy widgets before reapplying the filter
            $("#ToolCheckoutTM").empty();
            $("#ToolCheckoutTM").multiselect('destroy');
            $("#ToolCheckoutTM").multiselectfilter('destroy');

            $("#ToolCheckoutTM").append(s);
            $("#ToolCheckoutTM").multiselect(
                        {
                            noneSelectedText: ToolsMaintenance, selectedList: 5,
                            selectedText: function (numChecked, numTotal, checkedItems) {
                                return ToolsMaintenance + ': ' + numChecked + ' ' + selected;
                            }
                        },
                        {
                            checkAll: function (ui) {
                                $("#ToolCheckoutCollapseTM").html('');
                                for (var i = 0; i <= ui.target.length - 1; i++) {
                                    if ($("#ToolCheckoutCollapseTM").text().indexOf(ui.target[i].text) == -1) {
                                        $("#ToolCheckoutCollapseTM").append("<span>" + ui.target[i].text + "</span>");
                                    }
                                }
                                $("#ToolCheckoutCollapseTM").show();
                            }
                        }
            )
            .bind("multiselectclick multiselectcheckall multiselectuncheckall", function (event, ui) {
                if (ui.checked) {
                    if ($("#ToolCheckoutCollapseTM").text().indexOf(ui.text) == -1) {
                        $("#ToolCheckoutCollapseTM").append("<span>" + ui.text + "</span>");
                    }
                }
                else {
                    if (ui.checked == undefined) {
                        $("#ToolCheckoutCollapseTM").html('');
                    }
                    else if (!ui.checked) {
                        var text = $("#ToolCheckoutCollapseTM").html();
                        text = text.replace("<span>" + ui.text + "</span>", '');
                        $("#ToolCheckoutCollapseTM").html(text);
                    }
                    else
                        $("#ToolCheckoutCollapseTM").html('');
                }
                MaintenanceValue = $.map($(this).multiselect("getChecked"), function (input) {
                    return input.value;
                })

                if ($("#ToolCheckoutCollapseTM").text().trim() != '')
                    $("#ToolCheckoutCollapseTM").show();
                else
                    $("#ToolCheckoutCollapseTM").hide();


                if ($("#ToolCheckoutCollapseTM").find('span').length <= 2) {
                    $("#ToolCheckoutCollapseTM").scrollTop(0).height(50);
                }
                else {
                    $("#ToolCheckoutCollapseTM").scrollTop(0).height(100);
                }
                clearGlobalIfNotInFocus();
                DoNarrowSearchTM();
            }).multiselectfilter();
        },
        error: function (response) {
            // through errror message
        }
    });
    }

    function GetNarrowDDDataIM(tableName, companyID, roomID) {
        var ItemCallFrom = '';
        var CurTab = '';
        if ('@Model.ItemModelCallFromPageName' == 'NewPULL') {
            ItemCallFrom = 'newpull';
        }
        else {
            ItemCallFrom = '@Model.ControlID';
        }
        if (tableName == 'ToolMaster') {
            CurTab = 'ToolList';
        }
        

        $.ajax({
            'url': '/Master/GetNarrowDDData',
            data: { TableName: tableName, TextFieldName: 'CreatedBy', IsArchived: false, IsDeleted: false, RequisitionCurrentTab: CurTab, "ItemModelCallFrom": ItemCallFrom, ParentID: '@Model.ID' },
            success: function (response) {
                var s = '';

                if (response.DDData != null) {
                    $.each(response.DDData, function (i, val) {
                        var ArrData1 = i.toString().split('[###]');
                        s += '<option value="' + ArrData1[1] + '">' + ArrData1[0] + '(' + val + ')' + '</option>';
                    });
                }
                $("#UserCreatedTM").append(s);
                $("#UserCreatedTM").multiselect
            (
                {
                    noneSelectedText: UserCreatedBy, selectedList: 5,
                    selectedText: function (numChecked, numTotal, checkedItems) {
                        return CreatedBy + ' ' + numChecked + ' ' + selected;
                    }
                },
                {
                    checkAll: function (ui) {
                        $("#UserCreatedCollapseTM").html('');
                        for (var i = 0; i <= ui.target.length - 1; i++) {
                            if ($("#UserCreatedCollapseTM").text().indexOf(ui.target[i].text) == -1) {
                                $("#UserCreatedCollapseTM").append("<span>" + ui.target[i].text + "</span>");
                            }
                        }
                        $("#UserCreatedCollapseTM").show();
                    }
                }
            )
            .bind("multiselectclick multiselectcheckall multiselectuncheckall", function (event, ui) {
                if (ui.checked) {
                    if ($("#UserCreatedCollapseTM").text().indexOf(ui.text) == -1) {
                        $("#UserCreatedCollapseTM").append("<span>" + ui.text + "</span>");
                    }
                }
                else {
                    if (ui.checked == undefined) {
                        $("#UserCreatedCollapseTM").html('');
                    }
                    else if (!ui.checked) {
                        var text = $("#UserCreatedCollapseTM").html();
                        text = text.replace("<span>" + ui.text + "</span>", '');
                        $("#UserCreatedCollapseTM").html(text);
                    }
                    else
                        $("#UserCreatedCollapseTM").html('');
                }
                UserCreatedNarroValues = $.map($(this).multiselect("getChecked"), function (input) {
                    return input.value;
                })

                if ($("#UserCreatedCollapseTM").text().trim() != '')
                    $("#UserCreatedCollapseTM").show();
                else
                    $("#UserCreatedCollapseTM").hide();


                if ($("#UserCreatedCollapseTM").find('span').length <= 2) {
                    $("#UserCreatedCollapseTM").scrollTop(0).height(50);
                }
                else {
                    $("#UserCreatedCollapseTM").scrollTop(0).height(100);
                }
                //clearGlobalIMIfNotInFocus();
                DoNarrowSearchTM();
            }).multiselectfilter();
            },
            error: function (response) {
                // through errror message
            }
        });

        //alert('3');

        $.ajax({
            'url': '/Master/GetNarrowDDData',
            data: { TableName: tableName, TextFieldName: 'LastUpdatedBy', IsArchived: false, IsDeleted: false, RequisitionCurrentTab: CurTab, "ItemModelCallFrom": ItemCallFrom, ParentID: '@Model.ID' },
            success: function (response) {
                var s = '';
                if (response.DDData != null) {
                    $.each(response.DDData, function (i, val) {
                        var ArrData1 = i.toString().split('[###]');
                        s += '<option value="' + ArrData1[1] + '">' + ArrData1[0] + '(' + val + ')' + '</option>';
                    });
                }
                $("#UserUpdatedTM").append(s);
                $("#UserUpdatedTM").multiselect
            (
                {
                    noneSelectedText: UserUpdatedby, selectedList: 5,
                    selectedText: function (numChecked, numTotal, checkedItems) {
                        return UpdatedBy + ' ' + numChecked + ' ' + selected;
                    }
                },
                {
                    checkAll: function (ui) {
                        $("#UserUpdatedCollapseTM").html('');
                        for (var i = 0; i <= ui.target.length - 1; i++) {
                            if ($("#UserUpdatedCollapseTM").text().indexOf(ui.target[i].text) == -1) {
                                $("#UserUpdatedCollapseTM").append("<span>" + ui.target[i].text + "</span>");
                            }
                        }
                        $("#UserUpdatedCollapseTM").show();
                    }
                }
            )
            .bind("multiselectclick multiselectcheckall multiselectuncheckall", function (event, ui) {
                if (ui.checked) {
                    if ($("#UserUpdatedCollapseTM").text().indexOf(ui.text) == -1) {
                        $("#UserUpdatedCollapseTM").append("<span>" + ui.text + "</span>");
                    }
                }
                else {
                    if (ui.checked == undefined) {
                        $("#UserUpdatedCollapseTM").html('');
                    }
                    else if (!ui.checked) {
                        var text = $("#UserUpdatedCollapseTM").html();
                        text = text.replace("<span>" + ui.text + "</span>", '');
                        $("#UserUpdatedCollapseTM").html(text);
                    }
                    else
                        $("#UserUpdatedCollapseTM").html('');
                }
                UserUpdatedNarroValues = $.map($(this).multiselect("getChecked"), function (input) {
                    return input.value;
                })

                if ($("#UserUpdatedCollapseTM").text().trim() != '')
                    $("#UserUpdatedCollapseTM").show();
                else
                    $("#UserUpdatedCollapseTM").hide();

                if ($("#UserUpdatedCollapseTM").find('span').length <= 2) {
                    $("#UserUpdatedCollapseTM").scrollTop(0).height(50);
                }
                else {
                    $("#UserUpdatedCollapseTM").scrollTop(0).height(100);
                }
                //  clearGlobalIMIfNotInFocus();
                DoNarrowSearchTM();
            }).multiselectfilter();
            },
            error: function (response) {
                // through errror message
            }
        });



    }

    function GetNarroHTMLForUDFIM(tableName, companyID, roomID) {
        var ItemCallFrom = '';
        ItemCallFrom = '@Model.ControlID';
        var UDFObject;

        var CurTab = '';
        if (tableName == 'ToolMaster') {
            CurTab = 'ToolList';
        }

        $("select[name='udflist_Tool']").each(function (index) {
            var UDFUniqueID = this.getAttribute('UID');
            $.ajax({
                'url': '/Master/GetUDFDDData',
                data: { TableName: tableName, UDFName: this.id, UDFUniqueID: UDFUniqueID, IsArchived: false, IsDeleted: false, RequisitionCurrentTab: CurTab, "ItemModelCallFrom": ItemCallFrom, ParentID: '@Model.ID' },
                success: function (response) {
                    var s = '';
                    if (response.DDData != null) {
                        $.each(response.DDData, function (UDFVal, ValCount) {
                            s += '<option value="' + UDFVal + '">' + UDFVal + '(' + ValCount + ')' + '</option>';
                        });
                    }
                    var UDFColumnNameTemp = response.UDFColName.toString().replace("_dd_Tool", "");
                    //$('#' + response.UDFColName).append(s);
                    //$('#' + response.UDFColName).multiselect

                    //Destroy widgets before reapplying the filter
                    $('[id="' + response.UDFColName + '"]').empty();
                    $('[id="' + response.UDFColName + '"]').multiselect('destroy');
                    $('[id="' + response.UDFColName + '"]').multiselectfilter('destroy');

                    $('[id="' + response.UDFColName + '"]').append(s);
                    var currentDataCount = $('select#' + response.UDFColName + ' option').length;
                    if (parseInt(currentDataCount) < parseInt(loadNarrowSearchDataCount)) {
                        $(".alltoolns" + UDFUniqueID + "").hide();
                        $(".moretoolns" + UDFUniqueID + "").hide();
                    }

                    $('[id="' + response.UDFColName + '"]').multiselect
                        (
                        {
                            noneSelectedText: UDFColumnNameTemp, selectedList: 5,
                            selectedText: function (numChecked, numTotal, checkedItems) {
                                return UDFColumnNameTemp + ' ' + numChecked + ' ' + selected;
                            }
                        },
                        {
                            checkAll: function (ui) {
                                var CollapseObject = $('#' + UDFUniqueID + 'Collapse_Tool')
                                $(CollapseObject).html('');
                                for (var i = 0; i <= ui.target.length - 1; i++) {
                                    if ($(CollapseObject).text().indexOf(ui.target[i].text) == -1) {
                                        $(CollapseObject).append("<span>" + ui.target[i].text + "</span>");
                                    }
                                }
                                $(CollapseObject).show();
                            }
                        }
                        )
                        .unbind("multiselectclick multiselectcheckall multiselectuncheckall multiselectloadmore multiselectloadall")
                        .bind("multiselectclick multiselectcheckall multiselectuncheckall multiselectloadmore multiselectloadall", function (event, ui) {

                            if (event.type == 'multiselectloadmore' || event.type == 'multiselectloadall') {

                                var currentDataCount = $('select#' + this.id + ' option').length;
                                var _selectedTReqUDF = $.map($(this).multiselect("getChecked"), function (input) {
                                    return input.value;
                                });
                                var _loaddataCount = parseInt(currentDataCount) + parseInt(loadNarrowSearchDataCount);
                                if (event.type == 'multiselectloadall') {
                                    _loaddataCount = -1;

                                    $(".alltoolns" + UDFUniqueID + "").hide();
                                    $(".moretoolns" + UDFUniqueID + "").hide();
                                }                                
                                if (tableName == "ToolCheckOUT" && this.id.toLowerCase().indexOf("_tool") == -1) {
                                    tableName = "ToolMaster";
                                }
                                $.ajax({
                                    'url': '/Master/GetUDFDDData',
                                    data: { TableName: tableName, UDFName: this.id, UDFUniqueID: UDFUniqueID, IsArchived: false, IsDeleted: false, RequisitionCurrentTab: CurTab, "ItemModelCallFrom": ItemCallFrom, ParentID: '@Model.ID', NotIncludeDeletedUDF: true, ToolCurrentTab: 'ToolList', LoadDataCount: _loaddataCount },
                                    success: function (responseNew) {                                        
                                        var s = '';
                                        $.each(responseNew.DDData, function (UDFVal, ValCount) {
                                            if ($.inArray(UDFVal, _selectedTReqUDF) > -1) {
                                                s += '<option selected="selected" value="' + UDFVal + '">' + UDFVal + ' (' + ValCount + ')' + '</option>';
                                            }
                                            else {
                                                s += '<option value="' + UDFVal + '">' + UDFVal + ' (' + ValCount + ')' + '</option>';
                                            }
                                        });
                                        //Destroy widgets before reapplying the filter
                                        $('[id="' + responseNew.UDFColName + '"]').empty();
                                        $('[id="' + responseNew.UDFColName + '"]').append(s);
                                        $('[id="' + responseNew.UDFColName + '"]').multiselect("refresh");
                                        $('[id="' + responseNew.UDFColName + '"]').multiselectfilter("refresh");

                                        var currentNewDataCount = $('select#' + responseNew.UDFColName + ' option').length;
                                        if (parseInt(currentDataCount) >= parseInt(currentNewDataCount)) {
                                            $(".alltoolns" + UDFUniqueID + "").hide();
                                            $(".moretoolns" + UDFUniqueID + "").hide();
                                        }
                                    },
                                    error: function (responseNew) {
                                        // through errror message
                                    }
                                });

                            }
                            else {
                                var CollapseObject = $('#' + UDFUniqueID + 'Collapse_Tool')
                                if (ui.checked) {
                                    if ($(CollapseObject).text().indexOf(ui.text) == -1) {
                                        $(CollapseObject).append("<span>" + ui.text + "</span>");
                                    }
                                }
                                else {
                                    if (ui.checked == undefined) {
                                        $(CollapseObject).html('');
                                    }
                                    else if (!ui.checked) {
                                        var text = $(CollapseObject).html();
                                        text = text.replace("<span>" + ui.text + "</span>", '');
                                        $(CollapseObject).html(text);
                                    }
                                    else
                                        $(CollapseObject).html('');
                                }
                            }
                            if (UDFUniqueID == "UDF1") {
                                UserUDF1NarrowValues = $.map($(this).multiselect("getChecked"), function (input) {
                                    return input.value;
                                })
                            }
                            else if (UDFUniqueID == "UDF2") {
                                UserUDF2NarrowValues = $.map($(this).multiselect("getChecked"), function (input) {
                                    return input.value;
                                })
                            }
                            else if (UDFUniqueID == "UDF3") {
                                UserUDF3NarrowValues = $.map($(this).multiselect("getChecked"), function (input) {
                                    return input.value;
                                })
                            }
                            else if (UDFUniqueID == "UDF4") {
                                UserUDF4NarrowValues = $.map($(this).multiselect("getChecked"), function (input) {
                                    return input.value;
                                })
                            }
                            else {
                                UserUDF5NarrowValues = $.map($(this).multiselect("getChecked"), function (input) {
                                    return input.value;
                                })
                            }

                            if ($(CollapseObject).text().trim() != '')
                                $(CollapseObject).show();
                            else
                                $(CollapseObject).hide();


                            if ($(CollapseObject).find('span').length <= 2) {
                                $(CollapseObject).scrollTop(0).height(50);
                            }
                            else {
                                $(CollapseObject).scrollTop(0).height(100);
                            }
                            if (event.type != 'multiselectloadmore' && event.type != 'multiselectloadall') {
                                // clearGlobalIMIfNotInFocus();
                                DoNarrowSearchTM();
                            }
                        }).multiselectfilter();
                },
                error: function (response) {

                    // through errror message
                }
            });
        });
        $("select[name='udflist_ToolCheckOut']").each(function (index) {
            var UDFUniqueID = this.getAttribute('UID');
            $.ajax({
                'url': '/Master/GetUDFDDData',
                data: { TableName: 'ToolCheckOUT', UDFName: this.id, UDFUniqueID: UDFUniqueID, IsArchived: false, IsDeleted: false, "ItemModelCallFrom": ItemCallFrom, ParentID: '@Model.ID' },
                success: function (response) {
                    var s = '';
                    if (response.DDData != null) {
                        $.each(response.DDData, function (UDFVal, ValCount) {
                            s += '<option value="' + UDFVal + '">' + UDFVal + '(' + ValCount + ')' + '</option>';
                        });
                    }
                    var UDFColumnNameTemp = response.UDFColName.toString().replace("_dd_Tool", "");
                    //$('#' + response.UDFColName).append(s);
                    //$('#' + response.UDFColName).multiselect

                    //Destroy widgets before reapplying the filter
                    $('[id="' + response.UDFColName + '"]').empty();
                    $('[id="' + response.UDFColName + '"]').multiselect('destroy');
                    $('[id="' + response.UDFColName + '"]').multiselectfilter('destroy');

                    $('[id="' + response.UDFColName + '"]').append(s);
                    var currentDataCount = $('select#' + response.UDFColName  + ' option').length;
                    if (parseInt(currentDataCount) < parseInt(loadNarrowSearchDataCount)) {
                        $(".alltoolchkns" + UDFUniqueID + "").hide();
                        $(".moretoolchkns" + UDFUniqueID + "").hide();
                    }
                    $('[id="' + response.UDFColName + '"]').multiselect
                        (
                        {
                            noneSelectedText: UDFColumnNameTemp, selectedList: 5,
                            selectedText: function (numChecked, numTotal, checkedItems) {
                                return UDFColumnNameTemp + ' ' + numChecked + ' ' + selected;
                            }
                        },
                        {
                            checkAll: function (ui) {
                                var CollapseObject = $('#' + UDFUniqueID + 'Collapse_Tool')
                                $(CollapseObject).html('');
                                for (var i = 0; i <= ui.target.length - 1; i++) {
                                    if ($(CollapseObject).text().indexOf(ui.target[i].text) == -1) {
                                        $(CollapseObject).append("<span>" + ui.target[i].text + "</span>");
                                    }
                                }
                                $(CollapseObject).show();
                            }
                        }
                        )
                        .unbind("multiselectclick multiselectcheckall multiselectuncheckall multiselectloadmore multiselectloadall")
                        .bind("multiselectclick multiselectcheckall multiselectuncheckall multiselectloadmore multiselectloadall", function (event, ui) {

                            if (event.type == 'multiselectloadmore' || event.type == 'multiselectloadall') {

                                var currentDataCount = $('select#' + this.id + ' option').length;
                                var _selectedTReqUDF = $.map($(this).multiselect("getChecked"), function (input) {
                                    return input.value;
                                });
                                var _loaddataCount = parseInt(currentDataCount) + parseInt(loadNarrowSearchDataCount);
                                if (event.type == 'multiselectloadall') {
                                    _loaddataCount = -1;

                                    $(".alltoolchkns" + UDFUniqueID + "").hide();
                                    $(".moretoolchkns" + UDFUniqueID + "").hide();
                                }                                
                                if (tableName == "ToolCheckOUT" && this.id.toLowerCase().indexOf("_tool") == -1) {
                                    tableName = "ToolMaster";
                                }
                                $.ajax({
                                    'url': '/Master/GetUDFDDData',
                                    data: { TableName: 'ToolCheckOUT', UDFName: this.id, UDFUniqueID: UDFUniqueID, IsArchived: false, IsDeleted: false, "ItemModelCallFrom": ItemCallFrom, ParentID: '@Model.ID', NotIncludeDeletedUDF: true, ToolCurrentTab: 'ToolList', LoadDataCount: _loaddataCount },
                                    success: function (responseNew) {                                        
                                        var s = '';
                                        $.each(responseNew.DDData, function (UDFVal, ValCount) {
                                            if ($.inArray(UDFVal, _selectedTReqUDF) > -1) {
                                                s += '<option selected="selected" value="' + UDFVal + '">' + UDFVal + ' (' + ValCount + ')' + '</option>';
                                            }
                                            else {
                                                s += '<option value="' + UDFVal + '">' + UDFVal + ' (' + ValCount + ')' + '</option>';
                                            }
                                        });
                                        //Destroy widgets before reapplying the filter
                                        $('[id="' + responseNew.UDFColName + '"]').empty();
                                        $('[id="' + responseNew.UDFColName + '"]').append(s);
                                        $('[id="' + responseNew.UDFColName + '"]').multiselect("refresh");
                                        $('[id="' + responseNew.UDFColName + '"]').multiselectfilter("refresh");

                                        var currentNewDataCount = $('select#' + responseNew.UDFColName + ' option').length;
                                        if (parseInt(currentDataCount) >= parseInt(currentNewDataCount)) {
                                            $(".alltoolchkns" + UDFUniqueID + "").hide();
                                            $(".moretoolchkns" + UDFUniqueID + "").hide();
                                        }
                                    },
                                    error: function (responseNew) {
                                        // through errror message
                                    }
                                });

                            }
                            else {
                                var CollapseObject = $('#' + UDFUniqueID + 'Collapse_Tool')
                                if (ui.checked) {
                                    if ($(CollapseObject).text().indexOf(ui.text) == -1) {
                                        $(CollapseObject).append("<span>" + ui.text + "</span>");
                                    }
                                }
                                else {
                                    if (ui.checked == undefined) {
                                        $(CollapseObject).html('');
                                    }
                                    else if (!ui.checked) {
                                        var text = $(CollapseObject).html();
                                        text = text.replace("<span>" + ui.text + "</span>", '');
                                        $(CollapseObject).html(text);
                                    }
                                    else
                                        $(CollapseObject).html('');
                                }
                            }
                            if (UDFUniqueID == "UDF1") {
                                ToolCheckOutUDF1 = $.map($(this).multiselect("getChecked"), function (input) {
                                    return input.value;
                                })
                            }
                            else if (UDFUniqueID == "UDF2") {
                                ToolCheckOutUDF2 = $.map($(this).multiselect("getChecked"), function (input) {
                                    return input.value;
                                })
                            }
                            else if (UDFUniqueID == "UDF3") {
                                ToolCheckOutUDF3 = $.map($(this).multiselect("getChecked"), function (input) {
                                    return input.value;
                                })
                            }
                            else if (UDFUniqueID == "UDF4") {
                                ToolCheckOutUDF4 = $.map($(this).multiselect("getChecked"), function (input) {
                                    return input.value;
                                })
                            }
                            else {
                                ToolCheckOutUDF5 = $.map($(this).multiselect("getChecked"), function (input) {
                                    return input.value;
                                })
                            }

                            if ($(CollapseObject).text().trim() != '')
                                $(CollapseObject).show();
                            else
                                $(CollapseObject).hide();


                            if ($(CollapseObject).find('span').length <= 2) {
                                $(CollapseObject).scrollTop(0).height(50);
                            }
                            else {
                                $(CollapseObject).scrollTop(0).height(100);
                            }
                            if (event.type != 'multiselectloadmore' && event.type != 'multiselectloadall') {
                                // clearGlobalIMIfNotInFocus();
                                DoNarrowSearchTM();
                            }
                        }).multiselectfilter();
                },
                error: function (response) {

                    // through errror message
                }
            });
        });

    }

</script>
<script>

    /* COMMON FUNCTION TO NARROW SEARCH HIDE/SHOW ALONG WITH STATE SAVED : Dec 24, 2012 : IJ */
    var actionName = '@ActionName';
    var controllerName = '@ControllerName';
    $(document).ready(function () {
        $(".handle").each(function () {
            $(this).find("img").attr("src", "../../Content/images/Drage.png");
        });
        NSForItemModel_ExecuteOnDocReady();
        if ('@ActionName' == 'NewPull') {
            $("#NarrowUL").sortable({
                handle: "> .handle",
                stop: function (event, ui) {
                    var linkOrderData = $("#NarrowUL").sortable("toArray", { attribute: 'attrsortOrder' });

                    $.ajax({
                        "type": "POST",
                        "url": '/Master/SaveGridState',
                        "data": { Data: JSON.stringify(linkOrderData), ListName: '@ActionName' + "_NarrowSearch" },
                        "dataType": "json",
                        "cache": false,
                        "async": false,
                        "success": function (json1) {
                        }
                    });
                }
            });

            //var orderArray = '3,2,4,5,6,7,8,9,10,1,12,11,103,101,102,104,';
            //var listArray = $('#nssortable li');
            //for (var i = 0; i < orderArray.length; i++) {
            //    $('#nssortable').append(listArray[orderArray[i]-1]);
            //}
            $.ajax({
                "type": "POST",
                "url": '/Master/LoadGridState',
                "data": { ListName: '@ActionName' + "_NarrowSearch" },
                "dataType": "json",
                "cache": false,
                "async": false,
                "success": function (json1) {

                    if (json1.jsonData != null && json1.jsonData != '') {

                        var sorted = JSON.parse(json1.jsonData);
                        sorted = sorted.reverse();

                        sorted.forEach(function (id) {
                            $("#NarrowUL [attrsortOrder=" + parseInt(id) + "]").prependTo("#NarrowUL");
                        });
                    }
                }
            });
        }
       
    });

    function NSForItemModel_ExecuteOnDocReady() {
        //--------------------------------------------------------------------------------
        //
        //alert("This is test");


        //alert("a: " + actionName + " c: " + controllerName);

        var _IsArchived = false;
        var _IsDeleted = false;
        var ShowStagingLocations = false;


        if (actionName == "NewPull" || (controllerName == "WorkOrder" && actionName == "LoadItemMasterModel")) {
            GetPullNarrowSearchDataIM('@Model.PageName', _IsArchived, _IsDeleted);
        }

        //alert('4');
        GetNarrowDDDataIM_Common('@Model.PageName', _IsArchived, _IsDeleted);

        if ('@string.IsNullOrEmpty(Model.Text)' == '@Boolean.FalseString') {
            if ('@modelText.ToLower()' == "inventory count") {
                GetItemLocationsForCount(ShowStagingLocations, false);
            }
        }

        CallNarrowfunctionsIM();

        $('a.downarrow').click(function (e) {
            e.preventDefault();
            $(this).closest('.accordion').find('.dropcontent').slideToggle();
        });

        //--------------------------------------------------------------------------------
        //
        $('#ExpandNarrowSearchIM').click(function (e) {

            ExpandNarrowSearchIM();
        });
        $('#CollapseNarrowSearchIM').click(function (e) {

            CollapseNarrowSearchIM();
        });
        var NarrowSearchStateIM = getCookieIM('NarrowSearchStateIM');

        if (NarrowSearchStateIM == 'Expanded') {
            CollapseNarrowSearchIM();
        }
        else {
            ExpandNarrowSearchIM();
        }

        //alert('type 8');
        GetNarroHTMLForItemTypeIM();
        $("div#ItemModelTemp").find("div.userHead:first").find("div.BtnBlock a.clsactionSelectAll").click(function () {

            $("#myDataTable").find("tbody tr").removeClass("row_selected").addClass("row_selected");

            $("#ItemModeDataTable").find("tbody tr").removeClass("row_selected").addClass("row_selected");

            $("#ItemModeDataTable tbody tr").each(function () {
                if ($(this).find("input#btnLoad").length > 0) {
                    $(this).removeClass("row_selected");
                }
            });
            $(this).next("a.clsactionDeSelectAll").css('display', '');
            $(this).css('display', 'none');
            ShowHideCartCreateButton();
            ShowHideCartDeleteButton();
        });
        $("div#ItemModelTemp").find("div.userHead:first").find("div.BtnBlock a.clsactionDeSelectAll").click(function () {

            $("#myDataTable").find("tbody tr").removeClass("row_selected");
            $("#ItemModeDataTable").find("tbody tr").removeClass("row_selected");
            $(this).prev("a.clsactionSelectAll").css('display', '');
            $(this).css('display', 'none');
            ShowHideCartCreateButton();
            ShowHideCartDeleteButton();
        });
    }

    function ExpandNarrowSearchIM() {

        if ($('#ItemModelTemp .IteamBlock').length > 0) {

            var w = $('#ItemModelTemp .IteamBlock').css("width");
            $('#ItemModelTemp .IteamBlock').show();
            $('#ItemModelTemp .IteamBlock').stop().animate({
                width: "18%"
            }, 0, function () {
                $('#ItemModelTemp .userContent').css({ "width": "80.5%", "margin": "0" });
                $('#ItemModeDataTable_length').css({ "left": "0px" });
                $('#ItemModeDataTable_paginate').css({ "left": "145px" });
                $('#ItemModelTemp .leftopenContent').css({ "display": "none" });
                setCookieIM('NarrowSearchStateIM', 'Collapsed');
            });
        }
        else if ($('.userListBlock .IteamBlock').length > 0) {

            var w = $('.userListBlock .IteamBlock').css("width");
            $('.userListBlock .IteamBlock').show();
            $('.userListBlock .IteamBlock').stop().animate({
                width: "18%"
            }, 0, function () {
                $('.userListBlock .userContent').css({ "width": "80.5%", "margin": "0" });
                $('#ItemModeDataTable_length').css({ "left": "0px" });
                $('#ItemModeDataTable_paginate').css({ "left": "145px" });
                $('.userListBlock .leftopenContent').css({ "display": "none" });
                setCookieIM('NarrowSearchStateIM', 'Collapsed');
            });
        }
        else if ($('#CtabNew .IteamBlock').length > 0) {
            var w = $('#CtabNew .IteamBlock').css("width");
            $('#CtabNew .IteamBlock').show();
            $('#CtabNew .IteamBlock').stop().animate({
                width: "18%"
            }, 0, function () {
                $('#CtabNew .userContent').css({ "width": "80.5%", "margin": "0" });
                $('#ItemModeDataTable_length').css({ "left": "0px" });
                $('#ItemModeDataTable_paginate').css({ "left": "145px" });
                $('#CtabNew .leftopenContent').css({ "display": "none" });
                setCookieIM('NarrowSearchStateIM', 'Collapsed');
            });
        }
        else if ($('#Ctab .IteamBlock').length > 0) {

            var w = $('#Ctab .IteamBlock').css("width");
            $('#Ctab .IteamBlock').show();
            $('#Ctab .IteamBlock').stop().animate({
                width: "18%"
            }, 0, function () {
                $('#Ctab .userContent').css({ "width": "80.5%", "margin": "0" });
                $('#ItemModeDataTable_length').css({ "left": "0px" });
                $('#ItemModeDataTable_paginate').css({ "left": "145px" });
                $('#Ctab .leftopenContent').css({ "display": "none" });
                setCookieIM('NarrowSearchStateIM', 'Collapsed');
            });
        }


        else if ($('#ItemModel .IteamBlock').length > 0) {
            var w = $('#ItemModel .IteamBlock').css("width");
            $('#ItemModel .IteamBlock').show();
            $('#ItemModel .IteamBlock').stop().animate({
                width: "18%"
            }, 0, function () {
                $('#ItemModel .userContent').css({ "width": "80.5%", "margin": "0" });
                $('#ItemModeDataTable_length').css({ "left": "0px" });
                $('#ItemModeDataTable_paginate').css({ "left": "145px" });
                $('#ItemModel .leftopenContent').css({ "display": "none" });
                setCookieIM('NarrowSearchStateIM', 'Collapsed');
            });
        }

    }

    function CollapseNarrowSearchIM() {

        if ($('#ItemModelTemp .IteamBlock').length > 0) {

            $('#ItemModelTemp .IteamBlock').stop().animate({
                width: "0%"
            }, 0, function () {
                $('#ItemModelTemp .IteamBlock').hide();

                $('#ItemModelTemp .userContent').css({ "width": "98.5%", margin: "0 0.4% 1%" });
                var Left = $('.viewBlock').css("width");
                $('#ItemModeDataTable_length').css({ "left": Left });
                var LeftW = 145 + parseInt(Left);
                $('#ItemModeDataTable_paginate').css({ "left": LeftW + 'px' });
                if (typeof (oTableItemModel) != "undefined") {
                    oTableItemModel.fnAdjustColumnSizing();
                }


                $('#ItemModelTemp .leftopenContent').css({ "display": "" });

                setCookie('NarrowSearchStateIM', 'Expanded');
            });
        }
        else if ($('#CtabNew .IteamBlock').length > 0) {

            $('#CtabNew .IteamBlock').stop().animate({
                width: "0%"
            }, 0, function () {
                $('#CtabNew .IteamBlock').hide();
                $('#CtabNew .userContent').css({ "width": "98.5%", margin: "0 0.4% 1%" });
                var Left = $('.viewBlock').css("width");
                $('#ItemModeDataTable_length').css({ "left": Left });
                var LeftW = 145 + parseInt(Left);
                $('#ItemModeDataTable_paginate').css({ "left": LeftW + 'px' });
                if (typeof (oTableItemModel) != "undefined") {
                    oTableItemModel.fnAdjustColumnSizing();
                }
                $('#CtabNew .leftopenContent').css({ "display": "" });
                setCookie('NarrowSearchStateIM', 'Expanded');
            });
        }
        else if ($('.userListBlock .IteamBlock').length > 0) {

            $('.userListBlock .IteamBlock').stop().animate({
                width: "0%"
            }, 0, function () {
                $('.userListBlock .IteamBlock').hide();
                $('.userListBlock .userContent').css({ "width": "98.5%", margin: "0 0.4% 1%" });
                var Left = $('.viewBlock').css("width");
                $('#ItemModeDataTable_length').css({ "left": Left });
                var LeftW = 145 + parseInt(Left);
                $('#ItemModeDataTable_paginate').css({ "left": LeftW + 'px' });
                if (typeof (oTableItemModel) != "undefined") {
                    oTableItemModel.fnAdjustColumnSizing();
                }
                $('.userListBlock .leftopenContent').css({ "display": "" });
                setCookie('NarrowSearchStateIM', 'Expanded');
            });
        }
        else if ($('#Ctab .IteamBlock').length > 0) {

            $('#Ctab .IteamBlock').stop().animate({
                width: "0%"
            }, 0, function () {
                $('#Ctab .IteamBlock').hide();

                $('#Ctab .userContent').css({ "width": "98.5%", margin: "0 0.4% 1%" });
                var Left = $('.viewBlock').css("width");
                $('#ItemModeDataTable_length').css({ "left": Left });
                var LeftW = 145 + parseInt(Left);
                $('#ItemModeDataTable_paginate').css({ "left": LeftW + 'px' });
                if (typeof (oTableItemModel) != "undefined") {
                    oTableItemModel.fnAdjustColumnSizing();
                }


                $('#Ctab .leftopenContent').css({ "display": "" });

                setCookie('NarrowSearchStateIM', 'Expanded');
            });
        }
        else if ($('#ItemModel .IteamBlock').length > 0) {
            $('#ItemModel .IteamBlock').stop().animate({
                width: "0%"
            }, 0, function () {
                $('#ItemModel .IteamBlock').hide();
                $('#ItemModel .userContent').css({ "width": "98.5%", margin: "0 0.4% 1%" });
                var Left = $('.viewBlock').css("width");
                $('#ItemModeDataTable_length').css({ "left": Left });
                var LeftW = 145 + parseInt(Left);
                $('#ItemModeDataTable_paginate').css({ "left": LeftW + 'px' });
                if (typeof (oTableItemModel) != "undefined") {
                    oTableItemModel.fnAdjustColumnSizing();
                }
                $('#ItemModel .leftopenContent').css({ "display": "" });
                setCookie('NarrowSearchStateIM', 'Expanded');
            });
        }
    }

    function getCookieIM(name) {
        var arg = name + "=";
        var alen = arg.length;
        var clen = document.cookie.length;
        var i = 0;
        while (i < clen) {
            var j = i + alen;
            if (document.cookie.substring(i, j) == arg) {
                return getCookieValIM(j);
            }
            i = document.cookie.indexOf(" ", i) + 1;
            if (i == 0) break;
        }
        return null;
    }

    function getCookieValIM(offset) {
        var endstr = document.cookie.indexOf(";", offset);
        if (endstr == -1) { endstr = document.cookie.length; }
        return unescape(document.cookie.substring(offset, endstr));
    }

    function setCookieIM(name, value, days) {
        if (typeof days != "undefined") { //if set persistent cookie
            var expireDate = new Date();
            expireDate.setDate(expireDate.getDate() + days);
            document.cookie = name + "=" + value + "; path=/; expires=" + expireDate.toGMTString() + " ;SameSite=Strict;";
        }
        else //else if this is a session only cookie
            document.cookie = name + "=" + value + "; path=/ ;SameSite=Strict;";
    }

    /* COMMON FUNCTION TO NARROW SEARCH HIDE/SHOW ALONG WITH STATE SAVED : Dec 24, 2012 : IJ */

    /* CLEAR NARROW SEARCH - START */
    function clearNarrowSearchFilterTM() {
        
        if (typeof ($("#ItemLocationsIC").multiselect("getChecked").length) != undefined && $("#ItemLocationsIC").multiselect("getChecked").length > 0) {
            $("#ItemLocationsIC").multiselect("uncheckAll");
            $("#ItemLocationsICCollapseTM").html('');
        }
        if (typeof ($("#UserCreatedTM").multiselect("getChecked").length) != undefined && $("#UserCreatedTM").multiselect("getChecked").length > 0) {
            $("#UserCreatedTM").multiselect("uncheckAll");
            $("#UserCreatedCollapseTM").html('');
        }
        if (typeof ($("#UserCreatedTM").multiselect("getChecked").length) != undefined && $("#UserCreatedTM").multiselect("getChecked").length > 0) {
            $("#UserCreatedTM").multiselect("uncheckAll");
            $("#UserCreatedCollapseTM").html('');
        }
        if (typeof ($("#UserUpdatedTM").multiselect("getChecked").length) != undefined && $("#UserUpdatedTM").multiselect("getChecked").length > 0) {
            $("#UserUpdatedTM").multiselect("uncheckAll");
            $("#UserUpdatedCollapseTM").html('');
        }

        $("select[name='udflist_Tool']").each(function (index) {
            if (typeof ($(this).multiselect("getChecked").length) != undefined && $(this).multiselect("getChecked").length > 0) {
                var UDFUniqueID = this.getAttribute('UID');
                $(this).multiselect("uncheckAll");
                $('#' + UDFUniqueID + 'Collapse_Tool').html('');
            }
        });
        $("select[name='udflist_ToolCheckOut']").each(function (index) {
            if (typeof ($(this).multiselect("getChecked").length) != undefined && $(this).multiselect("getChecked").length > 0) {
                var UDFUniqueID = this.getAttribute('UID');
                $(this).multiselect("uncheckAll");
                $('#' + UDFUniqueID + 'Collapse_Tool').html('');
            }
        });
        if (typeof ($("#PullSupplierTM").multiselect("getChecked").length) != undefined && $("#PullSupplierTM").multiselect("getChecked").length > 0) {
            $("#PullSupplierTM").multiselect("uncheckAll");
            $("#PullSupplierCollapseTM").html('');
        }

        if (typeof ($("#StageLocationHeaderTM").multiselect("getChecked").length) != undefined && $("#StageLocationHeaderTM").multiselect("getChecked").length > 0) {
            $("#StageLocationHeaderTM").multiselect("uncheckAll");
            $("#StageLocationHeaderCollapseTM").html('');
            IsStagingLocationOnly = false;
        }

        if (typeof ($("#StageLocationTM").multiselect("getChecked").length) != undefined && $("#StageLocationTM").multiselect("getChecked").length > 0) {
            $("#StageLocationTM").multiselect("uncheckAll");
            $("#StageLocationCollapseTM").html('');
            IsStagingLocationOnly = false;
        }

        if (typeof ($("#ManufacturerTM").multiselect("getChecked").length) != undefined && $("#ManufacturerTM").multiselect("getChecked").length > 0) {
            $("#ManufacturerTM").multiselect("uncheckAll");
            $("#ManufacturerCollapseTM").html('');
        }

        if (typeof ($("#PullCategoryTM").multiselect("getChecked").length) != undefined && $("#PullCategoryTM").multiselect("getChecked").length > 0) {
            $("#PullCategoryTM").multiselect("uncheckAll");
            $("#PullCategoryCollapseTM").html('');
        }

        if ($('#DateCFromIM').val() != '') $('#DateCFromIM').val('');
        if ($('#DateCToIM').val() != '') $('#DateCToIM').val('');
        if ($('#DateUFromIM').val() != '') $('#DateUFromIM').val('');
        if ($('#DateUToIM').val() != '') $('#DateUToIM').val('');

        if ($('#PullCost') != undefined) {
            $('#PullCost').val('0_-1');
        }

        if ($('#StockStatus') != undefined) {
            $('#StockStatus').val('0');
        }

        if (typeof ($("#ItemTypeTM").multiselect("getChecked").length) != undefined && $("#ItemTypeTM").multiselect("getChecked").length > 0) {
            $("#ItemTypeTM").multiselect("uncheckAll");
            $("#ItemTypeCollapseTM").html('');
        }
        if (typeof ($("#ToolsCategoryTM").multiselect("getChecked").length) != undefined && $("#ToolsCategoryTM").multiselect("getChecked").length > 0) {
            $("#ToolsCategoryTM").multiselect("uncheckAll");
            $("#ToolsCategoryCollapseTM").html('');
        }
        if (typeof ($("#ToolCheckoutTM").multiselect("getChecked").length) != undefined && $("#ToolCheckoutTM").multiselect("getChecked").length > 0) {
            $("#ToolCheckoutTM").multiselect("uncheckAll");
            $("#ToolCheckoutCollapseTM").html('');
        }
        if (typeof ($("#ToolsTechnicianTM").multiselect("getChecked").length) != undefined && $("#ToolsTechnicianTM").multiselect("getChecked").length > 0) {
            $("#ToolsTechnicianTM").multiselect("uncheckAll");
            $("#ToolsTechnicianCollapseTM").html('');
        }
        if (typeof ($("#ToolsLocationTM").multiselect("getChecked").length) != undefined && $("#ToolsLocationTM").multiselect("getChecked").length > 0) {
            $("#ToolsLocationTM").multiselect("uncheckAll");
            $("#ToolsLocationCollapseTM").html('');
        }
       // NarrowSearchInGridTM('');
    }
    /* CLEAR NARROW SEARCH - END */

    /* CLEAR GLOBAL FILTER IF NOT IN FOCUS - START */
    function clearGlobalIMIfNotInFocus() {
        if ($(document.activeElement).attr('id') != 'ItemModel_filter')
            $("#ItemModel_filter").val('');
    }
    /* CLEAR GLOBAL FILTER IF NOT IN FOCUS - END */

</script>
