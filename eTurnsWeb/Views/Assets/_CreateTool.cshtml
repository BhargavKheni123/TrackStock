@model eTurns.DTO.ToolMasterDTO
@{
    Layout = "~/Views/Shared/_PopupMaster.cshtml";
    List<SelectListItem> lstItems = new List<SelectListItem>();
    lstItems.Add(new SelectListItem() { Text = "", Value = "" });
    lstItems.Add(new SelectListItem() { Text = "Mileage", Value = "1" });
    lstItems.Add(new SelectListItem() { Text = "Operation Hours", Value = "2" });
    List<ToolCategoryMasterDTO> lstToolcats = new List<ToolCategoryMasterDTO>();
    List<LocationMasterDTO> lstToolLocs = new List<LocationMasterDTO>();
    List<TechnicianMasterDTO> lstToolTechs = new List<TechnicianMasterDTO>();
    if (ViewBag.ToolCategoryList != null)
    {
        lstToolcats = ViewBag.ToolCategoryList;
        lstToolcats = lstToolcats.OrderBy(t => t.ToolCategory).ToList();
    }
    if (ViewBag.LocationList != null)
    {
        lstToolLocs = ViewBag.LocationList;
        lstToolLocs = lstToolLocs.OrderBy(t => t.Location).ToList();
    }
    if (ViewBag.TechnicianList != null)
    {
        lstToolTechs = ViewBag.TechnicianList;
        lstToolTechs = lstToolTechs.OrderBy(t => t.Technician).ToList();
    }
    //System.Xml.Linq.XElement Settinfile = System.Xml.Linq.XElement.Load(HttpContext.Current.Server.MapPath("/SiteSettings.xml"));
    string UNCPathRootToolPhoto = eTurns.DTO.SiteSettingHelper.ToolPhoto; // Settinfile.Element("ToolPhoto").Value;


    Int64 EnterpriseId = eTurnsWeb.Helper.SessionHelper.EnterPriceID;
    Int64 CompanyID = eTurnsWeb.Helper.SessionHelper.CompanyID;
    Int64 RoomID = eTurnsWeb.Helper.SessionHelper.RoomID;
    UNCPathRootToolPhoto = UNCPathRootToolPhoto.Replace("~", string.Empty);

    string CharCodeList = eTurnsWeb.Helper.CommonUtility.GetNotAllowCharList();

    string LogoPathImage = (UNCPathRootToolPhoto + EnterpriseId + "/" + CompanyID + "/" + RoomID);
}
@{
    bool isUpdate;
    bool isInsert;
    bool onlyView = false;
    bool isCost = false;
    bool haveToolWrittenOffRights = false;
    if (ViewBag.ViewOnly == true)
    {
        isUpdate = false;
        isInsert = false;
        onlyView = true;
    }
    else
    {
        isUpdate = eTurnsWeb.Helper.SessionHelper.GetModulePermission(eTurnsWeb.Helper.SessionHelper.ModuleList.ToolMaster, eTurnsWeb.Helper.SessionHelper.PermissionType.Update);
        isInsert = eTurnsWeb.Helper.SessionHelper.GetModulePermission(eTurnsWeb.Helper.SessionHelper.ModuleList.ToolMaster, eTurnsWeb.Helper.SessionHelper.PermissionType.Insert);
        isCost = eTurnsWeb.Helper.SessionHelper.GetAdminPermission(eTurnsWeb.Helper.SessionHelper.ModuleList.HideCostMarkUpSellPrice);
        haveToolWrittenOffRights = eTurnsWeb.Helper.SessionHelper.GetAdminPermission(eTurnsWeb.Helper.SessionHelper.ModuleList.AllowToolWrittenOff);
    }
}
<script type='text/javascript' src="@Url.Content("~/Scripts/ajaxfileupload.js?v=" + eTurnsWeb.Helper.CommonUtility.GetReleaseNumber())"></script>
@using (Ajax.BeginForm("ToolSave", "Assets", new AjaxOptions { HttpMethod = "Post", OnSuccess = "onSuccess", InsertionMode = InsertionMode.Replace, OnFailure = "onFailure" }, new { @id = "frmTool" }))
{
    @Html.AntiForgeryToken()
    <div class="userHead">
        @Html.ValidationSummary(true)
        @if (Model.ID != 0)
        {
            <div class="infoBlock">
                <ul>
                    <li>
                        <label for="RoomName">
                            @Html.LabelFor(model => model.RoomName)
                        </label>
                        : <span>@(Model.RoomName)</span>
                    </li>
                    <li>
                        <label for="RoomName">
                            @Html.LabelFor(model => model.Created)
                        </label>
                        : <span>@(eTurns.DTO.FnCommon.ConvertDateByTimeZone(Model.Created,true))</span>
                    </li>
                    <li>
                        <label for="RoomName">
                            @Html.LabelFor(model => model.CreatedByName)
                        </label>
                        : <span>@(Model.CreatedByName)</span>
                    </li>
                    <li>
                        <label for="RoomName">
                            @Html.LabelFor(model => model.Updated)
                        </label>
                        : <span>@(eTurns.DTO.FnCommon.ConvertDateByTimeZone(Model.Updated,true))</span>
                    </li>
                    <li style="border: none">
                        <label for="RoomName">
                            @Html.LabelFor(model => model.UpdatedByName)
                        </label>
                        : <span>@(Model.UpdatedByName)</span>
                    </li>
                </ul>
            </div>
        }
        <div class="mainForm">
            <div class="editorForm">
                <ul>

                    <li>
                        <div class="editor-label">
                            @Html.LabelFor(model => model.ToolName)<em> *</em>
                        </div>
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.ToolName, new { id = "ToolName", @class = "text-box", maxlength = 128 })
                            <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.ToolName)</span>
                            @Html.HiddenFor(model => model.ID, new { id = "hiddenID" })
                            @Html.HiddenFor(model => model.GUID)
                            @Html.HiddenFor(model => model.Created)
                            @Html.HiddenFor(model => model.Updated)
                            @Html.HiddenFor(model => model.CreatedBy)
                            @Html.HiddenFor(model => model.LastUpdatedBy)
                            @Html.HiddenFor(model => model.Room)
                            @Html.HiddenFor(model => model.RoomName)
                            @Html.HiddenFor(model => model.CompanyID)
                            @Html.HiddenFor(model => model.CreatedByName)
                            @Html.HiddenFor(model => model.UpdatedByName)
                            @Html.HiddenFor(model => model.IsDeleted)
                            @Html.HiddenFor(model => model.IsArchived)
                            @Html.HiddenFor(model => model.CheckedOutMQTY)
                            @Html.HiddenFor(model => model.CheckedOutQTY)
                            @Html.HiddenFor(model => model.IsOnlyFromItemUI)
                            @Html.HiddenFor(model => model.Type)
                            @Html.HiddenFor(model => model.IsBuildBreak)
                        </div>
                    </li>
                    <li>
                        <div class="editor-label">
                            @Html.LabelFor(model => model.Serial) <em> *</em>
                        </div>
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.Serial, new { id = "Serial", @class = "text-box", maxlength = 128 })
                            <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.Serial)</span>
                        </div>
                    </li>
                    <li>
                        <div class="editor-label">
                            @Html.LabelFor(model => model.Description)
                        </div>
                        <div class="editor-field">
                            @Html.TextAreaFor(model => model.Description, 10, 100, new { id = "Description", @class = "text-box", maxlength = 1024 })
                            <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.Description)</span>
                        </div>
                    </li>
                    @if (isCost)
                    {
                        <li>
                            <div class="editor-label">
                                @Html.LabelFor(model => model.Cost)
                            </div>
                            <div class="editor-field">
                                @Html.TextBoxFor(model => model.Cost, new { id = "Cost", @class = "numericinput", maxlength = 128 })
                                <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.Cost)</span>
                            </div>
                        </li>
                    }
                    else
                    {
                        <li>
                            @Html.HiddenFor(t => t.Cost)
                        </li>
                    }
                    <li>
                        <div class="editor-label">
                            @Html.LabelFor(model => model.IsGroupOfItems)<em> *</em>
                        </div>
                        <div class="editor-field" style="padding: 5px">
                            @if (Model.ID > 0)
                            {
                                @(Model.IsGroupOfItems == 1 ? "Yes" : "No")
                                @Html.HiddenFor(model => model.IsGroupOfItems)
                            }
                            else
                            {
                                @Html.DropDownListFor(model => model.IsGroupOfItems, new SelectList(ViewBag.GropOfItemsBag, "ID", "Text", Model.IsGroupOfItems), new { @class = "selectBox", @onchange = "FnIsGroupOfItems();" })
                                <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.IsGroupOfItems)</span>
                            }
                        </div>
                    </li>
                    <li>
                        <div class="editor-label">
                            @Html.LabelFor(model => model.Quantity)<em> *</em>
                        </div>
                        <div class="editor-field" style="padding: 5px">
                            @if (Model.ID > 0)
                            {
                                if (Model.IsGroupOfItems == 0)
                                {
                                    <span id="Qty">@(Model.Quantity)</span>
                                    @Html.HiddenFor(model => model.Quantity, new { @class = "text-box numericinput" })
                                }
                                else
                                {
                                    @Html.TextBoxFor(model => model.Quantity, new { @class = "text-box numericinput" })
                                    <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.Quantity)</span>
                                }
                            }
                            else
                            {
                                @Html.TextBoxFor(model => model.Quantity, new { @class = "text-box numericinput" })
                                <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.Quantity)</span>
                            }
                        </div>
                    </li>
                    <li>
                        <div class="editor-label">
                            @Html.LabelFor(model => model.NoOfPastMntsToConsider)
                        </div>
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.NoOfPastMntsToConsider, new { @class = "text-box", maxlenght = 2 })
                            <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.NoOfPastMntsToConsider)</span>
                        </div>
                    </li>
                    <li>
                        <div class="editor-label">
                            @Html.LabelFor(model => model.MaintenanceDueNoticeDays)
                        </div>
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.MaintenanceDueNoticeDays, new { @class = "text-box", maxlenght = 2 })
                            <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.MaintenanceDueNoticeDays)</span>
                        </div>
                    </li>
                    @*<li>
                            <div class="editor-label">
                                @Html.LabelFor(model => model.MaintenanceType)
                            </div>
                            <div class="editor-field">
                                @Html.DropDownListFor(model => model.MaintenanceType, new SelectList(lstItems, "Value", "Text"), new { @class = "selectBox" })
                                <span class="ErrorMessage">@Html.ValidationMessageFor(model => model.MaintenanceType)</span>
                            </div>
                        </li>*@
                    <li>
                        <ul>
                            <li>
                                <h4>
                                    @eTurns.DTO.ResItemMaster.ImagePath
                                </h4>
                            </li>
                            <li>
                                @Html.RadioButtonFor(e => e.ImageType, "ImagePath", new { id = "ImagePath", onchange = "ShowImage(this);" })
                                @Html.Label("ImagePath", "Local Image")
                                @Html.RadioButtonFor(e => e.ImageType, "ExternalImage", new { id = "ExternalImage", onchange = "ShowImage(this);" })
                                @Html.Label("ExternalImage", "External Url")
                            </li>

                            <li id="ExternalURL">
                                <div class="editor-label">
                                    @Html.LabelFor(model => model.ToolImageExternalURL)
                                </div>
                                <div class="editor-field">
                                    @Html.TextBoxFor(model => model.ToolImageExternalURL, new { @class = "text-box", maxlength = 500, @onblur = "return CheckValidURLForImage(this);" })
                                </div>
                                @Html.HiddenFor(model => Model.ToolImageExternalURL)
                            </li>
                            <li>
                                <ul>
                                    <li>
                                        <div class="editor-label">
                                            @Html.LabelFor(model => model.ImagePath)@*<em> *</em>*@
                                        </div>
                                        <div class="editor-field" style="width: 1000px;">
                                            <a href="javascript:void(null);" onclick="DeleteToolImage('@Model.GUID');" title="Delete Image" id="btnDeleteImage" name="btnDeleteImage">
                                                <img src="~/Content/images/delete.png" />
                                            </a>
                                            <input name="ToolImage" id="ToolImage" type="file" />
                                            @if (!string.IsNullOrEmpty(Model.ImagePath))
                                            {
                                                <input type="hidden" value="@( LogoPathImage + "/" + Model.ID + "/" + Model.ImagePath)" id="currentpath" />
                                            }
                                            else
                                            {
                                                <input type="hidden" value="~/Content/images/no-image.jpg" id="currentpath" />
                                            }
                                        <div style="float: left;">
                                            @if (!string.IsNullOrEmpty(Model.ImageType) && !string.IsNullOrEmpty(Model.ImagePath) && Model.ImageType.Trim().ToLower() == "imagepath")
                                            {
                                                <a href='/Consume/Get?path=@(LogoPathImage + "/" + Model.ID + "/" + Model.ImagePath)' target="_blank"> <img id="previewHolder" style="width:120px;height:120px;" src="/Consume/Get?path=@(LogoPathImage + "/" + Model.ID + "/" + Model.ImagePath)"> </a>
                                            }
                                            else if (!string.IsNullOrEmpty(Model.ImageType) && !string.IsNullOrEmpty(Model.ToolImageExternalURL) && Model.ImageType.Trim().ToLower() == "externalimage")
                                            {
                                                <img id="previewHolder" style="width:120px;height:120px;" src="@( Model.ToolImageExternalURL)">
                                            }
                                            else
                                            {
                                                <img id="previewHolder" style="width: 120px; height: 120px;" alt="No Image" src="~/Content/images/no-image.jpg" />
                                            }
                                        </div>
                                        </div>
                                    </li>
                                </ul>
                            </li>
                        </ul>

                    </li>

                    <li>
                        <div class="editor-label">
                            &nbsp;
                        </div>
                        <div class="BtnBlockform">
                            <input type="button" value="@eTurns.DTO.Resources.ResCommon.Cancel" id="btnCancel" class="CreateBtn" />
                            @if (isInsert == true && Model.ID == 0)
                            {
                                <input type="submit" value="@eTurns.DTO.Resources.ResCommon.Save" id="btnSave" onclick="return CheckBeforeSave();" class="CreateBtn" />
                            }
                            else if (isUpdate == true)
                            {
                                <input type="submit" value="@eTurns.DTO.Resources.ResCommon.Save" id="btnSave" onclick="return CheckBeforeSave();" class="CreateBtn" />
                            }
                            else if (isUpdate == false && isInsert == false)
                            {
                                <script>
                                    //This is the case when archived or deleted record is being viewed..
                                    disableControls('frmTool');
                                </script>
                            }
                        </div>
                    </li>
                </ul>
            </div>
            <div class="editorForm padRightNone">
                <ul>
                    <li>
                        <div class="editor-label">
                            @Html.LabelFor(model => model.ToolCategory)
                        </div>
                        <div class="editor-field">
                            @Html.DropDownListFor(model => model.ToolCategoryID, new SelectList(lstToolcats, "ID", "ToolCategory", Model.ToolCategoryID), "-- Select Category--", new { @class = "selectBox" })
                            @if (@eTurnsWeb.Helper.SessionHelper.GetModulePermission(eTurnsWeb.Helper.SessionHelper.ModuleList.ToolCategory,
eTurnsWeb.Helper.SessionHelper.PermissionType.Insert) && onlyView == false)
                            {
                                <a onclick="AddNewFromPopup('Tool Category');" id="btnAddToolCategory" class="addNewLink">
                                    (Add New)
                                </a>
                            }
                            <span class="ErrorMessage"> @Html.ValidationMessageFor(m => m.ToolCategoryID) </span>
                        </div>
                    </li>
                    <li>
                        <div class="editor-label">
                            @Html.LabelFor(model => model.Location)
                        </div>
                        <div class="editor-field">
                            @Html.DropDownListFor(model => model.LocationID, new SelectList(lstToolLocs, "ID", "Location", Model.LocationID), "-- Select Location --", new { @class = "selectBox" })
                            @if (@eTurnsWeb.Helper.SessionHelper.GetModulePermission(eTurnsWeb.Helper.SessionHelper.ModuleList.LocationMaster,
eTurnsWeb.Helper.SessionHelper.PermissionType.Insert) && onlyView == false)
                            {
                                <a onclick="AddNewFromPopup('Tool Location');" id="btnAddToolLocation" class="addNewLink">
                                    (Add New)
                                </a>
                            }
                            <span class="ErrorMessage"> @Html.ValidationMessageFor(m => m.LocationID) </span>
                        </div>
                    </li>
                    @*<li>
                            <div class="editor-label">
                                @Html.LabelFor(model => model.Technician)
                            </div>
                            <div class="editor-field">
                                @Html.DropDownListFor(model => model.TechnicianGuID, new SelectList(lstToolTechs, "GUID", "Technician", Model.TechnicianGuID), new { @class = "selectBox" })
                                @if (@eTurnsWeb.Helper.SessionHelper.GetModulePermission(eTurnsWeb.Helper.SessionHelper.ModuleList.TechnicianMaster,
                                eTurnsWeb.Helper.SessionHelper.PermissionType.Insert) && onlyView == false)
                                {
                                    <a onclick="AddNewFromPopup('Tool Technician');" id="btnAddToolTechnician" class="addNewLink">
                                        (Add New)
                                    </a>
                                }
                            </div>
                        </li>*@
                    @Html.Partial("UDFLayout", new eTurns.DTO.ResToolMaster())
                    @Html.Partial("_DueMaintenance")
                    @if (Model.ID > 0)
                    {
                        <li>
                            <ul>
                                <li>
                                    <h4>
                                        @ResToolMaster.WrittenOffTool
                                    </h4>
                                </li>
                                <li>
                                    <div class="editor-label">
                                        @ResToolMaster.Quantity
                                    </div>
                                    <div class="editor-field">
                                        <input type="text" id="txtWrittenOffQuantity" name="txtWrittenOffQuantity" class="text-box numericinput writtenOffInput" />
                                    </div>
                                </li>
                                <li>
                                    <div class="editor-label">
                                        @ResToolMaster.WrittenOffCategory
                                    </div>
                                    <div class="editor-field">
                                        @Html.DropDownList("ddlCategory", new SelectList(ViewBag.ToolWrittenOffCategories, "ID", "Text"), new { @class = "selectBox writtenOffInput" })
                                    </div>
                                </li>
                                <li>
                                    <div class="editor-label">
                                        @ResToolMaster.WrittenOffDescription
                                    </div>
                                    <div class="editor-field">
                                        <textarea class="text-box writtenOffInput" cols="100" id="WrittenOffDescription" maxlength="1024" name="WrittenOffDescription" rows="10"></textarea>
                                    </div>
                                </li>
                                <li>
                                    <div class="editor-label">
                                        &nbsp;
                                    </div>
                                    <div class="BtnBlockform">
                                        @if (haveToolWrittenOffRights == true)
                                        {
                                            <input type="button" value="@ResToolMaster.WrittenOffTool" id="btnWrittenOffTool" onclick="return WrittenOffTool();" class="CreateBtn writtenOffInput" />
                                            <script>
                                                $('.writtenOffInput').prop("disabled", false);
                                            </script>
                                        }
                                    </div>
                                </li>
                            </ul>
                        </li>
                    }

                </ul>
            </div>
        </div>
    </div>
}
@Html.Partial("_RequiredMessages")
<script type="text/javascript">

    var charCode = '@CharCodeList';

    $("form").submit(function (e) {
        IsClearGlobalFilter = false;
        //$('#NarroSearchClear').click();
        $.validator.unobtrusive.parse("#frmTool");
        if ($(this).valid()) {
            rememberUDFValues($("#hdnPageName").val(), '@Model.ID');
        }
        e.preventDefault();
    });
    $("span#Qty").text(FormatedCostQtyValues($("span#Qty").text(), 2));
</script>
<script language="javascript" type="text/javascript">
    var WrittenOffToolURL = '@Url.Content("~/Assets/WrittenOffTool")';
    var ToolImageType = '@Model.ImageType';
    var ToolImagePath = '@Model.ImagePath';
    var CommonFileExtension = '@SiteSettingHelper.CommonAllowedFileExtension';
    var MsgInvalidFileSelected = '@ResWorkOrder.MsgInvalidFileSelected';
    var MsgvalidFileList = '@ResWorkOrder.MsgvalidFileList';
    function onSuccess(response) {
        IsRefreshGrid = true;
        showNotificationDialog();
        $("#spanGlobalMessage").html(response.Message);
        $("#spanGlobalMessage").removeClass('errorIcon WarningIcon').addClass('succesIcon');
        var idValue = $("#hiddenID").val();
        GetToolsNarrowSearchData(false, false, 'ToolMaster', 'ToolList');
        if (response.Status == "fail") {
            $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
            $("#ToolName").val("");
            $("#ToolName").focus();
        }
        else if (idValue == 0) {
            $("#ToolName").val("");
            $("#ToolName").focus();

            if (response.Status == "duplicate")
                $("#spanGlobalMessage").removeClass('errorIcon succesIcon').addClass('WarningIcon');
            else {
                if ($("#ToolImage").val() != "") {
                    ajaxFileUpload(response.ToolID);
                }
                clearControls('frmTool');
                ShowNewTab('ToolCreate', 'frmTool');
            }
        }
        else if (idValue > 0) {
            if (response.Status == "duplicate") {
                $("#spanGlobalMessage").removeClass('errorIcon succesIcon').addClass('WarningIcon');
                $("#Serial").focus();
            }
            else {
                if ($("#ToolImage").val() != "") {
                    ajaxFileUpload(response.ToolID);
                }
                clearControls('frmTool');
                SwitchTextTab(0, 'ToolCreate', 'frmTool');
                if (TopGlobalSearch != '' && TopGlobalSearch != null && TopGlobalSearch != undefined) {
                    $("#global_filter").val(TopGlobalSearch);
                    $('#global_filter').unbind("keypress");
                    //_Common.setGloblaSearch('global_filter', 'myDataTable', null, null);
                    ////_Common.trimStartGlobalFilter('global_filter');
                    IsClearGlobalFilter = false;
                    if (TopGlobalSearch.length > 2) {
                        $("#myDataTable").dataTable().fnFilter(
                            TopGlobalSearch,
                            null,
                            null,
                            null
                        );
                    }
                }
            }
        }
    }

    function ajaxFileUpload(retid) {
        //starting setting some animation when the ajax starts and completes
        $("#loading")
    .ajaxStart(function () {
        $(this).show();
    })
    .ajaxComplete(function () {
        $(this).hide();
    });

        $.ajaxFileUpload
    (
        {
            url: '/api/fileupload/PostToolFile/' + retid,
            secureuri: false,
            type: "POST",
            fileElementId: 'ToolImage',
            dataType: 'json',
            success: function (data, status) {
            },
            error: function (data, status, e) {
            }
        }
    )
        return false;
    }

    function onFailure(message) {
        $("#spanGlobalMessage").html(message.statusText);
        showNotificationDialog();
        $("#ToolName").focus();
    }

    function FnIsGroupOfItems() {
        if ($("#IsGroupOfItems option:selected")[0].value == 0) { // 0 means false
            $("#Quantity").attr("readonly", true);
            $("#Quantity").val('1');
        }
        else
            $("#Quantity").attr("readonly", false);
    }

    function onlyNumeric(event) {
        var charCode = (event.which) ? event.which : event.keyCode

        if (charCode > 31 && (charCode < 48 || charCode > 57 || code == 86))
            return false;

        return true;

    }


    function CheckBeforeSave() {
        var tmpCheckedOutMQTY = parseInt($('#CheckedOutMQTY').val() == '' ? 0 : $('#CheckedOutMQTY').val(), 10);
        var tmpCheckedOutQTY = parseInt($('#CheckedOutQTY').val() == '' ? 0 : $('#CheckedOutQTY').val(), 10);
        var tmpQuantity = parseInt($('#Quantity').val() == '' ? 0 : $('#Quantity').val(), 10);

        if (tmpQuantity == 0) {
            showNotificationDialog();
            $("#spanGlobalMessage").html('@ResToolMaster.InvalidQuantity');
            $("#spanGlobalMessage").removeClass('errorIcon WarningIcon').addClass('succesIcon');
            return false;
        }
        else if (tmpQuantity < (tmpCheckedOutMQTY + tmpCheckedOutQTY)) {
            showNotificationDialog();
            $("#spanGlobalMessage").html('@ResToolMaster.QuantityGreaterThancheckedOutQty' + (tmpCheckedOutMQTY + tmpCheckedOutQTY));
            $("#spanGlobalMessage").removeClass('errorIcon WarningIcon').addClass('succesIcon');
            return false;
        }
        else
            return true;
    }

    function WrittenOffTool() {
        var availableQuantity = parseInt('@Model.Quantity') - (parseInt('@Model.CheckedOutQTY') + parseInt('@Model.CheckedOutMQTY'))
        var writtenOffQuantity = parseInt($('#txtWrittenOffQuantity').val() == '' ? 0 : $('#txtWrittenOffQuantity').val(), 10);
        var writtenOffCategoryId = parseInt($('#ddlCategory').val());
        var writtenOffDetails = $('#WrittenOffDescription').val();
        //var isGroupOfItems = '@Model.IsGroupOfItems';

        if (writtenOffCategoryId == 0) {
            showNotificationDialog();
            $("#spanGlobalMessage").html('@ResToolMaster.RequiredWrittenoffCategory');
            $("#spanGlobalMessage").removeClass('errorIcon succesIcon').addClass('WarningIcon');
            return false;
        }

        if (writtenOffQuantity <= 0) {
            showNotificationDialog();
            $("#spanGlobalMessage").html('@ResToolMaster.InvalidQuantity');
            $("#spanGlobalMessage").removeClass('errorIcon succesIcon').addClass('WarningIcon');
            return false;
        }
        else if (writtenOffQuantity > availableQuantity) {
            showNotificationDialog();
            $("#spanGlobalMessage").html('@ResToolMaster.QuantityGreaterThanAvailableQty ' + (availableQuantity));
            $("#spanGlobalMessage").removeClass('errorIcon succesIcon').addClass('WarningIcon');
            return false;
        }
        @*else if (parseInt(isGroupOfItems) == 1 && (writtenOffQuantity > (availableQuantity - 1)))
        {
            showNotificationDialog();
            $("#spanGlobalMessage").html('@ResToolMaster.AvailableQtyCantBeLessThanOne');
            $("#spanGlobalMessage").removeClass('errorIcon succesIcon').addClass('WarningIcon');
            return false;
        }*@
        else {
            var arrItemDetails = new Array();
            var ToolWrittenOff = { ToolGUID: '@Model.GUID', Quantity: writtenOffQuantity, ToolWrittenOffCategoryID: writtenOffCategoryId, Details: writtenOffDetails };
            arrItemDetails.push(ToolWrittenOff);

            $.ajax({
                type: "POST",
                url: WrittenOffToolURL,
                contentType: 'application/json',
                dataType: 'json',
                data: JSON.stringify(arrItemDetails),
                success: function (RetData) {
                    var errorMessage = "";
                    $.each(RetData, function (indx, RetDataItem) {
                        if (RetDataItem.ErrorMessage != null && RetDataItem.ErrorMessage != undefined && RetDataItem.ErrorMessage.trim() > '') {
                            errorMessage += RetDataItem.ErrorMessage + "\r\n";
                        }
                    });

                    if (errorMessage == "") {
                        showNotificationDialog();
                        $("#spanGlobalMessage").html('@ResToolMaster.ToolWrittenOffSuccessfully');
                        $("#spanGlobalMessage").removeClass('errorIcon WarningIcon').addClass('succesIcon');
                        $('#frmTool').areYouSure({ 'silent': true });
                        ShowEditTab("ToolEdit/" + '@Model.ID', "frmTool");
                    }
                    else {
                        showNotificationDialog();
                        $("#spanGlobalMessage").html(errorMessage);
                        $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                    }
                },
                error: function (err) {
                    console.log(err);
                    showNotificationDialog();
                    $("#spanGlobalMessage").html('@ResToolMaster.FailToWrittenOffTool');
                    $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                }
            });
        }
    }

    $(document).ready(function () {
        window.location.hash = '';
        $('#frmTool').areYouSure({ 'silent': false });
        var intNotAllowededCode = charCode.split(',');
        if (intNotAllowededCode != null && intNotAllowededCode.length > 0) {
            specialKeys = new Array();
            for (i = 0; i < intNotAllowededCode.length; i++) {
                specialKeys.push(parseInt(intNotAllowededCode[i])); //Backspace
            }
        }

        $('form').areYouSure();
        if (ToolImageType == 'ImagePath' || ToolImageType == '') {
            $("#ToolImage").show();
            $("#ExternalURL").hide();

            if (ToolImagePath != undefined && ToolImagePath != null && ToolImagePath != '') {
                $("#btnDeleteImage").show();
            }
            else {
                $("#btnDeleteImage").hide();
            }
        }
        else {
            $("#ToolImage").hide();
            $("#ExternalURL").show();
            $("#btnDeleteImage").hide();
        }
        $("#ToolImage").change(function () {
            readURL(this);
        });
        //$.ajaxSetup({
        //    beforeSend: function (req) {
        //        $('#DivLoading').show();
        //    },
        //    complete: function (req) {
        //        $('#DivLoading').hide();
        //    }
        //});

        $(".text-boxPriceFormat").priceFormat({
            prefix: '',
            thousandsSeparator: '',
            centsLimit: parseInt($('#hdCostcentsLimit').val(), 10)
        });
        $(".text-boxQuantityFormat").priceFormat({
            prefix: '',
            thousandsSeparator: '',
            centsLimit: parseInt($('#hdQuantitycentsLimit').val(), 10)
        });

        $('#btnCancel').click(function (e) {
            //            if (IsRefreshGrid)
            $('#NarroSearchClear').click();
            SwitchTextTab(0, 'ToolCreate', 'frmTool');
            if (oTable !== undefined && oTable != null) {
                //oTable.fnDraw();
                if (TopGlobalSearch != '' && TopGlobalSearch != null && TopGlobalSearch != undefined) {
                    $("#global_filter").val(TopGlobalSearch);
                    $('#global_filter').unbind("keypress");
                    IsClearGlobalFilter = false;
                    if (TopGlobalSearch.length > 2) {
                        $("#myDataTable").dataTable().fnFilter(
                            TopGlobalSearch,
                            null,
                            null,
                            null
                        );
                    }
                }
                else {
                    oTable.fnDraw();
                }
            }

        });

        checkRememberUDFValues($("#hdnPageName").val(), '@Model.ID');
    });
</script>
<div id="NewMasterPopUP">
</div>
<script type="text/javascript">
    $("#NewMasterPopUP").dialog({
        autoOpen: false,
        show: "blind",
        hide: "explode",
        height: 600,
        width: 800,
        modal: true,
        open: function () {
            $(this).parent().find("span.ui-dialog-title").html("Add New " + $(this).data("data"));
        },
        close: function () {
            $('#DivLoading').show();
            RefreshDropdownList($(this).data("data"), $(this).data("IDVal"));
            $(this).data("data", null);
            $(this).data("IDVal", null);
            $(this).parent().find("span.ui-dialog-title").html('');
        }
    });
    function AddNewFromPopup(PopupFor) {
        $('#DivLoading').show();
        var _URL = ''
        if (PopupFor == 'Tool Category') {
            _URL = '@Url.Action("../Master/ToolCategoryCreate")';
        }
        else if (PopupFor == 'Tool Location') {
            _URL = '@Url.Action("../Master/ToolLocationCreate")';
        }
        else if (PopupFor == 'Tool Technician') {
            _URL = '@Url.Action("../Master/TechnicianCreate")';
        }
        else {
            return false;
        }
        $('#NewMasterPopUP').load(_URL, function () {
            $('#NewMasterPopUP').data("data", PopupFor).dialog('open');
            $('#DivLoading').hide();
        });
    }
    function RefreshDropdownList(PopupFor, IDVal) {
        if (IDVal != undefined) {
            var _ControlID = '';
            if (PopupFor == 'Tool Category') {
                _ControlID = "ToolCategoryID";
            }
            else if (PopupFor == 'Tool Location') {
                _ControlID = "LocationID";
            }
            var arrdata = IDVal.split("~");
            var listData = $('select[id*="' + _ControlID + '"]');
            $(listData).each(function () {
                $(this).append($("<option />").val(arrdata[0]).text(arrdata[1]));
            });
        }
        $('#DivLoading').hide();
    }
    function CheckValidURLForImage(curobj) {
        var strURL = $(curobj).val();
        if (strURL != '' && strURL != null) {

            var validExtension = CommonFileExtension.split(',');
            var strValidationMessage = "";
            var fileExt = strURL.substring(strURL.lastIndexOf('.'));
            if (fileExt.indexOf("/") <= 0) {
                if (validExtension.indexOf(fileExt.toLowerCase()) <= -1) {
                    strValidationMessage = strValidationMessage + strURL + " " + MsgInvalidFileSelected;
                }
                if (strValidationMessage != "") {
                    alert(strValidationMessage + MsgvalidFileList.replace("{0}", validExtension.toString()));
                    $('#previewHolder').attr('src', '/Content/images/no-image.jpg');
                    $("input#ToolImageExternalURL").val('');
                    return;
                }
            }

            $("<img>", {
                src: strURL,
                error: function () {
                    $(curobj).val("");
                    alert('@ResCommon.InvalidURL');
                    curobj.focus();
                    return false;
                },
                load: function () {
                    $('#previewHolder').attr('src', strURL);
                }
            });
        }
        else {
            $('#previewHolder').attr('src', '/Content/images/no-image.jpg');
        }
        return false;
    }
    function ShowImage(currentRadio) {
        var currentId = $(currentRadio).attr("id");

        if (currentId == "ImagePath") {
            $("#ToolImage").show();
            $("#ExternalURL").hide();
            setImagePath();

            $("#btnDeleteImage").hide();
            if ((ToolImagePath != undefined && ToolImagePath != null && ToolImagePath != '') || ($("input#currentpath").val() != '' && $("input#currentpath").val() != '/Content/images/no-image.jpg')) {
                $("#btnDeleteImage").show();
            }

        }
        else {
            CheckValidURLForImage($("input#ToolImageExternalURL"));

            $("#ToolImage").hide();
            $("#ExternalURL").show();
            $("#btnDeleteImage").hide();

        }
    }
    function DeleteToolImage(ToolGUID) {

        $.ajax({
            url: '/Tool/DeleteToolImage',
            data: { 'ToolGUID': ToolGUID },
            dataType: 'json',
            type: 'POST',
            async: false,
            cache: false,
            success: function (response) {
                if (response.status == 'ok') {

                    $('#previewHolder').attr('src', '/Content/images/no-image.jpg');
                    $("input#currentpath").val('/Content/images/no-image.jpg');
                    $("input#ToolImage").val('');
                    $("#btnDeleteImage").hide();
                    ToolImagePath = '';
                }
                else {
                    Status = 'Error';
                    alert("Error");
                }
            }
        });
    }
    function setImagePath() {
        $('#previewHolder').attr('src', $("input#currentpath").val());
    }
    function readURL(input) {

        if (input.files && input.files[0]) {

            var validExtension = CommonFileExtension.split(',');
            var strValidationMessage = "";
            var fileExt = input.files[0].name;
            fileExt = fileExt.substring(fileExt.lastIndexOf('.'));
            if (validExtension.indexOf(fileExt.toLowerCase()) <= -1) {
                strValidationMessage = strValidationMessage + input.files[0].name + " " + MsgInvalidFileSelected;
            }
            if (strValidationMessage != "") {
                alert(strValidationMessage + MsgvalidFileList.replace("{0}", validExtension.toString()));
                $('#previewHolder').attr('src', '/Content/images/no-image.jpg');
                $("input#currentpath").val('');
                $("input#ToolImage").val('');
                $("#btnDeleteImage").hide();
                EnterpriseImagePath = '';
                return;
            }

            var isError = false;
            var objFile = input.files[0];

            for (var n = 0; n < specialKeys.length; n++) {
                if (objFile.name.toString().lastIndexOf(String.fromCharCode(specialKeys[n])) >= 0) {
                    isError = true;
                    break;
                }
            }


            if (isError == true) {
                showNotificationDialog();
                //alert("Please select correct file name.");
                $("#spanGlobalMessage").removeClass('succesIcon WarningIcon').addClass('errorIcon');
                $("#spanGlobalMessage").html('@ResCommon.ValidFileName');

                $("input#currentpath").val('');
                $("input#ToolImage").val('');
            }
            else{
                var reader = new FileReader();
                reader.onload = function (e) {
                    var filePath = $("#currentpath").val().split('\\').pop();

                    if (filePath.toString().indexOf("&") >= 0 || filePath.toString().indexOf("<") >= 0 || filePath.toString().indexOf(">") >= 0
                        || filePath.toString().indexOf("*") >= 0 || filePath.toString().indexOf(":") >= 0
                        || filePath.toString().indexOf("?") >= 0) {
                        alert("Please select correct file name.");
                        $("input#currentpath").val('');
                    }
                    else {
                        $('#previewHolder').attr('src', e.target.result);
                        $("input#currentpath").val(e.target.result);
                        $("#btnDeleteImage").show();
                    }
                }

                reader.readAsDataURL(input.files[0]);
            }
        }
    }
    _Common.addRequiredSign();
</script>
